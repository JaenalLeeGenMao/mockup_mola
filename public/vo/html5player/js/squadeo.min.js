!function(e){if('object'==typeof exports&&'undefined'!=typeof module)module.exports=e();else if('function'==typeof define&&define.amd)define([],e);else{var t;t='undefined'!=typeof window?window:'undefined'!=typeof global?global:'undefined'!=typeof self?self:this,t.Hls=e()}}(function(){var e;return function(){function e(t,r,i){function a(s,o){if(!r[s]){if(!t[s]){var l='function'==typeof require&&require;if(!o&&l)return l(s,!0);if(n)return n(s,!0);var u=new Error("Cannot find module '"+s+"'");throw u.code='MODULE_NOT_FOUND',u}var d=r[s]={ exports:{} };t[s][0].call(d.exports,function(e){return a(t[s][1][e]||e)},d,d.exports,e,t,r,i)}return r[s].exports}for(var n='function'==typeof require&&require,s=0;s<i.length;s++)a(i[s]);return a}return e}()({ 1:[function(e,t,r){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function a(e){return'function'==typeof e}function n(e){return'number'==typeof e}function s(e){return'object'==typeof e&&null!==e}function o(e){return void 0===e}t.exports=i,i.EventEmitter=i,i.prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(e){if(!n(e)||e<0||isNaN(e))throw TypeError('n must be a positive number');return this._maxListeners=e,this},i.prototype.emit=function(e){var t,r,i,n,l,u;if(this._events||(this._events={}),'error'===e&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var d=new Error('Uncaught, unspecified "error" event. ('+t+')');throw d.context=t,d}if(r=this._events[e],o(r))return!1;if(a(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:n=Array.prototype.slice.call(arguments,1),r.apply(this,n)}else if(s(r))for(n=Array.prototype.slice.call(arguments,1),u=r.slice(),i=u.length,l=0;l<i;l++)u[l].apply(this,n);return!0},i.prototype.addListener=function(e,t){var r;if(!a(t))throw TypeError('listener must be a function');return this._events||(this._events={}),this._events.newListener&&this.emit('newListener',e,a(t.listener)?t.listener:t),this._events[e]?s(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,s(this._events[e])&&!this._events[e].warned&&(r=o(this._maxListeners)?i.defaultMaxListeners:this._maxListeners)&&r>0&&this._events[e].length>r&&(this._events[e].warned=!0,console.trace),this},i.prototype.on=i.prototype.addListener,i.prototype.once=function(e,t){function r(){this.removeListener(e,r),i||(i=!0,t.apply(this,arguments))}if(!a(t))throw TypeError('listener must be a function');var i=!1;return r.listener=t,this.on(e,r),this},i.prototype.removeListener=function(e,t){var r,i,n,o;if(!a(t))throw TypeError('listener must be a function');if(!this._events||!this._events[e])return this;if(r=this._events[e],n=r.length,i=-1,r===t||a(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit('removeListener',e,t);else if(s(r)){for(o=n;o-- >0;)if(r[o]===t||r[o].listener&&r[o].listener===t){i=o;break}if(i<0)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(i,1),this._events.removeListener&&this.emit('removeListener',e,t)}return this},i.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)'removeListener'!==t&&this.removeAllListeners(t);return this.removeAllListeners('removeListener'),this._events={},this}if(r=this._events[e],a(r))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},i.prototype.listeners=function(e){return this._events&&this._events[e]?a(this._events[e])?[this._events[e]]:this._events[e].slice():[]},i.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(a(t))return 1;if(t)return t.length}return 0},i.listenerCount=function(e,t){return e.listenerCount(t)}},{}],2:[function(t,r,i){!function(t){var a=/^((?:[a-zA-Z0-9+\-.]+:)?)(\/\/[^\/?#]*)?((?:[^\/\?#]*\/)*.*?)??(;.*?)?(\?.*?)?(#.*?)?$/,n=/^([^\/?#]*)(.*)$/,s=/(?:\/|^)\.(?=\/)/g,o=/(?:\/|^)\.\.\/(?!\.\.\/).*?(?=\/)/g,l={ buildAbsoluteURL:function(e,t,r){if(r=r||{},e=e.trim(),!(t=t.trim())){if(!r.alwaysNormalize)return e;var i=l.parseURL(e);if(!i)throw new Error('Error trying to parse base URL.');return i.path=l.normalizePath(i.path),l.buildURLFromParts(i)}var a=l.parseURL(t);if(!a)throw new Error('Error trying to parse relative URL.');if(a.scheme)return r.alwaysNormalize?(a.path=l.normalizePath(a.path),l.buildURLFromParts(a)):t;var s=l.parseURL(e);if(!s)throw new Error('Error trying to parse base URL.');if(!s.netLoc&&s.path&&'/'!==s.path[0]){var o=n.exec(s.path);s.netLoc=o[1],s.path=o[2]}s.netLoc&&!s.path&&(s.path='/');var u={ scheme:s.scheme,netLoc:a.netLoc,path:null,params:a.params,query:a.query,fragment:a.fragment };if(!a.netLoc&&(u.netLoc=s.netLoc,'/'!==a.path[0]))if(a.path){var d=s.path,f=d.substring(0,d.lastIndexOf('/')+1)+a.path;u.path=l.normalizePath(f)}else u.path=s.path,a.params||(u.params=s.params,a.query||(u.query=s.query));return null===u.path&&(u.path=r.alwaysNormalize?l.normalizePath(a.path):a.path),l.buildURLFromParts(u)},parseURL:function(e){var t=a.exec(e);return t?{ scheme:t[1]||'',netLoc:t[2]||'',path:t[3]||'',params:t[4]||'',query:t[5]||'',fragment:t[6]||'' }:null},normalizePath:function(e){for(e=e.split('').reverse().join('').replace(s,'');e.length!==(e=e.replace(o,'')).length;);return e.split('').reverse().join('')},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment} };'object'==typeof i&&'object'==typeof r?r.exports=l:'function'==typeof e&&e.amd?e([],function(){return l}):'object'==typeof i?i.URLToolkit=l:t.URLToolkit=l}(this)},{}],3:[function(e,t,r){var i=arguments[3],a=arguments[4],n=arguments[5],s=JSON.stringify;t.exports=function(e,t){function r(e){p[e]=!0;for(var t in a[e][1]){var i=a[e][1][t];p[i]||r(i)}}for(var o,l=Object.keys(n),u=0,d=l.length;u<d;u++){var f=l[u],c=n[f].exports;if(c===e||c&&c.default===e){o=f;break}}if(!o){o=Math.floor(Math.pow(16,8)*Math.random()).toString(16);for(var h={},u=0,d=l.length;u<d;u++){var f=l[u];h[f]=f}a[o]=['function(require,module,exports){'+e+'(self); }',h]}var g=Math.floor(Math.pow(16,8)*Math.random()).toString(16),v={};v[o]=o,a[g]=['function(require,module,exports){var f = require('+s(o)+');(f.default ? f.default : f)(self);}',v];var p={};r(g);var y='('+i+')({'+Object.keys(p).map(function(e){return s(e)+':['+a[e][0]+','+s(a[e][1])+']'}).join(',')+'},{},['+s(g)+'])',m=window.URL||window.webkitURL||window.mozURL||window.msURL,E=new Blob([y],{ type:'text/javascript' });if(t&&t.bare)return E;var b=m.createObjectURL(E),T=new Worker(b);return T.objectURL=b,T}},{}],4:[function(e,t,r){'use strict';function i(e){return e&&e.__esModule?e:{ default:e }}Object.defineProperty(r,'__esModule',{ value:!0 }),r.hlsDefaultConfig=void 0;var a=e(5),n=i(a),s=e(8),o=i(s),l=e(9),u=i(l),d=e(10),f=i(d),c=e(58),h=i(c),g=e(7),v=i(g),p=e(6),y=i(p),m=e(50),E=i(m),b=e(16),T=i(b),k=e(15),_=i(k),R=e(14),A=i(R);r.hlsDefaultConfig={ autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,initialLiveManifestSize:1,maxBufferLength:30,maxBufferSize:6e7,maxBufferHole:.5,maxSeekHole:2,lowBufferWatchdogPeriod:.5,highBufferWatchdogPeriod:3,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxMaxBufferLength:600,enableWorker:!0,enableSoftwareAES:!0,manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,startLevel:void 0,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3,fragLoadingLoopThreshold:3,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:h.default,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,fetchSetup:void 0,abrController:n.default,bufferController:o.default,capLevelController:u.default,fpsController:f.default,audioStreamController:y.default,audioTrackController:v.default,subtitleStreamController:A.default,subtitleTrackController:_.default,timelineController:T.default,cueHandler:E.default,enableCEA708Captions:!0,enableWebVTT:!0,captionsTextTrack1Label:'English',captionsTextTrack1LanguageCode:'en',captionsTextTrack2Label:'Spanish',captionsTextTrack2LanguageCode:'es',stretchShortVideoTrack:!1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0 }},{ 10:10,14:14,15:15,16:16,5:5,50:50,58:58,6:6,7:7,8:8,9:9 }],5:[function(e,t,r){'use strict';function i(e){return e&&e.__esModule?e:{ default:e }}function a(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||'object'!=typeof t&&'function'!=typeof t?e:t}function s(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+typeof t);e.prototype=Object.create(t&&t.prototype,{ constructor:{ value:e,enumerable:!1,writable:!0,configurable:!0 } }),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,'__esModule',{ value:!0 });var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,'value'in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=e(35),u=i(l),d=e(34),f=i(d),c=e(37),h=i(c),g=e(33),v=e(53),p=e(51),y=i(p),m=function(e){function t(e){a(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.FRAG_LOADING,u.default.FRAG_LOADED,u.default.FRAG_BUFFERED,u.default.ERROR));return r.lastLoadedFragLevel=0,r._nextAutoLevel=-1,r.hls=e,r.onCheck=r._abandonRulesCheck.bind(r),r}return s(t,e),o(t,[{ key:'destroy',value:function(){this.clearTimer(),f.default.prototype.destroy.call(this)} },{ key:'onFragLoading',value:function(e){var t=e.frag;if('main'===t.type){if(this.timer||(this.timer=setInterval(this.onCheck,100)),!this._bwEstimator){var r=this.hls,i=e.frag.level,a=r.levels[i].details.live,n=r.config,s=void 0,o=void 0;a?(s=n.abrEwmaFastLive,o=n.abrEwmaSlowLive):(s=n.abrEwmaFastVoD,o=n.abrEwmaSlowVoD),this._bwEstimator=new y.default(r,o,s,n.abrEwmaDefaultEstimate)}this.fragCurrent=t}} },{ key:'_abandonRulesCheck',value:function(){var e=this.hls,t=e.media,r=this.fragCurrent,i=r.loader,a=e.minAutoLevel;if(!i||i.stats&&i.stats.aborted)return v.logger.warn('frag loader destroy or aborted, disarm abandonRules'),void this.clearTimer();var n=i.stats;if(t&&(!t.paused&&0!==t.playbackRate||!t.readyState)&&r.autoLevel&&r.level){var s=performance.now()-n.trequest,o=Math.abs(t.playbackRate);if(s>500*r.duration/o){var l=e.levels,d=Math.max(1,n.bw?n.bw/8:1e3*n.loaded/s),f=l[r.level],c=f.realBitrate?Math.max(f.realBitrate,f.bitrate):f.bitrate,g=n.total?n.total:Math.max(n.loaded,Math.round(r.duration*c/8)),p=t.currentTime,y=(g-n.loaded)/d,m=(h.default.bufferInfo(t,p,e.config.maxBufferHole).end-p)/o;if(m<2*r.duration/o&&y>m){var E=void 0,b=void 0;for(b=r.level-1;b>a;b--){var T=l[b].realBitrate?Math.max(l[b].realBitrate,l[b].bitrate):l[b].bitrate;if((E=r.duration*T/(6.4*d))<m)break}E<y&&(v.logger.warn('loading too slow, abort fragment loading and switch to level '+b+':fragLoadedDelay['+b+']<fragLoadedDelay['+(r.level-1)+'];bufferStarvationDelay:'+E.toFixed(1)+'<'+y.toFixed(1)+':'+m.toFixed(1)),e.nextLoadLevel=b,this._bwEstimator.sample(s,n.loaded),i.abort(),this.clearTimer(),e.trigger(u.default.FRAG_LOAD_EMERGENCY_ABORTED,{ frag:r,stats:n }))}}}} },{ key:'onFragLoaded',value:function(e){var t=e.frag;if('main'===t.type&&!isNaN(t.sn)){if(this.clearTimer(),this.lastLoadedFragLevel=t.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var r=this.hls.levels[t.level],i=(r.loaded?r.loaded.bytes:0)+e.stats.loaded,a=(r.loaded?r.loaded.duration:0)+e.frag.duration;r.loaded={ bytes:i,duration:a },r.realBitrate=Math.round(8*i/a)}if(e.frag.bitrateTest){var n=e.stats;n.tparsed=n.tbuffered=n.tload,this.onFragBuffered(e)}}} },{ key:'onFragBuffered',value:function(e){var t=e.stats,r=e.frag;if(!(!0===t.aborted||1!==r.loadCounter||'main'!==r.type||isNaN(r.sn)||r.bitrateTest&&t.tload!==t.tbuffered)){var i=t.tparsed-t.trequest;v.logger.log('latency/loading/parsing/append/kbps:'+Math.round(t.tfirst-t.trequest)+'/'+Math.round(t.tload-t.tfirst)+'/'+Math.round(t.tparsed-t.tload)+'/'+Math.round(t.tbuffered-t.tparsed)+'/'+Math.round(8*t.loaded/(t.tbuffered-t.trequest))),this._bwEstimator.sample(i,t.loaded),t.bwEstimate=this._bwEstimator.getEstimate(),r.bitrateTest?this.bitrateTestDelay=i/1e3:this.bitrateTestDelay=0}} },{ key:'onError',value:function(e){switch(e.details){case g.ErrorDetails.FRAG_LOAD_ERROR:case g.ErrorDetails.FRAG_LOAD_TIMEOUT:this.clearTimer()}} },{ key:'clearTimer',value:function(){this.timer&&(clearInterval(this.timer),this.timer=null)} },{ key:'_findBestLevel',value:function(e,t,r,i,a,n,s,o,l){for(var u=a;u>=i;u--){var d=l[u],f=d.details,c=f?f.totalduration/f.fragments.length:t,h=!!f&&f.live,g=void 0;g=u<=e?s*r:o*r;var p=l[u].realBitrate?Math.max(l[u].realBitrate,l[u].bitrate):l[u].bitrate,y=p*c/g;if(v.logger.trace('level/adjustedbw/bitrate/avgDuration/maxFetchDuration/fetchDuration: '+u+'/'+Math.round(g)+'/'+p+'/'+c+'/'+n+'/'+y),g>p&&(!y||h&&!this.bitrateTestDelay||y<n))return u}return-1} },{ key:'nextAutoLevel',get:function(){var e=this._nextAutoLevel,t=this._bwEstimator;if(!(-1===e||t&&t.canEstimate()))return e;var r=this._nextABRAutoLevel;return-1!==e&&(r=Math.min(e,r)),r},set:function(e){this._nextAutoLevel=e} },{ key:'_nextABRAutoLevel',get:function(){var e=this.hls,t=e.maxAutoLevel,r=e.levels,i=e.config,a=e.minAutoLevel,n=e.media,s=this.lastLoadedFragLevel,o=this.fragCurrent?this.fragCurrent.duration:0,l=n?n.currentTime:0,u=n&&0!==n.playbackRate?Math.abs(n.playbackRate):1,d=this._bwEstimator?this._bwEstimator.getEstimate():i.abrEwmaDefaultEstimate,f=(h.default.bufferInfo(n,l,i.maxBufferHole).end-l)/u,c=this._findBestLevel(s,o,d,a,t,f,i.abrBandWidthFactor,i.abrBandWidthUpFactor,r);if(c>=0)return c;v.logger.trace('rebuffering expected to happen, lets try to find a quality level minimizing the rebuffering');var g=o?Math.min(o,i.maxStarvationDelay):i.maxStarvationDelay,p=i.abrBandWidthFactor,y=i.abrBandWidthUpFactor;if(0===f){var m=this.bitrateTestDelay;if(m){g=(o?Math.min(o,i.maxLoadingDelay):i.maxLoadingDelay)-m,v.logger.trace('bitrate test took '+Math.round(1e3*m)+'ms, set first fragment max fetchDuration to '+Math.round(1e3*g)+' ms'),p=y=1}}return c=this._findBestLevel(s,o,d,a,t,f+g,p,y,r),Math.max(c,0)} }]),t}(f.default);r.default=m},{ 33:33,34:34,35:35,37:37,51:51,53:53 }],6:[function(e,t,r){'use strict';function i(e){return e&&e.__esModule?e:{ default:e }}function a(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||'object'!=typeof t&&'function'!=typeof t?e:t}function s(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+typeof t);e.prototype=Object.create(t&&t.prototype,{ constructor:{ value:e,enumerable:!1,writable:!0,configurable:!0 } }),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,'__esModule',{ value:!0 });var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,'value'in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=e(48),u=i(l),d=e(37),f=i(d),c=e(25),h=i(c),g=e(35),v=i(g),p=e(34),y=i(p),m=e(38),E=i(m),b=e(54),T=i(b),k=e(33),_=e(53),R={ STOPPED:'STOPPED',STARTING:'STARTING',IDLE:'IDLE',PAUSED:'PAUSED',KEY_LOADING:'KEY_LOADING',FRAG_LOADING:'FRAG_LOADING',FRAG_LOADING_WAITING_RETRY:'FRAG_LOADING_WAITING_RETRY',WAITING_TRACK:'WAITING_TRACK',PARSING:'PARSING',PARSED:'PARSED',BUFFER_FLUSHING:'BUFFER_FLUSHING',ENDED:'ENDED',ERROR:'ERROR',WAITING_INIT_PTS:'WAITING_INIT_PTS' },A=function(e){function t(e){a(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,v.default.MEDIA_ATTACHED,v.default.MEDIA_DETACHING,v.default.AUDIO_TRACKS_UPDATED,v.default.AUDIO_TRACK_SWITCHING,v.default.AUDIO_TRACK_LOADED,v.default.KEY_LOADED,v.default.FRAG_LOADED,v.default.FRAG_PARSING_INIT_SEGMENT,v.default.FRAG_PARSING_DATA,v.default.FRAG_PARSED,v.default.ERROR,v.default.BUFFER_CREATED,v.default.BUFFER_APPENDED,v.default.BUFFER_FLUSHED,v.default.INIT_PTS_FOUND));return r.config=e.config,r.audioCodecSwap=!1,r.ticks=0,r._state=R.STOPPED,r.ontick=r.tick.bind(r),r.initPTS=[],r.waitingFragment=null,r}return s(t,e),o(t,[{ key:'destroy',value:function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),y.default.prototype.destroy.call(this),this.state=R.STOPPED} },{ key:'onInitPtsFound',value:function(e){var t=e.id,r=e.frag.cc,i=e.initPTS;'main'===t&&(this.initPTS[r]=i,_.logger.log('InitPTS for cc:'+r+' found from video track:'+i),this.state===R.WAITING_INIT_PTS&&(_.logger.log('sending pending audio frag to demuxer'),this.state=R.FRAG_LOADING,this.onFragLoaded(this.waitingFragment),this.waitingFragment=null))} },{ key:'startLoad',value:function(e){if(this.tracks){var t=this.lastCurrentTime;this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.fragLoadError=0,t>0&&-1===e?(_.logger.log('audio:override startPosition with lastCurrentTime @'+t.toFixed(3)),this.state=R.IDLE):(this.lastCurrentTime=this.startPosition?this.startPosition:e,this.state=R.STARTING),this.nextLoadPosition=this.startPosition=this.lastCurrentTime,this.tick()}else this.startPosition=e,this.state=R.STOPPED} },{ key:'stopLoad',value:function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=R.STOPPED} },{ key:'tick',value:function(){1===++this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)} },{ key:'doTick',value:function(){var e,t,r,i=this.hls,a=i.config;switch(this.state){case R.ERROR:case R.PAUSED:case R.BUFFER_FLUSHING:break;case R.STARTING:this.state=R.WAITING_TRACK,this.loadedmetadata=!1;break;case R.IDLE:var n=this.tracks;if(!n)break;if(!this.media&&(this.startFragRequested||!a.startFragPrefetch))break;e=this.loadedmetadata?this.media.currentTime:this.nextLoadPosition;var s=this.mediaBuffer?this.mediaBuffer:this.media,o=f.default.bufferInfo(s,e,a.maxBufferHole),l=o.len,d=o.end,c=this.fragPrevious,h=a.maxMaxBufferLength,g=this.audioSwitch,p=this.trackId;if((l<h||g)&&p<n.length){if(void 0===(r=n[p].details)){this.state=R.WAITING_TRACK;break}if(!g&&!r.live&&c&&c.sn===r.endSN&&(!this.media.seeking||this.media.duration-d<c.duration/2)){this.hls.trigger(v.default.BUFFER_EOS,{ type:'audio' }),this.state=R.ENDED;break}var y=r.fragments,m=y.length,E=y[0].start,b=y[m-1].start+y[m-1].duration,T=void 0;if(g)if(r.live&&!r.PTSKnown)_.logger.log('switching audiotrack, live stream, unknown PTS,load first fragment'),d=0;else if(d=e,r.PTSKnown&&e<E){if(!(o.end>E||o.nextStart))return;_.logger.log('alt audio track ahead of main track, seek to start of alt audio track'),this.media.currentTime=E+.05}if(r.initSegment&&!r.initSegment.data)T=r.initSegment;else if(d<=E){if(T=y[0],r.live&&T.loadIdx&&T.loadIdx===this.fragLoadIdx){var A=o.nextStart?o.nextStart:E;return _.logger.log('no alt audio available @currentTime:'+this.media.currentTime+', seeking @'+(A+.05)),void(this.media.currentTime=A+.05)}}else{var S=void 0,L=a.maxFragLookUpTolerance,w=c?y[c.sn-y[0].sn+1]:void 0,D=function(e){var t=Math.min(L,e.duration);return e.start+e.duration-t<=d?1:e.start-t>d&&e.start?-1:0};d<b?(d>b-L&&(L=0),S=w&&!D(w)?w:u.default.search(y,D)):S=y[m-1],S&&(T=S,E=S.start,c&&T.level===c.level&&T.sn===c.sn&&(T.sn<r.endSN?(T=y[T.sn+1-r.startSN],_.logger.log('SN just loaded, load next one: '+T.sn)):T=null))}if(T)if(T.decryptdata&&null!=T.decryptdata.uri&&null==T.decryptdata.key)_.logger.log('Loading key for '+T.sn+' of ['+r.startSN+' ,'+r.endSN+'],track '+p),this.state=R.KEY_LOADING,i.trigger(v.default.KEY_LOADING,{ frag:T });else{if(_.logger.log('Loading '+T.sn+' of ['+r.startSN+' ,'+r.endSN+'],track '+p+', currentTime:'+e+',bufferEnd:'+d.toFixed(3)),void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,T.loadCounter){T.loadCounter++;var O=a.fragLoadingLoopThreshold;if(T.loadCounter>O&&Math.abs(this.fragLoadIdx-T.loadIdx)<O)return void i.trigger(v.default.ERROR,{ type:k.ErrorTypes.MEDIA_ERROR,details:k.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:T })}else T.loadCounter=1;T.loadIdx=this.fragLoadIdx,this.fragCurrent=T,this.startFragRequested=!0,isNaN(T.sn)||(this.nextLoadPosition=T.start+T.duration),i.trigger(v.default.FRAG_LOADING,{ frag:T }),this.state=R.FRAG_LOADING}}break;case R.WAITING_TRACK:t=this.tracks[this.trackId],t&&t.details&&(this.state=R.IDLE);break;case R.FRAG_LOADING_WAITING_RETRY:var I=performance.now(),P=this.retryDate;s=this.media;var C=s&&s.seeking;(!P||I>=P||C)&&(_.logger.log('audioStreamController: retryDate reached, switch back to IDLE state'),this.state=R.IDLE);break;case R.WAITING_INIT_PTS:case R.STOPPED:case R.FRAG_LOADING:case R.PARSING:case R.PARSED:case R.ENDED:}} },{ key:'onMediaAttached',value:function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener('seeking',this.onvseeking),t.addEventListener('ended',this.onvended);var r=this.config;this.tracks&&r.autoStartLoad&&this.startLoad(r.startPosition)} },{ key:'onMediaDetaching',value:function(){var e=this.media;e&&e.ended&&(_.logger.log('MSE detaching and video ended, reset startPosition'),this.startPosition=this.lastCurrentTime=0);var t=this.tracks;t&&t.forEach(function(e){e.details&&e.details.fragments.forEach(function(e){e.loadCounter=void 0})}),e&&(e.removeEventListener('seeking',this.onvseeking),e.removeEventListener('ended',this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()} },{ key:'onMediaSeeking',value:function(){this.state===R.ENDED&&(this.state=R.IDLE),this.media&&(this.lastCurrentTime=this.media.currentTime),void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold),this.tick()} },{ key:'onMediaEnded',value:function(){this.startPosition=this.lastCurrentTime=0} },{ key:'onAudioTracksUpdated',value:function(e){_.logger.log('audio tracks updated'),this.tracks=e.audioTracks} },{ key:'onAudioTrackSwitching',value:function(e){var t=!!e.url;this.trackId=e.id,this.state=R.IDLE,this.fragCurrent=null,this.state=R.PAUSED,this.waitingFragment=null,t?this.timer||(this.timer=setInterval(this.ontick,100)):this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),t&&(this.audioSwitch=!0,this.state=R.IDLE,void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold)),this.tick()} },{ key:'onAudioTrackLoaded',value:function(e){var t=e.details,r=e.id,i=this.tracks[r],a=t.totalduration,n=0;if(_.logger.log('track '+r+' loaded ['+t.startSN+','+t.endSN+'],duration:'+a),t.live){var s=i.details;s&&t.fragments.length>0?(E.default.mergeDetails(s,t),n=t.fragments[0].start,t.PTSKnown?_.logger.log('live audio playlist sliding:'+n.toFixed(3)):_.logger.log('live audio playlist - outdated PTS, unknown sliding')):(t.PTSKnown=!1,_.logger.log('live audio playlist - first load, unknown sliding'))}else t.PTSKnown=!1;if(i.details=t,!this.startFragRequested){if(-1===this.startPosition){var o=t.startTimeOffset;isNaN(o)?this.startPosition=0:(_.logger.log('start time offset found in playlist, adjust startPosition to '+o),this.startPosition=o)}this.nextLoadPosition=this.startPosition}this.state===R.WAITING_TRACK&&(this.state=R.IDLE),this.tick()} },{ key:'onKeyLoaded',value:function(){this.state===R.KEY_LOADING&&(this.state=R.IDLE,this.tick())} },{ key:'onFragLoaded',value:function(e){var t=this.fragCurrent,r=e.frag;if(this.state===R.FRAG_LOADING&&t&&'audio'===r.type&&r.level===t.level&&r.sn===t.sn){var i=this.tracks[this.trackId],a=i.details,n=a.totalduration,s=t.level,o=t.sn,l=t.cc,u=this.config.defaultAudioCodec||i.audioCodec||'mp4a.40.2',d=this.stats=e.stats;if('initSegment'===o)this.state=R.IDLE,d.tparsed=d.tbuffered=performance.now(),a.initSegment.data=e.payload,this.hls.trigger(v.default.FRAG_BUFFERED,{ stats:d,frag:t,id:'audio' }),this.tick();else{this.state=R.PARSING,this.appended=!1,this.demuxer||(this.demuxer=new h.default(this.hls,'audio'));var f=this.initPTS[l],c=a.initSegment?a.initSegment.data:[];if(a.initSegment||void 0!==f){this.pendingBuffering=!0,_.logger.log('Demuxing '+o+' of ['+a.startSN+' ,'+a.endSN+'],track '+s);this.demuxer.push(e.payload,c,u,null,t,n,!1,f)}else _.logger.log('unknown video PTS for continuity counter '+l+', waiting for video PTS before demuxing audio frag '+o+' of ['+a.startSN+' ,'+a.endSN+'],track '+s),this.waitingFragment=e,this.state=R.WAITING_INIT_PTS}}this.fragLoadError=0} },{ key:'onFragParsingInitSegment',value:function(e){var t=this.fragCurrent,r=e.frag;if(t&&'audio'===e.id&&r.sn===t.sn&&r.level===t.level&&this.state===R.PARSING){var i=e.tracks,a=void 0;if(i.video&&delete i.video,a=i.audio){a.levelCodec='mp4a.40.2',a.id=e.id,this.hls.trigger(v.default.BUFFER_CODECS,i),_.logger.log('audio track:audio,container:'+a.container+',codecs[level/parsed]=['+a.levelCodec+'/'+a.codec+']');var n=a.initSegment;if(n){var s={ type:'audio',data:n,parent:'audio',content:'initSegment' };this.audioSwitch?this.pendingData=[s]:(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(v.default.BUFFER_APPENDING,s))}this.tick()}}} },{ key:'onFragParsingData',value:function(e){var t=this,r=this.fragCurrent,i=e.frag;if(r&&'audio'===e.id&&'audio'===e.type&&i.sn===r.sn&&i.level===r.level&&this.state===R.PARSING){var a=this.trackId,n=this.tracks[a],s=this.hls;isNaN(e.endPTS)&&(e.endPTS=e.startPTS+r.duration,e.endDTS=e.startDTS+r.duration),_.logger.log('parsed '+e.type+',PTS:['+e.startPTS.toFixed(3)+','+e.endPTS.toFixed(3)+'],DTS:['+e.startDTS.toFixed(3)+'/'+e.endDTS.toFixed(3)+'],nb:'+e.nb),E.default.updateFragPTSDTS(n.details,r,e.startPTS,e.endPTS);var o=this.audioSwitch,l=this.media,u=!1;if(o&&l)if(l.readyState){var d=l.currentTime;_.logger.log('switching audio track : currentTime:'+d),d>=e.startPTS&&(_.logger.log('switching audio track : flushing all audio'),this.state=R.BUFFER_FLUSHING,s.trigger(v.default.BUFFER_FLUSHING,{ startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:'audio' }),u=!0,this.audioSwitch=!1,s.trigger(v.default.AUDIO_TRACK_SWITCHED,{ id:a }))}else this.audioSwitch=!1,s.trigger(v.default.AUDIO_TRACK_SWITCHED,{ id:a });var f=this.pendingData;this.audioSwitch||([e.data1,e.data2].forEach(function(t){t&&t.length&&f.push({ type:e.type,data:t,parent:'audio',content:'data' })}),!u&&f.length&&(f.forEach(function(e){t.state===R.PARSING&&(t.pendingBuffering=!0,t.hls.trigger(v.default.BUFFER_APPENDING,e))}),this.pendingData=[],this.appended=!0)),this.tick()}} },{ key:'onFragParsed',value:function(e){var t=this.fragCurrent,r=e.frag;t&&'audio'===e.id&&r.sn===t.sn&&r.level===t.level&&this.state===R.PARSING&&(this.stats.tparsed=performance.now(),this.state=R.PARSED,this._checkAppendedParsed())} },{ key:'onBufferCreated',value:function(e){var t=e.tracks.audio;t&&(this.mediaBuffer=t.buffer,this.loadedmetadata=!0)} },{ key:'onBufferAppended',value:function(e){if('audio'===e.parent){var t=this.state;t!==R.PARSING&&t!==R.PARSED||(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}} },{ key:'_checkAppendedParsed',value:function(){if(!(this.state!==R.PARSED||this.appended&&this.pendingBuffering)){var e=this.fragCurrent,t=this.stats,r=this.hls;if(e){this.fragPrevious=e,t.tbuffered=performance.now(),r.trigger(v.default.FRAG_BUFFERED,{ stats:t,frag:e,id:'audio' });var i=this.mediaBuffer?this.mediaBuffer:this.media;_.logger.log('audio buffered : '+T.default.toString(i.buffered)),this.audioSwitch&&this.appended&&(this.audioSwitch=!1,r.trigger(v.default.AUDIO_TRACK_SWITCHED,{ id:this.trackId })),this.state=R.IDLE}this.tick()}} },{ key:'onError',value:function(e){var t=e.frag;if(!t||'audio'===t.type)switch(e.details){case k.ErrorDetails.FRAG_LOAD_ERROR:case k.ErrorDetails.FRAG_LOAD_TIMEOUT:if(!e.fatal){var r=this.fragLoadError;r?r++:r=1;var i=this.config;if(r<=i.fragLoadingMaxRetry){this.fragLoadError=r,t.loadCounter=0;var a=Math.min(Math.pow(2,r-1)*i.fragLoadingRetryDelay,i.fragLoadingMaxRetryTimeout);_.logger.warn('audioStreamController: frag loading failed, retry in '+a+' ms'),this.retryDate=performance.now()+a,this.state=R.FRAG_LOADING_WAITING_RETRY}else _.logger.error('audioStreamController: '+e.details+' reaches max retry, redispatch as fatal ...'),e.fatal=!0,this.state=R.ERROR}break;case k.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case k.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case k.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case k.ErrorDetails.KEY_LOAD_ERROR:case k.ErrorDetails.KEY_LOAD_TIMEOUT:this.state!==R.ERROR&&(this.state=e.fatal?R.ERROR:R.IDLE,_.logger.warn('audioStreamController: '+e.details+' while loading frag,switch to '+this.state+' state ...'));break;case k.ErrorDetails.BUFFER_FULL_ERROR:if('audio'===e.parent&&(this.state===R.PARSING||this.state===R.PARSED)){var n=this.mediaBuffer,s=this.media.currentTime;if(n&&f.default.isBuffered(n,s)&&f.default.isBuffered(n,s+.5)){var o=this.config;o.maxMaxBufferLength>=o.maxBufferLength&&(o.maxMaxBufferLength/=2,_.logger.warn('audio:reduce max buffer length to '+o.maxMaxBufferLength+'s'),this.fragLoadIdx+=2*o.fragLoadingLoopThreshold),this.state=R.IDLE}else _.logger.warn('buffer full error also media.currentTime is not buffered, flush audio buffer'),this.fragCurrent=null,this.state=R.BUFFER_FLUSHING,this.hls.trigger(v.default.BUFFER_FLUSHING,{ startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:'audio' })}}} },{ key:'onBufferFlushed',value:function(){var e=this,t=this.pendingData;t&&t.length?(_.logger.log('appending pending audio data on Buffer Flushed'),t.forEach(function(t){e.hls.trigger(v.default.BUFFER_APPENDING,t)}),this.appended=!0,this.pendingData=[],this.state=R.PARSED):(this.state=R.IDLE,this.fragPrevious=null,this.tick())} },{ key:'state',set:function(e){if(this.state!==e){var t=this.state;this._state=e,_.logger.log('audio stream:'+t+'->'+e)}},get:function(){return this._state} }]),t}(y.default);r.default=A},{ 25:25,33:33,34:34,35:35,37:37,38:38,48:48,53:53,54:54 }],7:[function(e,t,r){'use strict';function i(e){return e&&e.__esModule?e:{ default:e }}function a(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||'object'!=typeof t&&'function'!=typeof t?e:t}function s(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+typeof t);e.prototype=Object.create(t&&t.prototype,{ constructor:{ value:e,enumerable:!1,writable:!0,configurable:!0 } }),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,'__esModule',{ value:!0 });var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,'value'in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){
return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=e(35),u=i(l),d=e(34),f=i(d),c=e(53),h=function(e){function t(e){a(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.MANIFEST_LOADING,u.default.MANIFEST_LOADED,u.default.AUDIO_TRACK_LOADED));return r.ticks=0,r.ontick=r.tick.bind(r),r}return s(t,e),o(t,[{ key:'destroy',value:function(){f.default.prototype.destroy.call(this)} },{ key:'tick',value:function(){1===++this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)} },{ key:'doTick',value:function(){this.updateTrack(this.trackId)} },{ key:'onManifestLoading',value:function(){this.tracks=[],this.trackId=-1} },{ key:'onManifestLoaded',value:function(e){var t=this,r=e.audioTracks||[],i=!1;this.tracks=r,this.hls.trigger(u.default.AUDIO_TRACKS_UPDATED,{ audioTracks:r });var a=0;r.forEach(function(e){if(e.default)return t.audioTrack=a,void(i=!0);a++}),!1===i&&r.length&&(c.logger.log('no default audio track defined, use first audio track as default'),this.audioTrack=0)} },{ key:'onAudioTrackLoaded',value:function(e){e.id<this.tracks.length&&(c.logger.log('audioTrack '+e.id+' loaded'),this.tracks[e.id].details=e.details,e.details.live&&!this.timer&&(this.timer=setInterval(this.ontick,1e3*e.details.targetduration)),!e.details.live&&this.timer&&(clearInterval(this.timer),this.timer=null))} },{ key:'setAudioTrackInternal',value:function(e){if(e>=0&&e<this.tracks.length){this.timer&&(clearInterval(this.timer),this.timer=null),this.trackId=e,c.logger.log('switching to audioTrack '+e);var t=this.tracks[e],r=this.hls,i=t.type,a=t.url,n={ id:e,type:i,url:a };r.trigger(u.default.AUDIO_TRACK_SWITCH,n),r.trigger(u.default.AUDIO_TRACK_SWITCHING,n);var s=t.details;!a||void 0!==s&&!0!==s.live||(c.logger.log('(re)loading playlist for audioTrack '+e),r.trigger(u.default.AUDIO_TRACK_LOADING,{ url:a,id:e }))}} },{ key:'updateTrack',value:function(e){if(e>=0&&e<this.tracks.length){this.timer&&(clearInterval(this.timer),this.timer=null),this.trackId=e,c.logger.log('updating audioTrack '+e);var t=this.tracks[e],r=t.url,i=t.details;!r||void 0!==i&&!0!==i.live||(c.logger.log('(re)loading playlist for audioTrack '+e),this.hls.trigger(u.default.AUDIO_TRACK_LOADING,{ url:r,id:e }))}} },{ key:'audioTracks',get:function(){return this.tracks} },{ key:'audioTrack',get:function(){return this.trackId},set:function(e){this.trackId===e&&void 0!==this.tracks[e].details||this.setAudioTrackInternal(e)} }]),t}(f.default);r.default=h},{ 34:34,35:35,53:53 }],8:[function(e,t,r){'use strict';function i(e){return e&&e.__esModule?e:{ default:e }}function a(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||'object'!=typeof t&&'function'!=typeof t?e:t}function s(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+typeof t);e.prototype=Object.create(t&&t.prototype,{ constructor:{ value:e,enumerable:!1,writable:!0,configurable:!0 } }),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,'__esModule',{ value:!0 });var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,'value'in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=e(35),u=i(l),d=e(34),f=i(d),c=e(53),h=e(33),g=function(e){function t(e){a(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.MEDIA_ATTACHING,u.default.MEDIA_DETACHING,u.default.MANIFEST_PARSED,u.default.BUFFER_RESET,u.default.BUFFER_APPENDING,u.default.BUFFER_CODECS,u.default.BUFFER_EOS,u.default.BUFFER_FLUSHING,u.default.LEVEL_PTS_UPDATED,u.default.LEVEL_UPDATED));return r._msDuration=null,r._levelDuration=null,r.onsbue=r.onSBUpdateEnd.bind(r),r.onsbe=r.onSBUpdateError.bind(r),r.pendingTracks={},r.tracks={},r}return s(t,e),o(t,[{ key:'destroy',value:function(){f.default.prototype.destroy.call(this)} },{ key:'onLevelPtsUpdated',value:function(e){var t=e.type,r=this.tracks.audio;if('audio'===t&&r&&'audio/mpeg'===r.container){var i=this.sourceBuffer.audio;if(Math.abs(i.timestampOffset-e.start)>.1){var a=i.updating;try{i.abort()}catch(e){a=!0,c.logger.warn('can not abort audio buffer: '+e)}a?this.audioTimestampOffset=e.start:(c.logger.warn('change mpeg audio timestamp offset from '+i.timestampOffset+' to '+e.start),i.timestampOffset=e.start)}}} },{ key:'onManifestParsed',value:function(e){var t=e.audio,r=e.video,i=0;e.altAudio&&(t||r)&&(i=(t?1:0)+(r?1:0),c.logger.log(i+' sourceBuffer(s) expected')),this.sourceBufferNb=i} },{ key:'onMediaAttaching',value:function(e){var t=this.media=e.media;if(t){var r=this.mediaSource=new MediaSource;this.onmso=this.onMediaSourceOpen.bind(this),this.onmse=this.onMediaSourceEnded.bind(this),this.onmsc=this.onMediaSourceClose.bind(this),r.addEventListener('sourceopen',this.onmso),r.addEventListener('sourceended',this.onmse),r.addEventListener('sourceclose',this.onmsc),t.src=URL.createObjectURL(r)}} },{ key:'onMediaDetaching',value:function(){c.logger.log('media source detaching');var e=this.mediaSource;if(e){if('open'===e.readyState)try{e.endOfStream()}catch(e){c.logger.warn('onMediaDetaching:'+e.message+' while calling endOfStream')}e.removeEventListener('sourceopen',this.onmso),e.removeEventListener('sourceended',this.onmse),e.removeEventListener('sourceclose',this.onmsc),this.media&&(URL.revokeObjectURL(this.media.src),this.media.removeAttribute('src'),this.media.load()),this.mediaSource=null,this.media=null,this.pendingTracks={},this.tracks={},this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0}this.onmso=this.onmse=this.onmsc=null,this.hls.trigger(u.default.MEDIA_DETACHED)} },{ key:'onMediaSourceOpen',value:function(){c.logger.log('media source opened'),this.hls.trigger(u.default.MEDIA_ATTACHED,{ media:this.media });var e=this.mediaSource;e&&e.removeEventListener('sourceopen',this.onmso),this.checkPendingTracks()} },{ key:'checkPendingTracks',value:function(){var e=this.pendingTracks,t=Object.keys(e).length;t&&(this.sourceBufferNb<=t||0===this.sourceBufferNb)&&(this.createSourceBuffers(e),this.pendingTracks={},this.doAppending())} },{ key:'onMediaSourceClose',value:function(){c.logger.log('media source closed')} },{ key:'onMediaSourceEnded',value:function(){c.logger.log('media source ended')} },{ key:'onSBUpdateEnd',value:function(){if(this.audioTimestampOffset){var e=this.sourceBuffer.audio;c.logger.warn('change mpeg audio timestamp offset from '+e.timestampOffset+' to '+this.audioTimestampOffset),e.timestampOffset=this.audioTimestampOffset,delete this.audioTimestampOffset}this._needsFlush&&this.doFlush(),this._needsEos&&this.checkEos(),this.appending=!1;var t=this.parent,r=this.segments.reduce(function(e,r){return r.parent===t?e+1:e},0);this.hls.trigger(u.default.BUFFER_APPENDED,{ parent:t,pending:r }),this._needsFlush||this.doAppending(),this.updateMediaElementDuration()} },{ key:'onSBUpdateError',value:function(e){c.logger.error('sourceBuffer error:',e),this.hls.trigger(u.default.ERROR,{ type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1 })} },{ key:'onBufferReset',value:function(){var e=this.sourceBuffer;for(var t in e){var r=e[t];try{this.mediaSource.removeSourceBuffer(r),r.removeEventListener('updateend',this.onsbue),r.removeEventListener('error',this.onsbe)}catch(e){}}this.sourceBuffer={},this.flushRange=[],this.segments=[],this.appended=0} },{ key:'onBufferCodecs',value:function(e){if(0===Object.keys(this.sourceBuffer).length){for(var t in e)this.pendingTracks[t]=e[t];var r=this.mediaSource;r&&'open'===r.readyState&&this.checkPendingTracks()}} },{ key:'createSourceBuffers',value:function(e){var t=this.sourceBuffer,r=this.mediaSource;for(var i in e)if(!t[i]){var a=e[i],n=a.levelCodec||a.codec,s=a.container+';codecs='+n;c.logger.log('creating sourceBuffer('+s+')');try{var o=t[i]=r.addSourceBuffer(s);o.addEventListener('updateend',this.onsbue),o.addEventListener('error',this.onsbe),this.tracks[i]={ codec:n,container:a.container },a.buffer=o}catch(e){c.logger.error('error while trying to add sourceBuffer:'+e.message),this.hls.trigger(u.default.ERROR,{ type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.BUFFER_ADD_CODEC_ERROR,fatal:!1,err:e,mimeType:s })}}this.hls.trigger(u.default.BUFFER_CREATED,{ tracks:e })} },{ key:'onBufferAppending',value:function(e){this._needsFlush||(this.segments?this.segments.push(e):this.segments=[e],this.doAppending())} },{ key:'onBufferAppendFail',value:function(e){c.logger.error('sourceBuffer error:',e.event),this.hls.trigger(u.default.ERROR,{ type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.BUFFER_APPENDING_ERROR,fatal:!1 })} },{ key:'onBufferEos',value:function(e){var t=this.sourceBuffer,r=e.type;for(var i in t)r&&i!==r||t[i].ended||(t[i].ended=!0,c.logger.log(i+' sourceBuffer now EOS'));this.checkEos()} },{ key:'checkEos',value:function(){var e=this.sourceBuffer,t=this.mediaSource;if(!t||'open'!==t.readyState)return void(this._needsEos=!1);for(var r in e){var i=e[r];if(!i.ended)return;if(i.updating)return void(this._needsEos=!0)}c.logger.log('all media data available, signal endOfStream() to MediaSource and stop loading fragment');try{t.endOfStream()}catch(e){c.logger.warn('exception while calling mediaSource.endOfStream()')}this._needsEos=!1} },{ key:'onBufferFlushing',value:function(e){this.flushRange.push({ start:e.startOffset,end:e.endOffset,type:e.type }),this.flushBufferCounter=0,this.doFlush()} },{ key:'onLevelUpdated',value:function(e){var t=e.details;0!==t.fragments.length&&(this._levelDuration=t.totalduration+t.fragments[0].start,this.updateMediaElementDuration())} },{ key:'updateMediaElementDuration',value:function(){var e=this.media,t=this.mediaSource,r=this.sourceBuffer,i=this._levelDuration;if(null!==i&&e&&t&&r&&0!==e.readyState&&'open'===t.readyState){for(var a in r)if(r[a].updating)return;null===this._msDuration&&(this._msDuration=t.duration);var n=e.duration;(i>this._msDuration&&i>n||n===1/0||isNaN(n))&&(c.logger.log('Updating mediasource duration to '+i.toFixed(3)),this._msDuration=t.duration=i)}} },{ key:'doFlush',value:function(){for(;this.flushRange.length;){var e=this.flushRange[0];if(!this.flushBuffer(e.start,e.end,e.type))return void(this._needsFlush=!0);this.flushRange.shift(),this.flushBufferCounter=0}if(0===this.flushRange.length){this._needsFlush=!1;var t=0,r=this.sourceBuffer;try{for(var i in r)t+=r[i].buffered.length}catch(e){c.logger.error('error while accessing sourceBuffer.buffered')}this.appended=t,this.hls.trigger(u.default.BUFFER_FLUSHED)}} },{ key:'doAppending',value:function(){var e=this.hls,t=this.sourceBuffer,r=this.segments;if(Object.keys(t).length){if(this.media.error)return this.segments=[],void c.logger.error('trying to append although a media error occured, flush segment and abort');if(this.appending)return;if(r&&r.length){var i=r.shift();try{var a=i.type,n=t[a];n?n.updating?r.unshift(i):(n.ended=!1,this.parent=i.parent,n.appendBuffer(i.data),this.appendError=0,this.appended++,this.appending=!0):this.onSBUpdateEnd()}catch(t){c.logger.error('error while trying to append buffer:'+t.message),r.unshift(i);var s={ type:h.ErrorTypes.MEDIA_ERROR,parent:i.parent };if(22===t.code)return this.segments=[],s.details=h.ErrorDetails.BUFFER_FULL_ERROR,s.fatal=!1,void e.trigger(u.default.ERROR,s);if(this.appendError?this.appendError++:this.appendError=1,s.details=h.ErrorDetails.BUFFER_APPEND_ERROR,this.appendError>e.config.appendErrorMaxRetry)return c.logger.log('fail '+e.config.appendErrorMaxRetry+' times to append segment in sourceBuffer'),r=[],s.fatal=!0,void e.trigger(u.default.ERROR,s);s.fatal=!1,e.trigger(u.default.ERROR,s)}}}} },{ key:'flushBuffer',value:function(e,t,r){var i,a,n,s,o,l,u=this.sourceBuffer;if(Object.keys(u).length){if(c.logger.log('flushBuffer,pos/start/end: '+this.media.currentTime.toFixed(3)+'/'+e+'/'+t),this.flushBufferCounter<this.appended){for(var d in u)if(!r||d===r){if(i=u[d],i.ended=!1,i.updating)return c.logger.warn('cannot flush, sb updating in progress'),!1;try{for(a=0;a<i.buffered.length;a++)if(n=i.buffered.start(a),s=i.buffered.end(a),-1!==navigator.userAgent.toLowerCase().indexOf('firefox')&&t===Number.POSITIVE_INFINITY?(o=e,l=t):(o=Math.max(n,e),l=Math.min(s,t)),Math.min(l,s)-o>.5)return this.flushBufferCounter++,c.logger.log('flush '+d+' ['+o+','+l+'], of ['+n+','+s+'], pos:'+this.media.currentTime),i.remove(o,l),!1}catch(e){c.logger.warn('exception while accessing sourcebuffer, it might have been removed from MediaSource')}}}else c.logger.warn('abort flushing too many retries');c.logger.log('buffer flushed')}return!0} }]),t}(f.default);r.default=g},{ 33:33,34:34,35:35,53:53 }],9:[function(e,t,r){'use strict';function i(e){return e&&e.__esModule?e:{ default:e }}function a(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||'object'!=typeof t&&'function'!=typeof t?e:t}function s(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+typeof t);e.prototype=Object.create(t&&t.prototype,{ constructor:{ value:e,enumerable:!1,writable:!0,configurable:!0 } }),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,'__esModule',{ value:!0 });var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,'value'in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=e(35),u=i(l),d=e(34),f=i(d),c=function(e){function t(e){return a(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.FPS_DROP_LEVEL_CAPPING,u.default.MEDIA_ATTACHING,u.default.MANIFEST_PARSED))}return s(t,e),o(t,[{ key:'destroy',value:function(){this.hls.config.capLevelToPlayerSize&&(this.media=this.restrictedLevels=null,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(this.timer=clearInterval(this.timer)))} },{ key:'onFpsDropLevelCapping',value:function(e){this.restrictedLevels||(this.restrictedLevels=[]),this.isLevelRestricted(e.droppedLevel)||this.restrictedLevels.push(e.droppedLevel)} },{ key:'onMediaAttaching',value:function(e){this.media=e.media instanceof HTMLVideoElement?e.media:null} },{ key:'onManifestParsed',value:function(e){var t=this.hls;t.config.capLevelToPlayerSize&&(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.levels=e.levels,t.firstLevel=this.getMaxLevel(e.firstLevel),clearInterval(this.timer),this.timer=setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())} },{ key:'detectPlayerSize',value:function(){if(this.media){var e=this.levels?this.levels.length:0;if(e){var t=this.hls;t.autoLevelCapping=this.getMaxLevel(e-1),t.autoLevelCapping>this.autoLevelCapping&&t.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}} },{ key:'getMaxLevel',value:function(e){var t=0,r=void 0,i=void 0,a=this.mediaWidth,n=this.mediaHeight,s=0,o=0;for(r=0;r<=e&&(i=this.levels[r],!this.isLevelRestricted(r))&&(t=r,s=i.width,o=i.height,!(a<=s||n<=o));r++);return t} },{ key:'isLevelRestricted',value:function(e){return!(!this.restrictedLevels||-1===this.restrictedLevels.indexOf(e))} },{ key:'contentScaleFactor',get:function(){var e=1;try{e=window.devicePixelRatio}catch(e){}return e} },{ key:'mediaWidth',get:function(){var e=void 0,t=this.media;return t&&(e=t.width||t.clientWidth||t.offsetWidth,e*=this.contentScaleFactor),e} },{ key:'mediaHeight',get:function(){var e=void 0,t=this.media;return t&&(e=t.height||t.clientHeight||t.offsetHeight,e*=this.contentScaleFactor),e} }]),t}(f.default);r.default=c},{ 34:34,35:35 }],10:[function(e,t,r){'use strict';function i(e){return e&&e.__esModule?e:{ default:e }}function a(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||'object'!=typeof t&&'function'!=typeof t?e:t}function s(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+typeof t);e.prototype=Object.create(t&&t.prototype,{ constructor:{ value:e,enumerable:!1,writable:!0,configurable:!0 } }),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,'__esModule',{ value:!0 });var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,'value'in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=e(35),u=i(l),d=e(34),f=i(d),c=e(53),h=function(e){function t(e){return a(this,t),n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.MEDIA_ATTACHING))}return s(t,e),o(t,[{ key:'destroy',value:function(){this.timer&&clearInterval(this.timer),this.isVideoPlaybackQualityAvailable=!1} },{ key:'onMediaAttaching',value:function(e){var t=this.hls.config;if(t.capLevelOnFPSDrop){'function'==typeof(this.video=e.media instanceof HTMLVideoElement?e.media:null).getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),clearInterval(this.timer),this.timer=setInterval(this.checkFPSInterval.bind(this),t.fpsDroppedMonitoringPeriod)}} },{ key:'checkFPS',value:function(e,t,r){var i=performance.now();if(t){if(this.lastTime){var a=i-this.lastTime,n=r-this.lastDroppedFrames,s=t-this.lastDecodedFrames,o=1e3*n/a,l=this.hls;if(l.trigger(u.default.FPS_DROP,{ currentDropped:n,currentDecoded:s,totalDroppedFrames:r }),o>0&&n>l.config.fpsDroppedMonitoringThreshold*s){var d=l.currentLevel;c.logger.warn('drop FPS ratio greater than max allowed value for currentLevel: '+d),d>0&&(-1===l.autoLevelCapping||l.autoLevelCapping>=d)&&(d-=1,l.trigger(u.default.FPS_DROP_LEVEL_CAPPING,{ level:d,droppedLevel:l.currentLevel }),l.autoLevelCapping=d,l.streamController.nextLevelSwitch())}}this.lastTime=i,this.lastDroppedFrames=r,this.lastDecodedFrames=t}} },{ key:'checkFPSInterval',value:function(){var e=this.video;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)} }]),t}(f.default);r.default=h},{ 34:34,35:35,53:53 }],11:[function(e,t,r){'use strict';function i(e){return e&&e.__esModule?e:{ default:e }}function a(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||'object'!=typeof t&&'function'!=typeof t?e:t}function s(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+typeof t);e.prototype=Object.create(t&&t.prototype,{ constructor:{ value:e,enumerable:!1,writable:!0,configurable:!0 } }),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,'__esModule',{ value:!0 });var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,'value'in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=e(35),u=i(l),d=e(34),f=i(d),c=function(e){function t(e){a(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.MEDIA_ATTACHED,u.default.MEDIA_DETACHING,u.default.FRAG_PARSING_METADATA));return r.id3Track=void 0,r.media=void 0,r}return s(t,e),o(t,[{ key:'destroy',value:function(){f.default.prototype.destroy.call(this)} },{ key:'onMediaAttached',value:function(e){this.media=e.media,this.media&&(this.id3Track=this.media.addTextTrack('metadata','id3'),this.id3Track.mode='hidden')} },{ key:'onMediaDetaching',value:function(){this.media=void 0} },{ key:'onFragParsingMetadata',value:function(e){var t=e.frag,r=e.samples,i=t.start,a=t.start+t.duration;i===a&&(a+=1e-4);for(var n=window.WebKitDataCue||window.VTTCue||window.TextTrackCue,s=0;s<r.length;s++){var o=this.parseID3Frame(r[s].data),l=this.decodeID3Frame(o);if(l){var u=new n(i,a,'');u.value=l,this.id3Track.addCue(u)}}} },{ key:'parseID3Frame',value:function(e){if(!(e.length<21)&&73===e[0]&&68===e[1]&&51===e[2]){var t=String.fromCharCode(e[10],e[11],e[12],e[13]);return e=e.subarray(20),{ type:t,data:e }}} },{ key:'decodeID3Frame',value:function(e){return'TXXX'===e.type?this.decodeTxxxFrame(e):'PRIV'===e.type?this.decodePrivFrame(e):'T'===e.type[0]?this.decodeTextFrame(e):void 0} },{ key:'decodeTxxxFrame',value:function(e){if(!(e.size<2)&&3===e.data[0]){var t=1,r=this.utf8ArrayToStr(e.data.subarray(t));t+=r.length+1;return{ key:'TXXX',description:r,data:this.utf8ArrayToStr(e.data.subarray(t)) }}} },{ key:'decodeTextFrame',value:function(e){if(!(e.size<2)&&3===e.data[0]){var t=e.data.subarray(1);return{ key:e.type,data:this.utf8ArrayToStr(t) }}} },{ key:'decodePrivFrame',value:function(e){if(!(e.size<2)){var t=this.utf8ArrayToStr(e.data);return{ key:'PRIV',info:t,data:e.data.subarray(t.length+1).buffer }}} },{ key:'utf8ArrayToStr',value:function(e){for(var t=void 0,r=void 0,i='',a=0,n=e.length;a<n;){var s=e[a++];switch(s>>4){case 0:return i;case 1:case 2:case 3:case 4:case 5:case 6:case 7:i+=String.fromCharCode(s);break;case 12:case 13:t=e[a++],i+=String.fromCharCode((31&s)<<6|63&t);break;case 14:t=e[a++],r=e[a++],i+=String.fromCharCode((15&s)<<12|(63&t)<<6|(63&r)<<0)}}return i} }]),t}(f.default);r.default=c},{ 34:34,35:35 }],12:[function(e,t,r){'use strict';function i(e){return e&&e.__esModule?e:{ default:e }}function a(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||'object'!=typeof t&&'function'!=typeof t?e:t}function s(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+typeof t);e.prototype=Object.create(t&&t.prototype,{ constructor:{ value:e,enumerable:!1,writable:!0,configurable:!0 } }),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,'__esModule',{ value:!0 });var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,'value'in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=e(35),u=i(l),d=e(34),f=i(d),c=e(53),h=e(33),g=e(37),v=i(g),p=function(e){function t(e){a(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.MANIFEST_LOADED,u.default.LEVEL_LOADED,u.default.FRAG_LOADED,u.default.ERROR));return r.ontick=r.tick.bind(r),r._manualLevel=-1,r}return s(t,e),o(t,[{ key:'destroy',value:function(){this.timer&&(clearTimeout(this.timer),this.timer=null),this._manualLevel=-1} },{ key:'startLoad',value:function(){this.canload=!0;var e=this._levels;e&&e.forEach(function(e){e.loadError=0;var t=e.details;t&&t.live&&(e.details=void 0)}),this.timer&&this.tick()} },{ key:'stopLoad',value:function(){this.canload=!1} },{ key:'onManifestLoaded',value:function(e){var t,r=[],i=[],a={},n=!1,s=!1,o=this.hls,l=/chrome|firefox/.test(navigator.userAgent.toLowerCase()),d=function(e,t){return MediaSource.isTypeSupported(e+'/mp4;codecs='+t)};if(e.levels.forEach(function(e){e.videoCodec&&(n=!0),l&&e.audioCodec&&-1!==e.audioCodec.indexOf('mp4a.40.34')&&(e.audioCodec=void 0),(e.audioCodec||e.attrs&&e.attrs.AUDIO)&&(s=!0);var t=a[e.bitrate];void 0===t?(a[e.bitrate]=r.length,e.url=[e.url],e.urlId=0,r.push(e)):r[t].url.push(e.url)}),n&&s?r.forEach(function(e){e.videoCodec&&i.push(e)}):i=r,i=i.filter(function(e){var t=e.audioCodec,r=e.videoCodec;return(!t||d('audio',t))&&(!r||d('video',r))}),i.length){t=i[0].bitrate,i.sort(function(e,t){return e.bitrate-t.bitrate}),this._levels=i;for(var f=0;f<i.length;f++)if(i[f].bitrate===t){this._firstLevel=f,c.logger.log('manifest loaded,'+i.length+' level(s) found, first bitrate:'+t);break}o.trigger(u.default.MANIFEST_PARSED,{ levels:i,firstLevel:this._firstLevel,stats:e.stats,audio:s,video:n,altAudio:e.audioTracks.length>0 })}else o.trigger(u.default.ERROR,{ type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:o.url,reason:'no level with compatible codecs found in manifest' })} },{ key:'setLevelInternal',value:function(e){var t=this._levels,r=this.hls;if(e>=0&&e<t.length){if(this.timer&&(clearTimeout(this.timer),this.timer=null),this._level!==e){c.logger.log('switching to level '+e),this._level=e;var i=t[e];i.level=e,r.trigger(u.default.LEVEL_SWITCH,i),r.trigger(u.default.LEVEL_SWITCHING,i)}var a=t[e],n=a.details;if(!n||!0===n.live){var s=a.urlId;r.trigger(u.default.LEVEL_LOADING,{ url:a.url[s],level:e,id:s })}}else r.trigger(u.default.ERROR,{ type:h.ErrorTypes.OTHER_ERROR,details:h.ErrorDetails.LEVEL_SWITCH_ERROR,level:e,fatal:!1,reason:'invalid level idx' })} },{ key:'onError',value:function(e){if(!e.fatal){var t=e.details,r=this.hls,i=void 0,a=void 0;switch(t){case h.ErrorDetails.FRAG_LOAD_ERROR:case h.ErrorDetails.FRAG_LOAD_TIMEOUT:case h.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case h.ErrorDetails.KEY_LOAD_ERROR:case h.ErrorDetails.KEY_LOAD_TIMEOUT:i=e.frag.level;break;case h.ErrorDetails.LEVEL_LOAD_ERROR:case h.ErrorDetails.LEVEL_LOAD_TIMEOUT:i=e.context.level,!0;break;case h.ErrorDetails.REMUX_ALLOC_ERROR:i=e.level}if(void 0!==i){a=this._levels[i],a.loadError?a.loadError++:a.loadError=1;var n=a.url.length;if(n>1&&a.loadError<n)a.urlId=(a.urlId+1)%n,a.details=void 0,c.logger.warn('level controller,'+t+' for level '+i+': switching to redundant stream id '+a.urlId);else{if(-1===this._manualLevel&&i)c.logger.warn('level controller,'+t+': switch-down for next fragment'),r.nextAutoLevel=Math.max(0,i-1);else if(t===h.ErrorDetails.LEVEL_LOAD_ERROR||t===h.ErrorDetails.LEVEL_LOAD_TIMEOUT){var s=r.media,o=s&&v.default.isBuffered(s,s.currentTime)&&v.default.isBuffered(s,s.currentTime+.5);if(o){var l=r.config.levelLoadingRetryDelay;c.logger.warn('level controller,'+t+', but media buffered, retry in '+l+'ms'),this.timer=setTimeout(this.ontick,l),e.levelRetry=!0}else c.logger.error('cannot recover '+t+' error'),this._level=void 0,this.timer&&(clearTimeout(this.timer),this.timer=null),e.fatal=!0}}}}} },{ key:'onFragLoaded',value:function(e){var t=e.frag;if(t&&'main'===t.type){var r=this._levels[t.level];r&&(r.loadError=0)}} },{ key:'onLevelLoaded',value:function(e){var t=e.level;if(t===this._level){var r=this._levels[t];r.loadError=0;var i=e.details;if(i.live){var a=1e3*(i.averagetargetduration?i.averagetargetduration:i.targetduration),n=r.details;n&&i.endSN===n.endSN&&(a/=2,c.logger.log('same live playlist, reload twice faster')),a-=performance.now()-e.stats.trequest,a=Math.max(1e3,Math.round(a)),c.logger.log('live playlist, reload in '+a+' ms'),this.timer=setTimeout(this.ontick,a)}else this.timer=null}} },{ key:'tick',value:function(){var e=this._level;if(void 0!==e&&this.canload){var t=this._levels[e];if(t&&t.url){var r=t.urlId;this.hls.trigger(u.default.LEVEL_LOADING,{ url:t.url[r],level:e,id:r })}}} },{ key:'levels',get:function(){return this._levels} },{ key:'level',get:function(){return this._level},set:function(e){var t=this._levels;t&&t.length>e&&(this._level===e&&void 0!==t[e].details||this.setLevelInternal(e))} },{ key:'manualLevel',get:function(){return this._manualLevel},set:function(e){this._manualLevel=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)} },{ key:'firstLevel',get:function(){return this._firstLevel},set:function(e){this._firstLevel=e} },{ key:'startLevel',get:function(){if(void 0===this._startLevel){var e=this.hls.config.startLevel;return void 0!==e?e:this._firstLevel}return this._startLevel},set:function(e){this._startLevel=e} },{ key:'nextLoadLevel',get:function(){return-1!==this._manualLevel?this._manualLevel:this.hls.nextAutoLevel},set:function(e){this.level=e,-1===this._manualLevel&&(this.hls.nextAutoLevel=e)} }]),t}(f.default);r.default=p},{ 33:33,34:34,35:35,37:37,53:53 }],13:[function(e,t,r){'use strict';function i(e){return e&&e.__esModule?e:{ default:e }}function a(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||'object'!=typeof t&&'function'!=typeof t?e:t}function s(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+typeof t);e.prototype=Object.create(t&&t.prototype,{ constructor:{ value:e,enumerable:!1,writable:!0,configurable:!0 } }),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,'__esModule',{ value:!0 });var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,'value'in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=e(48),u=i(l),d=e(37),f=i(d),c=e(25),h=i(c),g=e(35),v=i(g),p=e(34),y=i(p),m=e(38),E=i(m),b=e(54),T=i(b),k=e(33),_=e(53),R={ STOPPED:'STOPPED',IDLE:'IDLE',KEY_LOADING:'KEY_LOADING',FRAG_LOADING:'FRAG_LOADING',FRAG_LOADING_WAITING_RETRY:'FRAG_LOADING_WAITING_RETRY',WAITING_LEVEL:'WAITING_LEVEL',PARSING:'PARSING',PARSED:'PARSED',BUFFER_FLUSHING:'BUFFER_FLUSHING',ENDED:'ENDED',ERROR:'ERROR' },A=function(e){function t(e){a(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,v.default.MEDIA_ATTACHED,v.default.MEDIA_DETACHING,v.default.MANIFEST_LOADING,v.default.MANIFEST_PARSED,v.default.LEVEL_LOADED,v.default.KEY_LOADED,v.default.FRAG_LOADED,v.default.FRAG_LOAD_EMERGENCY_ABORTED,v.default.FRAG_PARSING_INIT_SEGMENT,v.default.FRAG_PARSING_DATA,v.default.FRAG_PARSED,v.default.ERROR,v.default.AUDIO_TRACK_SWITCHING,v.default.AUDIO_TRACK_SWITCHED,v.default.BUFFER_CREATED,v.default.BUFFER_APPENDED,v.default.BUFFER_FLUSHED));return r.config=e.config,r.audioCodecSwap=!1,r.ticks=0,r._state=R.STOPPED,r.ontick=r.tick.bind(r),r}return s(t,e),o(t,[{ key:'destroy',value:function(){this.stopLoad(),this.timer&&(clearInterval(this.timer),this.timer=null),y.default.prototype.destroy.call(this),this.state=R.STOPPED} },{ key:'startLoad',value:function(e){if(this.levels){var t=this.lastCurrentTime,r=this.hls;if(this.stopLoad(),this.timer||(this.timer=setInterval(this.ontick,100)),this.level=-1,this.fragLoadError=0,!this.startFragRequested){var i=r.startLevel;-1===i&&(i=0,this.bitrateTest=!0),this.level=r.nextLoadLevel=i,this.loadedmetadata=!1}t>0&&-1===e&&(_.logger.log('override startPosition with lastCurrentTime @'+t.toFixed(3)),e=t),this.state=R.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this.forceStartLoad=!0,this.state=R.STOPPED} },{ key:'stopLoad',value:function(){var e=this.fragCurrent;e&&(e.loader&&e.loader.abort(),this.fragCurrent=null),this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=R.STOPPED,this.forceStartLoad=!1} },{ key:'tick',value:function(){1===++this.ticks&&(this.doTick(),this.ticks>1&&setTimeout(this.tick,1),this.ticks=0)} },{ key:'doTick',value:function(){switch(this.state){case R.ERROR:break;case R.BUFFER_FLUSHING:this.fragLoadError=0;break;case R.IDLE:this._doTickIdle();break;case R.WAITING_LEVEL:var e=this.levels[this.level];e&&e.details&&(this.state=R.IDLE);break;case R.FRAG_LOADING_WAITING_RETRY:var t=performance.now(),r=this.retryDate;(!r||t>=r||this.media&&this.media.seeking)&&(_.logger.log('mediaController: retryDate reached, switch back to IDLE state'),this.state=R.IDLE);break;case R.ERROR:case R.STOPPED:case R.FRAG_LOADING:case R.PARSING:case R.PARSED:case R.ENDED:}this._checkBuffer(),this._checkFragmentChanged()} },{ key:'_doTickIdle',value:function(){var e=this.hls,t=e.config,r=this.media
;if(void 0===this.levelLastLoaded||r||!this.startFragRequested&&t.startFragPrefetch){var i=void 0;i=this.loadedmetadata?r.currentTime:this.nextLoadPosition;var a=e.nextLoadLevel,n=this.levels[a];if(n){var s=n.bitrate,o=void 0;o=s?Math.max(8*t.maxBufferSize/s,t.maxBufferLength):t.maxBufferLength,o=Math.min(o,t.maxMaxBufferLength);var l=f.default.bufferInfo(this.mediaBuffer?this.mediaBuffer:r,i,t.maxBufferHole),u=l.len;if(!(u>=o)){_.logger.trace('buffer length of '+u.toFixed(3)+' is below max of '+o.toFixed(3)+'. checking for more payload ...'),this.level=e.nextLoadLevel=a;var d=n.details;if(void 0===d||d.live&&this.levelLastLoaded!==a)return void(this.state=R.WAITING_LEVEL);var c=this.fragPrevious;if(!d.live&&c&&c.sn===d.endSN){if(Math.min(r.duration,c.start+c.duration)-Math.max(l.end,c.start)<=Math.max(.2,c.duration)){var h={};return this.altAudio&&(h.type='video'),this.hls.trigger(v.default.BUFFER_EOS,h),void(this.state=R.ENDED)}}this._fetchPayloadOrEos(i,l,d)}}}} },{ key:'_fetchPayloadOrEos',value:function(e,t,r){var i=this.fragPrevious,a=this.level,n=r.fragments,s=n.length;if(0!==s){var o=n[0].start,l=n[s-1].start+n[s-1].duration,u=t.end,d=void 0;if(r.initSegment&&!r.initSegment.data)d=r.initSegment;else if(r.live){var f=this.config.initialLiveManifestSize;if(s<f)return void _.logger.warn('Can not start playback of a level, reason: not enough fragments '+s+' < '+f);if(null===(d=this._ensureFragmentAtLivePoint(r,u,o,l,i,n,s)))return}else u<o&&(d=n[0]);d||(d=this._findFragment(o,i,s,n,u,l,r)),d&&this._loadFragmentOrKey(d,a,r,e,u)}} },{ key:'_ensureFragmentAtLivePoint',value:function(e,t,r,i,a,n,s){var o=this.hls.config,l=this.media,u=void 0,d=void 0!==o.liveMaxLatencyDuration?o.liveMaxLatencyDuration:o.liveMaxLatencyDurationCount*e.targetduration;if(t<Math.max(r-o.maxFragLookUpTolerance,i-d)){var f=this.liveSyncPosition=this.computeLivePosition(r,e);_.logger.log('buffer end: '+t.toFixed(3)+' is located too far from the end of live sliding playlist, reset currentTime to : '+f.toFixed(3)),t=f,l&&l.readyState&&l.duration>f&&(l.currentTime=f)}if(e.PTSKnown&&t>i&&l&&l.readyState)return null;if(this.startFragRequested&&!e.PTSKnown){if(a){var c=a.sn+1;c>=e.startSN&&c<=e.endSN&&(u=n[c-e.startSN],_.logger.log('live playlist, switching playlist, load frag with next SN: '+u.sn))}u||(u=n[Math.min(s-1,Math.round(s/2))],_.logger.log('live playlist, switching playlist, unknown, load middle frag : '+u.sn))}return u} },{ key:'_findFragment',value:function(e,t,r,i,a,n,s){var o=this.hls.config,l=void 0,d=void 0,f=o.maxFragLookUpTolerance,c=t?i[t.sn-i[0].sn+1]:void 0,h=function(e){var t=Math.min(f,e.duration);return e.start+e.duration-t<=a?1:e.start-t>a&&e.start?-1:0};if(a<n?(a>n-f&&(f=0),d=c&&!h(c)?c:u.default.search(i,h)):d=i[r-1],d){l=d;var g=l.sn-s.startSN,v=t&&l.level===t.level,p=i[g-1],y=i[g+1];if(t&&l.sn===t.sn)if(v&&!l.backtracked)if(l.sn<s.endSN){var m=t.deltaPTS;m&&m>o.maxBufferHole&&t.dropped&&g?(l=p,_.logger.warn('SN just loaded, with large PTS gap between audio and video, maybe frag is not starting with a keyframe ? load previous one to try to overcome this'),t.loadCounter--):(l=y,_.logger.log('SN just loaded, load next one: '+l.sn))}else l=null;else l.backtracked&&(y&&y.backtracked?(_.logger.warn('Already backtracked from fragment '+y.sn+', will not backtrack to fragment '+l.sn+'. Loading fragment '+y.sn),l=y):(_.logger.warn('Loaded fragment with dropped frames, backtracking 1 segment to find a keyframe'),l.dropped=0,p?(p.loadCounter&&p.loadCounter--,l=p,l.backtracked=!0):l=null))}return l} },{ key:'_loadFragmentOrKey',value:function(e,t,r,i,a){var n=this.hls,s=n.config;if(!e.decryptdata||null==e.decryptdata.uri||null!=e.decryptdata.key){if(_.logger.log('Loading '+e.sn+' of ['+r.startSN+' ,'+r.endSN+'],level '+t+', currentTime:'+i.toFixed(3)+',bufferEnd:'+a.toFixed(3)),void 0!==this.fragLoadIdx?this.fragLoadIdx++:this.fragLoadIdx=0,e.loadCounter){e.loadCounter++;var o=s.fragLoadingLoopThreshold;if(e.loadCounter>o&&Math.abs(this.fragLoadIdx-e.loadIdx)<o)return void n.trigger(v.default.ERROR,{ type:k.ErrorTypes.MEDIA_ERROR,details:k.ErrorDetails.FRAG_LOOP_LOADING_ERROR,fatal:!1,frag:e })}else e.loadCounter=1;return e.loadIdx=this.fragLoadIdx,this.fragCurrent=e,this.startFragRequested=!0,isNaN(e.sn)||(this.nextLoadPosition=e.start+e.duration),e.autoLevel=n.autoLevelEnabled,e.bitrateTest=this.bitrateTest,n.trigger(v.default.FRAG_LOADING,{ frag:e }),this.demuxer||(this.demuxer=new h.default(n,'main')),void(this.state=R.FRAG_LOADING)}_.logger.log('Loading key for '+e.sn+' of ['+r.startSN+' ,'+r.endSN+'],level '+t),this.state=R.KEY_LOADING,n.trigger(v.default.KEY_LOADING,{ frag:e })} },{ key:'getBufferedFrag',value:function(e){return u.default.search(this._bufferedFrags,function(t){return e<t.startPTS?-1:e>t.endPTS?1:0})} },{ key:'followingBufferedFrag',value:function(e){return e?this.getBufferedFrag(e.endPTS+.5):null} },{ key:'_checkFragmentChanged',value:function(){var e,t,r=this.media;if(r&&r.readyState&&!1===r.seeking&&(t=r.currentTime,t>r.playbackRate*this.lastCurrentTime&&(this.lastCurrentTime=t),f.default.isBuffered(r,t)?e=this.getBufferedFrag(t):f.default.isBuffered(r,t+.1)&&(e=this.getBufferedFrag(t+.1)),e)){var i=e;if(i!==this.fragPlaying){this.hls.trigger(v.default.FRAG_CHANGED,{ frag:i });var a=i.level;this.fragPlaying&&this.fragPlaying.level===a||this.hls.trigger(v.default.LEVEL_SWITCHED,{ level:a }),this.fragPlaying=i}}} },{ key:'immediateLevelSwitch',value:function(){if(_.logger.log('immediateLevelSwitch'),!this.immediateSwitch){this.immediateSwitch=!0;var e=this.media,t=void 0;e?(t=e.paused,e.pause()):t=!0,this.previouslyPaused=t}var r=this.fragCurrent;r&&r.loader&&r.loader.abort(),this.fragCurrent=null,this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)} },{ key:'immediateLevelSwitchEnd',value:function(){var e=this.media;e&&e.buffered.length&&(this.immediateSwitch=!1,f.default.isBuffered(e,e.currentTime)&&(e.currentTime-=1e-4),this.previouslyPaused||e.play())} },{ key:'nextLevelSwitch',value:function(){var e=this.media;if(e&&e.readyState){var t=void 0,r=void 0,i=void 0;if(this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,r=this.getBufferedFrag(e.currentTime),r&&r.startPTS>1&&this.flushMainBuffer(0,r.startPTS-1),e.paused)t=0;else{var a=this.hls.nextLoadLevel,n=this.levels[a],s=this.fragLastKbps;t=s&&this.fragCurrent?this.fragCurrent.duration*n.bitrate/(1e3*s)+1:0}if((i=this.getBufferedFrag(e.currentTime+t))&&(i=this.followingBufferedFrag(i))){var o=this.fragCurrent;o&&o.loader&&o.loader.abort(),this.fragCurrent=null,this.flushMainBuffer(i.startPTS,Number.POSITIVE_INFINITY)}}} },{ key:'flushMainBuffer',value:function(e,t){this.state=R.BUFFER_FLUSHING;var r={ startOffset:e,endOffset:t };this.altAudio&&(r.type='video'),this.hls.trigger(v.default.BUFFER_FLUSHING,r)} },{ key:'onMediaAttached',value:function(e){var t=this.media=this.mediaBuffer=e.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),this.onvended=this.onMediaEnded.bind(this),t.addEventListener('seeking',this.onvseeking),t.addEventListener('seeked',this.onvseeked),t.addEventListener('ended',this.onvended);var r=this.config;this.levels&&r.autoStartLoad&&this.hls.startLoad(r.startPosition)} },{ key:'onMediaDetaching',value:function(){var e=this.media;e&&e.ended&&(_.logger.log('MSE detaching and video ended, reset startPosition'),this.startPosition=this.lastCurrentTime=0);var t=this.levels;t&&t.forEach(function(e){e.details&&e.details.fragments.forEach(function(e){e.loadCounter=void 0,e.backtracked=void 0})}),e&&(e.removeEventListener('seeking',this.onvseeking),e.removeEventListener('seeked',this.onvseeked),e.removeEventListener('ended',this.onvended),this.onvseeking=this.onvseeked=this.onvended=null),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.stopLoad()} },{ key:'onMediaSeeking',value:function(){var e=this.media,t=e?e.currentTime:void 0,r=this.config;isNaN(t)||_.logger.log('media seeking to '+t.toFixed(3));var i=this.mediaBuffer?this.mediaBuffer:e,a=f.default.bufferInfo(i,t,this.config.maxBufferHole);if(this.state===R.FRAG_LOADING){var n=this.fragCurrent;if(0===a.len&&n){var s=r.maxFragLookUpTolerance,o=n.start-s,l=n.start+n.duration+s;t<o||t>l?(n.loader&&(_.logger.log('seeking outside of buffer while fragment load in progress, cancel fragment load'),n.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.state=R.IDLE):_.logger.log('seeking outside of buffer but within currently loaded fragment range')}}else this.state===R.ENDED&&(0===a.len&&(this.fragPrevious=0),this.state=R.IDLE);e&&(this.lastCurrentTime=t),this.state!==R.FRAG_LOADING&&void 0!==this.fragLoadIdx&&(this.fragLoadIdx+=2*r.fragLoadingLoopThreshold),this.loadedmetadata||(this.nextLoadPosition=this.startPosition=t),this.tick()} },{ key:'onMediaSeeked',value:function(){var e=this.media,t=e?e.currentTime:void 0;isNaN(t)||_.logger.log('media seeked to '+t.toFixed(3)),this.tick()} },{ key:'onMediaEnded',value:function(){_.logger.log('media ended'),this.startPosition=this.lastCurrentTime=0} },{ key:'onManifestLoading',value:function(){_.logger.log('trigger BUFFER_RESET'),this.hls.trigger(v.default.BUFFER_RESET),this._bufferedFrags=[],this.stalled=!1,this.startPosition=this.lastCurrentTime=0} },{ key:'onManifestParsed',value:function(e){var t,r=!1,i=!1;e.levels.forEach(function(e){(t=e.audioCodec)&&(-1!==t.indexOf('mp4a.40.2')&&(r=!0),-1!==t.indexOf('mp4a.40.5')&&(i=!0))}),this.audioCodecSwitch=r&&i,this.audioCodecSwitch&&_.logger.log('both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC'),this.levels=e.levels,this.startLevelLoaded=!1,this.startFragRequested=!1;var a=this.config;(a.autoStartLoad||this.forceStartLoad)&&this.hls.startLoad(a.startPosition)} },{ key:'onLevelLoaded',value:function(e){var t=e.details,r=e.level,i=this.levels[r],a=t.totalduration,n=0;if(_.logger.log('level '+r+' loaded ['+t.startSN+','+t.endSN+'],duration:'+a),this.levelLastLoaded=r,t.live){var s=i.details;s&&t.fragments.length>0?(E.default.mergeDetails(s,t),n=t.fragments[0].start,this.liveSyncPosition=this.computeLivePosition(n,s),t.PTSKnown?_.logger.log('live playlist sliding:'+n.toFixed(3)):_.logger.log('live playlist - outdated PTS, unknown sliding')):(t.PTSKnown=!1,_.logger.log('live playlist - first load, unknown sliding'))}else t.PTSKnown=!1;if(i.details=t,this.hls.trigger(v.default.LEVEL_UPDATED,{ details:t,level:r }),!1===this.startFragRequested){if(-1===this.startPosition||-1===this.lastCurrentTime){var o=t.startTimeOffset;isNaN(o)?t.live?(this.startPosition=this.computeLivePosition(n,t),_.logger.log('configure startPosition to '+this.startPosition)):this.startPosition=0:(o<0&&(_.logger.log('negative start time offset '+o+', count from end of last fragment'),o=n+a+o),_.logger.log('start time offset found in playlist, adjust startPosition to '+o),this.startPosition=o),this.lastCurrentTime=this.startPosition}this.nextLoadPosition=this.startPosition}this.state===R.WAITING_LEVEL&&(this.state=R.IDLE),this.tick()} },{ key:'onKeyLoaded',value:function(){this.state===R.KEY_LOADING&&(this.state=R.IDLE,this.tick())} },{ key:'onFragLoaded',value:function(e){var t=this.fragCurrent,r=e.frag;if(this.state===R.FRAG_LOADING&&t&&'main'===r.type&&r.level===t.level&&r.sn===t.sn){var i=e.stats,a=this.levels[t.level],n=a.details;if(_.logger.log('Loaded  '+t.sn+' of ['+n.startSN+' ,'+n.endSN+'],level '+t.level),this.bitrateTest=!1,this.stats=i,!0===r.bitrateTest&&this.hls.nextLoadLevel)this.state=R.IDLE,this.startFragRequested=!1,i.tparsed=i.tbuffered=performance.now(),this.hls.trigger(v.default.FRAG_BUFFERED,{ stats:i,frag:t,id:'main' }),this.tick();else if('initSegment'===r.sn)this.state=R.IDLE,i.tparsed=i.tbuffered=performance.now(),n.initSegment.data=e.payload,this.hls.trigger(v.default.FRAG_BUFFERED,{ stats:i,frag:t,id:'main' }),this.tick();else{this.state=R.PARSING;var s=n.totalduration,o=t.level,l=t.sn,u=this.config.defaultAudioCodec||a.audioCodec;this.audioCodecSwap&&(_.logger.log('swapping playlist audio codec'),void 0===u&&(u=this.lastAudioCodec),u&&(u=-1!==u.indexOf('mp4a.40.5')?'mp4a.40.2':'mp4a.40.5')),this.pendingBuffering=!0,this.appended=!1,_.logger.log('Parsing '+l+' of ['+n.startSN+' ,'+n.endSN+'],level '+o+', cc '+t.cc);var d=this.demuxer;d||(d=this.demuxer=new h.default(this.hls,'main'));var f=this.media,c=f&&f.seeking,g=!c&&(n.PTSKnown||!n.live),p=n.initSegment?n.initSegment.data:[];d.push(e.payload,p,u,a.videoCodec,t,s,g,void 0)}}this.fragLoadError=0} },{ key:'onFragParsingInitSegment',value:function(e){var t=this.fragCurrent,r=e.frag;if(t&&'main'===e.id&&r.sn===t.sn&&r.level===t.level&&this.state===R.PARSING){var i,a,n=e.tracks;if(n.audio&&this.altAudio&&delete n.audio,a=n.audio){var s=this.levels[this.level].audioCodec,o=navigator.userAgent.toLowerCase();s&&this.audioCodecSwap&&(_.logger.log('swapping playlist audio codec'),s=-1!==s.indexOf('mp4a.40.5')?'mp4a.40.2':'mp4a.40.5'),this.audioCodecSwitch&&1!==a.metadata.channelCount&&-1===o.indexOf('firefox')&&(s='mp4a.40.5'),-1!==o.indexOf('android')&&'audio/mpeg'!==a.container&&(s='mp4a.40.2',_.logger.log('Android: force audio codec to '+s)),a.levelCodec=s,a.id=e.id}a=n.video,a&&(a.levelCodec=this.levels[this.level].videoCodec,a.id=e.id),this.hls.trigger(v.default.BUFFER_CODECS,n);for(i in n){a=n[i],_.logger.log('main track:'+i+',container:'+a.container+',codecs[level/parsed]=['+a.levelCodec+'/'+a.codec+']');var l=a.initSegment;l&&(this.appended=!0,this.pendingBuffering=!0,this.hls.trigger(v.default.BUFFER_APPENDING,{ type:i,data:l,parent:'main',content:'initSegment' }))}this.tick()}} },{ key:'onFragParsingData',value:function(e){var t=this,r=this.fragCurrent,i=e.frag;if(r&&'main'===e.id&&i.sn===r.sn&&i.level===r.level&&('audio'!==e.type||!this.altAudio)&&this.state===R.PARSING){var a=this.levels[this.level],n=r;if(isNaN(e.endPTS)&&(e.endPTS=e.startPTS+r.duration,e.endDTS=e.startDTS+r.duration),_.logger.log('Parsed '+e.type+',PTS:['+e.startPTS.toFixed(3)+','+e.endPTS.toFixed(3)+'],DTS:['+e.startDTS.toFixed(3)+'/'+e.endDTS.toFixed(3)+'],nb:'+e.nb+',dropped:'+(e.dropped||0)),'video'===e.type)if(n.dropped=e.dropped,n.dropped){if(!n.backtracked)return _.logger.warn('missing video frame(s), backtracking fragment'),n.backtracked=!0,this.nextLoadPosition=e.startPTS,this.state=R.IDLE,this.fragPrevious=n,void this.tick();_.logger.warn('Already backtracked on this fragment, appending with the gap')}else n.backtracked=!1;var s=E.default.updateFragPTSDTS(a.details,n,e.startPTS,e.endPTS,e.startDTS,e.endDTS),o=this.hls;o.trigger(v.default.LEVEL_PTS_UPDATED,{ details:a.details,level:this.level,drift:s,type:e.type,start:e.startPTS,end:e.endPTS }),[e.data1,e.data2].forEach(function(r){r&&r.length&&t.state===R.PARSING&&(t.appended=!0,t.pendingBuffering=!0,o.trigger(v.default.BUFFER_APPENDING,{ type:e.type,data:r,parent:'main',content:'data' }))}),this.tick()}} },{ key:'onFragParsed',value:function(e){var t=this.fragCurrent,r=e.frag;t&&'main'===e.id&&r.sn===t.sn&&r.level===t.level&&this.state===R.PARSING&&(this.stats.tparsed=performance.now(),this.state=R.PARSED,this._checkAppendedParsed())} },{ key:'onAudioTrackSwitching',value:function(e){var t=!!e.url,r=e.id;if(!t){if(this.mediaBuffer!==this.media){_.logger.log('switching on main audio, use media.buffered to schedule main fragment loading'),this.mediaBuffer=this.media;var i=this.fragCurrent;i.loader&&(_.logger.log('switching to main audio track, cancel main fragment load'),i.loader.abort()),this.fragCurrent=null,this.fragPrevious=null,this.demuxer&&(this.demuxer.destroy(),this.demuxer=null),this.state=R.IDLE}var a=this.hls;a.trigger(v.default.BUFFER_FLUSHING,{ startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:'audio' }),a.trigger(v.default.AUDIO_TRACK_SWITCHED,{ id:r }),this.altAudio=!1}} },{ key:'onAudioTrackSwitched',value:function(e){var t=e.id,r=!!this.hls.audioTracks[t].url;if(r){var i=this.videoBuffer;i&&this.mediaBuffer!==i&&(_.logger.log('switching on alternate audio, use video.buffered to schedule main fragment loading'),this.mediaBuffer=i)}this.altAudio=r,this.tick()} },{ key:'onBufferCreated',value:function(e){var t=e.tracks,r=void 0,i=void 0,a=!1;for(var n in t){var s=t[n];'main'===s.id?(i=n,r=s,'video'===n&&(this.videoBuffer=t[n].buffer)):a=!0}a&&r?(_.logger.log('alternate track found, use '+i+'.buffered to schedule main fragment loading'),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media} },{ key:'onBufferAppended',value:function(e){if('main'===e.parent){var t=this.state;t!==R.PARSING&&t!==R.PARSED||(this.pendingBuffering=e.pending>0,this._checkAppendedParsed())}} },{ key:'_checkAppendedParsed',value:function(){if(!(this.state!==R.PARSED||this.appended&&this.pendingBuffering)){var e=this.fragCurrent;if(e){var t=this.mediaBuffer?this.mediaBuffer:this.media;_.logger.log('main buffered : '+T.default.toString(t.buffered));var r=this._bufferedFrags.filter(function(e){return f.default.isBuffered(t,(e.startPTS+e.endPTS)/2)});r.push(e),this._bufferedFrags=r.sort(function(e,t){return e.startPTS-t.startPTS}),this.fragPrevious=e;var i=this.stats;i.tbuffered=performance.now(),this.fragLastKbps=Math.round(8*i.total/(i.tbuffered-i.tfirst)),this.hls.trigger(v.default.FRAG_BUFFERED,{ stats:i,frag:e,id:'main' }),this.state=R.IDLE}this.tick()}} },{ key:'onError',value:function(e){var t=e.frag||this.fragCurrent;if(!t||'main'===t.type){var r=this.media,i=r&&f.default.isBuffered(r,r.currentTime)&&f.default.isBuffered(r,r.currentTime+.5);switch(e.details){case k.ErrorDetails.FRAG_LOAD_ERROR:case k.ErrorDetails.FRAG_LOAD_TIMEOUT:case k.ErrorDetails.KEY_LOAD_ERROR:case k.ErrorDetails.KEY_LOAD_TIMEOUT:if(!e.fatal){var a=this.fragLoadError;a?a++:a=1;var n=this.config;if(a<=n.fragLoadingMaxRetry||i||t.autoLevel&&t.level){this.fragLoadError=a,t.loadCounter=0;var s=Math.min(Math.pow(2,a-1)*n.fragLoadingRetryDelay,n.fragLoadingMaxRetryTimeout);_.logger.warn('mediaController: frag loading failed, retry in '+s+' ms'),this.retryDate=performance.now()+s,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.state=R.FRAG_LOADING_WAITING_RETRY}else _.logger.error('mediaController: '+e.details+' reaches max retry, redispatch as fatal ...'),e.fatal=!0,this.state=R.ERROR}break;case k.ErrorDetails.FRAG_LOOP_LOADING_ERROR:e.fatal||(i?(this._reduceMaxBufferLength(t.duration),this.state=R.IDLE):t.autoLevel&&0!==t.level||(e.fatal=!0,this.state=R.ERROR));break;case k.ErrorDetails.LEVEL_LOAD_ERROR:case k.ErrorDetails.LEVEL_LOAD_TIMEOUT:this.state!==R.ERROR&&(e.fatal?(this.state=R.ERROR,_.logger.warn('streamController: '+e.details+',switch to '+this.state+' state ...')):e.levelRetry||this.state!==R.WAITING_LEVEL||(this.state=R.IDLE));break;case k.ErrorDetails.BUFFER_FULL_ERROR:'main'!==e.parent||this.state!==R.PARSING&&this.state!==R.PARSED||(i?(this._reduceMaxBufferLength(this.config.maxBufferLength),this.state=R.IDLE):(_.logger.warn('buffer full error also media.currentTime is not buffered, flush everything'),this.fragCurrent=null,this.flushMainBuffer(0,Number.POSITIVE_INFINITY)))}}} },{ key:'_reduceMaxBufferLength',value:function(e){var t=this.config;t.maxMaxBufferLength>=e&&(t.maxMaxBufferLength/=2,_.logger.warn('main:reduce max buffer length to '+t.maxMaxBufferLength+'s'),this.fragLoadIdx+=2*t.fragLoadingLoopThreshold)} },{ key:'_checkBuffer',value:function(){var e=this.media;if(e&&e.readyState){var t=e.currentTime,r=this.mediaBuffer?this.mediaBuffer:e,i=r.buffered;if(!this.loadedmetadata&&i.length){this.loadedmetadata=!0;var a=e.seeking?t:this.startPosition,n=f.default.isBuffered(r,a);t===a&&n||(_.logger.log('target start position:'+a),n||(a=i.start(0),_.logger.log('target start position not buffered, seek to buffered.start(0) '+a)),_.logger.log('adjust currentTime from '+t+' to '+a),e.currentTime=a)}else if(this.immediateSwitch)this.immediateLevelSwitchEnd();else{var s=f.default.bufferInfo(e,t,0),o=!(e.paused||e.ended||0===e.buffered.length),l=t!==this.lastCurrentTime,u=this.config;if(l)this.stallReported&&(_.logger.warn('playback not stuck anymore @'+t+', after '+Math.round(performance.now()-this.stalled)+'ms'),this.stallReported=!1),this.stalled=void 0,this.nudgeRetry=0;else if(o){var d=performance.now(),c=this.hls;if(this.stalled){var h=d-this.stalled,g=s.len,p=this.nudgeRetry||0;if(g<=.5&&h>1e3*u.lowBufferWatchdogPeriod){this.stallReported||(this.stallReported=!0,_.logger.warn('playback stalling in low buffer @'+t),c.trigger(v.default.ERROR,{ type:k.ErrorTypes.MEDIA_ERROR,details:k.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:g }));var y=s.nextStart,m=y-t;if(y&&m<u.maxSeekHole&&m>0){this.nudgeRetry=++p;var E=p*u.nudgeOffset;_.logger.log('adjust currentTime from '+e.currentTime+' to next buffered @ '+y+' + nudge '+E),e.currentTime=y+E,this.stalled=void 0,c.trigger(v.default.ERROR,{ type:k.ErrorTypes.MEDIA_ERROR,details:k.ErrorDetails.BUFFER_SEEK_OVER_HOLE,fatal:!1,hole:y+E-t })}}else if(g>.5&&h>1e3*u.highBufferWatchdogPeriod)if(this.stallReported||(this.stallReported=!0,_.logger.warn('playback stalling in high buffer @'+t),c.trigger(v.default.ERROR,{ type:k.ErrorTypes.MEDIA_ERROR,details:k.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!1,buffer:g })),this.stalled=void 0,this.nudgeRetry=++p,p<u.nudgeMaxRetry){var b=e.currentTime,T=b+p*u.nudgeOffset;_.logger.log('adjust currentTime from '+b+' to '+T),e.currentTime=T,c.trigger(v.default.ERROR,{ type:k.ErrorTypes.MEDIA_ERROR,details:k.ErrorDetails.BUFFER_NUDGE_ON_STALL,fatal:!1 })}else _.logger.error('still stuck in high buffer @'+t+' after '+u.nudgeMaxRetry+', raise fatal error'),c.trigger(v.default.ERROR,{ type:k.ErrorTypes.MEDIA_ERROR,details:k.ErrorDetails.BUFFER_STALLED_ERROR,fatal:!0 })}else this.stalled=d,this.stallReported=!1}}}} },{ key:'onFragLoadEmergencyAborted',value:function(){this.state=R.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tick()} },{ key:'onBufferFlushed',value:function(){var e=this.mediaBuffer?this.mediaBuffer:this.media;this._bufferedFrags=this._bufferedFrags.filter(function(t){return f.default.isBuffered(e,(t.startPTS+t.endPTS)/2)}),this.fragLoadIdx+=2*this.config.fragLoadingLoopThreshold,this.state=R.IDLE,this.fragPrevious=null} },{ key:'swapAudioCodec',value:function(){this.audioCodecSwap=!this.audioCodecSwap} },{ key:'computeLivePosition',value:function(e,t){var r=void 0!==this.config.liveSyncDuration?this.config.liveSyncDuration:this.config.liveSyncDurationCount*t.targetduration;return e+Math.max(0,t.totalduration-r)} },{ key:'state',set:function(e){if(this.state!==e){var t=this.state;this._state=e,_.logger.log('main stream:'+t+'->'+e),this.hls.trigger(v.default.STREAM_STATE_TRANSITION,{ previousState:t,nextState:e })}},get:function(){return this._state} },{ key:'currentLevel',get:function(){var e=this.media;if(e){var t=this.getBufferedFrag(e.currentTime);if(t)return t.level}return-1} },{ key:'nextBufferedFrag',get:function(){var e=this.media;return e?this.followingBufferedFrag(this.getBufferedFrag(e.currentTime)):null} },{ key:'nextLevel',get:function(){var e=this.nextBufferedFrag;return e?e.level:-1} },{ key:'liveSyncPosition',get:function(){return this._liveSyncPosition},set:function(e){this._liveSyncPosition=e} }]),t}(y.default);r.default=A},{ 25:25,33:33,34:34,35:35,37:37,38:38,48:48,53:53,54:54 }],14:[function(e,t,r){'use strict';function i(e){return e&&e.__esModule?e:{ default:e }}function a(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||'object'!=typeof t&&'function'!=typeof t?e:t}function s(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+typeof t);e.prototype=Object.create(t&&t.prototype,{ constructor:{ value:e,enumerable:!1,writable:!0,configurable:!0 } }),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,'__esModule',{ value:!0 });var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,'value'in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=e(35),u=i(l),d=e(34),f=i(d),c=e(53),h=function(e){function t(e){a(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.ERROR,u.default.SUBTITLE_TRACKS_UPDATED,u.default.SUBTITLE_TRACK_SWITCH,u.default.SUBTITLE_TRACK_LOADED,u.default.SUBTITLE_FRAG_PROCESSED));return r.config=e.config,r.vttFragSNsProcessed={},r.vttFragQueues=void 0,r.currentlyProcessing=null,r.currentTrackId=-1,r}return s(t,e),o(t,[{ key:'destroy',value:function(){f.default.prototype.destroy.call(this)} },{ key:'clearVttFragQueues',value:function(){var e=this;this.vttFragQueues={},this.tracks.forEach(function(t){e.vttFragQueues[t.id]=[]})} },{ key:'nextFrag',value:function(){if(null===this.currentlyProcessing&&this.currentTrackId>-1&&this.vttFragQueues[this.currentTrackId].length){var e=this.currentlyProcessing=this.vttFragQueues[this.currentTrackId].shift();this.hls.trigger(u.default.FRAG_LOADING,{ frag:e })}} },{ key:'onSubtitleFragProcessed',value:function(e){e.success&&this.vttFragSNsProcessed[e.frag.trackId].push(e.frag.sn),this.currentlyProcessing=null,this.nextFrag()} },{ key:'onError',value:function(e){var t=e.frag;t&&'subtitle'!==t.type||this.currentlyProcessing&&(this.currentlyProcessing=null,this.nextFrag())} },{ key:'onSubtitleTracksUpdated',value:function(e){var t=this;c.logger.log('subtitle tracks updated'),this.tracks=e.subtitleTracks,this.clearVttFragQueues(),this.vttFragSNsProcessed={},this.tracks.forEach(function(e){t.vttFragSNsProcessed[e.id]=[]})} },{ key:'onSubtitleTrackSwitch',value:function(e){this.currentTrackId=e.id,this.clearVttFragQueues()} },{ key:'onSubtitleTrackLoaded',value:function(e){var t=this.vttFragSNsProcessed[e.id],r=this.vttFragQueues[e.id],i=this.currentlyProcessing?this.currentlyProcessing.sn:-1,a=function(e){return t.indexOf(e.sn)>-1},n=function(e){return r.some(function(t){return t.sn===e.sn})};e.details.fragments.forEach(function(t){a(t)||t.sn===i||n(t)||(t.trackId=e.id,r.push(t))}),this.nextFrag()} }]),t}(f.default);r.default=h},{ 34:34,35:35,53:53 }],15:[function(e,t,r){'use strict';function i(e){return e&&e.__esModule?e:{ default:e }}function a(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||'object'!=typeof t&&'function'!=typeof t?e:t}function s(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+typeof t);e.prototype=Object.create(t&&t.prototype,{ constructor:{ value:e,enumerable:!1,writable:!0,configurable:!0 } }),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function o(e){for(var t=[],r=0;r<e.length;r++)'subtitles'===e[r].kind&&t.push(e[r]);return t}Object.defineProperty(r,'__esModule',{ value:!0 });var l=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,'value'in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),u=e(35),d=i(u),f=e(34),c=i(f),h=e(53),g=function(e){function t(e){a(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,d.default.MEDIA_ATTACHED,d.default.MEDIA_DETACHING,d.default.MANIFEST_LOADING,d.default.MANIFEST_LOADED,d.default.SUBTITLE_TRACK_LOADED));return r.tracks=[],r.trackId=-1,r.media=void 0,r}return s(t,e),l(t,[{ key:'destroy',value:function(){c.default.prototype.destroy.call(this)} },{ key:'onMediaAttached',value:function(e){var t=this;this.media=e.media,this.media&&this.media.textTracks.addEventListener('change',function(){if(t.media){for(var e=-1,r=o(t.media.textTracks),i=0;i<r.length;i++)'showing'===r[i].mode&&(e=i);t.subtitleTrack=e}})} },{ key:'onMediaDetaching',value:function(){this.media=void 0} },{ key:'onManifestLoading',value:function(){this.tracks=[],this.trackId=-1} },{ key:'onManifestLoaded',value:function(e){var t=this,r=e.subtitles||[],i=!1;this.tracks=r,this.trackId=-1,this.hls.trigger(d.default.SUBTITLE_TRACKS_UPDATED,{ subtitleTracks:r }),r.forEach(function(e){e.default&&(t.subtitleTrack=e.id,i=!0)})} },{ key:'onTick',value:function(){var e=this.trackId,t=this.tracks[e];if(t){var r=t.details;void 0!==r&&!0!==r.live||(h.logger.log('(re)loading playlist for subtitle track '+e),this.hls.trigger(d.default.SUBTITLE_TRACK_LOADING,{ url:t.url,id:e }))}} },{ key:'onSubtitleTrackLoaded',value:function(e){var t=this;e.id<this.tracks.length&&(h.logger.log('subtitle track '+e.id+' loaded'),this.tracks[e.id].details=e.details,e.details.live&&!this.timer&&(this.timer=setInterval(function(){t.onTick()},1e3*e.details.targetduration,this)),!e.details.live&&this.timer&&(clearInterval(this.timer),this.timer=null))} },{ key:'setSubtitleTrackInternal',value:function(e){if(e>=0&&e<this.tracks.length){this.timer&&(clearInterval(this.timer),this.timer=null),this.trackId=e,h.logger.log('switching to subtitle track '+e);var t=this.tracks[e];this.hls.trigger(d.default.SUBTITLE_TRACK_SWITCH,{ id:e });var r=t.details;void 0!==r&&!0!==r.live||(h.logger.log('(re)loading playlist for subtitle track '+e),this.hls.trigger(d.default.SUBTITLE_TRACK_LOADING,{ url:t.url,id:e }))}} },{ key:'subtitleTracks',get:function(){return this.tracks} },{ key:'subtitleTrack',get:function(){return this.trackId},set:function(e){this.trackId!==e&&this.setSubtitleTrackInternal(e)} }]),t}(c.default);r.default=g},{ 34:34,35:35,53:53 }],16:[function(e,t,r){'use strict';function i(e){return e&&e.__esModule?e:{ default:e }}function a(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||'object'!=typeof t&&'function'!=typeof t?e:t}function s(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+typeof t);e.prototype=Object.create(t&&t.prototype,{ constructor:{ value:e,enumerable:!1,writable:!0,configurable:!0 } }),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function o(e){if(e&&e.cues)for(;e.cues.length>0;)e.removeCue(e.cues[0])}function l(e,t){return e&&e.label===t.name&&!(e.textTrack1||e.textTrack2)}function u(e,t,r,i){return Math.min(t,i)-Math.max(e,r)}Object.defineProperty(r,'__esModule',{ value:!0 });var d=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,'value'in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),f=e(35),c=i(f),h=e(34),g=i(h),v=e(49),p=i(v),y=e(57),m=i(y),E=e(53),b=function(e){function t(e){a(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,c.default.MEDIA_ATTACHING,c.default.MEDIA_DETACHING,c.default.FRAG_PARSING_USERDATA,c.default.MANIFEST_LOADING,c.default.MANIFEST_LOADED,c.default.FRAG_LOADED,c.default.LEVEL_SWITCHING,c.default.INIT_PTS_FOUND));if(r.hls=e,r.config=e.config,r.enabled=!0,r.Cues=e.config.cueHandler,r.textTracks=[],r.tracks=[],r.unparsedVttFrags=[],r.initPTS=void 0,r.cueRanges=[],r.config.enableCEA708Captions){var i=r,s=function(e,t){var r=null;try{r=new window.Event('addtrack')}catch(e){r=document.createEvent('Event'),r.initEvent('addtrack',!1,!1)}r.track=e,t.dispatchEvent(r)},l={ newCue:function(e,t,r){if(!i.textTrack1){var a=i.getExistingTrack('1');if(a)i.textTrack1=a,o(i.textTrack1),s(i.textTrack1,i.media);else{var n=i.createTextTrack('captions',i.config.captionsTextTrack1Label,i.config.captionsTextTrack1LanguageCode);n&&(n.textTrack1=!0,i.textTrack1=n)}}i.addCues('textTrack1',e,t,r)} },u={ newCue:function(e,t,r){if(!i.textTrack2){var a=i.getExistingTrack('2');if(a)i.textTrack2=a,o(i.textTrack2),s(i.textTrack2,i.media);else{
var n=i.createTextTrack('captions',i.config.captionsTextTrack2Label,i.config.captionsTextTrack1LanguageCode);n&&(n.textTrack2=!0,i.textTrack2=n)}}i.addCues('textTrack2',e,t,r)} };r.cea608Parser=new p.default(0,l,u)}return r}return s(t,e),d(t,[{ key:'addCues',value:function(e,t,r,i){for(var a=this.cueRanges,n=!1,s=a.length;s--;){var o=a[s],l=u(o[0],o[1],t,r);if(l>=0&&(o[0]=Math.min(o[0],t),o[1]=Math.max(o[1],r),n=!0,l/(r-t)>.5))return}n||a.push([t,r]),this.Cues.newCue(this[e],t,r,i)} },{ key:'onInitPtsFound',value:function(e){var t=this;void 0===this.initPTS&&(this.initPTS=e.initPTS),this.unparsedVttFrags.length&&(this.unparsedVttFrags.forEach(function(e){t.onFragLoaded(e)}),this.unparsedVttFrags=[])} },{ key:'getExistingTrack',value:function(e){var t=this.media;if(t)for(var r=0;r<t.textTracks.length;r++){var i=t.textTracks[r],a='textTrack'+e;if(!0===i[a])return i}return null} },{ key:'createTextTrack',value:function(e,t,r){var i=this.media;if(i)return E.logger.log('createTextTrack: '+e+', '+t+', '+r),i.addTextTrack(e,t,r)} },{ key:'destroy',value:function(){g.default.prototype.destroy.call(this)} },{ key:'onMediaAttaching',value:function(e){this.media=e.media} },{ key:'onMediaDetaching',value:function(){o(this.textTrack1),o(this.textTrack2)} },{ key:'onManifestLoading',value:function(){this.lastSn=-1,this.prevCC=-1,this.vttCCs={ ccOffset:0,presentationOffset:0 };var e=this.media;if(e){var t=e.textTracks;if(t)for(var r=0;r<t.length;r++)o(t[r])}} },{ key:'onManifestLoaded',value:function(e){var t=this;if(this.textTracks=[],this.unparsedVttFrags=this.unparsedVttFrags||[],this.initPTS=void 0,this.cueRanges=[],this.config.enableWebVTT){this.tracks=e.subtitles||[];var r=this.media?this.media.textTracks:[];this.tracks.forEach(function(e,i){var a=void 0;if(i<r.length){var n=r[i];l(n,e)&&(a=n)}a||(a=t.createTextTrack('subtitles',e.name,e.lang)),t.textTracks.push(a)})}} },{ key:'onLevelSwitching',value:function(){this.enabled='NONE'!==this.hls.currentLevel.closedCaptions} },{ key:'onFragLoaded',value:function(e){var t=e.frag,r=e.payload;if('main'===t.type){var i=t.sn;if(i!==this.lastSn+1){var a=this.cea608Parser;a&&a.reset()}this.lastSn=i}else if('subtitle'===t.type)if(r.byteLength){if(void 0===this.initPTS)return void this.unparsedVttFrags.push(e);var n=this.vttCCs;n[t.cc]||(n[t.cc]={ start:t.start,prevCC:this.prevCC,new:!0 },this.prevCC=t.cc);var s=this.textTracks,o=this.hls;m.default.parse(r,this.initPTS,n,t.cc,function(e){var r=s[t.trackId];e.forEach(function(e){r.cues.getCueById(e.id)||r.addCue(e)}),o.trigger(c.default.SUBTITLE_FRAG_PROCESSED,{ success:!0,frag:t })},function(e){E.logger.log('Failed to parse VTT cue: '+e),o.trigger(c.default.SUBTITLE_FRAG_PROCESSED,{ success:!1,frag:t })})}else this.hls.trigger(c.default.SUBTITLE_FRAG_PROCESSED,{ success:!1,frag:t })} },{ key:'onFragParsingUserdata',value:function(e){if(this.enabled&&this.config.enableCEA708Captions)for(var t=0;t<e.samples.length;t++){var r=this.extractCea608Data(e.samples[t].bytes);this.cea608Parser.addData(e.samples[t].pts,r)}} },{ key:'extractCea608Data',value:function(e){for(var t,r,i,a,n,s=31&e[0],o=2,l=[],u=0;u<s;u++)t=e[o++],r=127&e[o++],i=127&e[o++],a=0!=(4&t),n=3&t,0===r&&0===i||a&&0===n&&(l.push(r),l.push(i));return l} }]),t}(g.default);r.default=b},{ 34:34,35:35,49:49,53:53,57:57 }],17:[function(e,t,r){'use strict';function i(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(r,'__esModule',{ value:!0 });var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,'value'in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function(){function e(t,r){i(this,e),this.subtle=t,this.aesIV=r}return a(e,[{ key:'decrypt',value:function(e,t){return this.subtle.decrypt({ name:'AES-CBC',iv:this.aesIV },t,e)} }]),e}();r.default=n},{}],18:[function(e,t,r){'use strict';function i(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(r,'__esModule',{ value:!0 });var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,'value'in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function(){function e(){i(this,e),this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.initTable()}return a(e,[{ key:'uint8ArrayToUint32Array_',value:function(e){for(var t=new DataView(e),r=new Uint32Array(4),i=0;i<4;i++)r[i]=t.getUint32(4*i);return r} },{ key:'initTable',value:function(){var e=this.sBox,t=this.invSBox,r=this.subMix,i=r[0],a=r[1],n=r[2],s=r[3],o=this.invSubMix,l=o[0],u=o[1],d=o[2],f=o[3],c=new Uint32Array(256),h=0,g=0,v=0;for(v=0;v<256;v++)c[v]=v<128?v<<1:v<<1^283;for(v=0;v<256;v++){var p=g^g<<1^g<<2^g<<3^g<<4;p=p>>>8^255&p^99,e[h]=p,t[p]=h;var y=c[h],m=c[y],E=c[m],b=257*c[p]^16843008*p;i[h]=b<<24|b>>>8,a[h]=b<<16|b>>>16,n[h]=b<<8|b>>>24,s[h]=b,b=16843009*E^65537*m^257*y^16843008*h,l[p]=b<<24|b>>>8,u[p]=b<<16|b>>>16,d[p]=b<<8|b>>>24,f[p]=b,h?(h=y^c[c[c[E^y]]],g^=c[c[g]]):h=g=1}} },{ key:'expandKey',value:function(e){for(var t=this.uint8ArrayToUint32Array_(e),r=!0,i=0;i<t.length&&r;)r=t[i]===this.key[i],i++;if(!r){this.key=t;var a=this.keySize=t.length;if(4!==a&&6!==a&&8!==a)throw new Error('Invalid aes key size='+a);var n=this.ksRows=4*(a+6+1),s=void 0,o=void 0,l=this.keySchedule=new Uint32Array(n),u=this.invKeySchedule=new Uint32Array(n),d=this.sBox,f=this.rcon,c=this.invSubMix,h=c[0],g=c[1],v=c[2],p=c[3],y=void 0,m=void 0;for(s=0;s<n;s++)s<a?y=l[s]=t[s]:(m=y,s%a==0?(m=m<<8|m>>>24,m=d[m>>>24]<<24|d[m>>>16&255]<<16|d[m>>>8&255]<<8|d[255&m],m^=f[s/a|0]<<24):a>6&&s%a==4&&(m=d[m>>>24]<<24|d[m>>>16&255]<<16|d[m>>>8&255]<<8|d[255&m]),l[s]=y=(l[s-a]^m)>>>0);for(o=0;o<n;o++)s=n-o,m=3&o?l[s]:l[s-4],u[o]=o<4||s<=4?m:h[d[m>>>24]]^g[d[m>>>16&255]]^v[d[m>>>8&255]]^p[d[255&m]],u[o]=u[o]>>>0}} },{ key:'networkToHostOrderSwap',value:function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24} },{ key:'decrypt',value:function(e,t,r){for(var i,a,n=this.keySize+6,s=this.invKeySchedule,o=this.invSBox,l=this.invSubMix,u=l[0],d=l[1],f=l[2],c=l[3],h=this.uint8ArrayToUint32Array_(r),g=h[0],v=h[1],p=h[2],y=h[3],m=new Int32Array(e),E=new Int32Array(m.length),b=void 0,T=void 0,k=void 0,_=void 0,R=void 0,A=void 0,S=void 0,L=void 0,w=void 0,D=void 0,O=void 0,I=void 0,P=this.networkToHostOrderSwap;t<m.length;){for(w=P(m[t]),D=P(m[t+1]),O=P(m[t+2]),I=P(m[t+3]),R=w^s[0],A=I^s[1],S=O^s[2],L=D^s[3],i=4,a=1;a<n;a++)b=u[R>>>24]^d[A>>16&255]^f[S>>8&255]^c[255&L]^s[i],T=u[A>>>24]^d[S>>16&255]^f[L>>8&255]^c[255&R]^s[i+1],k=u[S>>>24]^d[L>>16&255]^f[R>>8&255]^c[255&A]^s[i+2],_=u[L>>>24]^d[R>>16&255]^f[A>>8&255]^c[255&S]^s[i+3],R=b,A=T,S=k,L=_,i+=4;b=o[R>>>24]<<24^o[A>>16&255]<<16^o[S>>8&255]<<8^o[255&L]^s[i],T=o[A>>>24]<<24^o[S>>16&255]<<16^o[L>>8&255]<<8^o[255&R]^s[i+1],k=o[S>>>24]<<24^o[L>>16&255]<<16^o[R>>8&255]<<8^o[255&A]^s[i+2],_=o[L>>>24]<<24^o[R>>16&255]<<16^o[A>>8&255]<<8^o[255&S]^s[i+3],i+=3,E[t]=P(b^g),E[t+1]=P(_^v),E[t+2]=P(k^p),E[t+3]=P(T^y),g=w,v=D,p=O,y=I,t+=4}return E.buffer} },{ key:'destroy',value:function(){this.key=void 0,this.keySize=void 0,this.ksRows=void 0,this.sBox=void 0,this.invSBox=void 0,this.subMix=void 0,this.invSubMix=void 0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.rcon=void 0} }]),e}();r.default=n},{}],19:[function(e,t,r){'use strict';function i(e){return e&&e.__esModule?e:{ default:e }}function a(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(r,'__esModule',{ value:!0 });var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,'value'in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),s=e(17),o=i(s),l=e(20),u=i(l),d=e(18),f=i(d),c=e(33),h=e(53),g=function(){function e(t,r){a(this,e),this.observer=t,this.config=r,this.logEnabled=!0;try{var i=crypto||self.crypto;this.subtle=i.subtle||i.webkitSubtle}catch(e){}this.disableWebCrypto=!this.subtle}return n(e,[{ key:'isSync',value:function(){return this.disableWebCrypto&&this.config.enableSoftwareAES} },{ key:'decrypt',value:function(e,t,r,i){var a=this;if(this.disableWebCrypto&&this.config.enableSoftwareAES){this.logEnabled&&(h.logger.log('JS AES decrypt'),this.logEnabled=!1);var n=this.decryptor;n||(this.decryptor=n=new f.default),n.expandKey(t),i(n.decrypt(e,0,r))}else{this.logEnabled&&(h.logger.log('WebCrypto AES decrypt'),this.logEnabled=!1);var s=this.subtle;this.key!==t&&(this.key=t,this.fastAesKey=new u.default(s,t)),this.fastAesKey.expandKey().then(function(n){new o.default(s,r).decrypt(e,n).catch(function(n){a.onWebCryptoError(n,e,t,r,i)}).then(function(e){i(e)})}).catch(function(n){a.onWebCryptoError(n,e,t,r,i)})}} },{ key:'onWebCryptoError',value:function(e,t,r,i,a){this.config.enableSoftwareAES?(h.logger.log('WebCrypto Error, disable WebCrypto API'),this.disableWebCrypto=!0,this.logEnabled=!0,this.decrypt(t,r,i,a)):(h.logger.error('decrypting error : '+e.message),this.observer.trigger(Event.ERROR,{ type:c.ErrorTypes.MEDIA_ERROR,details:c.ErrorDetails.FRAG_DECRYPT_ERROR,fatal:!0,reason:e.message }))} },{ key:'destroy',value:function(){var e=this.decryptor;e&&(e.destroy(),this.decryptor=void 0)} }]),e}();r.default=g},{ 17:17,18:18,20:20,33:33,53:53 }],20:[function(e,t,r){'use strict';function i(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(r,'__esModule',{ value:!0 });var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,'value'in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function(){function e(t,r){i(this,e),this.subtle=t,this.key=r}return a(e,[{ key:'expandKey',value:function(){return this.subtle.importKey('raw',this.key,{ name:'AES-CBC' },!1,['encrypt','decrypt'])} }]),e}();r.default=n},{}],21:[function(e,t,r){'use strict';function i(e){return e&&e.__esModule?e:{ default:e }}function a(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(r,'__esModule',{ value:!0 });var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,'value'in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),s=e(22),o=i(s),l=e(53),u=e(27),d=i(u),f=function(){function e(t,r,i){a(this,e),this.observer=t,this.config=i,this.remuxer=r}return n(e,[{ key:'resetInitSegment',value:function(e,t,r,i){this._audioTrack={ container:'audio/adts',type:'audio',id:-1,sequenceNumber:0,isAAC:!0,samples:[],len:0,manifestCodec:t,duration:i,inputTimeScale:9e4 }} },{ key:'resetTimeStamp',value:function(){} },{ key:'append',value:function(e,t,r,i){var a,n,s,u,f,c,h,g,v,p,y=new d.default(e),m=90*y.timeStamp;for(a=this._audioTrack,c=y.length,v=e.length;c<v-1&&(255!==e[c]||240!=(246&e[c+1]));c++);for(a.samplerate||(n=o.default.getAudioConfig(this.observer,e,c,a.manifestCodec),a.config=n.config,a.samplerate=n.samplerate,a.channelCount=n.channelCount,a.codec=n.codec,l.logger.log('parsed codec:'+a.codec+',rate:'+n.samplerate+',nb channel:'+n.channelCount)),f=0,u=9216e4/a.samplerate;c+5<v&&(h=1&e[c+1]?7:9,s=(3&e[c+3])<<11|e[c+4]<<3|(224&e[c+5])>>>5,(s-=h)>0&&c+h+s<=v);)for(g=m+f*u,p={ unit:e.subarray(c+h,c+h+s),pts:g,dts:g },a.samples.push(p),a.len+=s,c+=s+h,f++;c<v-1&&(255!==e[c]||240!=(246&e[c+1]));c++);this.remuxer.remux(a,{ samples:[] },{ samples:[{ pts:m,dts:m,data:y.payload }],inputTimeScale:9e4 },{ samples:[] },t,r,i)} },{ key:'destroy',value:function(){} }],[{ key:'probe',value:function(e){var t,r,i=new d.default(e);if(i.hasTimeStamp)for(t=i.length,r=Math.min(e.length-1,t+100);t<r;t++)if(255===e[t]&&240==(246&e[t+1]))return!0;return!1} }]),e}();r.default=f},{ 22:22,27:27,53:53 }],22:[function(e,t,r){'use strict';var i=e(53),a=e(33),n={ getAudioConfig:function(e,t,r,n){var s,o,l,u,d,f=navigator.userAgent.toLowerCase(),c=n,h=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];return s=1+((192&t[r+2])>>>6),(o=(60&t[r+2])>>>2)>h.length-1?void e.trigger(Event.ERROR,{ type:a.ErrorTypes.MEDIA_ERROR,details:a.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:'invalid ADTS sampling index:'+o }):(u=(1&t[r+2])<<2,u|=(192&t[r+3])>>>6,i.logger.log('manifest codec:'+n+',ADTS data:type:'+s+',sampleingIndex:'+o+'['+h[o]+'Hz],channelConfig:'+u),/firefox/i.test(f)?o>=6?(s=5,d=new Array(4),l=o-3):(s=2,d=new Array(2),l=o):-1!==f.indexOf('android')?(s=2,d=new Array(2),l=o):(s=5,d=new Array(4),n&&(-1!==n.indexOf('mp4a.40.29')||-1!==n.indexOf('mp4a.40.5'))||!n&&o>=6?l=o-3:((n&&-1!==n.indexOf('mp4a.40.2')&&o>=6&&1===u||!n&&1===u)&&(s=2,d=new Array(2)),l=o)),d[0]=s<<3,d[0]|=(14&o)>>1,d[1]|=(1&o)<<7,d[1]|=u<<3,5===s&&(d[1]|=(14&l)>>1,d[2]=(1&l)<<7,d[2]|=8,d[3]=0),{ config:d,samplerate:h[o],channelCount:u,codec:'mp4a.40.'+s,manifestCodec:c })} };t.exports=n},{ 33:33,53:53 }],23:[function(e,t,r){'use strict';function i(e){return e&&e.__esModule?e:{ default:e }}function a(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(r,'__esModule',{ value:!0 });var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,'value'in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),s=e(35),o=i(s),l=e(33),u=e(19),d=i(u),f=e(21),c=i(f),h=e(29),g=i(h),v=e(32),p=i(v),y=e(28),m=i(y),E=e(45),b=i(E),T=e(46),k=i(T),_=function(){function e(t,r,i,n){a(this,e),this.observer=t,this.typeSupported=r,this.config=i,this.vendor=n}return n(e,[{ key:'destroy',value:function(){var e=this.demuxer;e&&e.destroy()} },{ key:'push',value:function(e,t,r,i,a,n,s,l,u,f,c,h){if(e.byteLength>0&&null!=t&&null!=t.key&&'AES-128'===t.method){var g=this.decrypter;null==g&&(g=this.decrypter=new d.default(this.observer,this.config));var v,p=this;try{v=performance.now()}catch(e){v=Date.now()}g.decrypt(e,t.key.buffer,t.iv.buffer,function(e){var d;try{d=performance.now()}catch(e){d=Date.now()}p.observer.trigger(o.default.FRAG_DECRYPTED,{ stats:{ tstart:v,tdecrypt:d } }),p.pushDecrypted(new Uint8Array(e),t,new Uint8Array(r),i,a,n,s,l,u,f,c,h)})}else this.pushDecrypted(new Uint8Array(e),t,new Uint8Array(r),i,a,n,s,l,u,f,c,h)} },{ key:'pushDecrypted',value:function(e,t,r,i,a,n,s,u,d,f,h,v){var y=this.demuxer;if(!y||s&&!this.probe(e)){var E=this.observer,T=this.typeSupported,_=this.config,R=[{ demux:p.default,remux:b.default },{ demux:m.default,remux:b.default },{ demux:c.default,remux:b.default },{ demux:g.default,remux:k.default }];for(var A in R){var S=R[A],L=S.demux.probe;if(L(e)){var w=this.remuxer=new S.remux(E,_,T,this.vendor);y=new S.demux(E,w,_,T),this.probe=L;break}}if(!y)return void E.trigger(o.default.ERROR,{ type:l.ErrorTypes.MEDIA_ERROR,details:l.ErrorDetails.FRAG_PARSING_ERROR,fatal:!0,reason:'no demux matching with content found' });this.demuxer=y}var D=this.remuxer;(s||u)&&(y.resetInitSegment(r,i,a,f),D.resetInitSegment()),s&&(y.resetTimeStamp(),D.resetTimeStamp(v)),'function'==typeof y.setDecryptData&&y.setDecryptData(t),y.append(e,n,d,h)} }]),e}();r.default=_},{ 19:19,21:21,28:28,29:29,32:32,33:33,35:35,45:45,46:46 }],24:[function(e,t,r){'use strict';function i(e){return e&&e.__esModule?e:{ default:e }}Object.defineProperty(r,'__esModule',{ value:!0 });var a=e(23),n=i(a),s=e(35),o=i(s),l=e(53),u=e(1),d=i(u),f=function(e){var t=new d.default;t.trigger=function(e){for(var r=arguments.length,i=Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];t.emit.apply(t,[e,e].concat(i))},t.off=function(e){for(var r=arguments.length,i=Array(r>1?r-1:0),a=1;a<r;a++)i[a-1]=arguments[a];t.removeListener.apply(t,[e].concat(i))};var r=function(t,r){e.postMessage({ event:t,data:r })};e.addEventListener('message',function(i){var a=i.data;switch(a.cmd){case'init':var s=JSON.parse(a.config);e.demuxer=new n.default(t,a.typeSupported,s,a.vendor);try{(0,l.enableLogs)(!0===s.debug)}catch(e){}r('init',null);break;case'demux':e.demuxer.push(a.data,a.decryptdata,a.initSegment,a.audioCodec,a.videoCodec,a.timeOffset,a.discontinuity,a.trackSwitch,a.contiguous,a.duration,a.accurateTimeOffset,a.defaultInitPTS)}}),t.on(o.default.FRAG_DECRYPTED,r),t.on(o.default.FRAG_PARSING_INIT_SEGMENT,r),t.on(o.default.FRAG_PARSED,r),t.on(o.default.ERROR,r),t.on(o.default.FRAG_PARSING_METADATA,r),t.on(o.default.FRAG_PARSING_USERDATA,r),t.on(o.default.INIT_PTS_FOUND,r),t.on(o.default.FRAG_PARSING_DATA,function(t,r){var i=[],a={ event:t,data:r };r.data1&&(a.data1=r.data1.buffer,i.push(r.data1.buffer),delete r.data1),r.data2&&(a.data2=r.data2.buffer,i.push(r.data2.buffer),delete r.data2),e.postMessage(a,i)})};r.default=f},{ 1:1,23:23,35:35,53:53 }],25:[function(e,t,r){'use strict';function i(e){return e&&e.__esModule?e:{ default:e }}function a(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(r,'__esModule',{ value:!0 });var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,'value'in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),s=e(35),o=i(s),l=e(23),u=i(l),d=e(24),f=i(d),c=e(53),h=e(33),g=e(1),v=i(g),p=function(){function t(r,i){a(this,t),this.hls=r,this.id=i;var n=this.observer=new v.default,s=r.config;n.trigger=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];n.emit.apply(n,[e,e].concat(r))},n.off=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];n.removeListener.apply(n,[e].concat(r))};var l=function(e,t){t=t||{},t.frag=this.frag,t.id=this.id,r.trigger(e,t)}.bind(this);n.on(o.default.FRAG_DECRYPTED,l),n.on(o.default.FRAG_PARSING_INIT_SEGMENT,l),n.on(o.default.FRAG_PARSING_DATA,l),n.on(o.default.FRAG_PARSED,l),n.on(o.default.ERROR,l),n.on(o.default.FRAG_PARSING_METADATA,l),n.on(o.default.FRAG_PARSING_USERDATA,l),n.on(o.default.INIT_PTS_FOUND,l);var d={ mp4:MediaSource.isTypeSupported('video/mp4'),mpeg:MediaSource.isTypeSupported('audio/mpeg'),mp3:MediaSource.isTypeSupported('audio/mp4; codecs="mp3"') },g=navigator.vendor;if(s.enableWorker&&'undefined'!=typeof Worker){c.logger.log('demuxing in webworker');var p=void 0;try{var y=e(3);p=this.w=y(f.default),this.onwmsg=this.onWorkerMessage.bind(this),p.addEventListener('message',this.onwmsg),p.onerror=function(e){r.trigger(o.default.ERROR,{ type:h.ErrorTypes.OTHER_ERROR,details:h.ErrorDetails.INTERNAL_EXCEPTION,fatal:!0,event:'demuxerWorker',err:{ message:e.message+' ('+e.filename+':'+e.lineno+')' } })},p.postMessage({ cmd:'init',typeSupported:d,vendor:g,id:i,config:JSON.stringify(s) })}catch(e){c.logger.error('error while initializing DemuxerWorker, fallback on DemuxerInline'),p&&URL.revokeObjectURL(p.objectURL),this.demuxer=new u.default(n,d,s,g),this.w=void 0}}else this.demuxer=new u.default(n,d,s,g)}return n(t,[{ key:'destroy',value:function(){var e=this.w;if(e)e.removeEventListener('message',this.onwmsg),e.terminate(),this.w=null;else{var t=this.demuxer;t&&(t.destroy(),this.demuxer=null)}var r=this.observer;r&&(r.removeAllListeners(),this.observer=null)} },{ key:'push',value:function(e,t,r,i,a,n,s,o){var l=this.w,u=isNaN(a.startDTS)?a.start:a.startDTS,d=a.decryptdata,f=this.frag,h=!(f&&a.cc===f.cc),g=!(f&&a.level===f.level),v=f&&a.sn===f.sn+1,p=!g&&v;if(h&&c.logger.log(this.id+':discontinuity detected'),g&&c.logger.log(this.id+':switch detected'),this.frag=a,l)l.postMessage({ cmd:'demux',data:e,decryptdata:d,initSegment:t,audioCodec:r,videoCodec:i,timeOffset:u,discontinuity:h,trackSwitch:g,contiguous:p,duration:n,accurateTimeOffset:s,defaultInitPTS:o },[e]);else{var y=this.demuxer;y&&y.push(e,d,t,r,i,u,h,g,p,n,s,o)}} },{ key:'onWorkerMessage',value:function(e){var t=e.data,r=this.hls;switch(t.event){case'init':URL.revokeObjectURL(this.w.objectURL);break;case o.default.FRAG_PARSING_DATA:t.data.data1=new Uint8Array(t.data1),t.data2&&(t.data.data2=new Uint8Array(t.data2));default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,r.trigger(t.event,t.data)}} }]),t}();r.default=p},{ 1:1,23:23,24:24,3:3,33:33,35:35,53:53 }],26:[function(e,t,r){'use strict';function i(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(r,'__esModule',{ value:!0 });var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,'value'in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=e(53),s=function(){function e(t){i(this,e),this.data=t,this.bytesAvailable=t.byteLength,this.word=0,this.bitsAvailable=0}return a(e,[{ key:'loadWord',value:function(){var e=this.data,t=this.bytesAvailable,r=e.byteLength-t,i=new Uint8Array(4),a=Math.min(4,t);if(0===a)throw new Error('no bytes available');i.set(e.subarray(r,r+a)),this.word=new DataView(i.buffer).getUint32(0),this.bitsAvailable=8*a,this.bytesAvailable-=a} },{ key:'skipBits',value:function(e){var t;this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t>>3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)} },{ key:'readBits',value:function(e){var t=Math.min(this.bitsAvailable,e),r=this.word>>>32-t;return e>32&&n.logger.error('Cannot read more than 32 bits at a time'),this.bitsAvailable-=t,this.bitsAvailable>0?this.word<<=t:this.bytesAvailable>0&&this.loadWord(),t=e-t,t>0&&this.bitsAvailable?r<<t|this.readBits(t):r} },{ key:'skipLZ',value:function(){var e;for(e=0;e<this.bitsAvailable;++e)if(0!=(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()} },{ key:'skipUEG',value:function(){this.skipBits(1+this.skipLZ())} },{ key:'skipEG',value:function(){this.skipBits(1+this.skipLZ())} },{ key:'readUEG',value:function(){var e=this.skipLZ();return this.readBits(e+1)-1} },{ key:'readEG',value:function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)} },{ key:'readBoolean',value:function(){return 1===this.readBits(1)} },{ key:'readUByte',value:function(){return this.readBits(8)} },{ key:'readUShort',value:function(){return this.readBits(16)} },{ key:'readUInt',value:function(){return this.readBits(32)} },{ key:'skipScalingList',value:function(e){var t,r,i=8,a=8;for(t=0;t<e;t++)0!==a&&(r=this.readEG(),a=(i+r+256)%256),i=0===a?i:a} },{ key:'readSPS',value:function(){var e,t,r,i,a,n,s,o=0,l=0,u=0,d=0,f=this.readUByte.bind(this),c=this.readBits.bind(this),h=this.readUEG.bind(this),g=this.readBoolean.bind(this),v=this.skipBits.bind(this),p=this.skipEG.bind(this),y=this.skipUEG.bind(this),m=this.skipScalingList.bind(this);if(f(),e=f(),c(5),v(3),f(),y(),100===e||110===e||122===e||244===e||44===e||83===e||86===e||118===e||128===e){var E=h();if(3===E&&v(1),y(),y(),v(1),g())for(n=3!==E?8:12,s=0;s<n;s++)g()&&m(s<6?16:64)}y();var b=h();if(0===b)h();else if(1===b)for(v(1),p(),p(),t=h(),s=0;s<t;s++)p();y(),v(1),r=h(),i=h(),a=c(1),0===a&&v(1),v(1),g()&&(o=h(),l=h(),u=h(),d=h());var T=[1,1];if(g()&&g()){switch(f()){case 1:T=[1,1];break;case 2:T=[12,11];break;case 3:T=[10,11];break;case 4:T=[16,11];break;case 5:T=[40,33];break;case 6:T=[24,11];break;case 7:T=[20,11];break;case 8:T=[32,11];break;case 9:T=[80,33];break;case 10:T=[18,11];break;case 11:T=[15,11];break;case 12:T=[64,33];break;case 13:T=[160,99];break;case 14:T=[4,3];break;case 15:T=[3,2];break;case 16:T=[2,1];break;case 255:T=[f()<<8|f(),f()<<8|f()]}}return{ width:Math.ceil(16*(r+1)-2*o-2*l),height:(2-a)*(i+1)*16-(a?2:4)*(u+d),pixelRatio:T }} },{ key:'readSliceType',value:function(){return this.readUByte(),this.readUEG(),this.readUEG()} }]),e}();r.default=s},{ 53:53 }],27:[function(e,t,r){'use strict';function i(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(r,'__esModule',{ value:!0 });var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,'value'in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=e(53),s=function(){function e(t){i(this,e),this._hasTimeStamp=!1,this._length=0;for(var r,a,s,o,l,u,d,f,c=0;;)if(d=this.readUTF(t,c,3),c+=3,'ID3'===d)c+=3,r=127&t[c++],a=127&t[c++],s=127&t[c++],o=127&t[c++],l=(r<<21)+(a<<14)+(s<<7)+o,u=c+l,this._parseID3Frames(t,c,u),c=u;else{if('3DI'!==d)return c-=3,void((f=c)&&(this.hasTimeStamp||n.logger.warn('ID3 tag found, but no timestamp'),this._length=f,this._payload=t.subarray(0,f)));c+=7,n.logger.log('3DI footer found, end: '+c)}}return a(e,[{ key:'readUTF',value:function(e,t,r){var i='',a=t,n=t+r;do{i+=String.fromCharCode(e[a++])}while(a<n);return i} },{ key:'_parseID3Frames',value:function(e,t,r){for(var i,a;t+8<=r;)switch(i=this.readUTF(e,t,4),t+=4,e[t++]<<24+e[t++]<<16+e[t++]<<8+e[t++],e[t++]<<8+e[t++],t,i){case'PRIV':if('com.apple.streaming.transportStreamTimestamp'===this.readUTF(e,t,44)){t+=44,t+=4;var s=1&e[t++];this._hasTimeStamp=!0,a=((e[t++]<<23)+(e[t++]<<15)+(e[t++]<<7)+e[t++])/45,s&&(a+=47721858.84),a=Math.round(a),n.logger.trace('ID3 timestamp found: '+a),this._timeStamp=a}}} },{ key:'hasTimeStamp',get:function(){return this._hasTimeStamp} },{ key:'timeStamp',get:function(){return this._timeStamp} },{ key:'length',get:function(){return this._length} },{ key:'payload',get:function(){return this._payload} }]),e}();r.default=s},{ 53:53 }],28:[function(e,t,r){'use strict';function i(e){return e&&e.__esModule?e:{ default:e }}function a(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(r,'__esModule',{ value:!0 });var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,'value'in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),s=e(27),o=i(s),l=e(30),u=i(l),d=function(){function e(t,r,i){a(this,e),this.observer=t,this.config=i,this.remuxer=r}return n(e,[{ key:'resetInitSegment',value:function(e,t,r,i){this._audioTrack={ container:'audio/mpeg',type:'audio',id:-1,sequenceNumber:0,isAAC:!1,samples:[],len:0,manifestCodec:t,duration:i,inputTimeScale:9e4 }} },{ key:'resetTimeStamp',value:function(){} },{ key:'append',value:function(e,t,r,i){var a,n,s=new o.default(e),l=90*s.timeStamp,d=s.length;for(a=d,n=e.length;a<n-1&&(255!==e[a]||224!=(224&e[a+1])||0==(6&e[a+1]));a++);u.default.parse(this._audioTrack,e,s.length,l),this.remuxer.remux(this._audioTrack,{ samples:[] },{ samples:[{ pts:l,dts:l,data:s.payload }],inputTimeScale:9e4 },{ samples:[] },t,r,i)} },{ key:'destroy',value:function(){} }],[{ key:'probe',value:function(e){var t,r,i=new o.default(e);if(i.hasTimeStamp)for(t=i.length,r=Math.min(e.length-1,t+100);t<r;t++)if(255===e[t]&&224==(224&e[t+1])&&0!=(6&e[t+1]))return!0;return!1} }]),e}();r.default=d},{ 27:27,30:30 }],29:[function(e,t,r){'use strict';function i(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(r,'__esModule',{ value:!0 });var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,'value'in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=e(35),s=function(e){return e&&e.__esModule?e:{ default:e }}(n),o=function(){function e(t,r){i(this,e),this.observer=t,this.remuxer=r}return a(e,[{ key:'resetTimeStamp',value:function(){} },{ key:'resetInitSegment',value:function(t,r,i,a){var n=this.initData=e.parseInitSegment(t),o={};n.audio&&(o.audio={ container:'audio/mp4',codec:r,initSegment:t }),n.video&&(o.video={ container:'video/mp4',codec:i,initSegment:t }),this.observer.trigger(s.default.FRAG_PARSING_INIT_SEGMENT,{ tracks:o })} },{ key:'append',value:function(t,r,i,a){var n=this.initData,s=e.startDTS(n,t);this.remuxer.remux(n.audio,n.video,null,null,s,i,a,t)} },{ key:'destroy',value:function(){} }],[{ key:'probe',value:function(t){if(t.length>=8){return['moof','ftyp','styp'].indexOf(e.bin2str(t.subarray(4,8)))>=0}return!1} },{ key:'bin2str',value:function(e){return String.fromCharCode.apply(null,e)} },{ key:'readUint32',value:function(e,t){var r=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3];return r<0?4294967296+r:r} },{ key:'findBox',value:function(t,r){var i,a,n,s,o,l=[];if(!r.length)return null;for(i=0;i<t.byteLength;)a=e.readUint32(t,i),n=e.bin2str(t.subarray(i+4,i+8)),s=a>1?i+a:t.byteLength,n===r[0]&&(1===r.length?l.push(t.subarray(i+8,s)):(o=e.findBox(t.subarray(i+8,s),r.slice(1)),o.length&&(l=l.concat(o)))),i=s;return l} },{ key:'parseInitSegment',value:function(t){var r=[];return e.findBox(t,['moov','trak']).forEach(function(t){var i=e.findBox(t,['tkhd'])[0];if(i){var a=i[0],n=0===a?12:20,s=e.readUint32(i,n),o=e.findBox(t,['mdia','mdhd'])[0];if(o){a=o[0],n=0===a?12:20;var l=e.readUint32(o,n),u=e.findBox(t,['mdia','hdlr'])[0];if(u){var d=e.bin2str(u.subarray(8,12)),f={ soun:'audio',vide:'video' }[d];f&&(r[s]={ timescale:l,type:f },r[f]={ timescale:l,id:s })}}}}),r} },{ key:'startDTS',value:function(t,r){var i,a,n;return i=e.findBox(r,['moof','traf']),a=[].concat.apply([],i.map(function(r){return e.findBox(r,['tfhd']).map(function(i){var a,n,s;return a=e.readUint32(i,4),n=t[a].timescale||9e4,s=e.findBox(r,['tfdt']).map(function(t){var r,i;return r=t[0],i=e.readUint32(t,4),1===r&&(i*=Math.pow(2,32),i+=e.readUint32(t,8)),i})[0],(s=s||1/0)/n})})),n=Math.min.apply(null,a),isFinite(n)?n:0} }]),e}();r.default=o},{ 35:35 }],30:[function(e,t,r){'use strict';var i=e(53),a={ onFrame:function(e,t,r,i,a,n,s){var o=10368e4/i,l=s+n*o;e.config=[],e.channelCount=a,e.samplerate=i,e.samples.push({ unit:t,pts:l,dts:l }),e.len+=t.length},onNoise:function(e){i.logger.warn('mpeg audio has noise: '+e.length+' bytes')},parseFrames:function(e,t,r,i,a,n){var s=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],o=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3];if(r+2>i)return-1;if(255===t[r]||224==(224&t[r+1])){if(r+24>i)return-1;var l=t[r+1]>>3&3,u=t[r+1]>>1&3,d=t[r+2]>>4&15,f=t[r+2]>>2&3,c=!!(2&t[r+2]);if(1!==l&&0!==d&&15!==d&&3!==f){var h=3===l?3-u:3===u?3:4,g=1e3*s[14*h+d-1],v=3===l?0:2===l?1:2,p=o[3*v+f],y=c?1:0,m=t[r+3]>>6==3?1:2,E=3===u?(3===l?12:6)*g/p+y<<2:(3===l?144:72)*g/p+y|0;return r+E>i?-1:(this.onFrame(e,t.subarray(r,r+E),g,p,m,a,n),E)}}for(var b=r+2;b<i;){if(255===t[b-1]&&224==(224&t[b]))return this.onNoise(t.subarray(r,b-1)),b-r-1;b++}return-1},parse:function(e,t,r,i){for(var a,n=t.length,s=0;r<n&&(a=this.parseFrames(e,t,r,n,s++,i))>0;)r+=a} };t.exports=a},{ 53:53 }],31:[function(e,t,r){'use strict';function i(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(r,'__esModule',{ value:!0 });var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,'value'in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=e(19),s=function(e){return e&&e.__esModule?e:{ default:e }}(n),o=function(){function e(t,r,a,n){i(this,e),this.decryptdata=a,this.discardEPB=n,this.decrypter=new s.default(t,r)}return a(e,[{ key:'decryptBuffer',value:function(e,t){this.decrypter.decrypt(e,this.decryptdata.key.buffer,this.decryptdata.iv.buffer,t)} },{ key:'decryptAacSample',value:function(e,t,r,i){
var a=e[t].unit,n=a.subarray(16,a.length-a.length%16),s=n.buffer.slice(n.byteOffset,n.byteOffset+n.length),o=this;this.decryptBuffer(s,function(n){n=new Uint8Array(n),a.set(n,16),i||o.decryptAacSamples(e,t+1,r)})} },{ key:'decryptAacSamples',value:function(e,t,r){for(;;t++){if(t>=e.length)return void r();if(!(e[t].unit.length<32)){var i=this.decrypter.isSync();if(this.decryptAacSample(e,t,r,i),!i)return}}} },{ key:'getAvcEncryptedData',value:function(e){for(var t=16*Math.floor((e.length-48)/160)+16,r=new Int8Array(t),i=0,a=32;a<=e.length-16;a+=160,i+=16)r.set(e.subarray(a,a+16),i);return r} },{ key:'getAvcDecryptedUnit',value:function(e,t){t=new Uint8Array(t);for(var r=0,i=32;i<=e.length-16;i+=160,r+=16)e.set(t.subarray(r,r+16),i);return e} },{ key:'decryptAvcSample',value:function(e,t,r,i,a,n){var s=this.discardEPB(a.data),o=this.getAvcEncryptedData(s),l=this;this.decryptBuffer(o.buffer,function(o){a.data=l.getAvcDecryptedUnit(s,o),n||l.decryptAvcSamples(e,t,r+1,i)})} },{ key:'decryptAvcSamples',value:function(e,t,r,i){for(;;t++,r=0){if(t>=e.length)return void i();for(var a=e[t].units;!(r>=a.length);r++){var n=a[r];if(!(n.length<=48||1!==n.type&&5!==n.type)){var s=this.decrypter.isSync();if(this.decryptAvcSample(e,t,r,i,n,s),!s)return}}}} }]),e}();r.default=o},{ 19:19 }],32:[function(e,t,r){'use strict';function i(e){return e&&e.__esModule?e:{ default:e }}function a(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(r,'__esModule',{ value:!0 });var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,'value'in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),s=e(22),o=i(s),l=e(30),u=i(l),d=e(35),f=i(d),c=e(26),h=i(c),g=e(31),v=i(g),p=e(53),y=e(33),m=function(){function e(t,r,i,n){a(this,e),this.observer=t,this.config=i,this.typeSupported=n,this.remuxer=r,this.sampleAes=null}return n(e,[{ key:'setDecryptData',value:function(e){null!=e&&null!=e.key&&'SAMPLE-AES'===e.method?this.sampleAes=new v.default(this.observer,this.config,e,this.discardEPB):this.sampleAes=null} },{ key:'resetInitSegment',value:function(e,t,r,i){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack={ container:'video/mp2t',type:'video',id:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0,dropped:0 },this._audioTrack={ container:'video/mp2t',type:'audio',id:-1,inputTimeScale:9e4,duration:i,sequenceNumber:0,samples:[],len:0,isAAC:!0 },this._id3Track={ type:'id3',id:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0 },this._txtTrack={ type:'text',id:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],len:0 },this.aacOverFlow=null,this.aacLastPTS=null,this.avcSample=null,this.audioCodec=t,this.videoCodec=r,this._duration=i} },{ key:'resetTimeStamp',value:function(){} },{ key:'append',value:function(e,t,r,i){var a,n,s,o,l,u=e.length,d=!1;this.contiguous=r;var c=this.pmtParsed,h=this._avcTrack,g=this._audioTrack,v=this._id3Track,m=h.id,E=g.id,b=v.id,T=this._pmtId,k=h.pesData,_=g.pesData,R=v.pesData,A=this._parsePAT,S=this._parsePMT,L=this._parsePES,w=this._parseAVCPES.bind(this),D=this._parseAACPES.bind(this),O=this._parseMPEGPES.bind(this),I=this._parseID3PES.bind(this);for(u-=u%188,a=0;a<u;a+=188)if(71===e[a]){if(n=!!(64&e[a+1]),s=((31&e[a+1])<<8)+e[a+2],(48&e[a+3])>>4>1){if((o=a+5+e[a+4])===a+188)continue}else o=a+4;switch(s){case m:n&&(k&&(l=L(k))&&w(l,!1),k={ data:[],size:0 }),k&&(k.data.push(e.subarray(o,a+188)),k.size+=a+188-o);break;case E:n&&(_&&(l=L(_))&&(g.isAAC?D(l):O(l)),_={ data:[],size:0 }),_&&(_.data.push(e.subarray(o,a+188)),_.size+=a+188-o);break;case b:n&&(R&&(l=L(R))&&I(l),R={ data:[],size:0 }),R&&(R.data.push(e.subarray(o,a+188)),R.size+=a+188-o);break;case 0:n&&(o+=e[o]+1),T=this._pmtId=A(e,o);break;case T:n&&(o+=e[o]+1);var P=S(e,o,!0===this.typeSupported.mpeg||!0===this.typeSupported.mp3,null!=this.sampleAes);m=P.avc,m>0&&(h.id=m),E=P.audio,E>0&&(g.id=E,g.isAAC=P.isAAC),b=P.id3,b>0&&(v.id=b),d&&!c&&(p.logger.log('reparse from beginning'),d=!1,a=-188),c=this.pmtParsed=!0;break;case 17:case 8191:break;default:d=!0}}else this.observer.trigger(f.default.ERROR,{ type:y.ErrorTypes.MEDIA_ERROR,details:y.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:'TS packet did not start with 0x47' });k&&(l=L(k))?(w(l,!0),h.pesData=null):h.pesData=k,_&&(l=L(_))?(g.isAAC?D(l):O(l),g.pesData=null):(_&&_.size&&p.logger.log('last AAC PES packet truncated,might overlap between fragments'),g.pesData=_),R&&(l=L(R))?(I(l),v.pesData=null):v.pesData=R,null==this.sampleAes?this.remuxer.remux(g,h,v,this._txtTrack,t,r,i):this.decryptAndRemux(g,h,v,this._txtTrack,t,r,i)} },{ key:'decryptAndRemux',value:function(e,t,r,i,a,n,s){if(e.samples&&e.isAAC){var o=this;this.sampleAes.decryptAacSamples(e.samples,0,function(){o.decryptAndRemuxAvc(e,t,r,i,a,n,s)})}else this.decryptAndRemuxAvc(e,t,r,i,a,n,s)} },{ key:'decryptAndRemuxAvc',value:function(e,t,r,i,a,n,s){if(t.samples){var o=this;this.sampleAes.decryptAvcSamples(t.samples,0,0,function(){o.remuxer.remux(e,t,r,i,a,n,s)})}else this.remuxer.remux(e,t,r,i,a,n,s)} },{ key:'destroy',value:function(){this._initPTS=this._initDTS=void 0,this._duration=0} },{ key:'_parsePAT',value:function(e,t){return(31&e[t+10])<<8|e[t+11]} },{ key:'_parsePMT',value:function(e,t,r,i){var a,n,s,o,l={ audio:-1,avc:-1,id3:-1,isAAC:!0 };for(a=(15&e[t+1])<<8|e[t+2],n=t+3+a-4,s=(15&e[t+10])<<8|e[t+11],t+=12+s;t<n;){switch(o=(31&e[t+1])<<8|e[t+2],e[t]){case 207:if(!i){p.logger.log('unkown stream type:'+e[t]);break}case 15:-1===l.audio&&(l.audio=o);break;case 21:-1===l.id3&&(l.id3=o);break;case 219:if(!i){p.logger.log('unkown stream type:'+e[t]);break}case 27:-1===l.avc&&(l.avc=o);break;case 3:case 4:r?-1===l.audio&&(l.audio=o,l.isAAC=!1):p.logger.log('MPEG audio found, not supported in this browser for now');break;case 36:p.logger.warn('HEVC stream type found, not supported for now');break;default:p.logger.log('unkown stream type:'+e[t])}t+=5+((15&e[t+3])<<8|e[t+4])}return l} },{ key:'_parsePES',value:function(e){var t,r,i,a,n,s,o,l,u=0,d=e.data;if(!e||0===e.size)return null;for(;d[0].length<19&&d.length>1;){var f=new Uint8Array(d[0].length+d[1].length);f.set(d[0]),f.set(d[1],d[0].length),d[0]=f,d.splice(1,1)}if(t=d[0],1===(t[0]<<16)+(t[1]<<8)+t[2]){if((i=(t[4]<<8)+t[5])&&i>e.size-6)return null;r=t[7],192&r&&(s=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2,s>4294967295&&(s-=8589934592),64&r?(o=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2,o>4294967295&&(o-=8589934592),s-o>54e5&&(p.logger.warn(Math.round((s-o)/9e4)+'s delta between PTS and DTS, align them'),s=o)):o=s),a=t[8],l=a+9,e.size-=l,n=new Uint8Array(e.size);for(var c=0,h=d.length;c<h;c++){t=d[c];var g=t.byteLength;if(l){if(l>g){l-=g;continue}t=t.subarray(l),g-=l,l=0}n.set(t,u),u+=g}return i&&(i-=a+3),{ data:n,pts:s,dts:o,len:i }}return null} },{ key:'pushAccesUnit',value:function(e,t){if(e.units.length&&e.frame){var r=t.samples,i=r.length;!this.config.forceKeyFrameOnDiscontinuity||!0===e.key||t.sps&&(i||this.contiguous)?(e.id=i,r.push(e)):t.dropped++}e.debug.length&&p.logger.log(e.pts+'/'+e.dts+':'+e.debug)} },{ key:'_parseAVCPES',value:function(e,t){var r,i,a,n=this,s=this._avcTrack,o=this._parseAVCNALu(e.data),l=this.avcSample;e.data=null,o.forEach(function(t){switch(t.type){case 1:i=!0,l.frame=!0;var o=t.data;if(o.length>4){var u=new h.default(o).readSliceType();2!==u&&4!==u&&7!==u&&9!==u||(l.key=!0)}break;case 5:i=!0,l||(l=n.avcSample=n._createAVCSample(!0,e.pts,e.dts,'')),l.key=!0,l.frame=!0;break;case 6:i=!0,r=new h.default(n.discardEPB(t.data)),r.readUByte();for(var d=0,f=0,c=!1,g=0;!c&&r.bytesAvailable>1;){d=0;do{g=r.readUByte(),d+=g}while(255===g);f=0;do{g=r.readUByte(),f+=g}while(255===g);if(4===d&&0!==r.bytesAvailable){c=!0;if(181===r.readUByte()){if(49===r.readUShort()){if(1195456820===r.readUInt()){if(3===r.readUByte()){var v=r.readUByte(),p=r.readUByte(),y=31&v,m=[v,p];for(a=0;a<y;a++)m.push(r.readUByte()),m.push(r.readUByte()),m.push(r.readUByte());n._insertSampleInOrder(n._txtTrack.samples,{ type:3,pts:e.pts,bytes:m })}}}}}else if(f<r.bytesAvailable)for(a=0;a<f;a++)r.readUByte()}break;case 7:if(i=!0,!s.sps){r=new h.default(t.data);var E=r.readSPS();s.width=E.width,s.height=E.height,s.pixelRatio=E.pixelRatio,s.sps=[t.data],s.duration=n._duration;var b=t.data.subarray(1,4),T='avc1.';for(a=0;a<3;a++){var k=b[a].toString(16);k.length<2&&(k='0'+k),T+=k}s.codec=T}break;case 8:i=!0,s.pps||(s.pps=[t.data]);break;case 9:i=!1,l&&n.pushAccesUnit(l,s),l=n.avcSample=n._createAVCSample(!1,e.pts,e.dts,'');break;case 12:i=!1;break;default:i=!1,l&&(l.debug+='unknown NAL '+t.type+' ')}if(l&&i){l.units.push(t)}}),t&&l&&(this.pushAccesUnit(l,s),this.avcSample=null)} },{ key:'_createAVCSample',value:function(e,t,r,i){return{ key:e,pts:t,dts:r,units:[],debug:i }} },{ key:'_insertSampleInOrder',value:function(e,t){var r=e.length;if(r>0){if(t.pts>=e[r-1].pts)e.push(t);else for(var i=r-1;i>=0;i--)if(t.pts<e[i].pts){e.splice(i,0,t);break}}else e.push(t)} },{ key:'_getLastNalUnit',value:function(){var e=this.avcSample,t=void 0;if(!e||0===e.units.length){var r=this._avcTrack,i=r.samples;e=i[i.length-1]}if(e){var a=e.units;t=a[a.length-1]}return t} },{ key:'_parseAVCNALu',value:function(e){var t,r,i,a,n,s=0,o=e.byteLength,l=this._avcTrack,u=l.naluState||0,d=u,f=[],c=-1;for(-1===u&&(c=0,n=31&e[0],u=0,s=1);s<o;)if(t=e[s++],u)if(1!==u)if(t)if(1===t){if(c>=0)i={ data:e.subarray(c,s-u-1),type:n },f.push(i);else{var h=this._getLastNalUnit();if(h&&(d&&s<=4-d&&h.state&&(h.data=h.data.subarray(0,h.data.byteLength-d)),(r=s-u-1)>0)){var g=new Uint8Array(h.data.byteLength+r);g.set(h.data,0),g.set(e.subarray(0,r),h.data.byteLength),h.data=g}}s<o?(a=31&e[s],c=s,n=a,u=0):u=-1}else u=0;else u=3;else u=t?0:2;else u=t?0:1;if(c>=0&&u>=0&&(i={ data:e.subarray(c,o),type:n,state:u },f.push(i)),0===f.length){var v=this._getLastNalUnit();if(v){var p=new Uint8Array(v.data.byteLength+e.byteLength);p.set(v.data,0),p.set(e,v.data.byteLength),v.data=p}}return l.naluState=u,f} },{ key:'discardEPB',value:function(e){for(var t,r,i=e.byteLength,a=[],n=1;n<i-2;)0===e[n]&&0===e[n+1]&&3===e[n+2]?(a.push(n+2),n+=2):n++;if(0===a.length)return e;t=i-a.length,r=new Uint8Array(t);var s=0;for(n=0;n<t;s++,n++)s===a[0]&&(s++,a.shift()),r[n]=e[s];return r} },{ key:'_parseAACPES',value:function(e){var t,r,i,a,n,s,l,u,d,c=this._audioTrack,h=e.data,g=e.pts,v=this.aacOverFlow,m=this.aacLastPTS;if(v){var E=new Uint8Array(v.byteLength+h.byteLength);E.set(v,0),E.set(h,v.byteLength),h=E}for(n=0,u=h.length;n<u-1&&(255!==h[n]||240!=(240&h[n+1]));n++);if(n){var b,T;if(n<u-1?(b='AAC PES did not start with ADTS header,offset:'+n,T=!1):(b='no ADTS header found in AAC PES',T=!0),p.logger.warn('parsing error:'+b),this.observer.trigger(f.default.ERROR,{ type:y.ErrorTypes.MEDIA_ERROR,details:y.ErrorDetails.FRAG_PARSING_ERROR,fatal:T,reason:b }),T)return}if(!c.samplerate){var k=this.audioCodec;t=o.default.getAudioConfig(this.observer,h,n,k),c.config=t.config,c.samplerate=t.samplerate,c.channelCount=t.channelCount,c.codec=t.codec,c.manifestCodec=t.manifestCodec,p.logger.log('parsed codec:'+c.codec+',rate:'+t.samplerate+',nb channel:'+t.channelCount)}if(a=0,i=9216e4/c.samplerate,v&&m){var _=m+i;Math.abs(_-g)>1&&(p.logger.log('AAC: align PTS for overlapping frames by '+Math.round((_-g)/90)),g=_)}for(;n+5<u&&(s=1&h[n+1]?7:9,r=(3&h[n+3])<<11|h[n+4]<<3|(224&h[n+5])>>>5,(r-=s)>0&&n+s+r<=u);)for(l=g+a*i,d={ unit:h.subarray(n+s,n+s+r),pts:l,dts:l },c.samples.push(d),c.len+=r,n+=r+s,a++;n<u-1&&(255!==h[n]||240!=(240&h[n+1]));n++);v=n<u?h.subarray(n,u):null,this.aacOverFlow=v,this.aacLastPTS=l} },{ key:'_parseMPEGPES',value:function(e){u.default.parse(this._audioTrack,e.data,0,e.pts)} },{ key:'_parseID3PES',value:function(e){this._id3Track.samples.push(e)} }],[{ key:'probe',value:function(e){return e.length>=564&&71===e[0]&&71===e[188]&&71===e[376]} }]),e}();r.default=m},{ 22:22,26:26,30:30,31:31,33:33,35:35,53:53 }],33:[function(e,t,r){'use strict';Object.defineProperty(r,'__esModule',{ value:!0 });r.ErrorTypes={ NETWORK_ERROR:'networkError',MEDIA_ERROR:'mediaError',MUX_ERROR:'muxError',OTHER_ERROR:'otherError' },r.ErrorDetails={ MANIFEST_LOAD_ERROR:'manifestLoadError',MANIFEST_LOAD_TIMEOUT:'manifestLoadTimeOut',MANIFEST_PARSING_ERROR:'manifestParsingError',MANIFEST_INCOMPATIBLE_CODECS_ERROR:'manifestIncompatibleCodecsError',LEVEL_LOAD_ERROR:'levelLoadError',LEVEL_LOAD_TIMEOUT:'levelLoadTimeOut',LEVEL_SWITCH_ERROR:'levelSwitchError',AUDIO_TRACK_LOAD_ERROR:'audioTrackLoadError',AUDIO_TRACK_LOAD_TIMEOUT:'audioTrackLoadTimeOut',FRAG_LOAD_ERROR:'fragLoadError',FRAG_LOOP_LOADING_ERROR:'fragLoopLoadingError',FRAG_LOAD_TIMEOUT:'fragLoadTimeOut',FRAG_DECRYPT_ERROR:'fragDecryptError',FRAG_PARSING_ERROR:'fragParsingError',REMUX_ALLOC_ERROR:'remuxAllocError',KEY_LOAD_ERROR:'keyLoadError',KEY_LOAD_TIMEOUT:'keyLoadTimeOut',BUFFER_ADD_CODEC_ERROR:'bufferAddCodecError',BUFFER_APPEND_ERROR:'bufferAppendError',BUFFER_APPENDING_ERROR:'bufferAppendingError',BUFFER_STALLED_ERROR:'bufferStalledError',BUFFER_FULL_ERROR:'bufferFullError',BUFFER_SEEK_OVER_HOLE:'bufferSeekOverHole',BUFFER_NUDGE_ON_STALL:'bufferNudgeOnStall',INTERNAL_EXCEPTION:'internalException',WEBVTT_EXCEPTION:'webVTTException' }},{}],34:[function(e,t,r){'use strict';function i(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(r,'__esModule',{ value:!0 });var a='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&'function'==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?'symbol':typeof e},n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,'value'in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),s=e(53),o=e(33),l=e(35),u=function(e){return e&&e.__esModule?e:{ default:e }}(l),d=function(){function e(t){i(this,e),this.hls=t,this.onEvent=this.onEvent.bind(this);for(var r=arguments.length,a=Array(r>1?r-1:0),n=1;n<r;n++)a[n-1]=arguments[n];this.handledEvents=a,this.useGenericHandler=!0,this.registerListeners()}return n(e,[{ key:'destroy',value:function(){this.unregisterListeners()} },{ key:'isEventHandler',value:function(){return'object'===a(this.handledEvents)&&this.handledEvents.length&&'function'==typeof this.onEvent} },{ key:'registerListeners',value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){if('hlsEventGeneric'===e)throw new Error('Forbidden event name: '+e);this.hls.on(e,this.onEvent)}.bind(this))} },{ key:'unregisterListeners',value:function(){this.isEventHandler()&&this.handledEvents.forEach(function(e){this.hls.off(e,this.onEvent)}.bind(this))} },{ key:'onEvent',value:function(e,t){this.onEventGeneric(e,t)} },{ key:'onEventGeneric',value:function(e,t){var r=function(e,t){var r='on'+e.replace('hls','');if('function'!=typeof this[r])throw new Error('Event '+e+' has no generic handler in this '+this.constructor.name+' class (tried '+r+')');return this[r].bind(this,t)};try{r.call(this,e,t).call()}catch(t){s.logger.error('internal error happened while processing '+e+':'+t.message),this.hls.trigger(u.default.ERROR,{ type:o.ErrorTypes.OTHER_ERROR,details:o.ErrorDetails.INTERNAL_EXCEPTION,fatal:!1,event:e,err:t })}} }]),e}();r.default=d},{ 33:33,35:35,53:53 }],35:[function(e,t,r){'use strict';t.exports={ MEDIA_ATTACHING:'hlsMediaAttaching',MEDIA_ATTACHED:'hlsMediaAttached',MEDIA_DETACHING:'hlsMediaDetaching',MEDIA_DETACHED:'hlsMediaDetached',BUFFER_RESET:'hlsBufferReset',BUFFER_CODECS:'hlsBufferCodecs',BUFFER_CREATED:'hlsBufferCreated',BUFFER_APPENDING:'hlsBufferAppending',BUFFER_APPENDED:'hlsBufferAppended',BUFFER_EOS:'hlsBufferEos',BUFFER_FLUSHING:'hlsBufferFlushing',BUFFER_FLUSHED:'hlsBufferFlushed',MANIFEST_LOADING:'hlsManifestLoading',MANIFEST_LOADED:'hlsManifestLoaded',MANIFEST_PARSED:'hlsManifestParsed',LEVEL_SWITCH:'hlsLevelSwitch',LEVEL_SWITCHING:'hlsLevelSwitching',LEVEL_SWITCHED:'hlsLevelSwitched',LEVEL_LOADING:'hlsLevelLoading',LEVEL_LOADED:'hlsLevelLoaded',LEVEL_UPDATED:'hlsLevelUpdated',LEVEL_PTS_UPDATED:'hlsLevelPtsUpdated',AUDIO_TRACKS_UPDATED:'hlsAudioTracksUpdated',AUDIO_TRACK_SWITCH:'hlsAudioTrackSwitch',AUDIO_TRACK_SWITCHING:'hlsAudioTrackSwitching',AUDIO_TRACK_SWITCHED:'hlsAudioTrackSwitched',AUDIO_TRACK_LOADING:'hlsAudioTrackLoading',AUDIO_TRACK_LOADED:'hlsAudioTrackLoaded',SUBTITLE_TRACKS_UPDATED:'hlsSubtitleTracksUpdated',SUBTITLE_TRACK_SWITCH:'hlsSubtitleTrackSwitch',SUBTITLE_TRACK_LOADING:'hlsSubtitleTrackLoading',SUBTITLE_TRACK_LOADED:'hlsSubtitleTrackLoaded',SUBTITLE_FRAG_PROCESSED:'hlsSubtitleFragProcessed',INIT_PTS_FOUND:'hlsInitPtsFound',FRAG_LOADING:'hlsFragLoading',FRAG_LOAD_PROGRESS:'hlsFragLoadProgress',FRAG_LOAD_EMERGENCY_ABORTED:'hlsFragLoadEmergencyAborted',FRAG_LOADED:'hlsFragLoaded',FRAG_DECRYPTED:'hlsFragDecrypted',FRAG_PARSING_INIT_SEGMENT:'hlsFragParsingInitSegment',FRAG_PARSING_USERDATA:'hlsFragParsingUserdata',FRAG_PARSING_METADATA:'hlsFragParsingMetadata',FRAG_PARSING_DATA:'hlsFragParsingData',FRAG_PARSED:'hlsFragParsed',FRAG_BUFFERED:'hlsFragBuffered',FRAG_CHANGED:'hlsFragChanged',FPS_DROP:'hlsFpsDrop',FPS_DROP_LEVEL_CAPPING:'hlsFpsDropLevelCapping',ERROR:'hlsError',DESTROYING:'hlsDestroying',KEY_LOADING:'hlsKeyLoading',KEY_LOADED:'hlsKeyLoaded',STREAM_STATE_TRANSITION:'hlsStreamStateTransition' }},{}],36:[function(e,t,r){'use strict';function i(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(r,'__esModule',{ value:!0 });var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,'value'in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function(){function e(){i(this,e)}return a(e,null,[{ key:'getSilentFrame',value:function(e,t){switch(e){case'mp4a.40.2':if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94])}return null} }]),e}();r.default=n},{}],37:[function(e,t,r){'use strict';var i={ isBuffered:function(e,t){if(e)for(var r=e.buffered,i=0;i<r.length;i++)if(t>=r.start(i)&&t<=r.end(i))return!0;return!1},bufferInfo:function(e,t,r){if(e){var i,a=e.buffered,n=[];for(i=0;i<a.length;i++)n.push({ start:a.start(i),end:a.end(i) });return this.bufferedInfo(n,t,r)}return{ len:0,start:t,end:t,nextStart:void 0 }},bufferedInfo:function(e,t,r){var i,a,n,s,o,l=[];for(e.sort(function(e,t){var r=e.start-t.start;return r||t.end-e.end}),o=0;o<e.length;o++){var u=l.length;if(u){var d=l[u-1].end;e[o].start-d<r?e[o].end>d&&(l[u-1].end=e[o].end):l.push(e[o])}else l.push(e[o])}for(o=0,i=0,a=n=t;o<l.length;o++){var f=l[o].start,c=l[o].end;if(t+r>=f&&t<c)a=f,n=c,i=n-t;else if(t+r<f){s=f;break}}return{ len:i,start:a,end:n,nextStart:s }} };t.exports=i},{}],38:[function(e,t,r){'use strict';var i=e(53),a={ mergeDetails:function(e,t){var r,n=Math.max(e.startSN,t.startSN)-t.startSN,s=Math.min(e.endSN,t.endSN)-t.startSN,o=t.startSN-e.startSN,l=e.fragments,u=t.fragments,d=0;if(s<n)return void(t.PTSKnown=!1);for(var f=n;f<=s;f++){var c=l[o+f],h=u[f];h&&c&&(d=c.cc-h.cc,isNaN(c.startPTS)||(h.start=h.startPTS=c.startPTS,h.endPTS=c.endPTS,h.duration=c.duration,h.backtracked=c.backtracked,h.dropped=c.dropped,r=h))}if(d)for(i.logger.log('discontinuity sliding from playlist, take drift into account'),f=0;f<u.length;f++)u[f].cc+=d;if(r)a.updateFragPTSDTS(t,r,r.startPTS,r.endPTS,r.startDTS,r.endDTS);else if(o>=0&&o<l.length){var g=l[o].start;for(f=0;f<u.length;f++)u[f].start+=g}t.PTSKnown=e.PTSKnown},updateFragPTSDTS:function(e,t,r,i,n,s){if(!isNaN(t.startPTS)){var o=Math.abs(t.startPTS-r);isNaN(t.deltaPTS)?t.deltaPTS=o:t.deltaPTS=Math.max(o,t.deltaPTS),r=Math.min(r,t.startPTS),i=Math.max(i,t.endPTS),n=Math.min(n,t.startDTS),s=Math.max(s,t.endDTS)}var l=r-t.start;t.start=t.startPTS=r,t.endPTS=i,t.startDTS=n,t.endDTS=s,t.duration=i-r;var u=t.sn;if(!e||u<e.startSN||u>e.endSN)return 0;var d,f,c;for(d=u-e.startSN,f=e.fragments,t=f[d],c=d;c>0;c--)a.updatePTS(f,c,c-1);for(c=d;c<f.length-1;c++)a.updatePTS(f,c,c+1);return e.PTSKnown=!0,l},updatePTS:function(e,t,r){var a=e[t],n=e[r],s=n.startPTS;isNaN(s)?n.start=r>t?a.start+a.duration:Math.max(a.start-n.duration,0):r>t?(a.duration=s-a.start,a.duration<0&&i.logger.warn('negative duration computed for frag '+a.sn+',level '+a.level+', there should be some duration drift between playlist and fragment!')):(n.duration=a.start-s,n.duration<0&&i.logger.warn('negative duration computed for frag '+n.sn+',level '+n.level+', there should be some duration drift between playlist and fragment!'))} };t.exports=a},{ 53:53 }],39:[function(e,t,r){'use strict';function i(e){return e&&e.__esModule?e:{ default:e }}function a(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(r,'__esModule',{ value:!0 });var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,'value'in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),s=e(2),o=i(s),l=e(35),u=i(l),d=e(33),f=e(43),c=i(f),h=e(41),g=i(h),v=e(42),p=i(v),y=e(13),m=i(y),E=e(12),b=i(E),T=e(11),k=i(T),_=e(53),R=e(1),A=i(R),S=e(4),L=function(){function e(){var t=this,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,e);var i=e.DefaultConfig;if((r.liveSyncDurationCount||r.liveMaxLatencyDurationCount)&&(r.liveSyncDuration||r.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");for(var n in i)n in r||(r[n]=i[n]);if(void 0!==r.liveMaxLatencyDurationCount&&r.liveMaxLatencyDurationCount<=r.liveSyncDurationCount)throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be gt "liveSyncDurationCount"');if(void 0!==r.liveMaxLatencyDuration&&(r.liveMaxLatencyDuration<=r.liveSyncDuration||void 0===r.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be gt "liveSyncDuration"');(0,_.enableLogs)(r.debug),this.config=r,this._autoLevelCapping=-1;var s=this.observer=new A.default;s.trigger=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];s.emit.apply(s,[e,e].concat(r))},s.off=function(e){for(var t=arguments.length,r=Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];s.removeListener.apply(s,[e].concat(r))},this.on=s.on.bind(s),this.off=s.off.bind(s),this.trigger=s.trigger.bind(s);var o=this.abrController=new r.abrController(this),l=new r.bufferController(this),u=new r.capLevelController(this),d=new r.fpsController(this),f=new c.default(this),h=new g.default(this),v=new p.default(this),y=new k.default(this),E=this.levelController=new b.default(this),T=this.streamController=new m.default(this),R=[E,T],S=r.audioStreamController;S&&R.push(new S(this)),this.networkControllers=R;var L=[f,h,v,o,l,u,d,y];if(S=r.audioTrackController){var w=new S(this);this.audioTrackController=w,L.push(w)}if(S=r.subtitleTrackController){var D=new S(this);this.subtitleTrackController=D,L.push(D)}if(S=r.timelineController){var O=new S(this);this.timelineController=O,L.push(O)}[r.subtitleStreamController].forEach(function(e){e&&L.push(new e(t))}),this.coreComponents=L}return n(e,null,[{ key:'isSupported',value:function(){var e=window.MediaSource=window.MediaSource||window.WebKitMediaSource,t=window.SourceBuffer=window.SourceBuffer||window.WebKitSourceBuffer,r=e&&'function'==typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),i=!t||t.prototype&&'function'==typeof t.prototype.appendBuffer&&'function'==typeof t.prototype.remove;return r&&i} },{ key:'version',get:function(){return'0.7.9'} },{ key:'Events',get:function(){return u.default} },{ key:'ErrorTypes',get:function(){return d.ErrorTypes} },{ key:'ErrorDetails',get:function(){return d.ErrorDetails} },{ key:'DefaultConfig',get:function(){return e.defaultConfig?e.defaultConfig:S.hlsDefaultConfig},set:function(t){e.defaultConfig=t} }]),n(e,[{ key:'destroy',value:function(){_.logger.log('destroy'),this.trigger(u.default.DESTROYING),this.detachMedia();var e=this.subtitleTrackController;e&&e.subtitleTrack>=0&&this.timelineController.textTracks[e.subtitleTrack].removeEventListener('cuechange',this.cueChangeEventListener),this.coreComponents.concat(this.networkControllers).forEach(function(e){e.destroy()}),this.url=null,this.observer.removeAllListeners(),this._autoLevelCapping=-1} },{ key:'attachMedia',value:function(e){_.logger.log('attachMedia'),this.media=e,this.trigger(u.default.MEDIA_ATTACHING,{ media:e })} },{ key:'detachMedia',value:function(){_.logger.log('detachMedia'),this.trigger(u.default.MEDIA_DETACHING),this.media=null} },{ key:'loadSource',value:function(e){e=o.default.buildAbsoluteURL(window.location.href,e,{ alwaysNormalize:!0 }),_.logger.log('loadSource:'+e),this.url=e,this.trigger(u.default.MANIFEST_LOADING,{ url:e })} },{ key:'startLoad',value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:-1;_.logger.log('startLoad('+e+')'),this.networkControllers.forEach(function(t){t.startLoad(e)})} },{ key:'stopLoad',value:function(){_.logger.log('stopLoad'),this.networkControllers.forEach(function(e){e.stopLoad()})} },{ key:'swapAudioCodec',value:function(){_.logger.log('swapAudioCodec'),this.streamController.swapAudioCodec()} },{ key:'recoverMediaError',value:function(){_.logger.log('recoverMediaError');var e=this.media;this.detachMedia(),this.attachMedia(e)} },{ key:'setSubtitleTrackCueChange',value:function(e){this.cueChangeEventListener=e} },{ key:'levels',get:function(){return this.levelController.levels} },{ key:'currentLevel',get:function(){return this.streamController.currentLevel},set:function(e){_.logger.log('set currentLevel:'+e),this.loadLevel=e,this.streamController.immediateLevelSwitch()} },{ key:'nextLevel',get:function(){return this.streamController.nextLevel},set:function(e){_.logger.log('set nextLevel:'+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()} },{ key:'loadLevel',get:function(){return this.levelController.level},set:function(e){_.logger.log('set loadLevel:'+e),this.levelController.manualLevel=e} },{ key:'nextLoadLevel',get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e} },{ key:'firstLevel',get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(e){_.logger.log('set firstLevel:'+e),this.levelController.firstLevel=e} },{ key:'startLevel',get:function(){return this.levelController.startLevel},set:function(e){_.logger.log('set startLevel:'+e);var t=this;-1!==e&&(e=Math.max(e,t.minAutoLevel)),t.levelController.startLevel=e} },{ key:'autoLevelCapping',get:function(){return this._autoLevelCapping},set:function(e){_.logger.log('set autoLevelCapping:'+e),this._autoLevelCapping=e} },{ key:'autoLevelEnabled',get:function(){return-1===this.levelController.manualLevel} },{ key:'manualLevel',get:function(){return this.levelController.manualLevel} },{ key:'minAutoLevel',get:function(){for(var e=this,t=e.levels,r=e.config.minAutoBitrate,i=t?t.length:0,a=0;a<i;a++){if((t[a].realBitrate?Math.max(t[a].realBitrate,t[a].bitrate):t[a].bitrate)>r)return a}return 0} },{ key:'maxAutoLevel',get:function(){var e=this,t=e.levels,r=e.autoLevelCapping;return-1===r&&t&&t.length?t.length-1:r} },{ key:'nextAutoLevel',get:function(){var e=this;return Math.min(Math.max(e.abrController.nextAutoLevel,e.minAutoLevel),e.maxAutoLevel)},set:function(e){var t=this;t.abrController.nextAutoLevel=Math.max(t.minAutoLevel,e)} },{ key:'audioTracks',get:function(){var e=this.audioTrackController;return e?e.audioTracks:[]} },{ key:'audioTrack',get:function(){var e=this.audioTrackController;return e?e.audioTrack:-1},set:function(e){var t=this.audioTrackController;t&&(t.audioTrack=e)} },{ key:'liveSyncPosition',get:function(){return this.streamController.liveSyncPosition} },{ key:'subtitleTracks',get:function(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]} },{ key:'subtitleTrack',get:function(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleTrack>=0&&this.timelineController.textTracks[t.subtitleTrack].removeEventListener('cuechange',this.cueChangeEventListener),t.subtitleTrack=e,e>=0&&this.timelineController.textTracks[t.subtitleTrack].addEventListener('cuechange',this.cueChangeEventListener))} }]),e}();r.default=L},{ 1:1,11:11,12:12,13:13,2:2,33:33,35:35,4:4,41:41,42:42,43:43,53:53 }],40:[function(e,t,r){'use strict';t.exports=e(39).default},{ 39:39 }],41:[function(e,t,r){'use strict';function i(e){return e&&e.__esModule?e:{ default:e }}function a(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||'object'!=typeof t&&'function'!=typeof t?e:t}function s(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+typeof t);e.prototype=Object.create(t&&t.prototype,{ constructor:{ value:e,enumerable:!1,writable:!0,configurable:!0 } }),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,'__esModule',{ value:!0 });var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,'value'in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=e(35),u=i(l),d=e(34),f=i(d),c=e(33),h=e(53),g=function(e){function t(e){a(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.FRAG_LOADING));return r.loaders={},r}return s(t,e),o(t,[{ key:'destroy',value:function(){var e=this.loaders;for(var t in e){var r=e[t];r&&r.destroy()}this.loaders={},f.default.prototype.destroy.call(this)} },{ key:'onFragLoading',value:function(e){var t=e.frag,r=t.type,i=this.loaders[r],a=this.hls.config;t.loaded=0,i&&(h.logger.warn('abort previous fragment loader for type:'+r),i.abort()),i=this.loaders[r]=t.loader=void 0!==a.fLoader?new a.fLoader(a):new a.loader(a);var n=void 0,s=void 0,o=void 0;n={ url:t.url,frag:t,responseType:'arraybuffer',progressData:!1 };var l=t.byteRangeStartOffset,u=t.byteRangeEndOffset;isNaN(l)||isNaN(u)||(n.rangeStart=l,n.rangeEnd=u),s={ timeout:a.fragLoadingTimeOut,maxRetry:0,retryDelay:0,maxRetryDelay:a.fragLoadingMaxRetryTimeout },o={ onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this),onProgress:this.loadprogress.bind(this) },i.load(n,s,o)} },{ key:'loadsuccess',value:function(e,t,r){var i=e.data,a=r.frag;a.loader=void 0,this.loaders[a.type]=void 0,this.hls.trigger(u.default.FRAG_LOADED,{ payload:i,frag:a,stats:t })} },{ key:'loaderror',value:function(e,t){
var r=t.loader;r&&r.abort(),this.loaders[t.type]=void 0,this.hls.trigger(u.default.ERROR,{ type:c.ErrorTypes.NETWORK_ERROR,details:c.ErrorDetails.FRAG_LOAD_ERROR,fatal:!1,frag:t.frag,response:e })} },{ key:'loadtimeout',value:function(e,t){var r=t.loader;r&&r.abort(),this.loaders[t.type]=void 0,this.hls.trigger(u.default.ERROR,{ type:c.ErrorTypes.NETWORK_ERROR,details:c.ErrorDetails.FRAG_LOAD_TIMEOUT,fatal:!1,frag:t.frag })} },{ key:'loadprogress',value:function(e,t,r){var i=t.frag;i.loaded=e.loaded,this.hls.trigger(u.default.FRAG_LOAD_PROGRESS,{ frag:i,stats:e })} }]),t}(f.default);r.default=g},{ 33:33,34:34,35:35,53:53 }],42:[function(e,t,r){'use strict';function i(e){return e&&e.__esModule?e:{ default:e }}function a(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}function n(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||'object'!=typeof t&&'function'!=typeof t?e:t}function s(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+typeof t);e.prototype=Object.create(t&&t.prototype,{ constructor:{ value:e,enumerable:!1,writable:!0,configurable:!0 } }),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,'__esModule',{ value:!0 });var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,'value'in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=e(35),u=i(l),d=e(34),f=i(d),c=e(33),h=e(53),g=function(e){function t(e){a(this,t);var r=n(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,u.default.KEY_LOADING));return r.loaders={},r.decryptkey=null,r.decrypturl=null,r}return s(t,e),o(t,[{ key:'destroy',value:function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy()}this.loaders={},f.default.prototype.destroy.call(this)} },{ key:'onKeyLoading',value:function(e){var t=e.frag,r=t.type,i=this.loaders[r],a=t.decryptdata,n=a.uri;if(n!==this.decrypturl||null===this.decryptkey){var s=this.hls.config;i&&(h.logger.warn('abort previous key loader for type:'+r),i.abort()),t.loader=this.loaders[r]=new s.loader(s),this.decrypturl=n,this.decryptkey=null;var o=void 0,l=void 0,d=void 0;o={ url:n,frag:t,responseType:'arraybuffer' },l={ timeout:s.fragLoadingTimeOut,maxRetry:s.fragLoadingMaxRetry,retryDelay:s.fragLoadingRetryDelay,maxRetryDelay:s.fragLoadingMaxRetryTimeout },d={ onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this) },t.loader.load(o,l,d)}else this.decryptkey&&(a.key=this.decryptkey,this.hls.trigger(u.default.KEY_LOADED,{ frag:t }))} },{ key:'loadsuccess',value:function(e,t,r){var i=r.frag;this.decryptkey=i.decryptdata.key=new Uint8Array(e.data),i.loader=void 0,this.loaders[i.type]=void 0,this.hls.trigger(u.default.KEY_LOADED,{ frag:i })} },{ key:'loaderror',value:function(e,t){var r=t.frag,i=r.loader;i&&i.abort(),this.loaders[t.type]=void 0,this.hls.trigger(u.default.ERROR,{ type:c.ErrorTypes.NETWORK_ERROR,details:c.ErrorDetails.KEY_LOAD_ERROR,fatal:!1,frag:r,response:e })} },{ key:'loadtimeout',value:function(e,t){var r=t.frag,i=r.loader;i&&i.abort(),this.loaders[t.type]=void 0,this.hls.trigger(u.default.ERROR,{ type:c.ErrorTypes.NETWORK_ERROR,details:c.ErrorDetails.KEY_LOAD_TIMEOUT,fatal:!1,frag:r })} }]),t}(f.default);r.default=g},{ 33:33,34:34,35:35,53:53 }],43:[function(e,t,r){'use strict';function i(e){return e&&e.__esModule?e:{ default:e }}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||'object'!=typeof t&&'function'!=typeof t?e:t}function n(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+typeof t);e.prototype=Object.create(t&&t.prototype,{ constructor:{ value:e,enumerable:!1,writable:!0,configurable:!0 } }),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function s(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(r,'__esModule',{ value:!0 });var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,'value'in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),l=e(2),u=i(l),d=e(35),f=i(d),c=e(34),h=i(c),g=e(33),v=e(47),p=i(v),y=e(53),m=/#EXT-X-STREAM-INF:([^\n\r]*)[\r\n]+([^\r\n]+)/g,E=/#EXT-X-MEDIA:(.*)/g,b=/#EXTINF:(\d*(?:\.\d+)?)(?:,(.*))?|(?!#)(\S.+)|#EXT-X-BYTERANGE: *(.+)|#EXT-X-PROGRAM-DATE-TIME:(.+)|#.*/g,T=/(?:(?:#(EXTM3U))|(?:#EXT-X-(PLAYLIST-TYPE):(.+))|(?:#EXT-X-(MEDIA-SEQUENCE): *(\d+))|(?:#EXT-X-(TARGETDURATION): *(\d+))|(?:#EXT-X-(KEY):(.+))|(?:#EXT-X-(START):(.+))|(?:#EXT-X-(ENDLIST))|(?:#EXT-X-(DISCONTINUITY-SEQ)UENCE:(\d+))|(?:#EXT-X-(DIS)CONTINUITY))|(?:#EXT-X-(VERSION):(\d+))|(?:#EXT-X-(MAP):(.+))|(?:(#)(.*):(.*))|(?:(#)(.*))(?:.*)\r?\n?/,k=function(){function e(){s(this,e),this.method=null,this.key=null,this.iv=null,this._uri=null}return o(e,[{ key:'uri',get:function(){return!this._uri&&this.reluri&&(this._uri=u.default.buildAbsoluteURL(this.baseuri,this.reluri,{ alwaysNormalize:!0 })),this._uri} }]),e}(),_=function(){function e(){s(this,e),this._url=null,this._byteRange=null,this._decryptdata=null,this.tagList=[]}return o(e,[{ key:'createInitializationVector',value:function(e){for(var t=new Uint8Array(16),r=12;r<16;r++)t[r]=e>>8*(15-r)&255;return t} },{ key:'fragmentDecryptdataFromLevelkey',value:function(e,t){var r=e;return e&&e.method&&e.uri&&!e.iv&&(r=new k,r.method=e.method,r.baseuri=e.baseuri,r.reluri=e.reluri,r.iv=this.createInitializationVector(t)),r} },{ key:'cloneObj',value:function(e){return JSON.parse(JSON.stringify(e))} },{ key:'url',get:function(){return!this._url&&this.relurl&&(this._url=u.default.buildAbsoluteURL(this.baseurl,this.relurl,{ alwaysNormalize:!0 })),this._url},set:function(e){this._url=e} },{ key:'programDateTime',get:function(){return!this._programDateTime&&this.rawProgramDateTime&&(this._programDateTime=new Date(Date.parse(this.rawProgramDateTime))),this._programDateTime} },{ key:'byteRange',get:function(){if(!this._byteRange){var e=this._byteRange=[];if(this.rawByteRange){var t=this.rawByteRange.split('@',2);if(1===t.length){var r=this.lastByteRangeEndOffset;e[0]=r||0}else e[0]=parseInt(t[1]);e[1]=parseInt(t[0])+e[0]}}return this._byteRange} },{ key:'byteRangeStartOffset',get:function(){return this.byteRange[0]} },{ key:'byteRangeEndOffset',get:function(){return this.byteRange[1]} },{ key:'decryptdata',get:function(){return this._decryptdata||(this._decryptdata=this.fragmentDecryptdataFromLevelkey(this.levelkey,this.sn)),this._decryptdata} }]),e}(),R=function(e){function t(e){s(this,t);var r=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,f.default.MANIFEST_LOADING,f.default.LEVEL_LOADING,f.default.AUDIO_TRACK_LOADING,f.default.SUBTITLE_TRACK_LOADING));return r.loaders={},r}return n(t,e),o(t,[{ key:'destroy',value:function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy()}this.loaders={},h.default.prototype.destroy.call(this)} },{ key:'onManifestLoading',value:function(e){this.load(e.url,{ type:'manifest' })} },{ key:'onLevelLoading',value:function(e){this.load(e.url,{ type:'level',level:e.level,id:e.id })} },{ key:'onAudioTrackLoading',value:function(e){this.load(e.url,{ type:'audioTrack',id:e.id })} },{ key:'onSubtitleTrackLoading',value:function(e){this.load(e.url,{ type:'subtitleTrack',id:e.id })} },{ key:'load',value:function(e,t){var r=this.loaders[t.type];if(r){var i=r.context;if(i&&i.url===e)return void y.logger.trace('playlist request ongoing');y.logger.warn('abort previous loader for type:'+t.type),r.abort()}var a=this.hls.config,n=void 0,s=void 0,o=void 0,l=void 0;'manifest'===t.type?(n=a.manifestLoadingMaxRetry,s=a.manifestLoadingTimeOut,o=a.manifestLoadingRetryDelay,l=a.manifestLoadingMaxRetryTimeout):(n=a.levelLoadingMaxRetry,s=a.levelLoadingTimeOut,o=a.levelLoadingRetryDelay,l=a.levelLoadingMaxRetryTimeout,y.logger.log('loading playlist for '+t.type+' '+(t.level||t.id))),r=this.loaders[t.type]=t.loader=void 0!==a.pLoader?new a.pLoader(a):new a.loader(a),t.url=e,t.responseType='';var u=void 0,d=void 0;u={ timeout:s,maxRetry:n,retryDelay:o,maxRetryDelay:l },d={ onSuccess:this.loadsuccess.bind(this),onError:this.loaderror.bind(this),onTimeout:this.loadtimeout.bind(this) },r.load(t,u,d)} },{ key:'resolve',value:function(e,t){return u.default.buildAbsoluteURL(t,e,{ alwaysNormalize:!0 })} },{ key:'parseMasterPlaylist',value:function(e,t){var r=[],i=void 0;for(m.lastIndex=0;null!=(i=m.exec(e));){var a={},n=a.attrs=new p.default(i[1]);a.url=this.resolve(i[2],t);var s=n.decimalResolution('RESOLUTION');s&&(a.width=s.width,a.height=s.height),a.bitrate=n.decimalInteger('AVERAGE-BANDWIDTH')||n.decimalInteger('BANDWIDTH'),a.name=n.NAME;var o=n.CODECS;if(o){o=o.split(/[ ,]+/);for(var l=0;l<o.length;l++){var u=o[l];-1!==u.indexOf('avc1')?a.videoCodec=this.avc1toavcoti(u):a.audioCodec=u}}r.push(a)}return r} },{ key:'parseMasterPlaylistMedia',value:function(e,t,r){var i=void 0,a=[],n=0;for(E.lastIndex=0;null!=(i=E.exec(e));){var s={},o=new p.default(i[1]);o.TYPE===r&&(s.groupId=o['GROUP-ID'],s.name=o.NAME,s.type=r,s.default='YES'===o.DEFAULT,s.autoselect='YES'===o.AUTOSELECT,s.forced='YES'===o.FORCED,o.URI&&(s.url=this.resolve(o.URI,t)),s.lang=o.LANGUAGE,s.name||(s.name=s.lang),s.id=n++,a.push(s))}return a} },{ key:'avc1toavcoti',value:function(e){var t,r=e.split('.');return r.length>2?(t=r.shift()+'.',t+=parseInt(r.shift()).toString(16),t+=('000'+parseInt(r.shift()).toString(16)).substr(-4)):t=e,t} },{ key:'parseLevelPlaylist',value:function(e,t,r,i){var a,n,s=0,o=0,l={ type:null,version:null,url:t,fragments:[],live:!0,startSN:0 },u=new k,d=0,f=null,c=new _;for(b.lastIndex=0;null!==(a=b.exec(e));){var h=a[1];if(h){c.duration=parseFloat(h);var g=(' '+a[2]).slice(1);c.title=g||null,c.tagList.push(g?['INF',h,g]:['INF',h])}else if(a[3]){if(!isNaN(c.duration)){var v=s++;c.type=i,c.start=o,c.levelkey=u,c.sn=v,c.level=r,c.cc=d,c.baseurl=t,c.relurl=(' '+a[3]).slice(1),l.fragments.push(c),f=c,o+=c.duration,c=new _}}else if(a[4]){if(c.rawByteRange=(' '+a[4]).slice(1),f){var m=f.byteRangeEndOffset;m&&(c.lastByteRangeEndOffset=m)}}else if(a[5])c.rawProgramDateTime=(' '+a[5]).slice(1),c.tagList.push(['PROGRAM-DATE-TIME',c.rawProgramDateTime]);else{for(a=a[0].match(T),n=1;n<a.length&&void 0===a[n];n++);var E=(' '+a[n+1]).slice(1),R=(' '+a[n+2]).slice(1);switch(a[n]){case'#':c.tagList.push(R?[E,R]:[E]);break;case'PLAYLIST-TYPE':l.type=E.toUpperCase();break;case'MEDIA-SEQUENCE':s=l.startSN=parseInt(E);break;case'TARGETDURATION':l.targetduration=parseFloat(E);break;case'VERSION':l.version=parseInt(E);break;case'EXTM3U':break;case'ENDLIST':l.live=!1;break;case'DIS':d++,c.tagList.push(['DIS']);break;case'DISCONTINUITY-SEQ':d=parseInt(E);break;case'KEY':var A=E,S=new p.default(A),L=S.enumeratedString('METHOD'),w=S.URI,D=S.hexadecimalInteger('IV');L&&(u=new k,w&&['AES-128','SAMPLE-AES'].indexOf(L)>=0&&(u.method=L,u.baseuri=t,u.reluri=w,u.key=null,u.iv=D));break;case'START':var O=E,I=new p.default(O),P=I.decimalFloatingPoint('TIME-OFFSET');isNaN(P)||(l.startTimeOffset=P);break;case'MAP':var C=new p.default(E);c.relurl=C.URI,c.rawByteRange=C.BYTERANGE,c.baseurl=t,c.level=r,c.type=i,c.sn='initSegment',l.initSegment=c,c=new _;break;default:y.logger.warn('line parsed but not handled: '+a)}}}return c=f,c&&!c.relurl&&(l.fragments.pop(),o-=c.duration),l.totalduration=o,l.averagetargetduration=o/l.fragments.length,l.endSN=s-1,l} },{ key:'loadsuccess',value:function(e,t,r){var i=e.data,a=e.url,n=r.type,s=r.id,o=r.level,l=this.hls;if(this.loaders[n]=void 0,void 0!==a&&0!==a.indexOf('data:')||(a=r.url),t.tload=performance.now(),0===i.indexOf('#EXTM3U'))if(i.indexOf('#EXTINF:')>0){var u='audioTrack'!==n&&'subtitleTrack'!==n,d=isNaN(o)?isNaN(s)?0:s:o,c=this.parseLevelPlaylist(i,a,d,'audioTrack'===n?'audio':'subtitleTrack'===n?'subtitle':'main');c.tload=t.tload,'manifest'===n&&l.trigger(f.default.MANIFEST_LOADED,{ levels:[{ url:a,details:c }],audioTracks:[],url:a,stats:t }),t.tparsed=performance.now(),c.targetduration?u?l.trigger(f.default.LEVEL_LOADED,{ details:c,level:o||0,id:s||0,stats:t }):'audioTrack'===n?l.trigger(f.default.AUDIO_TRACK_LOADED,{ details:c,id:s,stats:t }):'subtitleTrack'===n&&l.trigger(f.default.SUBTITLE_TRACK_LOADED,{ details:c,id:s,stats:t }):l.trigger(f.default.ERROR,{ type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:a,reason:'invalid targetduration' })}else{var h=this.parseMasterPlaylist(i,a);if(h.length){var v=this.parseMasterPlaylistMedia(i,a,'AUDIO'),p=this.parseMasterPlaylistMedia(i,a,'SUBTITLES');if(v.length){var m=!1;v.forEach(function(e){e.url||(m=!0)}),!1===m&&h[0].audioCodec&&!h[0].attrs.AUDIO&&(y.logger.log('audio codec signaled in quality level, but no embedded audio track signaled, create one'),v.unshift({ type:'main',name:'main' }))}l.trigger(f.default.MANIFEST_LOADED,{ levels:h,audioTracks:v,subtitles:p,url:a,stats:t })}else l.trigger(f.default.ERROR,{ type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:a,reason:'no level found in manifest' })}else l.trigger(f.default.ERROR,{ type:g.ErrorTypes.NETWORK_ERROR,details:g.ErrorDetails.MANIFEST_PARSING_ERROR,fatal:!0,url:a,reason:'no EXTM3U delimiter' })} },{ key:'loaderror',value:function(e,t){var r,i,a=t.loader;switch(t.type){case'manifest':r=g.ErrorDetails.MANIFEST_LOAD_ERROR,i=!0;break;case'level':r=g.ErrorDetails.LEVEL_LOAD_ERROR,i=!1;break;case'audioTrack':r=g.ErrorDetails.AUDIO_TRACK_LOAD_ERROR,i=!1}a&&(a.abort(),this.loaders[t.type]=void 0),this.hls.trigger(f.default.ERROR,{ type:g.ErrorTypes.NETWORK_ERROR,details:r,fatal:i,url:a.url,loader:a,response:e,context:t })} },{ key:'loadtimeout',value:function(e,t){var r,i,a=t.loader;switch(t.type){case'manifest':r=g.ErrorDetails.MANIFEST_LOAD_TIMEOUT,i=!0;break;case'level':r=g.ErrorDetails.LEVEL_LOAD_TIMEOUT,i=!1;break;case'audioTrack':r=g.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT,i=!1}a&&(a.abort(),this.loaders[t.type]=void 0),this.hls.trigger(f.default.ERROR,{ type:g.ErrorTypes.NETWORK_ERROR,details:r,fatal:i,url:a.url,loader:a,context:t })} }]),t}(h.default);r.default=R},{ 2:2,33:33,34:34,35:35,47:47,53:53 }],44:[function(e,t,r){'use strict';function i(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(r,'__esModule',{ value:!0 });var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,'value'in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=Math.pow(2,32)-1,s=function(){function e(){i(this,e)}return a(e,null,[{ key:'init',value:function(){e.types={ avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],'.mp3':[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[] };var t;for(t in e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var r=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),i=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={ video:r,audio:i };var a=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),n=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=n,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var s=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,s,l,s,o),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,a))} },{ key:'box',value:function(e){for(var t,r=Array.prototype.slice.call(arguments,1),i=8,a=r.length,n=a;a--;)i+=r[a].byteLength;for(t=new Uint8Array(i),t[0]=i>>24&255,t[1]=i>>16&255,t[2]=i>>8&255,t[3]=255&i,t.set(e,4),a=0,i=8;a<n;a++)t.set(r[a],i),i+=r[a].byteLength;return t} },{ key:'hdlr',value:function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])} },{ key:'mdat',value:function(t){return e.box(e.types.mdat,t)} },{ key:'mdhd',value:function(t,r){r*=t;var i=Math.floor(r/(n+1)),a=Math.floor(r%(n+1));return e.box(e.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,i>>24,i>>16&255,i>>8&255,255&i,a>>24,a>>16&255,a>>8&255,255&a,85,196,0,0]))} },{ key:'mdia',value:function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))} },{ key:'mfhd',value:function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))} },{ key:'minf',value:function(t){return'audio'===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))} },{ key:'moof',value:function(t,r,i){return e.box(e.types.moof,e.mfhd(t),e.traf(i,r))} },{ key:'moov',value:function(t){for(var r=t.length,i=[];r--;)i[r]=e.trak(t[r]);return e.box.apply(null,[e.types.moov,e.mvhd(t[0].timescale,t[0].duration)].concat(i).concat(e.mvex(t)))} },{ key:'mvex',value:function(t){for(var r=t.length,i=[];r--;)i[r]=e.trex(t[r]);return e.box.apply(null,[e.types.mvex].concat(i))} },{ key:'mvhd',value:function(t,r){r*=t;var i=Math.floor(r/(n+1)),a=Math.floor(r%(n+1)),s=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,i>>24,i>>16&255,i>>8&255,255&i,a>>24,a>>16&255,a>>8&255,255&a,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,s)} },{ key:'sdtp',value:function(t){var r,i,a=t.samples||[],n=new Uint8Array(4+a.length);for(i=0;i<a.length;i++)r=a[i].flags,n[i+4]=r.dependsOn<<4|r.isDependedOn<<2|r.hasRedundancy;return e.box(e.types.sdtp,n)} },{ key:'stbl',value:function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))} },{ key:'avc1',value:function(t){var r,i,a,n=[],s=[];for(r=0;r<t.sps.length;r++)i=t.sps[r],a=i.byteLength,n.push(a>>>8&255),n.push(255&a),n=n.concat(Array.prototype.slice.call(i));for(r=0;r<t.pps.length;r++)i=t.pps[r],a=i.byteLength,s.push(a>>>8&255),s.push(255&a),s=s.concat(Array.prototype.slice.call(i));var o=e.box(e.types.avcC,new Uint8Array([1,n[3],n[4],n[5],255,224|t.sps.length].concat(n).concat([t.pps.length]).concat(s))),l=t.width,u=t.height,d=t.pixelRatio[0],f=t.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,u>>8&255,255&u,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([d>>24,d>>16&255,d>>8&255,255&d,f>>24,f>>16&255,f>>8&255,255&f])))} },{ key:'esds',value:function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))} },{ key:'mp4a',value:function(t){var r=t.samplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,r>>8&255,255&r,0,0]),e.box(e.types.esds,e.esds(t)))} },{ key:'mp3',value:function(t){var r=t.samplerate;return e.box(e.types['.mp3'],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,r>>8&255,255&r,0,0]))} },{ key:'stsd',value:function(t){return'audio'===t.type?t.isAAC||'mp3'!==t.codec?e.box(e.types.stsd,e.STSD,e.mp4a(t)):e.box(e.types.stsd,e.STSD,e.mp3(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))} },{ key:'tkhd',value:function(t){var r=t.id,i=t.duration*t.timescale,a=t.width,s=t.height,o=Math.floor(i/(n+1)),l=Math.floor(i%(n+1));return e.box(e.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,r>>24&255,r>>16&255,r>>8&255,255&r,0,0,0,0,o>>24,o>>16&255,o>>8&255,255&o,l>>24,l>>16&255,l>>8&255,255&l,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,a>>8&255,255&a,0,0,s>>8&255,255&s,0,0]))} },{ key:'traf',value:function(t,r){var i=e.sdtp(t),a=t.id,s=Math.floor(r/(n+1)),o=Math.floor(r%(n+1));return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,a>>24,a>>16&255,a>>8&255,255&a])),e.box(e.types.tfdt,new Uint8Array([1,0,0,0,s>>24,s>>16&255,s>>8&255,255&s,o>>24,o>>16&255,o>>8&255,255&o])),e.trun(t,i.length+16+20+8+16+8+8),i)} },{ key:'trak',value:function(t){return t.duration=t.duration||4294967295,e.box(e.types.trak,e.tkhd(t),e.mdia(t))} },{ key:'trex',value:function(t){var r=t.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))} },{ key:'trun',value:function(t,r){var i,a,n,s,o,l,u=t.samples||[],d=u.length,f=12+16*d,c=new Uint8Array(f);for(r+=8+f,c.set([0,0,15,1,d>>>24&255,d>>>16&255,d>>>8&255,255&d,r>>>24&255,r>>>16&255,r>>>8&255,255&r],0),i=0;i<d;i++)a=u[i],n=a.duration,s=a.size,o=a.flags,l=a.cts,c.set([n>>>24&255,n>>>16&255,n>>>8&255,255&n,s>>>24&255,s>>>16&255,s>>>8&255,255&s,o.isLeading<<2|o.dependsOn,o.isDependedOn<<6|o.hasRedundancy<<4|o.paddingValue<<1|o.isNonSync,61440&o.degradPrio,15&o.degradPrio,l>>>24&255,l>>>16&255,l>>>8&255,255&l],12+16*i);return e.box(e.types.trun,c)} },{ key:'initSegment',value:function(t){e.types||e.init();var r,i=e.moov(t);return r=new Uint8Array(e.FTYP.byteLength+i.byteLength),r.set(e.FTYP),r.set(i,e.FTYP.byteLength),r} }]),e}();r.default=s},{}],45:[function(e,t,r){'use strict';function i(e){return e&&e.__esModule?e:{ default:e }}function a(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(r,'__esModule',{ value:!0 });var n=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,'value'in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),s=e(36),o=i(s),l=e(35),u=i(l),d=e(53),f=e(44),c=i(f),h=e(33),g=function(){function e(t,r,i,n){a(this,e),this.observer=t,this.config=r,this.typeSupported=i;var s=navigator.userAgent;this.isSafari=n&&n.indexOf('Apple')>-1&&s&&!s.match('CriOS'),this.ISGenerated=!1}return n(e,[{ key:'destroy',value:function(){} },{ key:'resetTimeStamp',value:function(e){this._initPTS=this._initDTS=e} },{ key:'resetInitSegment',value:function(){this.ISGenerated=!1} },{ key:'remux',value:function(e,t,r,i,a,n,s){if(this.ISGenerated||this.generateIS(e,t,a),this.ISGenerated)if(e.samples.length){e.timescale||(d.logger.warn('regenerate InitSegment as audio detected'),this.generateIS(e,t,a));var o=this.remuxAudio(e,a,n,s);if(t.samples.length){var l=void 0;o&&(l=o.endPTS-o.startPTS),t.timescale||(d.logger.warn('regenerate InitSegment as video detected'),this.generateIS(e,t,a)),this.remuxVideo(t,a,n,l,s)}}else{var f=void 0;t.samples.length&&(f=this.remuxVideo(t,a,n,s)),f&&e.codec&&this.remuxEmptyAudio(e,a,n,f)}r.samples.length&&this.remuxID3(r,a),i.samples.length&&this.remuxText(i,a),this.observer.trigger(u.default.FRAG_PARSED)} },{ key:'generateIS',value:function(e,t,r){var i,a,n=this.observer,s=e.samples,o=t.samples,l=this.typeSupported,f='audio/mp4',g={},v={ tracks:g },p=void 0===this._initPTS;if(p&&(i=a=1/0),e.config&&s.length&&(e.timescale=e.samplerate,d.logger.log('audio sampling rate : '+e.samplerate),e.isAAC||(l.mpeg?(f='audio/mpeg',e.codec=''):l.mp3&&(e.codec='mp3')),g.audio={ container:f,codec:e.codec,initSegment:!e.isAAC&&l.mpeg?new Uint8Array:c.default.initSegment([e]),metadata:{ channelCount:e.channelCount } },p&&(i=a=s[0].pts-e.inputTimeScale*r)),t.sps&&t.pps&&o.length){var y=t.inputTimeScale;t.timescale=y,g.video={ container:'video/mp4',codec:t.codec,initSegment:c.default.initSegment([t]),metadata:{ width:t.width,height:t.height } },p&&(i=Math.min(i,o[0].pts-y*r),a=Math.min(a,o[0].dts-y*r),this.observer.trigger(u.default.INIT_PTS_FOUND,{ initPTS:i }))}Object.keys(g).length?(n.trigger(u.default.FRAG_PARSING_INIT_SEGMENT,v),this.ISGenerated=!0,p&&(this._initPTS=i,this._initDTS=a)):n.trigger(u.default.ERROR,{ type:h.ErrorTypes.MEDIA_ERROR,details:h.ErrorDetails.FRAG_PARSING_ERROR,fatal:!1,reason:'no audio/video samples found' })} },{ key:'remuxVideo',value:function(e,t,r,i,a){var n,s,o,l,f,g,v,p=8,y=e.timescale,m=e.samples,E=[],b=m.length,T=this._PTSNormalize,k=this._initDTS,_=this.nextAvcDts,R=this.isSafari;R&&(r|=m.length&&_&&(a&&Math.abs(t-_/y)<.1||Math.abs(m[0].pts-_-k)<y/5)),r||(_=t*y),m.forEach(function(e){e.pts=T(e.pts-k,_),e.dts=T(e.dts-k,_)}),m.sort(function(e,t){var r=e.dts-t.dts,i=e.pts-t.pts;return r||(i||e.id-t.id)});var A=m.reduce(function(e,t){return Math.max(Math.min(e,t.pts-t.dts),-18e3)},0);if(A<0){d.logger.warn('PTS < DTS detected in video samples, shifting DTS by '+Math.round(A/90)+' ms to overcome this issue');for(var S=0;S<m.length;S++)m[S].dts+=A}var L=m[0];f=Math.max(L.dts,0),l=Math.max(L.pts,0);var w=Math.round((f-_)/90);r&&w&&(w>1?d.logger.log('AVC:'+w+' ms hole between fragments detected,filling it'):w<-1&&d.logger.log('AVC:'+-w+' ms overlapping between fragments detected'),f=_,m[0].dts=f,l=Math.max(l-w,_),m[0].pts=l,d.logger.log('Video/PTS/DTS adjusted: '+Math.round(l/90)+'/'+Math.round(f/90)+',delta:'+w+' ms')),L=m[m.length-1],v=Math.max(L.dts,0),g=Math.max(L.pts,0,v),R&&(n=Math.round((v-f)/(m.length-1)));for(var D=0,O=0,I=0;I<b;I++){for(var P=m[I],C=P.units,x=C.length,F=0,M=0;M<x;M++)F+=C[M].data.length;O+=F,D+=x,P.length=F,P.dts=R?f+I*n:Math.max(P.dts,f),P.pts=Math.max(P.pts,P.dts)}var N=O+4*D+8;try{s=new Uint8Array(N)}catch(e){return void this.observer.trigger(u.default.ERROR,{ type:h.ErrorTypes.MUX_ERROR,details:h.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:N,reason:'fail allocating video mdat '+N })}var U=new DataView(s.buffer);U.setUint32(0,N),s.set(c.default.types.mdat,4);for(var B=0;B<b;B++){for(var G=m[B],j=G.units,K=0,H=void 0,W=0,V=j.length;W<V;W++){var Y=j[W],X=Y.data,z=Y.data.byteLength;U.setUint32(p,z),p+=4,s.set(X,p),p+=z,K+=4+z}if(R)H=Math.max(0,n*Math.round((G.pts-G.dts)/n));else{if(B<b-1)n=m[B+1].dts-G.dts;else{var q=this.config,Q=G.dts-m[B>0?B-1:B].dts;if(q.stretchShortVideoTrack){var J=q.maxBufferHole,Z=q.maxSeekHole,$=Math.floor(Math.min(J,Z)*y),ee=(i?l+i*y:this.nextAudioPts)-G.pts;ee>$?(n=ee-Q,n<0&&(n=Q),d.logger.log('It is approximately '+ee/90+' ms to the next segment; using duration '+n/90+' ms for the last video frame.')):n=Q}else n=Q}H=Math.round(G.pts-G.dts)}E.push({ size:K,duration:n,cts:H,flags:{ isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:G.key?2:1,isNonSync:G.key?0:1 } })}this.nextAvcDts=v+n;var te=e.dropped;if(e.len=0,e.nbNalu=0,e.dropped=0,E.length&&navigator.userAgent.toLowerCase().indexOf('chrome')>-1){var re=E[0].flags;re.dependsOn=2,re.isNonSync=0}e.samples=E,o=c.default.moof(e.sequenceNumber++,f,e),e.samples=[];var ie={ data1:o,data2:s,startPTS:l/y,endPTS:(g+n)/y,startDTS:f/y,endDTS:this.nextAvcDts/y,type:'video',nb:E.length,dropped:te };return this.observer.trigger(u.default.FRAG_PARSING_DATA,ie),ie} },{ key:'remuxAudio',value:function(e,t,r,i){var a,n,s,l,f,g,v,p=e.inputTimeScale,y=e.timescale,m=p/y,E=e.isAAC?1024:1152,b=E*m,T=this._PTSNormalize,k=this._initDTS,_=!e.isAAC&&this.typeSupported.mpeg,R=e.samples,A=[],S=this.nextAudioPts;if(r|=R.length&&S&&(i&&Math.abs(t-S/p)<.1||Math.abs(R[0].pts-S-k)<20*b),r||(S=t*p),R.forEach(function(e){e.pts=e.dts=T(e.pts-k,S)}),R.sort(function(e,t){return e.pts-t.pts}),i&&e.isAAC)for(var L=0,w=S;L<R.length;){var D,O=R[L],I=O.pts;D=I-w;var P=Math.abs(1e3*D/p);if(D<=-b)d.logger.warn('Dropping 1 audio frame @ '+(w/p).toFixed(3)+'s due to '+P+' ms overlap.'),R.splice(L,1),e.len-=O.unit.length;else if(D>=b&&P<1e4&&w){var C=Math.round(D/b);d.logger.warn('Injecting '+C+' audio frame @ '+(w/p).toFixed(3)+'s due to '+Math.round(1e3*D/p)+' ms gap.');for(var x=0;x<C;x++){var F=Math.max(w,0);s=o.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount),s||(d.logger.log('Unable to get silent frame for given audio codec; duplicating last frame instead.'),s=O.unit.subarray()),R.splice(L,0,{ unit:s,pts:F,dts:F }),e.len+=s.length,w+=b,L++}O.pts=O.dts=w,w+=b,L++}else Math.abs(D),O.pts=O.dts=w,w+=b,L++}for(var M=0,N=R.length;M<N;M++){var U=R[M],B=U.unit,G=U.pts;if(void 0!==v)n.duration=Math.round((G-v)/m);else{var j=Math.round(1e3*(G-S)/p),K=0;if(r&&e.isAAC&&j){if(j>0&&j<1e4)K=Math.round((G-S)/b),d.logger.log(j+' ms hole between AAC samples detected,filling it'),K>0&&(s=o.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount),s||(s=B.subarray()),e.len+=K*s.length);else if(j<-12){d.logger.log('drop overlapping AAC sample, expected/parsed/delta:'+(S/p).toFixed(3)+'s/'+(G/p).toFixed(3)+'s/'+-j+'ms'),e.len-=B.byteLength;continue}G=S}if(g=Math.max(0,G),!(e.len>0))return;var H=_?e.len:e.len+8;a=_?0:8;try{l=new Uint8Array(H)}catch(e){return void this.observer.trigger(u.default.ERROR,{ type:h.ErrorTypes.MUX_ERROR,details:h.ErrorDetails.REMUX_ALLOC_ERROR,fatal:!1,bytes:H,reason:'fail allocating audio mdat '+H })}if(!_){new DataView(l.buffer).setUint32(0,H),l.set(c.default.types.mdat,4)}for(var W=0;W<K;W++)s=o.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount),s||(d.logger.log('Unable to get silent frame for given audio codec; duplicating this frame instead.'),s=B.subarray()),l.set(s,a),a+=s.byteLength,n={ size:s.byteLength,cts:0,duration:1024,flags:{ isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1 } },A.push(n)}l.set(B,a);var V=B.byteLength;a+=V,n={ size:V,cts:0,duration:0,flags:{ isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:1 } },A.push(n),v=G}var Y=0,X=A.length;if(X>=2&&(Y=A[X-2].duration,n.duration=Y),X){this.nextAudioPts=S=v+m*Y,e.len=0,e.samples=A,f=_?new Uint8Array:c.default.moof(e.sequenceNumber++,g/m,e),e.samples=[];var z=g/p,q=S/p,Q={ data1:f,data2:l,startPTS:z,endPTS:q,startDTS:z,endDTS:q,type:'audio',nb:X };return this.observer.trigger(u.default.FRAG_PARSING_DATA,Q),Q}return null} },{ key:'remuxEmptyAudio',value:function(e,t,r,i){var a=e.inputTimeScale,n=e.samplerate?e.samplerate:a,s=a/n,l=this.nextAudioPts,u=(void 0!==l?l:i.startDTS*a)+this._initDTS,f=i.endDTS*a+this._initDTS,c=1024*s,h=Math.ceil((f-u)/c),g=o.default.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(d.logger.warn('remux empty Audio'),!g)return void d.logger.trace('Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec!');for(var v=[],p=0;p<h;p++){var y=u+p*c;v.push({ unit:g,pts:y,dts:y }),e.len+=g.length}e.samples=v,this.remuxAudio(e,t,r)} },{ key:'remuxID3',value:function(e,t){var r,i=e.samples.length,a=e.inputTimeScale,n=this._initPTS,s=this._initDTS;if(i){for(var o=0;o<i;o++)r=e.samples[o],r.pts=(r.pts-n)/a,r.dts=(r.dts-s)/a;this.observer.trigger(u.default.FRAG_PARSING_METADATA,{ samples:e.samples })}e.samples=[],t=t} },{ key:'remuxText',value:function(e,t){e.samples.sort(function(e,t){return e.pts-t.pts});var r,i=e.samples.length,a=e.inputTimeScale,n=this._initPTS;if(i){for(var s=0;s<i;s++)r=e.samples[s],r.pts=(r.pts-n)/a;this.observer.trigger(u.default.FRAG_PARSING_USERDATA,{ samples:e.samples })}e.samples=[],t=t} },{ key:'_PTSNormalize',value:function(e,t){var r;if(void 0===t)return e;for(r=t<e?-8589934592:8589934592;Math.abs(e-t)>4294967296;)e+=r;return e} }]),e}();r.default=g},{ 33:33,35:35,36:36,44:44,53:53 }],46:[function(e,t,r){'use strict';function i(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(r,'__esModule',{ value:!0 });var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,
i.configurable=!0,'value'in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=e(35),s=function(e){return e&&e.__esModule?e:{ default:e }}(n),o=function(){function e(t){i(this,e),this.observer=t}return a(e,[{ key:'destroy',value:function(){} },{ key:'resetTimeStamp',value:function(){} },{ key:'resetInitSegment',value:function(){} },{ key:'remux',value:function(e,t,r,i,a,n,o,l){var u=this.observer,d='';e&&(d+='audio'),t&&(d+='video'),u.trigger(s.default.FRAG_PARSING_DATA,{ data1:l,startPTS:a,startDTS:a,type:d,nb:1,dropped:0 }),u.trigger(s.default.FRAG_PARSED)} }]),e}();r.default=o},{ 35:35 }],47:[function(e,t,r){'use strict';function i(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(r,'__esModule',{ value:!0 });var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,'value'in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=/^(\d+)x(\d+)$/,s=/\s*(.+?)\s*=((?:\".*?\")|.*?)(?:,|$)/g,o=function(){function e(t){i(this,e),'string'==typeof t&&(t=e.parseAttrList(t));for(var r in t)t.hasOwnProperty(r)&&(this[r]=t[r])}return a(e,[{ key:'decimalInteger',value:function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t} },{ key:'hexadecimalInteger',value:function(e){if(this[e]){var t=(this[e]||'0x').slice(2);t=(1&t.length?'0':'')+t;for(var r=new Uint8Array(t.length/2),i=0;i<t.length/2;i++)r[i]=parseInt(t.slice(2*i,2*i+2),16);return r}return null} },{ key:'hexadecimalIntegerAsNumber',value:function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t} },{ key:'decimalFloatingPoint',value:function(e){return parseFloat(this[e])} },{ key:'enumeratedString',value:function(e){return this[e]} },{ key:'decimalResolution',value:function(e){var t=n.exec(this[e]);if(null!==t)return{ width:parseInt(t[1],10),height:parseInt(t[2],10) }} }],[{ key:'parseAttrList',value:function(e){var t,r={};for(s.lastIndex=0;null!==(t=s.exec(e));){var i=t[2];0===i.indexOf('"')&&i.lastIndexOf('"')===i.length-1&&(i=i.slice(1,-1)),r[t[1]]=i}return r} }]),e}();r.default=o},{}],48:[function(e,t,r){'use strict';var i={ search:function(e,t){for(var r=0,i=e.length-1,a=null,n=null;r<=i;){a=(r+i)/2|0,n=e[a];var s=t(n);if(s>0)r=a+1;else{if(!(s<0))return n;i=a-1}}return null} };t.exports=i},{}],49:[function(e,t,r){'use strict';function i(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(r,'__esModule',{ value:!0 });var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,'value'in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n={ 42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499 },s=function(e){var t=e;return n.hasOwnProperty(e)&&(t=n[e]),String.fromCharCode(t)},o=15,l=100,u={ 17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14 },d={ 17:2,18:4,21:6,22:8,23:10,19:13,20:15 },f={ 25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14 },c={ 25:2,26:4,29:6,30:8,31:10,27:13,28:15 },h=['white','green','blue','cyan','red','yellow','magenta','black','transparent'],g={ verboseFilter:{ DATA:3,DEBUG:3,INFO:2,WARNING:2,TEXT:1,ERROR:0 },time:null,verboseLevel:0,setTime:function(e){this.time=e},log:function(e,t){this.verboseFilter[e];this.verboseLevel} },v=function(e){for(var t=[],r=0;r<e.length;r++)t.push(e[r].toString(16));return t},p=function(){function e(t,r,a,n,s){i(this,e),this.foreground=t||'white',this.underline=r||!1,this.italics=a||!1,this.background=n||'black',this.flash=s||!1}return a(e,[{ key:'reset',value:function(){this.foreground='white',this.underline=!1,this.italics=!1,this.background='black',this.flash=!1} },{ key:'setStyles',value:function(e){for(var t=['foreground','underline','italics','background','flash'],r=0;r<t.length;r++){var i=t[r];e.hasOwnProperty(i)&&(this[i]=e[i])}} },{ key:'isDefault',value:function(){return'white'===this.foreground&&!this.underline&&!this.italics&&'black'===this.background&&!this.flash} },{ key:'equals',value:function(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash} },{ key:'copy',value:function(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash} },{ key:'toString',value:function(){return'color='+this.foreground+', underline='+this.underline+', italics='+this.italics+', background='+this.background+', flash='+this.flash} }]),e}(),y=function(){function e(t,r,a,n,s,o){i(this,e),this.uchar=t||' ',this.penState=new p(r,a,n,s,o)}return a(e,[{ key:'reset',value:function(){this.uchar=' ',this.penState.reset()} },{ key:'setChar',value:function(e,t){this.uchar=e,this.penState.copy(t)} },{ key:'setPenState',value:function(e){this.penState.copy(e)} },{ key:'equals',value:function(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)} },{ key:'copy',value:function(e){this.uchar=e.uchar,this.penState.copy(e.penState)} },{ key:'isEmpty',value:function(){return' '===this.uchar&&this.penState.isDefault()} }]),e}(),m=function(){function e(){i(this,e),this.chars=[];for(var t=0;t<l;t++)this.chars.push(new y);this.pos=0,this.currPenState=new p}return a(e,[{ key:'equals',value:function(e){for(var t=!0,r=0;r<l;r++)if(!this.chars[r].equals(e.chars[r])){t=!1;break}return t} },{ key:'copy',value:function(e){for(var t=0;t<l;t++)this.chars[t].copy(e.chars[t])} },{ key:'isEmpty',value:function(){for(var e=!0,t=0;t<l;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e} },{ key:'setCursor',value:function(e){this.pos!==e&&(this.pos=e),this.pos<0?(g.log('ERROR','Negative cursor position '+this.pos),this.pos=0):this.pos>l&&(g.log('ERROR','Too large cursor position '+this.pos),this.pos=l)} },{ key:'moveCursor',value:function(e){var t=this.pos+e;if(e>1)for(var r=this.pos+1;r<t+1;r++)this.chars[r].setPenState(this.currPenState);this.setCursor(t)} },{ key:'backSpace',value:function(){this.moveCursor(-1),this.chars[this.pos].setChar(' ',this.currPenState)} },{ key:'insertChar',value:function(e){e>=144&&this.backSpace();var t=s(e);if(this.pos>=l)return void g.log('ERROR','Cannot insert '+e.toString(16)+' ('+t+') at position '+this.pos+'. Skipping it!');this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)} },{ key:'clearFromPos',value:function(e){var t;for(t=e;t<l;t++)this.chars[t].reset()} },{ key:'clear',value:function(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()} },{ key:'clearToEndOfRow',value:function(){this.clearFromPos(this.pos)} },{ key:'getTextString',value:function(){for(var e=[],t=!0,r=0;r<l;r++){var i=this.chars[r].uchar;' '!==i&&(t=!1),e.push(i)}return t?'':e.join('')} },{ key:'setPenStyles',value:function(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)} }]),e}(),E=function(){function e(){i(this,e),this.rows=[];for(var t=0;t<o;t++)this.rows.push(new m);this.currRow=o-1,this.nrRollUpRows=null,this.reset()}return a(e,[{ key:'reset',value:function(){for(var e=0;e<o;e++)this.rows[e].clear();this.currRow=o-1} },{ key:'equals',value:function(e){for(var t=!0,r=0;r<o;r++)if(!this.rows[r].equals(e.rows[r])){t=!1;break}return t} },{ key:'copy',value:function(e){for(var t=0;t<o;t++)this.rows[t].copy(e.rows[t])} },{ key:'isEmpty',value:function(){for(var e=!0,t=0;t<o;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e} },{ key:'backSpace',value:function(){this.rows[this.currRow].backSpace()} },{ key:'clearToEndOfRow',value:function(){this.rows[this.currRow].clearToEndOfRow()} },{ key:'insertChar',value:function(e){this.rows[this.currRow].insertChar(e)} },{ key:'setPen',value:function(e){this.rows[this.currRow].setPenStyles(e)} },{ key:'moveCursor',value:function(e){this.rows[this.currRow].moveCursor(e)} },{ key:'setCursor',value:function(e){g.log('INFO','setCursor: '+e),this.rows[this.currRow].setCursor(e)} },{ key:'setPAC',value:function(e){g.log('INFO','pacData = '+JSON.stringify(e));var t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(var r=0;r<o;r++)this.rows[r].clear();var i=this.currRow+1-this.nrRollUpRows,a=this.lastOutputScreen;if(a){var n=a.rows[i].cueStartTime;if(n&&n<g.time)for(var s=0;s<this.nrRollUpRows;s++)this.rows[t-this.nrRollUpRows+s+1].copy(a.rows[i+s])}}this.currRow=t;var l=this.rows[this.currRow];if(null!==e.indent){var u=e.indent,d=Math.max(u-1,0);l.setCursor(e.indent),e.color=l.chars[d].penState.foreground}var f={ foreground:e.color,underline:e.underline,italics:e.italics,background:'black',flash:!1 };this.setPen(f)} },{ key:'setBkgData',value:function(e){g.log('INFO','bkgData = '+JSON.stringify(e)),this.backSpace(),this.setPen(e),this.insertChar(32)} },{ key:'setRollUpRows',value:function(e){this.nrRollUpRows=e} },{ key:'rollUp',value:function(){if(null===this.nrRollUpRows)return void g.log('DEBUG','roll_up but nrRollUpRows not set yet');g.log('TEXT',this.getDisplayText());var e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),g.log('INFO','Rolling up')} },{ key:'getDisplayText',value:function(e){e=e||!1;for(var t=[],r='',i=-1,a=0;a<o;a++){var n=this.rows[a].getTextString();n&&(i=a+1,e?t.push('Row '+i+": '"+n+"'"):t.push(n.trim()))}return t.length>0&&(r=e?'['+t.join(' | ')+']':t.join('\n')),r} },{ key:'getTextAndFormat',value:function(){return this.rows} }]),e}(),b=function(){function e(t,r){i(this,e),this.chNr=t,this.outputFilter=r,this.mode=null,this.verbose=0,this.displayedMemory=new E,this.nonDisplayedMemory=new E,this.lastOutputScreen=new E,this.currRollUpRow=this.displayedMemory.rows[o-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}return a(e,[{ key:'reset',value:function(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.currRollUpRow=this.displayedMemory.rows[o-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.lastCueEndTime=null} },{ key:'getHandler',value:function(){return this.outputFilter} },{ key:'setHandler',value:function(e){this.outputFilter=e} },{ key:'setPAC',value:function(e){this.writeScreen.setPAC(e)} },{ key:'setBkgData',value:function(e){this.writeScreen.setBkgData(e)} },{ key:'setMode',value:function(e){e!==this.mode&&(this.mode=e,g.log('INFO','MODE='+e),'MODE_POP-ON'===this.mode?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),'MODE_ROLL-UP'!==this.mode&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)} },{ key:'insertChars',value:function(e){for(var t=0;t<e.length;t++)this.writeScreen.insertChar(e[t]);var r=this.writeScreen===this.displayedMemory?'DISP':'NON_DISP';g.log('INFO',r+': '+this.writeScreen.getDisplayText(!0)),'MODE_PAINT-ON'!==this.mode&&'MODE_ROLL-UP'!==this.mode||(g.log('TEXT','DISPLAYED: '+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())} },{ key:'ccRCL',value:function(){g.log('INFO','RCL - Resume Caption Loading'),this.setMode('MODE_POP-ON')} },{ key:'ccBS',value:function(){g.log('INFO','BS - BackSpace'),'MODE_TEXT'!==this.mode&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())} },{ key:'ccAOF',value:function(){} },{ key:'ccAON',value:function(){} },{ key:'ccDER',value:function(){g.log('INFO','DER- Delete to End of Row'),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()} },{ key:'ccRU',value:function(e){g.log('INFO','RU('+e+') - Roll Up'),this.writeScreen=this.displayedMemory,this.setMode('MODE_ROLL-UP'),this.writeScreen.setRollUpRows(e)} },{ key:'ccFON',value:function(){g.log('INFO','FON - Flash On'),this.writeScreen.setPen({ flash:!0 })} },{ key:'ccRDC',value:function(){g.log('INFO','RDC - Resume Direct Captioning'),this.setMode('MODE_PAINT-ON')} },{ key:'ccTR',value:function(){g.log('INFO','TR'),this.setMode('MODE_TEXT')} },{ key:'ccRTD',value:function(){g.log('INFO','RTD'),this.setMode('MODE_TEXT')} },{ key:'ccEDM',value:function(){g.log('INFO','EDM - Erase Displayed Memory'),this.displayedMemory.reset(),this.outputDataUpdate()} },{ key:'ccCR',value:function(){g.log('CR - Carriage Return'),this.writeScreen.rollUp(),this.outputDataUpdate()} },{ key:'ccENM',value:function(){g.log('INFO','ENM - Erase Non-displayed Memory'),this.nonDisplayedMemory.reset()} },{ key:'ccEOC',value:function(){if(g.log('INFO','EOC - End Of Caption'),'MODE_POP-ON'===this.mode){var e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,g.log('TEXT','DISP: '+this.displayedMemory.getDisplayText())}this.outputDataUpdate()} },{ key:'ccTO',value:function(e){g.log('INFO','TO('+e+') - Tab Offset'),this.writeScreen.moveCursor(e)} },{ key:'ccMIDROW',value:function(e){var t={ flash:!1 };if(t.underline=e%2==1,t.italics=e>=46,t.italics)t.foreground='white';else{var r=Math.floor(e/2)-16,i=['white','green','blue','cyan','red','yellow','magenta'];t.foreground=i[r]}g.log('INFO','MIDROW: '+JSON.stringify(t)),this.writeScreen.setPen(t)} },{ key:'outputDataUpdate',value:function(){var e=g.time;null!==e&&this.outputFilter&&(this.outputFilter.updateData&&this.outputFilter.updateData(e,this.displayedMemory),null!==this.cueStartTime||this.displayedMemory.isEmpty()?this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.lastOutputScreen),this.cueStartTime=this.displayedMemory.isEmpty()?null:e):this.cueStartTime=e,this.lastOutputScreen.copy(this.displayedMemory))} },{ key:'cueSplitAtTime',value:function(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))} }]),e}(),T=function(){function e(t,r,a){i(this,e),this.field=t||1,this.outputs=[r,a],this.channels=[new b(1,r),new b(2,a)],this.currChNr=-1,this.lastCmdA=null,this.lastCmdB=null,this.bufferedData=[],this.startTime=null,this.lastTime=null,this.dataCounters={ padding:0,char:0,cmd:0,other:0 }}return a(e,[{ key:'getHandler',value:function(e){return this.channels[e].getHandler()} },{ key:'setHandler',value:function(e,t){this.channels[e].setHandler(t)} },{ key:'addData',value:function(e,t){var r,i,a,n=!1;this.lastTime=e,g.setTime(e);for(var s=0;s<t.length;s+=2)if(i=127&t[s],a=127&t[s+1],0!==i||0!==a){if(g.log('DATA','['+v([t[s],t[s+1]])+'] -> ('+v([i,a])+')'),r=this.parseCmd(i,a),r||(r=this.parseMidrow(i,a)),r||(r=this.parsePAC(i,a)),r||(r=this.parseBackgroundAttributes(i,a)),!r&&(n=this.parseChars(i,a)))if(this.currChNr&&this.currChNr>=0){var o=this.channels[this.currChNr-1];o.insertChars(n)}else g.log('WARNING','No channel found yet. TEXT-MODE?');r?this.dataCounters.cmd+=2:n?this.dataCounters.char+=2:(this.dataCounters.other+=2,g.log('WARNING',"Couldn't parse cleaned data "+v([i,a])+' orig: '+v([t[s],t[s+1]])))}else this.dataCounters.padding+=2} },{ key:'parseCmd',value:function(e,t){var r=null,i=(20===e||28===e)&&32<=t&&t<=47,a=(23===e||31===e)&&33<=t&&t<=35;if(!i&&!a)return!1;if(e===this.lastCmdA&&t===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,g.log('DEBUG','Repeated command ('+v([e,t])+') is dropped'),!0;r=20===e||23===e?1:2;var n=this.channels[r-1];return 20===e||28===e?32===t?n.ccRCL():33===t?n.ccBS():34===t?n.ccAOF():35===t?n.ccAON():36===t?n.ccDER():37===t?n.ccRU(2):38===t?n.ccRU(3):39===t?n.ccRU(4):40===t?n.ccFON():41===t?n.ccRDC():42===t?n.ccTR():43===t?n.ccRTD():44===t?n.ccEDM():45===t?n.ccCR():46===t?n.ccENM():47===t&&n.ccEOC():n.ccTO(t-32),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=r,!0} },{ key:'parseMidrow',value:function(e,t){var r=null;if((17===e||25===e)&&32<=t&&t<=47){if((r=17===e?1:2)!==this.currChNr)return g.log('ERROR','Mismatch channel in midrow parsing'),!1;return this.channels[r-1].ccMIDROW(t),g.log('DEBUG','MIDROW ('+v([e,t])+')'),!0}return!1} },{ key:'parsePAC',value:function(e,t){var r=null,i=null,a=(17<=e&&e<=23||25<=e&&e<=31)&&64<=t&&t<=127,n=(16===e||24===e)&&64<=t&&t<=95;if(!a&&!n)return!1;if(e===this.lastCmdA&&t===this.lastCmdB)return this.lastCmdA=null,this.lastCmdB=null,!0;r=e<=23?1:2,i=64<=t&&t<=95?1===r?u[e]:f[e]:1===r?d[e]:c[e];var s=this.interpretPAC(i,t);return this.channels[r-1].setPAC(s),this.lastCmdA=e,this.lastCmdB=t,this.currChNr=r,!0} },{ key:'interpretPAC',value:function(e,t){var r=t,i={ color:null,italics:!1,indent:null,underline:!1,row:e };return r=t>95?t-96:t-64,i.underline=1==(1&r),r<=13?i.color=['white','green','blue','cyan','red','yellow','magenta','white'][Math.floor(r/2)]:r<=15?(i.italics=!0,i.color='white'):i.indent=4*Math.floor((r-16)/2),i} },{ key:'parseChars',value:function(e,t){var r=null,i=null,a=null;if(e>=25?(r=2,a=e-8):(r=1,a=e),17<=a&&a<=19){var n=t;n=17===a?t+80:18===a?t+112:t+144,g.log('INFO',"Special char '"+s(n)+"' in channel "+r),i=[n]}else 32<=e&&e<=127&&(i=0===t?[e]:[e,t]);if(i){var o=v(i);g.log('DEBUG','Char codes =  '+o.join(',')),this.lastCmdA=null,this.lastCmdB=null}return i} },{ key:'parseBackgroundAttributes',value:function(e,t){var r,i,a,n,s=(16===e||24===e)&&32<=t&&t<=47,o=(23===e||31===e)&&45<=t&&t<=47;return!(!s&&!o)&&(r={},16===e||24===e?(i=Math.floor((t-32)/2),r.background=h[i],t%2==1&&(r.background=r.background+'_semi')):45===t?r.background='transparent':(r.foreground='black',47===t&&(r.underline=!0)),a=e<24?1:2,n=this.channels[a-1],n.setBkgData(r),this.lastCmdA=null,this.lastCmdB=null,!0)} },{ key:'reset',value:function(){for(var e=0;e<this.channels.length;e++)this.channels[e]&&this.channels[e].reset();this.lastCmdA=null,this.lastCmdB=null} },{ key:'cueSplitAtTime',value:function(e){for(var t=0;t<this.channels.length;t++)this.channels[t]&&this.channels[t].cueSplitAtTime(e)} }]),e}();r.default=T},{}],50:[function(e,t,r){'use strict';var i=e(56),a={ newCue:function(e,t,r,a){for(var n,s,o,l,u,d=window.VTTCue||window.TextTrackCue,f=0;f<a.rows.length;f++)if(n=a.rows[f],o=!0,l=0,u='',!n.isEmpty()){for(var c=0;c<n.chars.length;c++)n.chars[c].uchar.match(/\s/)&&o?l++:(u+=n.chars[c].uchar,o=!1);n.cueStartTime=t,t===r&&(r+=1e-4),s=new d(t,r,(0,i.fixLineBreaks)(u.trim())),l>=16?l--:l++,navigator.userAgent.match(/Firefox\//)?s.line=f+1:s.line=f>7?f-2:f+1,s.align='left',s.position=Math.max(0,Math.min(100,l/32*100+(navigator.userAgent.match(/Firefox\//)?50:0))),e.addCue(s)}} };t.exports=a},{ 56:56 }],51:[function(e,t,r){'use strict';function i(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(r,'__esModule',{ value:!0 });var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,'value'in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=e(52),s=function(e){return e&&e.__esModule?e:{ default:e }}(n),o=function(){function e(t,r,a,n){i(this,e),this.hls=t,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new s.default(r),this.fast_=new s.default(a)}return a(e,[{ key:'sample',value:function(e,t){e=Math.max(e,this.minDelayMs_);var r=8e3*t/e,i=e/1e3;this.fast_.sample(i,r),this.slow_.sample(i,r)} },{ key:'canEstimate',value:function(){var e=this.fast_;return e&&e.getTotalWeight()>=this.minWeight_} },{ key:'getEstimate',value:function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_} },{ key:'destroy',value:function(){} }]),e}();r.default=o},{ 52:52 }],52:[function(e,t,r){'use strict';function i(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(r,'__esModule',{ value:!0 });var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,'value'in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=function(){function e(t){i(this,e),this.alpha_=t?Math.exp(Math.log(.5)/t):0,this.estimate_=0,this.totalWeight_=0}return a(e,[{ key:'sample',value:function(e,t){var r=Math.pow(this.alpha_,e);this.estimate_=t*(1-r)+r*this.estimate_,this.totalWeight_+=e} },{ key:'getTotalWeight',value:function(){return this.totalWeight_} },{ key:'getEstimate',value:function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);return this.estimate_/e}return this.estimate_} }]),e}();r.default=n},{}],53:[function(e,t,r){'use strict';function i(){}function a(e,t){return t='['+e+'] > '+t}function n(e){var t=self.console[e];return t?function(){for(var r=arguments.length,i=Array(r),n=0;n<r;n++)i[n]=arguments[n];i[0]&&(i[0]=a(e,i[0])),t.apply(self.console,i)}:i}function s(e){for(var t=arguments.length,r=Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];r.forEach(function(t){u[t]=e[t]?e[t].bind(e):n(t)})}Object.defineProperty(r,'__esModule',{ value:!0 });var o='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&'function'==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?'symbol':typeof e},l={ trace:i,debug:i,log:i,warn:i,info:i,error:i },u=l;r.enableLogs=function(e){if(!0===e||'object'===(void 0===e?'undefined':o(e))){s(e,'debug','log','info','warn','error');try{u.log()}catch(e){u=l}}else u=l},r.logger=u},{}],54:[function(e,t,r){'use strict';var i={ toString:function(e){for(var t='',r=e.length,i=0;i<r;i++)t+='['+e.start(i).toFixed(3)+','+e.end(i).toFixed(3)+']';return t} };t.exports=i},{}],55:[function(e,t,r){'use strict';Object.defineProperty(r,'__esModule',{ value:!0 }),r.default=function(){function e(e){return'string'==typeof e&&(!!n[e.toLowerCase()]&&e.toLowerCase())}function t(e){return'string'==typeof e&&(!!s[e.toLowerCase()]&&e.toLowerCase())}function r(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var i in r)e[i]=r[i]}return e}function i(i,n,s){var o=this,l=function(){if('undefined'!=typeof navigator)return/MSIE\s8\.0/.test(navigator.userAgent)}(),u={};l?o=document.createElement('custom'):u.enumerable=!0,o.hasBeenReset=!1;var d='',f=!1,c=i,h=n,g=s,v=null,p='',y=!0,m='auto',E='start',b=50,T='middle',k=50,_='middle';if(Object.defineProperty(o,'id',r({},u,{ get:function(){return d},set:function(e){d=''+e} })),Object.defineProperty(o,'pauseOnExit',r({},u,{ get:function(){return f},set:function(e){f=!!e} })),Object.defineProperty(o,'startTime',r({},u,{ get:function(){return c},set:function(e){if('number'!=typeof e)throw new TypeError('Start time must be set to a number.');c=e,this.hasBeenReset=!0} })),Object.defineProperty(o,'endTime',r({},u,{ get:function(){return h},set:function(e){if('number'!=typeof e)throw new TypeError('End time must be set to a number.');h=e,this.hasBeenReset=!0} })),Object.defineProperty(o,'text',r({},u,{ get:function(){return g},set:function(e){g=''+e,this.hasBeenReset=!0} })),Object.defineProperty(o,'region',r({},u,{ get:function(){return v},set:function(e){v=e,this.hasBeenReset=!0} })),Object.defineProperty(o,'vertical',r({},u,{ get:function(){return p},set:function(t){var r=e(t);if(!1===r)throw new SyntaxError('An invalid or illegal string was specified.');p=r,this.hasBeenReset=!0} })),Object.defineProperty(o,'snapToLines',r({},u,{ get:function(){return y},set:function(e){y=!!e,this.hasBeenReset=!0} })),Object.defineProperty(o,'line',r({},u,{ get:function(){return m},set:function(e){if('number'!=typeof e&&e!==a)throw new SyntaxError('An invalid number or illegal string was specified.');m=e,this.hasBeenReset=!0} })),Object.defineProperty(o,'lineAlign',r({},u,{ get:function(){return E},set:function(e){var r=t(e);if(!r)throw new SyntaxError('An invalid or illegal string was specified.');E=r,this.hasBeenReset=!0} })),Object.defineProperty(o,'position',r({},u,{ get:function(){return b},set:function(e){if(e<0||e>100)throw new Error('Position must be between 0 and 100.');b=e,this.hasBeenReset=!0} })),Object.defineProperty(o,'positionAlign',r({},u,{ get:function(){return T},set:function(e){var r=t(e);if(!r)throw new SyntaxError('An invalid or illegal string was specified.');T=r,this.hasBeenReset=!0} })),Object.defineProperty(o,'size',r({},u,{ get:function(){return k},set:function(e){if(e<0||e>100)throw new Error('Size must be between 0 and 100.');k=e,this.hasBeenReset=!0} })),Object.defineProperty(o,'align',r({},u,{ get:function(){return _},set:function(e){var r=t(e);if(!r)throw new SyntaxError('An invalid or illegal string was specified.');_=r,this.hasBeenReset=!0} })),o.displayState=void 0,l)return o}if('undefined'!=typeof window&&window.VTTCue)return window.VTTCue;var a='auto',n={ '':!0,lr:!0,rl:!0 },s={ start:!0,middle:!0,end:!0,left:!0,right:!0 };return i.prototype.getCueAsHTML=function(){return window.WebVTT.convertCueToDOMTree(window,this.text)},i}()},{}],56:[function(e,t,r){'use strict';function i(){this.window=window,this.state='INITIAL',this.buffer='',this.decoder=new f,this.regionList=[]}function a(e){function t(e,t,r,i){return 3600*(0|e)+60*(0|t)+(0|r)+(0|i)/1e3}var r=e.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return r?r[3]?t(r[1],r[2],r[3].replace(':',''),r[4]):r[1]>59?t(r[1],r[2],0,r[4]):t(0,r[1],r[2],r[4]):null}function n(){this.values=Object.create(null)}function s(e,t,r,i){var a=i?e.split(i):[e];for(var n in a)if('string'==typeof a[n]){var s=a[n].split(r);if(2===s.length){var o=s[0],l=s[1];t(o,l)}}}function o(e,t,r){function i(){var t=a(e);if(null===t)throw new Error('Malformed timestamp: '+l);return e=e.replace(/^[^\sa-zA-Z-]+/,''),t}function o(){e=e.replace(/^\s+/,'')}var l=e;if(o(),t.startTime=i(),o(),'--\x3e'!==e.substr(0,3))throw new Error("Malformed time stamp (time stamps must be separated by '--\x3e'): "+l);e=e.substr(3),o(),t.endTime=i(),o(),function(e,t){var i=new n;s(e,function(e,t){switch(e){case'region':for(var a=r.length-1;a>=0;a--)if(r[a].id===t){i.set(e,r[a].region);break}break;case'vertical':i.alt(e,t,['rl','lr']);break;case'line':var n=t.split(','),s=n[0];i.integer(e,s),i.percent(e,s)&&i.set('snapToLines',!1),i.alt(e,s,['auto']),2===n.length&&i.alt('lineAlign',n[1],['start',h,'end']);break;case'position':n=t.split(','),i.percent(e,n[0]),2===n.length&&i.alt('positionAlign',n[1],['start',h,'end','line-left','line-right','auto']);break;case'size':i.percent(e,t);break;case'align':i.alt(e,t,['start',h,'end','left','right'])}},/:/,/\s/),t.region=i.get('region',null),t.vertical=i.get('vertical','');var a=i.get('line','auto');'auto'===a&&-1===c.line&&(a=-1),t.line=a,t.lineAlign=i.get('lineAlign','start'),t.snapToLines=i.get('snapToLines',!0),t.size=i.get('size',100),t.align=i.get('align',h);var o=i.get('position','auto');'auto'===o&&50===c.position&&(o='start'===t.align||'left'===t.align?0:'end'===t.align||'right'===t.align?100:50),t.position=o}(e,t)}function l(e){return e.replace(/<br(?: \/)?>/gi,'\n')}Object.defineProperty(r,'__esModule',{ value:!0 }),r.fixLineBreaks=void 0;var u=e(55),d=function(e){return e&&e.__esModule?e:{ default:e }}(u),f=function(){return{ decode:function(e){if(!e)return'';if('string'!=typeof e)throw new Error('Error - expected string data.');return decodeURIComponent(encodeURIComponent(e))} }};n.prototype={ set:function(e,t){this.get(e)||''===t||(this.values[e]=t)},get:function(e,t,r){return r?this.has(e)?this.values[e]:t[r]:this.has(e)?this.values[e]:t},has:function(e){return e in this.values},alt:function(e,t,r){for(var i=0;i<r.length;++i)if(t===r[i]){this.set(e,t);break}},integer:function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},percent:function(e,t){return!!(t.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(t=parseFloat(t))>=0&&t<=100)&&(this.set(e,t),!0)} };var c=new d.default(0,0,0),h='middle'===c.align?'middle':'center';i.prototype={ parse:function(e){function t(){var e=r.buffer,t=0;for(e=l(e);t<e.length&&'\r'!==e[t]&&'\n'!==e[t];)++t;var i=e.substr(0,t);return'\r'===e[t]&&++t,'\n'===e[t]&&++t,r.buffer=e.substr(t),i}var r=this;e&&(r.buffer+=r.decoder.decode(e,{ stream:!0 }));try{var i;if('INITIAL'===r.state){if(!/\r\n|\n/.test(r.buffer))return this;i=t();var a=i.match(/^WEBVTT([ \t].*)?$/);if(!a||!a[0])throw new Error('Malformed WebVTT signature.');r.state='HEADER'}for(var n=!1;r.buffer;){if(!/\r\n|\n/.test(r.buffer))return this;switch(n?n=!1:i=t(),r.state){case'HEADER':/:/.test(i)?function(e){s(e,function(e,t){},/:/)}(i):i||(r.state='ID');continue;case'NOTE':i||(r.state='ID');continue;case'ID':if(/^NOTE($|[ \t])/.test(i)){r.state='NOTE';break}if(!i)continue;if(r.cue=new d.default(0,0,''),r.state='CUE',-1===i.indexOf('--\x3e')){r.cue.id=i;continue}case'CUE':try{o(i,r.cue,r.regionList)}catch(e){r.cue=null,r.state='BADCUE';continue}r.state='CUETEXT';continue;case'CUETEXT':var u=-1!==i.indexOf('--\x3e');if(!i||u&&(n=!0)){r.oncue&&r.oncue(r.cue),r.cue=null,r.state='ID';continue}r.cue.text&&(r.cue.text+='\n'),r.cue.text+=i;continue;case'BADCUE':i||(r.state='ID');continue}}}catch(e){'CUETEXT'===r.state&&r.cue&&r.oncue&&r.oncue(r.cue),r.cue=null,r.state='INITIAL'===r.state?'BADWEBVTT':'BADCUE'}return this},flush:function(){var e=this;try{if(e.buffer+=e.decoder.decode(),(e.cue||'HEADER'===e.state)&&(e.buffer+='\n\n',e.parse()),'INITIAL'===e.state)throw new Error('Malformed WebVTT signature.')}catch(e){throw e}return e.onflush&&e.onflush(),this} },r.fixLineBreaks=l,r.default=i},{ 55:55 }],57:[function(e,t,r){'use strict';var i=e(56),a=function(e){return e&&e.__esModule?e:{ default:e }}(i),n=function(e,t,r){return e.substr(r||0,t.length)===t},s=function(e){var t=parseInt(e.substr(-3)),r=parseInt(e.substr(-6,2)),i=parseInt(e.substr(-9,2)),a=e.length>9?parseInt(e.substr(0,e.indexOf(':'))):0;return isNaN(t)||isNaN(r)||isNaN(i)||isNaN(a)?-1:(t+=1e3*r,t+=6e4*i,t+=36e5*a)},o=function(e){for(var t=5381,r=e.length;r;)t=33*t^e.charCodeAt(--r);return(t>>>0).toString()},l=function(e,t,r){var i=e[t],a=e[i.prevCC];if(!a||!a.new&&i.new)return e.ccOffset=e.presentationOffset=i.start,void(i.new=!1);for(;a&&a.new;)e.ccOffset+=i.start-a.start,i.new=!1,i=a,a=e[i.prevCC];e.presentationOffset=r},u={ parse:function(e,t,r,i,u,d){var f=/\r\n|\n\r|\n|\r/g,c=String.fromCharCode.apply(null,new Uint8Array(e)).trim().replace(f,'\n').split('\n'),h='00:00.000',g=0,v=0,p=0,y=[],m=void 0,E=!0,b=new a.default;b.oncue=function(e){var t=r[i],a=r.ccOffset;t&&t.new&&(void 0!==v?a=r.ccOffset=t.start:l(r,i,p)),p&&(a=p+r.ccOffset-r.presentationOffset),e.startTime+=a-v,e.endTime+=a-v,e.id=o(e.startTime)+o(e.endTime)+o(e.text),e.text=decodeURIComponent(escape(e.text)),e.endTime>0&&y.push(e)},b.onparsingerror=function(e){m=e},b.onflush=function(){if(m&&d)return void d(m);u(y)},c.forEach(function(e){if(E){if(n(e,'X-TIMESTAMP-MAP=')){E=!1,e.substr(16).split(',').forEach(function(e){n(e,'LOCAL:')?h=e.substr(6):n(e,'MPEGTS:')&&(g=parseInt(e.substr(7)))});try{t=t<0?t+8589934592:t,g-=t,v=s(h)/1e3,p=g/9e4,-1===v&&(m=new Error('Malformed X-TIMESTAMP-MAP: '+e))}catch(t){m=new Error('Malformed X-TIMESTAMP-MAP: '+e)}return}''===e&&(E=!1)}b.parse(e+'\n')}),b.flush()} };t.exports=u},{ 56:56 }],58:[function(e,t,r){'use strict';function i(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')}Object.defineProperty(r,'__esModule',{ value:!0 });var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,'value'in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){
return r&&e(t.prototype,r),i&&e(t,i),t}}(),n=e(53),s=function(){function e(t){i(this,e),t&&t.xhrSetup&&(this.xhrSetup=t.xhrSetup)}return a(e,[{ key:'destroy',value:function(){this.abort(),this.loader=null} },{ key:'abort',value:function(){var e=this.loader;e&&4!==e.readyState&&(this.stats.aborted=!0,e.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null} },{ key:'load',value:function(e,t,r){this.context=e,this.config=t,this.callbacks=r,this.stats={ trequest:performance.now(),retry:0 },this.retryDelay=t.retryDelay,this.loadInternal()} },{ key:'loadInternal',value:function(){var e,t=this.context;e='undefined'!=typeof XDomainRequest?this.loader=new XDomainRequest:this.loader=new XMLHttpRequest;var r=this.stats;r.tfirst=0,r.loaded=0;var i=this.xhrSetup;try{if(i)try{i(e,t.url)}catch(r){e.open('GET',t.url,!0),i(e,t.url)}e.readyState||e.open('GET',t.url,!0)}catch(r){return void this.callbacks.onError({ code:e.status,text:r.message },t)}t.rangeEnd&&e.setRequestHeader('Range','bytes='+t.rangeStart+'-'+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),e.send()} },{ key:'readystatechange',value:function(e){var t=e.currentTarget,r=t.readyState,i=this.stats,a=this.context,s=this.config;if(!i.aborted&&r>=2)if(window.clearTimeout(this.requestTimeout),0===i.tfirst&&(i.tfirst=Math.max(performance.now(),i.trequest)),4===r){var o=t.status;if(o>=200&&o<300){i.tload=Math.max(i.tfirst,performance.now());var l=void 0,u=void 0;'arraybuffer'===a.responseType?(l=t.response,u=l.byteLength):(l=t.responseText,u=l.length),i.loaded=i.total=u;var d={ url:t.responseURL,data:l };this.callbacks.onSuccess(d,i,a)}else i.retry>=s.maxRetry||o>=400&&o<499?(n.logger.error(o+' while loading '+a.url),this.callbacks.onError({ code:o,text:t.statusText },a)):(n.logger.warn(o+' while loading '+a.url+', retrying in '+this.retryDelay+'...'),this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,s.maxRetryDelay),i.retry++)}else this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),s.timeout)} },{ key:'loadtimeout',value:function(){n.logger.warn('timeout while loading '+this.context.url),this.callbacks.onTimeout(this.stats,this.context)} },{ key:'loadprogress',value:function(e){var t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total);var r=this.callbacks.onProgress;r&&r(t,this.context,null)} }]),e}();r.default=s},{ 53:53 }] },{},[40])(40)});
!function(f){if('object'==typeof exports&&'undefined'!=typeof module)module.exports=f();else if('function'==typeof define&&define.amd)define([],f);else{('undefined'!=typeof window?window:'undefined'!=typeof global?global:'undefined'!=typeof self?self:this).squadeo=f()}}(function(){return function(){return function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c='function'==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code='MODULE_NOT_FOUND',a}var p=n[i]={ exports:{} };e[i][0].call(p.exports,function(r){return o(e[i][1][r]||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u='function'==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}}()({ 1:[function(_dereq_,module,exports){'use strict';function asyncGeneratorStep(j,a,b,c,d,e,f){try{var g=j[e](f),h=g.value}catch(c){return void b(c)}g.done?a(h):Promise.resolve(h).then(c,d)}function _defineProperties(e,a){for(var b,f=0;f<a.length;f++)(b=a[f]).enumerable=b.enumerable||!1,b.configurable=!0,'value'in b&&(b.writable=!0),Object.defineProperty(e,b.key,b)}Object.defineProperty(exports,'__esModule',{ value:!0 }),exports.default=void 0;var AdBasicStrategy=function(){function c(a){(function(c,a){if(!(c instanceof a))throw new TypeError('Cannot call a class as a function')})(this,c),this.playerImplementation=a}return function(d,a,b){a&&_defineProperties(d.prototype,a),b&&_defineProperties(d,b)}(c,[{ key:'startAd',value:function(b){this.featurePosition=this.playerImplementation.squadeoPlayer.currentTime,this.featureContent=this.playerImplementation.squadeoPlayer.src,this.playerImplementation.squadeoPlayer.load(b)} },{ key:'resumeFeatureContent',value:(i=regeneratorRuntime.mark(function b(){return regeneratorRuntime.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.next=2,this.playerImplementation.squadeoPlayer.load(this.featureContent);case 2:this.playerImplementation.squadeoPlayer.currentTime=this.featurePosition;case 3:case'end':return b.stop()}},b,this)}),b=function(){var a=this,b=arguments;return new Promise(function(c,d){function e(b){asyncGeneratorStep(g,c,d,e,f,'next',b)}function f(b){asyncGeneratorStep(g,c,d,e,f,'throw',b)}var g=i.apply(a,b);e(void 0)})},function(){return b.apply(this,arguments)}) }]),c;var i,b}();exports.default=AdBasicStrategy},{}],2:[function(_dereq_,module,exports){'use strict';var _vastClient=_dereq_(58);function asyncGeneratorStep(j,a,b,c,d,e,f){try{var g=j[e](f),h=g.value}catch(c){return void b(c)}g.done?a(h):Promise.resolve(h).then(c,d)}function _asyncToGenerator(i){return function(){var a=this,b=arguments;return new Promise(function(c,d){function e(b){asyncGeneratorStep(g,c,d,e,f,'next',b)}function f(b){asyncGeneratorStep(g,c,d,e,f,'throw',b)}var g=i.apply(a,b);e(void 0)})}}function _defineProperties(e,a){for(var b,f=0;f<a.length;f++)(b=a[f]).enumerable=b.enumerable||!1,b.configurable=!0,'value'in b&&(b.writable=!0),Object.defineProperty(e,b.key,b)}Object.defineProperty(exports,'__esModule',{ value:!0 }),exports.default=void 0;var AdManager=function(){function c(a){(function(c,a){if(!(c instanceof a))throw new TypeError('Cannot call a class as a function')})(this,c),this.squadeoPlayer=a,this.boundTimeUpdate=this.timeupdate.bind(this),this.squadeoPlayer.on('timeupdate',this.boundTimeUpdate),this.boundPlay=this.play.bind(this),this.squadeoPlayer.on('play',this.boundPlay),this.boundPlaying=this.playing.bind(this),this.squadeoPlayer.on('playing',this.boundPlaying),this.boundAdEnded=this.adEnded.bind(this),this.squadeoPlayer.on('adEnded',this.boundAdEnded),this.isAdManager=!0}return function(d,a,b){a&&_defineProperties(d.prototype,a),b&&_defineProperties(d,b)}(c,[{ key:'timeupdate',value:function(){var f=this;if(!this.squadeoPlayer.playingAd&&null!=this.squadeoPlayer.adBreaks){var a=Math.min(this.squadeoPlayer.currentTime,this.previousTime),b=Math.max(this.squadeoPlayer.currentTime,this.previousTime);this.squadeoPlayer.adBreaks.some(function(c){var d=c.time;if(d>=a&&d<=b&&(!c.lastPlayed||3e5<Date.now()-c.lastPlayed))return f.startAdBreak(c),!0}),this.previousTime=this.squadeoPlayer.currentTime}} },{ key:'play',value:function(){null==this.squadeoPlayer.adBreaks?this.squadeoPlayer.once('adBreaksLoaded',this.checkPreroll):this.checkPreroll()} },{ key:'featureEnded',value:function(){null!=this.squadeoPlayer.adBreaks&&this.checkPostroll()} },{ key:'checkPreroll',value:function(){var c=this;0==this.squadeoPlayer.currentTime&&this.squadeoPlayer.adBreaks.forEach(function(a){'start'===a.time&&c.startAdBreak(a)})} },{ key:'checkPostroll',value:function(){var c=this;this.squadeoPlayer.adBreaks.forEach(function(a){'end'===a.time&&(c.inPostRoll=!0,c.startAdBreak(a))})} },{ key:'playing',value:function(){} },{ key:'startAdBreak',value:(b=_asyncToGenerator(regeneratorRuntime.mark(function e(f){var g;return regeneratorRuntime.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(f.time,!f.lastPlayed||3e5<Date.now()-f.lastPlayed){c.next=3;break}return c.abrupt('return');case 3:return this.currentAdBreak=f,this.sendBreakStartTrackingEvent(),f.lastPlayed=Date.now(),c.next=9,this.getVASTDataFromAdSource(f.vmapBreak.adSource);case 9:g=c.sent,this.currentVASTData=g,this.squadeoPlayer.startAdBreak(),this.remainingAdsInBreak=Array.from(g.ads),this.startAd();case 15:case'end':return c.stop()}},e,this)})),function(){return b.apply(this,arguments)}) },{ key:'getVASTDataFromAdSource',value:function(){var b=_asyncToGenerator(regeneratorRuntime.mark(function g(h){var b,i,j,k;return regeneratorRuntime.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(null==h.vastAdData){c.next=6;break}i=h.vastAdData.outerHTML,b=(new window.DOMParser).parseFromString(i,'text/xml'),c.next=12;break;case 6:return c.next=8,fetch(h.adTagURI.uri);case 8:return c.next=10,c.sent.text();case 10:j=c.sent,b=(new window.DOMParser).parseFromString(j,'text/xml');case 12:return c.next=14,(new _vastClient.VASTParser).parseVAST(b);case 14:return k=c.sent,c.abrupt('return',k);case 16:case'end':return c.stop()}},g)}));return function(){return b.apply(this,arguments)}}() },{ key:'findLinearCreativeInAd',value:function(c){for(var a=0;a<c.creatives.length;a++)if('linear'==c.creatives[a].type)return c.creatives[a]} },{ key:'findMediaFile',value:function(d){for(var a=this.squadeoPlayer.currentImplementation.adStrategy.supportedMimeTypes,b=0;b<d.length;b++)if(-1<a.indexOf(d[b].mimeType))return d[b]} },{ key:'startAd',value:function(){var c=this.remainingAdsInBreak.shift();this.currentCreative=this.findLinearCreativeInAd(c);var a=this.findMediaFile(this.currentCreative.mediaFiles).fileURL;this.currentAdData=c,this.currentAd=a,this.squadeoPlayer.startAd(a)} },{ key:'adEnded',value:function(){var c=this;this.findVASTEvent('complete').forEach(function(a){c.callEventURI(a)}),0===this.remainingAdsInBreak.length?this.adBreakEnded():this.startAd()} },{ key:'adBreakEnded',value:function(){this.squadeoPlayer.playingAd&&!this.inPostRoll&&this.squadeoPlayer.resumeFeatureContent(),this.sendBreakEndTrackingEvent(),this.currentAdBreak=null,this.inPostRoll=!1,this.squadeoPlayer.emit('adBreakEnded')} },{ key:'hasPostRolls',value:function(){return this.squadeoPlayer.adBreaks.some(function(b){return'end'==b.time})} },{ key:'findEvent',value:function(e,a){for(var b,f=0;f<e.vmapBreak.trackingEvents.length;f++)if((b=e.vmapBreak.trackingEvents[f]).event===a)return b} },{ key:'findVASTEvent',value:function(b){return this.currentCreative.trackingEvents[b]} },{ key:'adLoaded',value:function(c){var d=this;this.currentAdDuration=c,this.currentTimeBasedTrackingEvents=this.normaliseVASTProgressEvents(this.currentCreative.trackingEvents),this.findVASTEvent('creativeView').forEach(function(b){d.callEventURI(b)})} },{ key:'normaliseVASTProgressEvents',value:function(h){var a=this;this.normalised=!0;var b=[];return Object.keys(h).forEach(function(c){var e,d=c.split('-');if('progress'!==d[0])switch(d[0].toLowerCase()){case'firstquartile':e=.25*a.currentAdDuration,h[c].forEach(function(c){b.push({ time:e,uri:c })});break;case'midpoint':e=.5*a.currentAdDuration,h[c].forEach(function(c){b.push({ time:e,uri:c })});break;case'thirdquartile':e=.75*a.currentAdDuration,h[c].forEach(function(c){b.push({ time:e,uri:c })})}else if('%'==d[1].substr(-1,1)){var i=a.currentAdDuration/100*d[1].substr(0,d[1].length-1);h[c].forEach(function(c){b.push({ time:i,uri:c })})}else h[c].forEach(function(c){b.push({ time:parseFloat(d[1]),uri:c })})}),b} },{ key:'sendBreakStartTrackingEvent',value:function(){var b=_asyncToGenerator(regeneratorRuntime.mark(function d(){var e,f;return regeneratorRuntime.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(null!=this.currentAdBreak){b.next=2;break}return b.abrupt('return');case 2:if(null==(e=this.findEvent(this.currentAdBreak,'breakStart'))){b.next=9;break}return f=e.uri,window.createAdTestSession&&(this.currentVOAdSession=1e4*Math.random(),f=''.concat(f,'&voadsession=').concat(this.currentVOAdSession)),b.next=8,fetch(f);case 8:return b.abrupt('return',b.sent);case 9:case'end':return b.stop()}},d,this)}));return function(){return b.apply(this,arguments)}}() },{ key:'sendBreakEndTrackingEvent',value:function(){var b=_asyncToGenerator(regeneratorRuntime.mark(function d(){var e,f;return regeneratorRuntime.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(null!=this.currentAdBreak){b.next=2;break}return b.abrupt('return');case 2:if(null==(e=this.findEvent(this.currentAdBreak,'breakEnd'))){b.next=9;break}return f=e.uri,window.createAdTestSession&&(f=''.concat(f,'&voadsession=').concat(this.currentVOAdSession)),b.next=8,fetch(f);case 8:return b.abrupt('return',b.sent);case 9:case'end':return b.stop()}},d,this)}));return function(){return b.apply(this,arguments)}}() },{ key:'sendErrorTrackingEvent',value:function(){var b=_asyncToGenerator(regeneratorRuntime.mark(function d(){var e,f;return regeneratorRuntime.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(null!=this.currentAdBreak){b.next=2;break}return b.abrupt('return');case 2:null!=(e=this.findEvent(this.currentAdBreak,'error'))&&(f=e.uri,this.callEventURI(f,900));case 4:case'end':return b.stop()}},d,this)}));return function(){return b.apply(this,arguments)}}() },{ key:'adTimeUpdated',value:function(d){var e=this;this.currentTimeBasedTrackingEvents.forEach(function(a){e.previousAdTime<a.time&&d>=a.time&&e.callEventURI(a.uri)}),d<this.previousAdTime&&this.findVASTEvent('rewind').forEach(function(b){e.callEventURI(b)}),this.previousAdTime=d,this.squadeoPlayer.emit('adTimeUpdated')} },{ key:'callEventURI',value:function(c,d){return window.createAdTestSession&&(c=''.concat(c,'&voadsession=').concat(this.currentVOAdSession)),c=(c=(c=c.replace('[CONTENTPLAYHEAD]',this.previousAdTime)).replace('[CACHEBUSTING]',(1e8*Math.random()).toString().substring(0,8))).replace('[ASSETURI]',this.currentAd),null!=d&&(c=c.replace('[ERRORCODE]',d)),fetch(c)} },{ key:'skipAd',value:function(){this.squadeoPlayer.currentImplementation.adStrategy.skipAd()} },{ key:'adPlay',value:function(){var c=this;this.findVASTEvent('start').forEach(function(a){c.callEventURI(a)})} },{ key:'adResume',value:function(){var c=this;this.findVASTEvent('resume').forEach(function(a){c.callEventURI(a)})} },{ key:'adPause',value:function(){var c=this;this.findVASTEvent('pause').forEach(function(a){c.callEventURI(a)})} },{ key:'adMute',value:function(){var c=this;this.findVASTEvent('mute').forEach(function(a){c.callEventURI(a)})} },{ key:'adUnmute',value:function(){var c=this;this.findVASTEvent('unmute').forEach(function(a){c.callEventURI(a)})} },{ key:'adRewind',value:function(){var c=this;this.findVASTEvent('rewind').forEach(function(a){c.callEventURI(a)})} },{ key:'destroy',value:function(){this.squadeoPlayer.removeListener('timeupdate',this.boundTimeUpdate),this.squadeoPlayer.removeListener('play',this.boundPlay),this.squadeoPlayer.removeListener('playing',this.boundPlaying),this.squadeoPlayer.removeListener('adEnded',this.boundAdEnded)} },{ key:'adDuration',get:function(){return this.squadeoPlayer.currentImplementation.adStrategy.adDuration} },{ key:'adSkipOffset',get:function(){return this.currentCreative.skipDelay} },{ key:'adPosition',get:function(){return this.squadeoPlayer.currentImplementation.adStrategy.adPosition} }]),c;var b}();exports.default=AdManager},{ 58:58 }],3:[function(_dereq_,module,exports){'use strict';function asyncGeneratorStep(j,a,b,c,d,e,f){try{var g=j[e](f),h=g.value}catch(c){return void b(c)}g.done?a(h):Promise.resolve(h).then(c,d)}function _defineProperties(e,a){for(var b,f=0;f<a.length;f++)(b=a[f]).enumerable=b.enumerable||!1,b.configurable=!0,'value'in b&&(b.writable=!0),Object.defineProperty(e,b.key,b)}Object.defineProperty(exports,'__esModule',{ value:!0 }),exports.default=void 0;var AdTagStrategy=function(){function c(a){(function(c,a){if(!(c instanceof a))throw new TypeError('Cannot call a class as a function')})(this,c),this.playerImplementation=a,this.boundEnded=this.ended.bind(this),this.adBreakEnded=this.adBreakEnded.bind(this),this.boundError=this.error.bind(this),this.boundAdLoaded=this.adLoaded.bind(this),this.boundTimeUpdated=this.timeUpdated.bind(this),this.boundVolumeChange=this.volumeChange.bind(this),this.boundPause=this.pause.bind(this),this.boundPlay=this.play.bind(this)}return function(d,a,b){a&&_defineProperties(d.prototype,a),b&&_defineProperties(d,b)}(c,[{ key:'startAd',value:function(c){this.adPaused=!1;var a=this.playerImplementation.squadeoPlayer.video_;null==this.tag&&(this.background=document.createElement('div'),this.background.style.backgroundColor='black',this.background.style.width='100%',this.background.style.height='100%',this.background.style.position='absolute',this.background.style.top='0',this.background.style.left='0',this.tag=document.createElement('video'),this.tag.style.width=a.clientWidth+'px',this.tag.style.height=a.clientHeight+'px',this.tag.style.position='absolute',this.tag.style.top='0',this.tag.style.left='0',a.parentNode.appendChild(this.background),this.background.appendChild(this.tag),this.playerImplementation.squadeoPlayer.liveHack?(this.initiallyMuted=this.playerImplementation.squadeoPlayer.muted,this.playerImplementation.squadeoPlayer.muted=!0):this.playerImplementation.pause()),this.tag.addEventListener('error',this.boundError),this.tag.addEventListener('loadeddata',this.boundAdLoaded),this.tag.addEventListener('ended',this.boundEnded),this.tag.addEventListener('timeupdate',this.boundTimeUpdated),this.tag.addEventListener('volumechange',this.boundVolumeChange),this.tag.addEventListener('pause',this.boundPause),this.tag.addEventListener('play',this.boundPlay),this.tag.src=c,this.tag.play()} },{ key:'timeUpdated',value:function(){this.playerImplementation.squadeoPlayer.adManager.adTimeUpdated(this.tag.currentTime)} },{ key:'resumeFeatureContent',value:(i=regeneratorRuntime.mark(function b(){return regeneratorRuntime.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:this.background.parentNode.removeChild(this.background),this.background=null,this.tag=null,this.playerImplementation.squadeoPlayer.play();case 4:case'end':return b.stop()}},b,this)}),b=function(){var a=this,b=arguments;return new Promise(function(c,d){function e(b){asyncGeneratorStep(g,c,d,e,f,'next',b)}function f(b){asyncGeneratorStep(g,c,d,e,f,'throw',b)}var g=i.apply(a,b);e(void 0)})},function(){return b.apply(this,arguments)}) },{ key:'ended',value:function(){this.tag.removeEventListener('ended',this.boundEnded),this.tag.removeEventListener('error',this.boundError),this.tag.removeEventListener('loadeddata',this.boundAdLoaded),this.tag.removeEventListener('timeupdate',this.boundTimeUpdated),this.tag.removeEventListener('volumechange',this.boundVolumeChange),this.tag.removeEventListener('pause',this.boundPause),this.tag.removeEventListener('play',this.boundPlay),this.playerImplementation.squadeoPlayer.emit('adEnded')} },{ key:'skipAd',value:function(){this.playerImplementation.squadeoPlayer.emit('skipAd'),this.ended()} },{ key:'adBreakEnded',value:function(){this.playerImplementation.squadeoPlayer.liveHack?this.playerImplementation.squadeoPlayer.muted=this.initiallyMuted:this.playerImplementation.squadeoPlayer.play(),this.playerImplementation.squadeoPlayer.resumeFeatureContent(),this.playerImplementation.squadeoPlayer.adManager.sendBreakEndTrackingEvent()} },{ key:'error',value:function(b){this.playerImplementation.squadeoPlayer.adManager.sendErrorTrackingEvent(b)} },{ key:'adLoaded',value:function(){this.playerImplementation.squadeoPlayer.adManager.adLoaded(this.tag.duration)} },{ key:'volumeChange',value:function(){this.tag.muted?this.playerImplementation.squadeoPlayer.adManager.adMute():this.playerImplementation.squadeoPlayer.adManager.adUnmute()} },{ key:'pause',value:function(){this.adPaused=!0,this.playerImplementation.squadeoPlayer.adManager.adPause()} },{ key:'play',value:function(){this.adPaused?this.playerImplementation.squadeoPlayer.adManager.adResume():this.playerImplementation.squadeoPlayer.adManager.adPlay(),this.adPaused=!1} },{ key:'adPosition',get:function(){return this.tag.currentTime} },{ key:'adDuration',get:function(){return this.tag.duration} },{ key:'supportedMimeTypes',get:function(){var b=['video/mp4','video/x-msvideo','video/mpeg'];return(-1<navigator.userAgent.indexOf('Firefox')||-1<navigator.userAgent.indexOf('Chrome')||-1<navigator.userAgent.indexOf('Edge'))&&b.push('video/webm'),b} }]),c;var i,b}();exports.default=AdTagStrategy},{}],4:[function(_dereq_,module,exports){'use strict';function _defineProperties(e,a){for(var b,f=0;f<a.length;f++)(b=a[f]).enumerable=b.enumerable||!1,b.configurable=!0,'value'in b&&(b.writable=!0),Object.defineProperty(e,b.key,b)}Object.defineProperty(exports,'__esModule',{ value:!0 }),exports.default=void 0;var _default=function(){function i(a){(function(c,a){if(!(c instanceof a))throw new TypeError('Cannot call a class as a function')})(this,i),this._tables=[[[],[],[],[],[]],[[],[],[],[],[]]],this._precompute();var b,j,n,o,p,q=this._tables[0][4],h=this._tables[1],k=a.length,l=1;if(4!==k&&6!==k&&8!==k)throw new Error('Invalid aes key size='+k);for(o=a.slice(0),p=[],this._key=[o,p],b=k;b<4*k+28;b++)n=o[b-1],(0==b%k||8===k&&4==b%k)&&(n=q[n>>>24]<<24^q[255&n>>16]<<16^q[255&n>>8]<<8^q[255&n],0==b%k&&(n=n<<8^n>>>24^l<<24,l=l<<1^283*(l>>7))),o[b]=o[b-k]^n;for(j=0;b;j++,b--)n=o[3&j?b:b-4],p[j]=4>=b||4>j?n:h[0][q[n>>>24]]^h[1][q[255&n>>16]]^h[2][q[255&n>>8]]^h[3][q[255&n]]}return d=i,(a=[{ key:'_precompute',value:function(){var i,q,r,s,t,v,w,x,y=this._tables[0],l=this._tables[1],m=y[4],n=l[4],o=[],p=[];for(i=0;256>i;i++)p[(o[i]=i<<1^283*(i>>7))^i]=i;for(q=r=0;!m[q];q^=s||1,r=p[r]||1)for(v=(v=r^r<<1^r<<2^r<<3^r<<4)>>8^255&v^99,m[q]=v,n[v]=q,x=16843009*o[t=o[s=o[q]]]^65537*t^257*s^16843008*q,w=257*o[v]^16843008*v,i=0;4>i;i++)y[i][q]=w=w<<24^w>>>8,l[i][v]=x=x<<24^x>>>8;for(i=0;5>i;i++)y[i]=y[i].slice(0),l[i]=l[i].slice(0)} },{ key:'decrypt',value:function(a,b,c,d,e,f){var g,h,i,j,k=this._key[1],p=a^k[0],C=d^k[1],D=c^k[2],E=b^k[3],F=k.length/4-2,u=4,G=this._tables[1],w=G[0],x=G[1],y=G[2],z=G[3],A=G[4];for(j=0;j<F;j++)g=w[p>>>24]^x[255&C>>16]^y[255&D>>8]^z[255&E]^k[u],h=w[C>>>24]^x[255&D>>16]^y[255&E>>8]^z[255&p]^k[u+1],i=w[D>>>24]^x[255&E>>16]^y[255&p>>8]^z[255&C]^k[u+2],E=w[E>>>24]^x[255&p>>16]^y[255&C>>8]^z[255&D]^k[u+3],u+=4,p=g,C=h,D=i;for(j=0;4>j;j++)e[(3&-j)+f]=A[p>>>24]<<24^A[255&C>>16]<<16^A[255&D>>8]<<8^A[255&E]^k[u++],g=p,p=C,C=D,D=E,E=g} }])&&_defineProperties(d.prototype,a),b&&_defineProperties(d,b),i;var d,a,b}();exports.default=_default},{}],5:[function(_dereq_,module,exports){'use strict';var b,_aes=(b=_dereq_(4))&&b.__esModule?b:{ default:b };function _defineProperties(e,a){for(var b,f=0;f<a.length;f++)(b=a[f]).enumerable=b.enumerable||!1,b.configurable=!0,'value'in b&&(b.writable=!0),Object.defineProperty(e,b.key,b)}Object.defineProperty(exports,'__esModule',{ value:!0 }),exports.default=void 0;var _default=function(){function d(a,b){(function(c,a){if(!(c instanceof a))throw new TypeError('Cannot call a class as a function')})(this,d),this.key=a,this.iv=b}return function(d,a,b){a&&_defineProperties(d.prototype,a),b&&_defineProperties(d,b)}(d,[{ key:'ntoh',value:function(b){return b<<24|(65280&b)<<8|(16711680&b)>>8|b>>>24} },{ key:'doDecrypt',value:function(q,a,b){var c,r,s,t,u,v,w,x,y,z=new Int32Array(q.buffer,q.byteOffset,q.byteLength>>2),m=new _aes.default(Array.prototype.slice.call(a)),n=new Uint8Array(q.byteLength),o=new Int32Array(n.buffer);for(c=~~b[0],r=~~b[1],s=~~b[2],t=~~b[3],y=0;y<z.length;y+=4)u=~~this.ntoh(z[y]),v=~~this.ntoh(z[y+1]),w=~~this.ntoh(z[y+2]),x=~~this.ntoh(z[y+3]),m.decrypt(u,v,w,x,o,y),o[y]=this.ntoh(o[y]^c),o[y+1]=this.ntoh(o[y+1]^r),o[y+2]=this.ntoh(o[y+2]^s),o[y+3]=this.ntoh(o[y+3]^t),c=u,r=v,s=w,t=x;return n} },{ key:'localDecrypt',value:function(f,a,b,c){var d=this.doDecrypt(f,a,b);c.set(d,f.byteOffset)} },{ key:'decrypt',value:function(g){var a=new Int32Array(g),b=new Uint8Array(g.byteLength),c=0,h=this.key,e=this.iv;for(this.localDecrypt(a.subarray(c,c+32e3),h,e,b),c=32e3;c<a.length;c+=32e3)e=new Uint32Array([this.ntoh(a[c-4]),this.ntoh(a[c-3]),this.ntoh(a[c-2]),this.ntoh(a[c-1])]),this.localDecrypt(a.subarray(c,c+32e3),h,e,b);return b} }]),d}();exports.default=_default},{ 4:4 }],6:[function(_dereq_,module,exports){'use strict';function _typeof2(a){return(_typeof2='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&'function'==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?'symbol':typeof a})(a)}Object.defineProperty(exports,'__esModule',{ value:!0 }),exports.default=void 0;var b,_squadeoPlayer=_dereq_(11),_utils=(b=_dereq_(13))&&b.__esModule?b:{ default:b };function _typeof(b){return(_typeof='function'==typeof Symbol&&'symbol'==_typeof2(Symbol.iterator)?function(b){return _typeof2(b)}:function(b){return b&&'function'==typeof Symbol&&b.constructor===Symbol&&b!==Symbol.prototype?'symbol':_typeof2(b)})(b)}function asyncGeneratorStep(j,a,b,c,d,e,f){try{var g=j[e](f),h=g.value}catch(c){return void b(c)}g.done?a(h):Promise.resolve(h).then(c,d)}function _defineProperties(e,a){for(var b,f=0;f<a.length;f++)(b=a[f]).enumerable=b.enumerable||!1,b.configurable=!0,'value'in b&&(b.writable=!0),Object.defineProperty(e,b.key,b)}var PlayerAppleNative=function(){function c(a){(function(c,a){if(!(c instanceof a))throw new TypeError('Cannot call a class as a function')})(this,c),this.squadeoPlayer=a,this._fpEventsAlreadyListened=!1}return function(d,a,b){a&&_defineProperties(d.prototype,a),b&&_defineProperties(d,b)}(c,[{ key:'load',value:function(d,a){return this.squadeoPlayer.currentPlayer_=_squadeoPlayer.PLAYER_TYPE.SAFARI_NATIVE_APPLEOS,this.squadeoPlayer.video_.addEventListener('loadeddata',this.onNativePlayerLoaded_.bind(this)),this.squadeoPlayer.video_.addEventListener('error',this.squadeoPlayer.onVideoErrorEvent_.bind(this.squadeoPlayer),!0),this.squadeoPlayer._fpEventsAlreadyListened||(this.squadeoPlayer._fpEventsAlreadyListened=!0,this.squadeoPlayer.video_.addEventListener('webkitneedkey',this.onFPKeyNeedKey_.bind(this),!1)),this.squadeoPlayer.safariNativeiOSBrowser_&&(this.squadeoPlayer.video_.setAttribute('autoplay',!0),this.squadeoPlayer.configuration_.iosPlaysInline?this.squadeoPlayer.video_.setAttribute('playsinline',!0):this.squadeoPlayer.video_.removeAttribute('playsinline')),new Promise(function(b){new Promise(function(b){this.squadeoPlayer.setBuffering_(!0),this.squadeoPlayer.configuration_.drm.advanced.hasOwnProperty('com.apple.fps')&&this.squadeoPlayer.configuration_.drm.advanced['com.apple.fps'].serverCertificateUrl?(this.squadeoPlayer.fairplayCertificate_LoadedCB_=b,this.loadFairPlayCertificate_(this.configuration_.drm.advanced['com.apple.fps'].serverCertificateUrl)):this.squadeoPlayer.configuration_.drm.advanced.hasOwnProperty('com.apple.fps')&&this.squadeoPlayer.configuration_.drm.advanced['com.apple.fps'].serverCertificate?(this.fairplayCertificate_=this.squadeoPlayer.configuration_.drm.advanced['com.apple.fps'].serverCertificate,b()):b()}.bind(this)).then(function(){this.squadeoPlayer.setBufferingWatchdog_(!0),this.squadeoPlayer.video_.setAttribute('src',d),null!=a&&0<a&&(this.squadeoPlayer.startTime_=a),b()}.bind(this))}.bind(this))} },{ key:'loadFairPlayCertificate_',value:function(c){var a=new XMLHttpRequest;a.responseType='arraybuffer',a.addEventListener('load',this.onFPCertificateLoaded_.bind(this),!1),a.addEventListener('error',this.onFPCertificateError_.bind(this),!1),a.open('GET',c,!0),a.send()} },{ key:'onFPCertificateLoaded_',value:function(c){var a=c.target;this.fairplayCertificate_=new Uint8Array(a.response),this.fairplayCertificate_LoadedCB_()} },{ key:'onFPCertificateError_',value:function(){this.fairplayCertificate_=void 0} },{ key:'destroy',value:function(){} },{ key:'seekRange',value:function(){var b=this.squadeoPlayer.video_.seekable;return{ start:b.start(0),end:b.end(0) }} },{ key:'programinfo',value:function(){return{ start:void 0,end:void 0 }} },{ key:'reset',value:(i=regeneratorRuntime.mark(function c(d){return regeneratorRuntime.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return _squadeoPlayer.PLAYER_TYPE.SAFARI_NATIVE_APPLEOS===d&&(this.squadeoPlayer.video_.removeEventListener('loadeddata',this.onNativePlayerLoaded_.bind(this)),this.squadeoPlayer.video_.removeEventListener('error',this.squadeoPlayer.onVideoErrorEvent_.bind(this.squadeoPlayer)),this.squadeoPlayer.video_.pause(),this.squadeoPlayer.video_.removeAttribute('src'),this.squadeoPlayer.video_.load(),null!=this.squadeoPlayer.fpKeySession&&this.squadeoPlayer.fpKeySession.close()),b.abrupt('return');case 2:case'end':return b.stop()}},c,this)}),b=function(){var a=this,b=arguments;return new Promise(function(c,d){function e(b){asyncGeneratorStep(g,c,d,e,f,'next',b)}function f(b){asyncGeneratorStep(g,c,d,e,f,'throw',b)}var g=i.apply(a,b);e(void 0)})},function(){return b.apply(this,arguments)}) },{ key:'loadTextTracks',value:function(){var h,i;0<=this.squadeoPlayer.textTrack_&&this.squadeoPlayer.textTrack_<=this.squadeoPlayer.textTracks_.length&&(h=this.squadeoPlayer.textTracks_[this.squadeoPlayer.textTrack_].language,i=this.squadeoPlayer.textTracks_[this.squadeoPlayer.textTrack_].kind);for(var j=[],c=this.squadeoPlayer.video_.textTracks,d=-1,k=0;k<c.length;k++){if(0<=c[k].label.indexOf('Shaka')||0==c[k].label.length&&0==c[k].language.length)continue;c[k].mode='disabled';var l={ language:c[k].language,id:c[k].id,kind:c[k].kind };j.push(l),c[k].kind==i&&c[k].language==h&&(d=j.length-1,c[k].mode='hidden')}this.squadeoPlayer.textTracks_=j,this.squadeoPlayer.textTrack_=d} },{ key:'onFPKeyNeedKey_',value:function(g){var a=g.target,b=g.initData,h=this.extractFPContentId_(b);if(this.squadeoPlayer.fpKeyId=h,this.squadeoPlayer.fairplayCertificate_){if(b=this.fpConcatInitDataIdAndCertificate_(b,h,this.squadeoPlayer.fairplayCertificate_),!a.webkitKeys){var d;if(!WebKitMediaKeys.isTypeSupported('com.apple.fps.1_0','video/mp4'))return void this.squadeoPlayer.emit('error',{ category:6,code:6001,message:'Key system com.apple.fps.1_0 is not supported by the browser' });d='com.apple.fps.1_0',a.webkitSetMediaKeys(new WebKitMediaKeys(d))}if(a.webkitKeys)if(null==this.squadeoPlayer._fpKeySession){var i=a.webkitKeys.createSession('video/mp4',b);if(!i)return void this.squadeoPlayer.emit('error',{ category:6,code:6005,message:'Failed to create FairPlay session' });i.contentId=h,i.addEventListener('webkitkeymessage',this.onFPLicenseRequestReady_.bind(this),!1),i.addEventListener('webkitkeyadded',this.onFPKeyAdded_.bind(this),!1),i.addEventListener('webkitkeyerror',this.onFPKeyError_.bind(this),!1),this.squadeoPlayer._fpKeySession=i}else this.squadeoPlayer._fpKeySession.contentId=h;else this.squadeoPlayer.emit('error',{ category:6,code:6002,message:'Failed to create FairPlay media keys' })}else this.squadeoPlayer.emit('error',{ category:6,code:6004,message:'Invalid FairPlay certificate' })} },{ key:'onFPLicenseRequestReady_',value:function(f){var a=f.target,b={};b.uri=this.squadeoPlayer.configuration_.drm.servers['com.apple.fps'],b.responseType='text',b.method='POST',b.body=_utils.default.base64EncodeUint8Array(f.message),b.keyIds=[this.squadeoPlayer.fpKeyId],b.drm='com.apple.fps',b.headers={},b.allowCrossSiteCredentials=!1,this.runLicenseRequestFilterForFairplay_(b);var c=new XMLHttpRequest;if(c.session=a,c.withCredentials=b.allowCrossSiteCredentials,c.addEventListener('load',this.squadeoPlayer.bind(this),!1),c.addEventListener('error',this.onFPLicenseRequestFailed_.bind(this),!1),c.addEventListener('timeout',this.onFPLicenseRequestFailed_.bind(this),!1),c.open(b.method,b.uri,!0),'object'===_typeof(b.headers))for(var d in b.headers)c.setRequestHeader(d,b.headers[d]);c.responseType=b.responseType,void 0!==b.allowCrossSiteCredentials&&(c.withCredentials=b.allowCrossSiteCredentials),c.send(b.body)} },{ key:'extractFPContentId_',value:function(d){var a=_utils.default.arrayToString(d);a=a.substring(1);var e=document.createElement('a');return e.href=a,e.hostname} },{ key:'fpConcatInitDataIdAndCertificate_',value:function(j,a,k){'string'==typeof a&&(a=_utils.default.stringToArray(a));var c=0,l=new ArrayBuffer(j.byteLength+4+a.byteLength+4+k.byteLength),e=new DataView(l);new Uint8Array(l,c,j.byteLength).set(j),c+=j.byteLength,e.setUint32(c,a.byteLength,!0),c+=4;var g=new Uint16Array(l,c,a.length);return g.set(a),c+=g.byteLength,e.setUint32(c,k.byteLength,!0),c+=4,new Uint8Array(l,c,k.byteLength).set(k),new Uint8Array(l,0,l.byteLength)} },{ key:'onFPLicenseRequestLoaded_',value:function(j){var a=j.target.session,b=j.target.getAllResponseHeaders().split('\r\n').reduce(function(d,a){var b=a.split(': ');return d[b[0].toLowerCase()]=b.slice(1).join(': '),d},{}),d={ uri:j.target.responseURL,data:j.target.response,headers:b,drm:'com.apple.fps' };if(this.runLicenseResponseFilterForFairPlay_(d))var f=d.data;else if('<ckc>'===(f=j.target.responseText.trim()).substr(0,5)&&'</ckc>'===f.substr(-6)&&(f=f.slice(5,-6)),0<=f.indexOf('<FAIRPLAY_RESPONSE>')){var k=f.search('</LICENSE>');f=f.slice(28,k)}try{var h=_utils.default.base64DecodeUint8Array(f);a.update(h)}catch(b){this.onFPKeyError_()}} },{ key:'onFPLicenseRequestFailed_',value:function(){this.squadeoPlayer.emit('error',{ category:6,code:6007,message:'FairPlay license request failed' })} },{ key:'onFPKeyError_',value:function(){this.squadeoPlayer.emit('error',{ category:6,code:6008,message:'FairPlay key error' })} },{ key:'onFPKeyAdded_',value:function(){} },{ key:'runLicenseRequestFilterForFairplay_',value:function(d){for(var a=this.squadeoPlayer.licenseRequestFilters_,b=0;b<a.length;b++)try{a[b](d)}catch(b){}} },{ key:'runLicenseResponseFilterForFairPlay_',value:function(e){for(var a=!1,f=this.squadeoPlayer.licenseResponseFilters_,c=0;c<f.length;c++)try{f[c](e),a=!0}catch(b){}return a} },{ key:'onNativePlayerLoaded_',value:function(){null!=this.startTime_&&(this.squadeoPlayer.video_.currentTime=this.startTime_,this.squadeoPlayer.startTime_=void 0),setTimeout(this.deferedNativePlayerLoaded_.bind(this),50)} },{ key:'deferedNativePlayerLoaded_',value:function(){for(var e,f=[],b=this.squadeoPlayer.video_.audioTracks,c=0;c<b.length;c++)e={ language:b[c].language,id:b[c].id,active:b[c].enabled },f.push(e),b[c].enabled&&(this.squadeoPlayer.currentAudioTrackId_=c);this.squadeoPlayer.audioTracks_=f,this.squadeoPlayer.currentImplementation.loadTextTracks(),this.squadeoPlayer.video_.textTracks.onchange=function(d){for(var a=this.squadeoPlayer.video_.textTracks,b=0;b<a.length;b++)'showing'==this.squadeoPlayer.video_.textTracks[b].mode&&(this.squadeoPlayer.video_.textTracks[b].mode='hidden')}.bind(this),this.squadeoPlayer.isLive_=this.squadeoPlayer.video_.duration==1/0,this.squadeoPlayer.emit('loaded',{ type:'loaded' }),this.squadeoPlayer.emit('durationchange',{ type:'durationchange' }),this.squadeoPlayer.emit('trackschanged',{ type:'trackschanged',emittedBy:'manifest' })} },{ key:'play',value:function(){this.squadeoPlayer.video_.play()} },{ key:'pause',value:function(){this.squadeoPlayer.video_.pause()} },{ key:'audioTrack',set:function(f){for(var a=this.squadeoPlayer.audioTracks_[f].language,b=this.squadeoPlayer.video_.audioTracks,c=0;c<b.length;c++)if(b[c].language===a){b[c].enabled=!0;break}this.squadeoPlayer.currentAudioTrackId_=f;var g=this.squadeoPlayer.textTrack_;this.squadeoPlayer.textTrack_=-2,this.squadeoPlayer.textTrack=g} },{ key:'textTrack',set:function(f){this.squadeoPlayer.registerTextTrackCueListener&&(this.squadeoPlayer.registerTextTrackCueListener.mode='disabled',this.squadeoPlayer.registerTextTrackCueListener.oncuechange=null,this.squadeoPlayer.registerTextTrackCueListener=void 0);for(var a=this.squadeoPlayer.video_.textTracks,g=0;g<a.length;g++)a[g].oncuechange=null,a[g].mode='disabled';if(0<=f){var h=this.squadeoPlayer.textTracks_[f].language,d=this.squadeoPlayer.textTracks_[f].kind;for(a=this.squadeoPlayer.video_.textTracks,g=0;g<a.length;g++)if(a[g].language===h&&a[g].kind===d){a[g].oncuechange=function(){this.squadeoPlayer.onNativeHLSCueChange_()}.bind(this),a[g].mode='hidden',this.squadeoPlayer.registerTextTrackCueListener=a[g];break}}this.squadeoPlayer.textTrack_=f} },{ key:'currentTime',get:function(){return this.squadeoPlayer.video_.currentTime},set:function(b){this.squadeoPlayer.video_.currentTime=b} }]),c;var i,b}();exports.default=PlayerAppleNative},{ 11:11,13:13 }],7:[function(_dereq_,module,exports){'use strict';Object.defineProperty(exports,'__esModule',{ value:!0 }),exports.default=void 0;var _squadeoPlayer=_dereq_(11),_xhrLoader=_interopRequireDefault(_dereq_(14)),_adTagStrategy=(_interopRequireDefault(_dereq_(1)),_interopRequireDefault(_dereq_(3)));function _interopRequireDefault(b){return b&&b.__esModule?b:{ default:b }}function asyncGeneratorStep(j,a,b,c,d,e,f){try{var g=j[e](f),h=g.value}catch(c){return void b(c)}g.done?a(h):Promise.resolve(h).then(c,d)}function _asyncToGenerator(i){return function(){var a=this,b=arguments;return new Promise(function(c,d){function e(b){asyncGeneratorStep(g,c,d,e,f,'next',b)}function f(b){asyncGeneratorStep(g,c,d,e,f,'throw',b)}var g=i.apply(a,b);e(void 0)})}}function _defineProperties(e,a){for(var b,f=0;f<a.length;f++)(b=a[f]).enumerable=b.enumerable||!1,b.configurable=!0,'value'in b&&(b.writable=!0),Object.defineProperty(e,b.key,b)}var PlayerDash=function(){function c(a){(function(c,a){if(!(c instanceof a))throw new TypeError('Cannot call a class as a function')})(this,c),this.squadeoPlayer=a,this.adStrategy=new _adTagStrategy.default(this),this.dashPlayer_=new shaka.Player(this.squadeoPlayer.video_),this.dashPlayer_.addEventListener('error',this.dispatchDashEvent_.bind(this)),this.dashPlayer_.addEventListener('trackschanged',this.dispatchDashEvent_.bind(this)),this.dashPlayer_.addEventListener('unloading',this.dispatchDashEvent_.bind(this)),this.dashPlayer_.addEventListener('buffering',this.dispatchDashEvent_.bind(this)),this.squadeoPlayer.video_.addEventListener('timeupdate',this._onVideoTimeUpdate.bind(this)),this.dashPlayer_.getNetworkingEngine().registerRequestFilter(function(c,a){this.runLicenseRequestFilters_(c,a)}.bind(this)),this.dashPlayer_.getNetworkingEngine().registerResponseFilter(function(c,a){this.runLicenseResponseFilters_(c,a)}.bind(this))}return function(d,a,b){a&&_defineProperties(d.prototype,a),b&&_defineProperties(d,b)}(c,[{ key:'load',value:(b=_asyncToGenerator(regeneratorRuntime.mark(function d(e,b){return regeneratorRuntime.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(void 0!==this.squadeoPlayer.configuration_&&(this.configure(this.squadeoPlayer.configuration_),this.squadeoPlayer.configuration_.abr.hasOwnProperty('maxBandwidthCap')),this.setTextTrackVisibility(!1),this.squadeoPlayer.internalSetTextTrack(-1,!1),this.firstTrackChangedEventAfterDASHLoading_=!0,null==this.squadeoPlayer.widevineServerCertificateURL_){c.next=16;break}return c.prev=6,c.next=9,this.loadWidevineServerCertificate_();case 9:c.next=16;break;case 11:throw c.prev=11,c.t0=c.catch(6),this.squadeoPlayer.emit('error',c.t0),c.t0;case 16:return c.prev=16,c.next=19,this.dashPlayer_.load(e,b);case 19:c.next=26;break;case 21:throw c.prev=21,c.t1=c.catch(16),this.squadeoPlayer.emit('error',c.t1),c.t1;case 26:if(this.squadeoPlayer.control.test){c.next=29;break}return c.abrupt('return');case 29:return this.squadeoPlayer.emit('loaded',{ type:'loaded' }),c.abrupt('return');case 31:case'end':return c.stop()}},d,this,[[6,11],[16,21]])})),function(){return b.apply(this,arguments)}) },{ key:'seekRange',value:function(){return this.dashPlayer_.seekRange()} },{ key:'programInfo',value:function(){var d={ start:void 0,end:void 0 },a=this.dashPlayer_.getManifest().presentationTimeline.getPresentationStartTime();d.start=1e4<a?a:this.dashPlayer_.getManifest().presentationTimeline.getMinSegmentStartTime();var b=this.dashPlayer_.seekRange();return d.end=d.start+(b.end-b.start),d} },{ key:'setQualityLevel_',value:function(e){var a=this.findDashTrackForId_(this.squadeoPlayer.levels_[e].id);if(null!=a){if(this.dashPlayer_.configure({ abr:{ enabled:!1 } }),this.squadeoPlayer.allowImmediateQualitySwitch_){this.dashPlayer_.selectVariantTrack(a,!0),this.squadeoPlayer.currentDashLevelId_=a.videoId;for(var b=this.squadeoPlayer.levels_.length,c=0;c<b;c++)this.squadeoPlayer.levels_[c].active=!1;this.squadeoPlayer.levels_[e].active=!0}else this.dashPlayer_.selectVariantTrack(a,!1);return this.squadeoPlayer.currentQualityLevel_=e,this.squadeoPlayer.levels_[e]}} },{ key:'configure',value:function(b){this.dashPlayer_.configure(b)} },{ key:'getConfiguration',value:function(){return this.dashPlayer_.getConfiguration()} },{ key:'reset',value:function(){var b=_asyncToGenerator(regeneratorRuntime.mark(function c(d){return regeneratorRuntime.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(_squadeoPlayer.PLAYER_TYPE.DASH!==d){b.next=7;break}return null!=this.squadeoPlayer.dashCueChangeListener_&&(this.dashPlayer_.getTextTrack().removeEventListener('cuechange',this.squadeoPlayer.dashCueChangeListener_.bind(this)),this.squadeoPlayer.dashCueChangeListener_=void 0),b.next=4,this.dashPlayer_.unload();case 4:return b.abrupt('return');case 7:return this.isResseting_=!1,b.abrupt('return');case 9:case'end':return b.stop()}},c,this)}));return function(){return b.apply(this,arguments)}}() },{ key:'dispatchDashEvent_',value:function(b){switch(b.type){case'trackschanged':this.loadDashTracks_(!1),this.squadeoPlayer.emit('trackschanged',{ type:'trackschanged',emittedBy:'manifest' });break;case'buffering':this.squadeoPlayer.emit('buffering',{ buffering:b.buffering });break;case'error':this.squadeoPlayer.emit('error',{ category:b.detail.category,code:b.detail.code,message:b.detail.message,data:b.detail.data })}} },{ key:'loadDashTracks_',value:function(){this.squadeoPlayer.isLive_=this.dashPlayer_.isLive();var b=this.findActiveLanguage();this.loadVariantTracks(b),this.loadAudioTracks(b),this.loadTextTracks()} },{ key:'loadTextTracks',value:function(){var i=[];if(this.dashPlayer_.getTextTracks().forEach(function(a){if('text'==a.type){var b=a.active&&!this.firstTrackChangedEventAfterDASHLoading_,c={ id:a.id,language:a.language,active:b,kind:a.kind };i.push(c)}}.bind(this)),this.squadeoPlayer.srtManager_){var b=this.squadeoPlayer.srtManager_.srtTrackNames;if(0<b.length)for(var c=this.squadeoPlayer.srtManager_.srtTracks,d=0;d<b.length;d++){var f=c[b[d]];if(f.loaded){var g={ id:0,name:f.name,language:f.language,active:!1,type:'SRT',kind:'subtitles' };i.push(g)}}}this.squadeoPlayer.textTracks_=i,this.firstTrackChangedEventAfterDASHLoading_&&(this.firstTrackChangedEventAfterDASHLoading_=!1,this.squadeoPlayer.applyPreferredTextLanguage_())} },{ key:'findActiveLanguage',value:function(){for(var d,e=this.dashPlayer_.getVariantTracks(),b=0;b<e.length;b++)if((d=e[b]).active)return{ language:d.language,audioId:d.audioId }} },{ key:'loadVariantTracks',value:function(f){var g=[],b={};null==f&&(f=this.findActiveLanguage()),this.dashPlayer_.getVariantTracks().forEach(function(a){if(a.language==f.language&&a.audioId==f.audioId){var c={ bandwidth:a.bandwidth,width:a.width,height:a.height,id:a.id,active:a.active };a.active&&(b=c,null==this.squadeoPlayer.currentDashLevelId_&&(this.squadeoPlayer.currentDashLevelId_=a.videoId)),g.push(c)}}.bind(this)),this.squadeoPlayer.levels_=g.sort(function(c,a){return a.bandwidth-c.bandwidth});var d=this.squadeoPlayer.levels_.findIndex(function(b){return 1==b.active});this.squadeoPlayer.dashVideoTrack_=b,this.squadeoPlayer.currentQualityLevel_=d} },{ key:'loadAudioTracks',value:function(f){var g=0,h=[];null==f&&(f=this.findActiveLanguage()),this.dashPlayer_.getAudioLanguages().forEach(function(a){var b={ language:a };a==f.language?(b.active=!0,this.squadeoPlayer.currentAudioTrackId_=g):b.active=!1,h.push(b),g++}.bind(this)),this.squadeoPlayer.audioTracks_=h} },{ key:'_onVideoTimeUpdate',value:function(){var e=this.squadeoPlayer.video_.currentTime;!this.squadeoPlayer.isLive_||this.dashPlayer_.isLive()||this.squadeoPlayer.endOfLiveReached_||(this.squadeoPlayer.endOfLiveReached_=!0,this.squadeoPlayer.emit('endoflivereached',{ type:'endoflivereached' }));var a=this.dashPlayer_.getTrackIdForTime('video',e);if(0<=a&&a!=this.squadeoPlayer.currentDashLevelId_){this.squadeoPlayer.currentDashLevelId_=a;var b=this.findDashVideoTrackForId_(a);if(0<b){for(var c=0;c<this.squadeoPlayer.levels_.length;c++)this.squadeoPlayer.levels_[c].id===b?(this.squadeoPlayer.currentQualityLevel_=c,this.squadeoPlayer.levels_[c].active=!0):this.squadeoPlayer.levels_[c].active=!1;this.squadeoPlayer.emit('qualitychanged',{ type:'qualitychanged',currentLevel:this.squadeoPlayer.levels_[this.squadeoPlayer.currentQualityLevel_],forced:!1 })}}} },{ key:'loadWidevineServerCertificate_',value:function(){return new Promise(function(f,a){var b=new _xhrLoader.default,c={ onSuccess:function(a){var b=new Uint8Array(a.data);this.squadeoPlayer.configuration_.drm.advanced.hasOwnProperty('com.widevine.alpha')||(this.squadeoPlayer.configuration_.drm.advanced['com.widevine.alpha']={}),this.squadeoPlayer.configuration_.drm.advanced['com.widevine.alpha'].serverCertificate=b,this.squadeoPlayer.configure(this.squadeoPlayer.configuration_),f()}.bind(this),onTimeout:function(){a('Timeout on Widevine certificate loading')}.bind(this),onError:function(){a('Error on Widevine certificate loading')}.bind(this) },d={ url:this.squadeoPlayer.widevineServerCertificateURL_,responseType:'arraybuffer' };b.load(d,{ timeout:2500 },c)}.bind(this))} },{ key:'setTextTrackVisibility',value:function(b){this.dashPlayer_.setTextTrackVisibility(b)} },{ key:'findDashVideoTrackForId_',value:function(e){var a,f=-1,g=this.dashPlayer_.getVariantTracks();return 0<this.squadeoPlayer.audioTracks_.length&&(a=this.squadeoPlayer.audioTracks_[this.squadeoPlayer.currentAudioTrackId_].language),g.forEach(function(b){null!=b.videoId&&b.videoId===e&&b.language==a&&(f=b.id)}),f} },{ key:'findDashTrackForId_',value:function(c){return this.dashPlayer_.getVariantTracks().find(function(a){return a.id==c})} },{ key:'runLicenseRequestFilters_',value:function(f,a){if(f==shaka.net.NetworkingEngine.RequestType.LICENSE&&0<this.squadeoPlayer.licenseRequestFilters_.length){var b=this.dashPlayer_.drmInfo();a.keyIds=b&&b.hasOwnProperty('keyIds')?b.keyIds:[];for(var c=this.squadeoPlayer.licenseRequestFilters_,d=0;d<c.length;d++)try{c[d](a)}catch(b){}}} },{ key:'runLicenseResponseFilters_',value:function(e,a){if(e==shaka.net.NetworkingEngine.RequestType.LICENSE&&0<this.squadeoPlayer.licenseResponseFilters_.length)for(var b=this.squadeoPlayer.licenseResponseFilters_,c=0;c<b.length;c++)try{b[c](a)}catch(b){}} },{ key:'findDashTextTrackForId_',value:function(c){return this.dashPlayer_.getTextTracks().find(function(a){return a.id==c})} },{ key:'play',value:function(){this.squadeoPlayer.video_.play()} },{ key:'pause',value:function(){this.squadeoPlayer.video_.pause()} },{ key:'startAd',value:function(b){this.adStrategy.startAd(b)} },{ key:'resumeFeatureContent',value:function(){var b=_asyncToGenerator(regeneratorRuntime.mark(function b(){return regeneratorRuntime.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return b.abrupt('return',this.adStrategy.resumeFeatureContent());case 1:case'end':return b.stop()}},b,this)}));return function(){return b.apply(this,arguments)}}() },{ key:'destroy',value:function(){var b=_asyncToGenerator(regeneratorRuntime.mark(function b(){return regeneratorRuntime.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:this.dashPlayer_.destroy();case 1:case'end':return b.stop()}},b,this)}));return function(){return b.apply(this,arguments)}}() },{ key:'audioTrack',get:function(){return this.squadeoPlayer.currentAudioTrackId_},set:function(h){var i,a=this.squadeoPlayer.audioTracks_[h].language,b=this.squadeoPlayer.currentQualityLevel_;if(0<=this.squadeoPlayer.textTrack_&&'SRT'!==this.squadeoPlayer.textTracks_[this.squadeoPlayer.textTrack_].type){var c=this.squadeoPlayer.textTracks_[this.squadeoPlayer.textTrack_].language;i=this.squadeoPlayer.textTracks_[this.squadeoPlayer.textTrack_].kind}if(this.dashPlayer_.selectAudioLanguage(a),this.squadeoPlayer.currentAudioTrackId_=h,this.loadDashTracks_(),0<=b&&!this.getConfiguration().abr.enabled&&this.squadeoPlayer.setQualityLevel_(b,!0),null!=i){var f=this.squadeoPlayer.textTracks_.findIndex(function(b){return b.kind==i&&b.language==c});this.textTrack=-1,this.textTrack=f}} },{ key:'textTrack',get:function(){return this.squadeoPlayer.textTrack_},set:function(c){if(0<=c&&c<this.squadeoPlayer.textTracks_.length){var a=this.findDashTextTrackForId_(this.squadeoPlayer.textTracks_[c].id);null==a?'SRT'===this.squadeoPlayer.textTracks_[c].type&&(this.squadeoPlayer.srtManager_.trackName=this.squadeoPlayer.textTracks_[c].name):(this.dashPlayer_.selectTextTrack(a),this.dashPlayer_.setTextTrackVisibility(!0),null==this.squadeoPlayer.dashCueChangeListener_&&(this.squadeoPlayer.dashCueChangeListener_=function(){this.squadeoPlayer.displayDashTextTrack_&&this.squadeoPlayer.onTextTrackCueChange_(this.dashPlayer_.getTextTrack())},this.dashPlayer_.getTextTrack().addEventListener('cuechange',this.squadeoPlayer.dashCueChangeListener_.bind(this))),this.squadeoPlayer.displayDashTextTrack_=!0,this.squadeoPlayer.srtManager_.trackName=void 0),this.squadeoPlayer.textTracks_[c].active=!0}else null!=this.squadeoPlayer.dashCueChangeListener_&&(this.squadeoPlayer.displayDashTextTrack_=!1),this.dashPlayer_.setTextTrackVisibility(!1),this.squadeoPlayer.srtManager_.trackName=void 0,this.squadeoPlayer._subtitleRenderingNode.innerHTML='';this.squadeoPlayer.textTrack_=c} },{ key:'estimatedBandwidth',get:function(){return this.dashPlayer_.getStats().estimatedBandwidth} },{ key:'currentTime',get:function(){return this.squadeoPlayer.video_.currentTime},set:function(b){this.squadeoPlayer.video_.currentTime=b} }]),c;var b}();exports.default=PlayerDash},{ 1:1,11:11,14:14,3:3 }],8:[function(_dereq_,module,exports){'use strict';Object.defineProperty(exports,'__esModule',{ value:!0 }),exports.default=void 0;var _smpteParser=_interopRequireDefault(_dereq_(9)),_squadeoPlayer=_dereq_(11),_adBasicStrategy=_interopRequireDefault(_dereq_(1));function _interopRequireDefault(b){return b&&b.__esModule?b:{ default:b }}function asyncGeneratorStep(j,a,b,c,d,e,f){try{var g=j[e](f),h=g.value}catch(c){return void b(c)}g.done?a(h):Promise.resolve(h).then(c,d)}function _asyncToGenerator(i){return function(){var a=this,b=arguments;return new Promise(function(c,d){function e(b){asyncGeneratorStep(g,c,d,e,f,'next',b)}function f(b){asyncGeneratorStep(g,c,d,e,f,'throw',b)}var g=i.apply(a,b);e(void 0)})}}function _defineProperties(e,a){for(var b,f=0;f<a.length;f++)(b=a[f]).enumerable=b.enumerable||!1,b.configurable=!0,'value'in b&&(b.writable=!0),Object.defineProperty(e,b.key,b)}var PlayerHLS=function(){function c(a){(function(c,a){if(!(c instanceof a))throw new TypeError('Cannot call a class as a function')})(this,c),this.squadeoPlayer=a,this.adStrategy=new _adBasicStrategy.default(this),this.squadeoPlayer.video_.addEventListener('timeupdate',this._onVideoTimeUpdate.bind(this))}return function(d,a,b){a&&_defineProperties(d.prototype,a),b&&_defineProperties(d,b)}(c,[{ key:'load',value:function(f,a){return this.src=f,!this.squadeoPlayer._smpteParser&&this.squadeoPlayer.isSMPTEEnabled_()&&(this.squadeoPlayer._smpteParser=new _smpteParser.default),new Promise(function(b){this.squadeoPlayer.currentPlayer_=_squadeoPlayer.PLAYER_TYPE.HLS;var c={ debug:!1,enableWorker:!0,defaultAudioCodec:void 0,enableCEA708Captions:!1 };if(void 0!==a&&0<a&&(c.startPosition=a),null!=this.hlsConfig_)for(var d in Hls.DefaultConfig)this.squadeoPlayer.hlsConfig_.hasOwnProperty(d)&&(c[d]=this.hlsConfig_[d]);this.squadeoPlayer.setBufferingWatchdog_(!0),this.hlsPlayer=new Hls(c),this.hlsPlayer.loadSource(f),this.hlsPlayer.autoLevelCapping=-1,this.hlsPlayer.attachMedia(this.squadeoPlayer.video_),this.hlsPlayer.on(Hls.Events.FRAG_CHANGED,this.processHLSFragmentEvent_.bind(this)),this.hlsPlayer.on(Hls.Events.MANIFEST_PARSED,this.dispatchHLSEvent_.bind(this)),this.hlsPlayer.on(Hls.Events.AUDIO_TRACKS_UPDATED,this.dispatchHLSEvent_.bind(this)),this.hlsPlayer.on(Hls.Events.SUBTITLE_TRACKS_UPDATED,this.dispatchHLSEvent_.bind(this)),this.hlsPlayer.on(Hls.Events.FRAG_PARSING_METADATA,this._parsingMetadata.bind(this)),this.hlsPlayer.on(Hls.Events.ERROR,this.onHLSError_.bind(this)),this.hlsPlayer.setSubtitleTrackCueChange(this.squadeoPlayer.cuechangeEventListenerForHLS_.bind(this.squadeoPlayer)),this.squadeoPlayer.hlsResolveOnFirstLevelUpdate_=b,this.hlsPlayer.on(Hls.Events.LEVEL_UPDATED,this.dispatchHLSEvent_.bind(this)),this.hlsPlayer.on(Hls.Events.MEDIA_ATTACHED,function(){})}.bind(this))} },{ key:'processHLSFragmentEvent_',value:function(f,a){if(f==Hls.Events.FRAG_CHANGED&&this.squadeoPlayer.currentHLSLevel_!=a.frag.level){this.squadeoPlayer.currentHLSLevel_=a.frag.level;for(var b={},g=this.squadeoPlayer.levels_.length,d=0;d<g;d++)this.squadeoPlayer.levels_[d].id==a.frag.level?(this.squadeoPlayer.levels_[d].active=!0,b=this.squadeoPlayer.levels_[d],this.squadeoPlayer.currentQualityLevel_=d):this.squadeoPlayer.levels_[d].active=!1;this.squadeoPlayer.emit('qualitychanged',{ type:'qualitychanged',currentLevel:b,forced:!1 })}} },{ key:'dispatchHLSEvent_',value:function(h,i){switch(h){case Hls.Events.MANIFEST_PARSED:var b=[],c=0;i.levels;i.levels.forEach(function(d){var a={ id:c,bandwidth:d.bitrate,width:d.width,height:d.height,active:c==i.firstLevel };b.push(a),c++}),b.sort(function(c,a){return a.bandwidth-c.bandwidth}),this.squadeoPlayer.isLive_=!1,this.squadeoPlayer.levels_=b,this.squadeoPlayer.currentHLSLevel_=i.firstLevel,this.squadeoPlayer.emit('trackschanged',{ type:'trackschanged',emittedBy:'manifest' });break;case Hls.Events.AUDIO_TRACKS_UPDATED:this.loadHLSAudioTracks_(),this.squadeoPlayer.emit('trackschanged',{ type:'trackschanged',emittedBy:'manifest' });break;case Hls.Events.SUBTITLE_TRACKS_UPDATED:this.loadTextTracks(),this.squadeoPlayer.emit('trackschanged',{ type:'trackschanged',emittedBy:'manifest' });break;case Hls.Events.LEVEL_UPDATED:null!=this.squadeoPlayer.hlsResolveOnFirstLevelUpdate_&&(this.squadeoPlayer.isLive_=i.details.live,this.squadeoPlayer.hlsResolveOnFirstLevelUpdate_(),delete this.squadeoPlayer.hlsResolveOnFirstLevelUpdate_,this.squadeoPlayer.emit('loaded',{ type:'loaded' }));var e=i.details.fragments,f={};f.start=e[0].start,f.end=e[e.length-1].start,this.squadeoPlayer.hlsSeekRange_=f,this.squadeoPlayer.hlsLastSeekRangeUpdate_=performance.now()}} },{ key:'_parsingMetadata',value:function(l,a){if(this.squadeoPlayer.isSMPTEEnabled_()&&a.samples){var b=0;do{for(var m,n=a.samples[b],e=1;e+b<a.samples.length&&!(0<(m=a.samples[b+e]).pts&&m.pts!=n.pts);)e++;if(1<e){var o,p=0;for(o=0;o<e;o++)p+=a.samples[b+o].len;var q=new Uint8Array(p);for(p=0,o=0;o<e;o++)q.set(a.samples[b+o].data,p),p+=a.samples[b+o].len;var i={ data:q,pts:n.pts,len:p },j=this.squadeoPlayer._smpteParser.parseMetaData(i);this.squadeoPlayer._mergeSMPTETracks(j),b+=e}else{j=this.squadeoPlayer._smpteParser.parseMetaData(n);this.squadeoPlayer._mergeSMPTETracks(j),b++}}while(b<a.samples.length)}} },{ key:'onHLSError_',value:function(d,a){var b=-1;if(a.fatal){switch(a.type){case Hls.ErrorTypes.NETWORK_ERROR:b=1;break;case Hls.ErrorTypes.MEDIA_ERROR:b=3;break;case Hls.ErrorTypes.OTHER_ERROR:b=7}switch(a.details){case Hls.ErrorDetails.MANIFEST_LOAD_ERROR:case Hls.ErrorDetails.MANIFEST_LOAD_TIMEOUT:b=1;break;case Hls.ErrorDetails.MANIFEST_PARSING_ERROR:b=4;break;case Hls.ErrorDetails.MANIFEST_INCOMPATIBLE_CODECS_ERROR:b=3;break;case Hls.ErrorDetails.LEVEL_LOAD_ERROR:case Hls.ErrorDetails.LEVEL_LOAD_TIMEOUT:b=1;break;case Hls.ErrorDetails.LEVEL_SWITCH_ERROR:b=3;break;case Hls.ErrorDetails.AUDIO_TRACK_LOAD_ERROR:case Hls.ErrorDetails.AUDIO_TRACK_LOAD_TIMEOUT:case Hls.ErrorDetails.FRAG_LOAD_ERROR:case Hls.ErrorDetails.FRAG_LOOP_LOADING_ERROR:case Hls.ErrorDetails.FRAG_LOAD_TIMEOUT:b=1;break;case Hls.ErrorDetails.FRAG_DECRYPT_ERROR:case Hls.ErrorDetails.FRAG_PARSING_ERROR:b=3;break;case Hls.ErrorDetails.KEY_LOAD_ERROR:case Hls.ErrorDetails.KEY_LOAD_TIMEOUT:b=1;break;case Hls.ErrorDetails.BUFFER_ADD_CODEC_ERROR:case Hls.ErrorDetails.BUFFER_APPEND_ERROR:case Hls.ErrorDetails.BUFFER_APPENDING_ERROR:case Hls.ErrorDetails.BUFFER_STALLED_ERROR:case Hls.ErrorDetails.BUFFER_FULL_ERROR:b=3;break;case Hls.ErrorDetails.BUFFER_SEEK_OVER_HOLE:b=7;break;case Hls.ErrorDetails.INTERNAL_EXCEPTION:b=7}this.squadeoPlayer.emit('error',{ category:b,code:0 })}} },{ key:'reset',value:(b=_asyncToGenerator(regeneratorRuntime.mark(function b(){return regeneratorRuntime.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return this.destroy(),b.abrupt('return');case 2:case'end':return b.stop()}},b,this)})),function(){return b.apply(this,arguments)}) },{ key:'destroy',value:function(){this.hlsPlayer.destroy(),this.squadeoPlayer.hlsPlayer=void 0,this.squadeoPlayer.isResseting_=!1} },{ key:'seekRange',value:function(){if(this.squadeoPlayer.isLive_){var c=(performance.now()-this.squadeoPlayer.hlsLastSeekRangeUpdate_)/1e3;return{ start:this.squadeoPlayer.hlsSeekRange_.start+c,end:this.squadeoPlayer.hlsSeekRange_.end+c }}return this.squadeoPlayer.hlsSeekRange_} },{ key:'programInfo',value:function(){var c={ start:void 0,end:void 0 };try{var a=this.hlsPlayer.levelController.levels[0].details.fragments[0].programDateTime;a&&(c.start=a.getTime())}catch(b){}return c} },{ key:'setQualityLevel_',value:function(e){if(0<=e&&e<this.squadeoPlayer.levels_.length){this.hlsPlayer.currentLevel=this.squadeoPlayer.levels_[e].id,this.squadeoPlayer.currentQualityLevel_=e;for(var a=this.squadeoPlayer.levels_.length,b=0;b<a;b++)this.squadeoPlayer.levels_[b].active=!1;return this.squadeoPlayer.levels_[e].active=!0,this.squadeoPlayer.levels_[e]}} },{ key:'applyHLSConfiguration_',value:function(b){b.hasOwnProperty('abr')&&(1==b.abr.enabled?this.hlsPlayer.nextLevel=-1:this.hlsPlayer.currentLevel=this.squadeoPlayer.currentHLSLevel_),b.hasOwnProperty('hls')&&(this.squadeoPlayer.hlsConfig_=this.squadeoPlayer.config.hls)} },{ key:'loadTextTracks',value:function(){var m=this.hlsPlayer.subtitleTracks,n=[],b=0;this.hlsPlayer.subtitleTrack;if(m.forEach(function(c){var a={ id:b,name:c.name,language:c.lang,default:c.default,kind:'subtitle',type:'WEBVTT' };n.push(a),b++}),this.squadeoPlayer._smpteTracks)for(var d=Object.keys(this.squadeoPlayer._smpteTracks),p=0;p<d.length;p++){var q=this.squadeoPlayer._smpteTracks[d[p]],g={ id:b,name:q.name,language:q.language,default:!1,kind:'subtitle',type:'SMPTE' };n.push(g),b++}if(this.squadeoPlayer.srtManager_){d=this.squadeoPlayer.srtManager_.srtTrackNames,m=this.squadeoPlayer.srtManager_.srtTracks;for(var h=0;h<d.length;h++){var j=m[d[h]];if(j.loaded){var k={ id:b,name:j.name,language:j.language,active:!1,type:'SRT',kind:'subtitles' };b++,n.push(k)}}}this.squadeoPlayer.textTracks_=n} },{ key:'loadHLSAudioTracks_',value:function(){var e=this.hlsPlayer.audioTracks,g=[],b=0,h=this.hlsPlayer.audioTrack;e.forEach(function(c){var a=h==b||-1===h&&c.default,d={ id:b,name:c.name,language:c.lang,default:c.default,active:a };a&&(this.squadeoPlayer.currentAudioTrackId_=b),g.push(d),b++}.bind(this)),this.squadeoPlayer.audioTracks_=g} },{ key:'_mergeSMPTETracks',value:function(f){this.squadeoPlayer._smpteTracks||(this.squadeoPlayer._smpteTracks={});for(var a,g=!1,h=Object.keys(f),d=0;d<h.length;d++)(a=f[h[d]]).name&&(!this.squadeoPlayer._smpteTracks.hasOwnProperty(a.name)&&(this.squadeoPlayer._smpteTracks[a.name]={ language:a.language,name:a.name,fragments:[],currentFragIds:{},currentPos:-1 },g=!0),Array.prototype.push.apply(this.squadeoPlayer._smpteTracks[a.name].fragments,a.fragments));g&&(this.squadeoPlayer.loadTextTracks(),this.squadeoPlayer.emit('trackschanged',{ type:'trackschanged',emittedBy:'manifest' }))} },{ key:'_onVideoTimeUpdate',value:function(){var f=this.squadeoPlayer.video_.currentTime;if(this.squadeoPlayer._currentSMPTETrack&&''!==this.squadeoPlayer._currentSMPTETrack){var a,k=this.squadeoPlayer._smpteTracks[this.squadeoPlayer._currentSMPTETrack],c=Object.keys(k.currentFragIds);for(a in c){var l=k.currentFragIds[c[a]],e=k.fragments[l.id];(f>e.end||f<e.begin)&&(this.squadeoPlayer._subtitleRenderingNode.removeChild(l.imgNode),delete k.currentFragIds[c[a]])}var g=0;c=Object.keys(k.currentFragIds);for(a=0;a<k.fragments.length&&g<=f;a++)if(f>=(g=k.fragments[a].begin)&&f<=k.fragments[a].end&&-1===c.indexOf(''+a)){var m=document.createElement('img');m.style.position='absolute',m.style.width=k.fragments[a].width,m.style.height=k.fragments[a].height,m.style.left=k.fragments[a].left,m.style.top=k.fragments[a].top,m.className='fradId'+a,m.src='data:image/png;base64,'+k.fragments[a].pngBase64;var i=this.squadeoPlayer._subtitleRenderingNode.appendChild(m);k.currentFragIds[''+a]={ imgNode:i,id:a }}}} },{ key:'play',value:function(){this.squadeoPlayer.video_.play()} },{ key:'pause',value:function(){this.squadeoPlayer.video_.pause()} },{ key:'startAd',value:function(b){this.adStrategy.startAd(b)} },{ key:'resumeFeatureContent',value:function(){var b=_asyncToGenerator(regeneratorRuntime.mark(function b(){return regeneratorRuntime.wrap(function(b){for(;;)switch(b.prev=b.next){case 0:this.adStrategy.resumeFeatureContent();case 1:case'end':return b.stop()}},b,this)}));return function(){return b.apply(this,arguments)}}() },{ key:'audioTrack',set:function(c){this.hlsPlayer.audioTrack=c,this.squadeoPlayer.currentAudioTrackId_=c,this.squadeoPlayer.audioTracks.forEach(function(a){a.active=a.id==c})} },{ key:'textTrack',set:function(d){var a=!1,e=this.squadeoPlayer.textTracks_[d];e?('WEBVTT'===e.type?(a=!0,this.hlsPlayer.subtitleTrack=d,this.squadeoPlayer.srtManager_.trackName=void 0):'SRT'===e.type?(a=!0,this.hlsPlayer.subtitleTrack=-1,this.squadeoPlayer.srtManager_.trackName=e.name):(this.squadeoPlayer._currentSMPTETrack=e.name,this.hlsPlayer.subtitleTrack=-1,this.squadeoPlayer.srtManager_.trackName=void 0),this.squadeoPlayer.textTrack_=d,this.squadeoPlayer.textTracks_[d].active=!0):(a=!0,this.hlsPlayer.subtitleTrack=-1,this.squadeoPlayer.srtManager_.trackName=void 0,this.squadeoPlayer.textTrack_=-1),a&&this.squadeoPlayer.clearSMPTE_()} },{ key:'estimatedBandwidth',get:function(){return void 0===this.hlsPlayer.abrController.bwEstimator?0:this.hlsPlayer.abrController.bwEstimator.getEstimate()} },{ key:'currentTime',get:function(){return this.squadeoPlayer.video_.currentTime},set:function(b){this.squadeoPlayer.video_.currentTime=b} }]),c;var b}();exports.default=PlayerHLS},{ 1:1,11:11,9:9 }],9:[function(_dereq_,module,exports){'use strict';function _defineProperties(e,a){for(var b,f=0;f<a.length;f++)(b=a[f]).enumerable=b.enumerable||!1,b.configurable=!0,'value'in b&&(b.writable=!0),Object.defineProperty(e,b.key,b)}Object.defineProperty(exports,'__esModule',{ value:!0 }),exports.default=void 0;var _default=function(){function b(){!function(c,a){if(!(c instanceof a))throw new TypeError('Cannot call a class as a function')}(this,b)}return function(d,a,b){a&&_defineProperties(d.prototype,a),b&&_defineProperties(d,b)}(b,[{ key:'_readUTF',value:function(g,a,b){var c='',h=a,i=a+b;i=Math.min(g.length-1,i);do{c+=String.fromCharCode(g[h++])}while(h<i);return c} },{ key:'parseSMPTETrack',value:function(d,a){var e,b={ divs:[] },c=d.match(/Track:(\w+),Lang:(\w+)\0[^]+(<div [^]*>[^]*<\/div>)+/);if(null==c)return b;for(c.shift(),b.name=c.shift(),b.lang=c.shift(),e=0;e<c.length;e++){var i=c[e].match(/<div begin="([0-9]{2}):([0-9]{2}):([0-9]{2}\.[.0-9]+)" end="([0-9]{2}):([0-9]{2}):([0-9]{2}\.[0-9]+)" tts:extent="(([0-9]+%) ([0-9]+%))" tts:origin="(([0-9]+%) ([0-9]+%))">[^]*encoding="Base64">(.*)<[^]+<\/div>/),g={};g.begin=3600*parseInt(i[1])+60*parseInt(i[2])+parseFloat(i[3])+a,g.end=3600*parseInt(i[4])+60*parseInt(i[5])+parseFloat(i[6])+a,g.width=i[8],g.height=i[9],g.left=i[11],g.top=i[12],g.pngBase64=i[13],b.divs.push(g)}return b} },{ key:'parseMetaData',value:function(t){var a,v,w,x,B=t.data,i={},j=0,A=this._readUTF(B,j,3),C=[];j+=3;var l=!0;if('ID3'===A){for(j+=3,a=127&B[j++],v=127&B[j++],w=127&B[j++],x=127&B[j++],j+((a<<21)+(v<<14)+(w<<7)+x);j+4<B.length;){if('TXXX'===this._readUTF(B,j,4)){l=!1;for(var n=127&B[j+7]|(127&B[j+6])<<7|(127&B[j+5])<<14|(127&B[j+4])<<21,o=!1,E=j+8;!o&&E<B.length;)if('T'==String.fromCharCode(B[E])){if('Track:'===this._readUTF(B,E,6)){C.push(this._readUTF(B,E,n-(E-j-8)+1)),o=!0,j=E+n-1;break}E++}else E++}else{if(l)return;j++}}for(var r,G=0;G<C.length;G++)r=this.parseSMPTETrack(C[G],t.pts),i.hasOwnProperty(r.name)||(i[r.name]={ language:r.lang,name:r.name,fragments:[] }),Array.prototype.push.apply(i[r.name].fragments,r.divs)}return i} }]),b}();exports.default=_default},{}],10:[function(_dereq_,module,exports){(function(Buffer){'use strict';var b,_aes128Decrypter=(b=_dereq_(5))&&b.__esModule?b:{ default:b };function _defineProperties(e,a){for(var b,f=0;f<a.length;f++)(b=a[f]).enumerable=b.enumerable||!1,b.configurable=!0,'value'in b&&(b.writable=!0),Object.defineProperty(e,b.key,b)}Object.defineProperty(exports,'__esModule',{ value:!0 }),exports.default=void 0;var base64js=_dereq_(15),md5=_dereq_(27),_default=function(){function b(){(function(c,a){if(!(c instanceof a))throw new TypeError('Cannot call a class as a function')})(this,b),this._license=void 0,this._runP=void 0,this.runRes_=!1}return function(d,a,b){a&&_defineProperties(d.prototype,a),b&&_defineProperties(d,b)}(b,[{ key:'run',value:function(){this._runP=new Promise(function(g){this.runRes_=!1;var a=base64js.toByteArray(this._license);this._runInternal_(a,function(a){if(null!=a){var c=new Buffer(a).toString('utf-8').trim().split(',');if(4==c.length)if('v1'===c[0]){var e=md5(c[1]+c[2]+'SQ');this.runRes_=e===c[3]&&1e3*parseInt(c[2])>Date.now()}}g()}.bind(this))}.bind(this)),this._runP.then(function(){this._runP=void 0}.bind(this))} },{ key:'_runInternal_',value:function(i,a){for(var b=new Uint32Array(4),c=new Uint8Array(16),d=['S','q','H','#','5','z'],e=0;16>e;e++)c[e]=e+d[e%5].charCodeAt(0);var l=new DataView(c.buffer),g=new Uint32Array([l.getUint32(0),l.getUint32(4),l.getUint32(8),l.getUint32(12)]),h=new _aes128Decrypter.default(g,b),j=new DataView(i.buffer);a(h.decrypt(j.buffer))} },{ key:'license',set:function(b){this._license=b},get:function(){return this._license} },{ key:'setup',get:function(){return this._runP} },{ key:'test',get:function(){return this.runRes_} }]),b}();exports.default=_default}).call(this,_dereq_(18).Buffer)},{ 15:15,18:18,27:27,5:5 }],11:[function(_dereq_,module,exports){'use strict';function _typeof2(a){return(_typeof2='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&'function'==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?'symbol':typeof a})(a)}Object.defineProperty(exports,'__esModule',{ value:!0 }),exports.findNextFreeVideoElementId=function(){for(var d=0;24>d;d++){var e='spVideoElement'+d,b=document.getElementById(e);if(null==b)return e}throw'Too many video elements with Squadeo ids'},exports.installPolyfill=function(){shaka.polyfill.installAll(),Array.prototype.find||Object.defineProperty(Array.prototype,'find',{ value:function(g){if(null==this)throw new TypeError('Array.prototype.find called on null or undefined');if('function'!=typeof g)throw new TypeError('predicate must be a function');for(var a,h=Object(this),c=h.length>>>0,d=arguments[1],e=0;e<c;e++)if(a=h[e],g.call(d,a,e,h))return a} }),Array.prototype.findIndex||Object.defineProperty(Array.prototype,'findIndex',{ value:function(g){if(null==this)throw new TypeError('Array.prototype.findIndex called on null or undefined');if('function'!=typeof g)throw new TypeError('predicate must be a function');for(var a,h=Object(this),c=h.length>>>0,d=arguments[1],e=0;e<c;e++)if(a=h[e],g.call(d,a,e,h))return e;return-1},enumerable:!1,configurable:!1,writable:!1 })},exports.createPlayer=function(d){var a;if(squadeo.installPolyfill(),!squadeo.Player.isBrowserSupported())throw'Browser is not supported by Squadeo HTML5 player';var e=document.getElementById(d);a=new squadeo.Player(e);return a},exports.createPlayerWithControls=function(){throw"This function is available only after file 'squadeo-ui.min.js' is present in the webpage !"},exports.Player=exports.PLAYER_TYPE=void 0,_dereq_(33);var _srtManager=_interopRequireDefault(_dereq_(12)),_squadeoControl=_interopRequireDefault(_dereq_(10)),_utils=_interopRequireDefault(_dereq_(13)),_playerHls=_interopRequireDefault(_dereq_(8)),_playerDash=_interopRequireDefault(_dereq_(7)),_playerAppleNative=_interopRequireDefault(_dereq_(6)),_vmap=_interopRequireDefault(_dereq_(59)),_adManager=_interopRequireDefault(_dereq_(2));function _interopRequireDefault(b){return b&&b.__esModule?b:{ default:b }}function _typeof(b){return(_typeof='function'==typeof Symbol&&'symbol'==_typeof2(Symbol.iterator)?function(b){return _typeof2(b)}:function(b){return b&&'function'==typeof Symbol&&b.constructor===Symbol&&b!==Symbol.prototype?'symbol':_typeof2(b)})(b)}function asyncGeneratorStep(j,a,b,c,d,e,f){try{var g=j[e](f),h=g.value}catch(c){return void b(c)}g.done?a(h):Promise.resolve(h).then(c,d)}function _asyncToGenerator(i){return function(){var a=this,b=arguments;return new Promise(function(c,d){function e(b){asyncGeneratorStep(g,c,d,e,f,'next',b)}function f(b){asyncGeneratorStep(g,c,d,e,f,'throw',b)}var g=i.apply(a,b);e(void 0)})}}function _getPrototypeOf(b){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(b){return b.__proto__||Object.getPrototypeOf(b)})(b)}function _assertThisInitialized(b){if(void 0===b)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b}function _defineProperties(e,a){for(var b,f=0;f<a.length;f++)(b=a[f]).enumerable=b.enumerable||!1,b.configurable=!0,'value'in b&&(b.writable=!0),Object.defineProperty(e,b.key,b)}function _createClass(d,a,b){return a&&_defineProperties(d.prototype,a),b&&_defineProperties(d,b),d}function _setPrototypeOf(c,a){return(_setPrototypeOf=Object.setPrototypeOf||function(c,a){return c.__proto__=a,c})(c,a)}var EventEmitter=_dereq_(22).EventEmitter,PLAYER_TYPE={ NONE:-1,HLS:0,DASH:1,SAFARI_NATIVE_APPLEOS:2 };exports.PLAYER_TYPE=PLAYER_TYPE;var Player=function(c){function d(b){var a;return function(c,a){if(!(c instanceof a))throw new TypeError('Cannot call a class as a function')}(this,d),(a=function(c,a){return!a||'object'!==_typeof(a)&&'function'!=typeof a?_assertThisInitialized(c):a}(this,_getPrototypeOf(d).call(this))).video_=b,a.microsoftBrowser_=a.constructor.isBrowserEdgeOrIE11(),a.safariNativeMacBrowser_=a.constructor.isBrowserSafariMacOS(),a.safariNativeiOSBrowser_=a.constructor.isBrowserSafariiOS(),a.widevineServerCertificateURL_=void 0,a.allowImmediateQualitySwitch_=!(a.microsoftBrowser_||a.safariNativeMacBrowser_||a.safariNativeiOSBrowser_),a.configuration_=a.defaultConfig_(),a.licenseRequestFilters_=[],a.licenseResponseFilters_=[],a.clearInternals_(),a._createSubtitleRenderingNode(),a.video_.addEventListener('timeupdate',a._onVideoTimeUpdate.bind(_assertThisInitialized(a))),a.onVideoEvent_=a.onVideoEvent_.bind(_assertThisInitialized(a)),a.video_.addEventListener('play',a.onVideoEvent_),a.video_.addEventListener('pause',a.onVideoEvent_),a.video_.addEventListener('durationchange',a.onVideoEvent_),a.video_.addEventListener('volumechange',a.onVideoEvent_),a.video_.addEventListener('ended',a.onVideoEvent_),a.video_.addEventListener('error',a.onVideoErrorEvent_.bind(_assertThisInitialized(a))),a.video_.addEventListener('waiting',a.onVideoEvent_),a.video_.addEventListener('playing',a.onVideoEvent_),a._fpEventsAlreadyListened=!1,a.srtManager_=new _srtManager.default(a.video_),a.srtManager_.on('trackavailable',a.onNewSRTTrack_.bind(_assertThisInitialized(a))),a.srtManager_.cueChangeEventListener=a.onTextTrackCueChange_.bind(_assertThisInitialized(a)),a.cuechangeEventListenerForHLS_=function(b){this.onTextTrackCueChange_(b.target)},a.bufferingWatchDog_={ timer:void 0,checkActive:!1,checkInterval:50 },a.hlsConfig_=void 0,a.control=new _squadeoControl.default,a}return function(c,a){if('function'!=typeof a&&null!==a)throw new TypeError('Super expression must either be null or a function');c.prototype=Object.create(a&&a.prototype,{ constructor:{ value:c,writable:!0,configurable:!0 } }),a&&_setPrototypeOf(c,a)}(d,EventEmitter),_createClass(d,null,[{ key:'isBrowserSafariiOS',value:function(){var c=!1,d=navigator.platform.toLowerCase();return(0<=d.indexOf('ipad')||0<=d.indexOf('iphone'))&&(c=!0),c} },{ key:'isBrowserSafariMacOS',value:function(){var c=!1,d=navigator.platform.toLowerCase();return(window.safari&&0<=d.indexOf('mac')||0<=d.indexOf('ipad')||0<=d.indexOf('iphone'))&&(c=!0),c} },{ key:'isBrowserEdgeOrIE11',value:function(){var d=navigator.userAgent.toLowerCase(),a=0<=d.indexOf('edge/'),b=0<=d.indexOf('trident/');return a||b} },{ key:'isBrowserSupported',value:function(){var c=shaka.Player.isBrowserSupported()&&Hls.isSupported(),a=this.isBrowserSafariiOS();return c||a} },{ key:'getSupportedTypes',value:function(d){var e={};if(null!=d)var a=d;else a=['video/mp4; codecs="avc3.42E01E"','video/mp4; codecs="hvc1.1.6.L93.90"','video/mp4; codecs="avc1.66.13"','video/mp4; codecs="avc1.66.30"','video/mp4; codecs="avc1.42001e"','video/mp4; codecs="avc1.42001f"','video/mp4; codecs="avc1.42801f"','video/mp4; codecs="avc1.77.30"','video/mp4; codecs="avc1.4d001e"','video/mp4; codecs="avc1.4d001f"','video/mp4; codecs="avc1.640029"','audio/mp4; codecs="mp4a.40.2"','audio/mp4; codecs="mp4a.40.5"','audio/mp4; codecs="mp4a.40.29"','audio/mp4; codecs="mp4a.67"','audio/mp4; codecs="ac-3"','audio/mp4; codecs="ec-3"','video/webm; codecs="vp8"','video/webm; codecs="vp9"','video/webm; codecs="av1"','video/mp2t; codecs="avc1.42E01E"','video/mp2t; codecs="avc3.42E01E"','video/mp2t; codecs="hvc1.1.6.L93.90"','video/mp2t; codecs="mp4a.40.2"','video/mp2t; codecs="ac-3"','video/mp2t; codecs="ec-3"','video/mp2t; codecs="mp4a.40.2"'];return a.forEach(function(b){e[b]=MediaSource.isTypeSupported(b)}),e} },{ key:'version',get:function(){return'2.0.1'} }]),_createClass(d,[{ key:'isFeatureEnabled',value:function(b){return'qualityselection'===b} },{ key:'bufferingWatchDogExec_',value:function(){var b=this.bufferEnd_(this.video_.buffered)>=this.video_.duration-.2||this.video_.ended;!this.bufferingWatchDog_.checkActive||this.video_.paused||b||(.5>this.bufferedAheadOf_(this.video_.buffered,this.video_.currentTime)?this.setBuffering_(!0):this.setBuffering_(!1))} },{ key:'onVideoEvent_',value:function(c){var a=this;if(!this.isResseting_)switch(c.type){case'play':this.playing_=!0,this.setBufferingWatchdog_(!0),this.emit('play',{ type:'play' });break;case'pause':this.playing_=!1,this.emit('pause',{ type:'pause' });break;case'durationchange':this.emit('durationchange',{ type:'durationchange' });break;case'volumechange':this.emit('volumechange',{ type:'volumechange' });break;case'ended':this.playing_=!1,this.setBufferingWatchdog_(!1),this.setBuffering_(!1),this.playingAd?this.emit('adEnded',{ type:'adEnded' }):this.adManager.hasPostRolls()?(this.once('adBreakEnded',function(){a.emit('ended',{ type:'ended' })}),this.adManager.featureEnded()):this.emit('ended',{ type:'ended' });break;case'waiting':this.setBuffering_(!0);break;case'playing':this.setBuffering_(!1),this.emit('playing',{ type:'playing' })}} },{ key:'onVideoErrorEvent_',value:function(b){PLAYER_TYPE.NONE!=this.currentPlayer_&&this.emit('error',{ category:10,code:0,message:'Video element error',details:b })} },{ key:'_createSubtitleRenderingNode',value:function(){this._subtitleRenderingNode=document.createElement('div'),this._subtitleRenderingNode.style.position='absolute',this._subtitleRenderingNode.style.width='inherit',this._subtitleRenderingNode.style.top='0px',this._subtitleRenderingNode.style.bottom='0px',this._subtitleRenderingNode.className+='sqp-subtitle-rendering';var b=this.video_.parentNode.querySelector('.sqp-all-controls');b.insertBefore(this._subtitleRenderingNode,b.firstChild)} },{ key:'load',value:(b=_asyncToGenerator(regeneratorRuntime.mark(function e(f,b){var g;return regeneratorRuntime.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(this.src=f,isNaN(b)&&(b=void 0),null==(g=this.control.setup)){c.next=10;break}return c.next=8,g;case 8:return c.abrupt('return');case 10:if(this.control.test){c.next=13;break}return this.emit('error',{ category:7,code:0,message:'License error' }),c.abrupt('return');case 13:return c.next=15,this.init_();case 15:return this.configuration_.autostart&&this.once('loaded',this.play.bind(this)),0<f.indexOf('.m3u8')?this.safariNativeMacBrowser_||this.safariNativeiOSBrowser_?this.loadNativeHLS_(f,b):this.loadHLS_(f,b):this.loadDash_(f,b),c.next=20,this.currentImplementation.load(f,b);case 20:return c.abrupt('return',c.sent);case 21:case'end':return c.stop()}},e,this)})),function(){return b.apply(this,arguments)}) },{ key:'loadNativeHLS_',value:function(){var b=new _playerAppleNative.default(this);this.currentImplementation=b} },{ key:'loadDash_',value:function(){return this.safariNativeiOSBrowser_?void new Promise(function(d,a){var b={ category:3,code:3016,message:'DASH is not supported in Safari iOS' };this.emit('error',b),a(b)}.bind(this)):(this.squadeoPlayerDash||(this.squadeoPlayerDash=new _playerDash.default(this)),this.currentPlayer_=PLAYER_TYPE.DASH,void(this.currentImplementation=this.squadeoPlayerDash))} },{ key:'isLive',value:function(){return this.isLive_} },{ key:'isEvent',value:function(){return!1} },{ key:'seekRange',value:function(){return null==this.currentImplementation?{ start:0,end:0 }:this.currentImplementation.seekRange()} },{ key:'programInfo',value:function(){return null==this.currentImplementation?{ start:void 0,end:void 0 }:this.currentImplementation.programInfo()} },{ key:'setQualityLevel_',value:function(d,a){if(-1!=d){if((this.currentQualityLevel_!=d||this.getConfiguration().abr.enabled||a)&&(PLAYER_TYPE.HLS==this.currentPlayer_||PLAYER_TYPE.DASH==this.currentPlayer_)){var b=this.currentImplementation.setQualityLevel_(d,a);null!=b&&this.emit('qualitychanged',{ type:'qualitychanged',currentLevel:b,forced:!0 })}}else 1!=this.getConfiguration().abr.enabled&&(this.configure({ abr:{ enabled:!0 } }),this.emit('qualitychanged',{ type:'qualitychanged',currentLevel:this.levels_[this.currentQualityLevel_],forced:!1 }))} },{ key:'getConfiguration',value:function(){if(PLAYER_TYPE.HLS==this.currentPlayer_)var b={ abr:{ enabled:this.squadeoPlayerHLS.hlsPlayer_.autoLevelEnabled },subtitles:{ enableSMPTE:this.isSMPTEEnabled_() } };else if(PLAYER_TYPE.DASH==this.currentPlayer_)b=this.squadeoPlayerDash.getConfiguration();else b={};return b.autostart=this.configuration_.autostart,b} },{ key:'configure',value:function(b){try{null!=b.drm.advanced['com.widevine.alpha'].serverCertificateUrl&&(this.widevineServerCertificateURL_=b.drm.advanced['com.widevine.alpha'].serverCertificateUrl,delete b.drm.advanced['com.widevine.alpha'].serverCertificateUrl)}catch(b){}b.hasOwnProperty('hlsConfiguration')&&(this.hlsConfig_=b.hlsConfiguration,delete b.hlsConfiguration),this.mergeConfigs_(this.configuration_,b,this.defaultConfig_(),this.configOverrides_(),''),PLAYER_TYPE.HLS==this.currentPlayer_&&this.applyHLSConfiguration_(b),this.squadeoPlayerDash&&(this.squadeoPlayerDash.configure(this.configuration_),this.configuration_.abr.hasOwnProperty('maxBandwidthCap'))} },{ key:'defaultConfig_',value:function(){var b={ autostart:!1,iosPlaysInline:!1,abr:{ enabled:!0,maxBandwidthCap:1/0 },drm:{ retryParameters:{ maxAttempts:2,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:0 },servers:{},clearKeys:{},advanced:{} },manifest:{ availabilityWindowOverride:NaN },subtitles:{ enableSMPTE:!1 },restrictions:{ minWidth:0,maxWidth:1/0,minHeight:0,maxHeight:1/0,minPixels:0,maxPixels:1/0 },streaming:{ retryParameters:{ maxAttempts:2,baseDelay:1e3,backoffFactor:2,fuzzFactor:.5,timeout:0 },infiniteRetriesForLiveStreams:!0,rebufferingGoal:2,bufferingGoal:10,bufferBehind:30,ignoreTextStreamFailures:!1,startAtSegmentBoundary:!1,smallGapLimit:.5,jumpLargeGaps:!1 },preferredTextLanguage:'',preferredAudioLanguage:'' };return this.allowImmediateQualitySwitch_||(b.streaming.bufferingGoal=3,b.streaming.bufferBehind=6),b} },{ key:'configOverrides_',value:function(){return{ '.drm.servers':'','.drm.clearKeys':'','.drm.advanced':{ distinctiveIdentifierRequired:!1,persistentStateRequired:!1,videoRobustness:'',audioRobustness:'',serverCertificate:new Uint8Array(0) } }} },{ key:'internalSetAudioTrack',value:function(c,a){this.audioTrack_==c||0<=c&&c<this.audioTracks_.length&&(null!=this.currentImplementation&&(this.currentImplementation.audioTrack=c),a&&this.emit('trackschanged',{ type:'trackschanged',emittedBy:'setAudio' }))} },{ key:'internalSetTextTrack',value:function(c,a){this.textTrack_==c||(this._subtitleRenderingNode.innerHTML='',0<=this.textTrack_&&(this.textTracks_[this.textTrack_].active=!1),null!=this.currentImplementation&&(this.currentImplementation.textTrack=c),a&&this.emit('trackschanged',{ type:'trackschanged',emittedBy:'setSubtitle' }))} },{ key:'onNativeHLSCueChange_',value:function(){this.onTextTrackCueChange_(this.registerTextTrackCueListener)} },{ key:'addSRTTextTrack',value:function(d,a,b){this.srtManager_.addSRTTrack(d,a,b)} },{ key:'onNewSRTTrack_',value:function(){null!=this.currentPlayer_&&this.currentImplementation.loadTextTracks(),this.emit('trackschanged',{ type:'trackschanged',emittedBy:'manifest' })} },{ key:'applyPreferredTextLanguage_',value:function(){if(this.configuration_.preferredTextLanguage&&0<this.configuration_.preferredTextLanguage.length){var j,i=_utils.default.normalizeLanguage(this.configuration_.preferredTextLanguage),a=0,k=!0,l=!1;try{for(var m,n,o=this.textTracks_[Symbol.iterator]();!(k=(m=o.next()).done);k=!0){if(n=m.value,_utils.default.languageMatch(i,n.language)){this.textTrack=a;break}a++}}catch(b){l=!0,j=b}finally{try{k||null==o.return||o.return()}finally{if(l)throw j}}}} },{ key:'loadHLS_',value:function(){this.squadeoPlayerHLS=new _playerHls.default(this),this.currentImplementation=this.squadeoPlayerHLS} },{ key:'setBufferingWatchdog_',value:function(b){this.bufferingWatchDog_.checkActive=b,b?!this.bufferingWatchDog_.timer&&(this.bufferingWatchDog_.timer=setInterval(this.bufferingWatchDogExec_.bind(this),this.bufferingWatchDog_.checkInterval)):!this.bufferingWatchDog_.timer&&(clearInterval(this.bufferingWatchDog_.timer),this.bufferingWatchDog_.timer=void 0)} },{ key:'_onVideoTimeUpdate',value:function(){this.emit('timeupdate',{ type:'timeupdate' })} },{ key:'setBuffering_',value:function(b){b!=this.buffering_&&(this.buffering_=b,this.emit('buffering',{ type:'buffering',buffering:this.buffering_ }),b?this.emit('waiting'):this.playing_&&this.emit('playing'))} },{ key:'isSMPTEEnabled_',value:function(){return'object'===_typeof(this.configuration_)&&'object'===_typeof(this.configuration_.subtitles)&&!0===this.configuration_.subtitles.enableSMPTE} },{ key:'applyHLSConfiguration_',value:function(b){this.squadeoPlayerHLS.applyHLSConfiguration_(b)} },{ key:'init_',value:function(){var b=_asyncToGenerator(regeneratorRuntime.mark(function f(g){var b,i;return regeneratorRuntime.wrap(function(c){for(;;)switch(c.prev=c.next){case 0:if(1==g&&(this.widevineServerCertificateURL_=void 0,this.configuration_=this.defaultConfig_(),this.hlsConfig_=void 0),PLAYER_TYPE.NONE==this.currentPlayer_){c.next=17;break}if(this.setBufferingWatchdog_(!1),b=this.currentPlayer_,this._fpKeySession,i=this.currentImplementation,this.clearInternals_(),this._subtitleRenderingNode.innerHTML='',this.emit('reset',{ type:'reset' }),this.srtManager_&&this.srtManager_.reset(),null==i){c.next=13;break}return c.next=13,i.reset(b);case 13:return this.isResseting_=!1,c.abrupt('return');case 17:return this.clearInternals_(),this.emit('reset',{ type:'reset' }),this.isResseting_=!1,c.abrupt('return');case 21:case'end':return c.stop()}},f,this)}));return function(){return b.apply(this,arguments)}}() },{ key:'clearInternals_',value:function(){this.currentPlayer_=PLAYER_TYPE.NONE,this.currentImplementation=null,this.isLive_=!1,this.endOfLiveReached_=!1,this.hlsSeekRange_={ start:0,end:0 },this.playing_=!1,this.levels_=[],this.currentQualityLevel_=-1,this.currentHLSLevel_=-1,this.displayDashTextTrack_=!1,this.currentDashLevelId_=void 0,this.audioTracks_=[],this.audioTrack_=-1,this.textTracks_=[],this.textTrack_=-1,this.clearSMPTE_(),this._fpKeySession=void 0} },{ key:'clearSMPTE_',value:function(){if(this._currentSMPTETrack)for(var d=this._smpteTracks[this._currentSMPTETrack],a=Object.keys(d.currentFragIds),b=0;b<a.length;b++)delete d.currentFragIds[a[b]];this._currentSMPTETrack=void 0} },{ key:'reset',value:function(){return this.isResseting_=!0,this.init_(!0)} },{ key:'destroy',value:function(){return Promise.resolve().then(function(){var b;return this.setBufferingWatchdog_(!1),b=this.squadeoPlayerDash?Promise.all([this.squadeoPlayerDash.destroy()]):Promise.all([]),this.emit('destroyed',{}),b}.bind(this))} },{ key:'registerLicenseRequestFilter',value:function(b){'function'==typeof b&&this.licenseRequestFilters_.push(b)} },{ key:'unregisterLicenseRequestFilter',value:function(d){var a=this.licenseRequestFilters_,b=a.indexOf(d);0<=b&&a.splice(b,1)} },{ key:'registerLicenseResponseFilter',value:function(b){'function'==typeof b&&this.licenseResponseFilters_.push(b)} },{ key:'unregisterLicenseResponseFilter',value:function(d){var a=this.licenseResponseFilters_,b=a.indexOf(d);0<=b&&a.splice(b,1)} },{ key:'mergeConfigs_',value:function(k,a,b,c,d){var e=d in c;for(var f in a){var g=d+'.'+f,h=e?c[d]:b[f],i=!!{ '.abr.manager':!0,'.drm.advanced.com.apple.fps.serverCertificateUrl':!0,'.drm.advanced.com.widevine.alpha.serverCertificate':!0 }[g];(e||f in k)&&(void 0===a[f]?void 0===h||e?delete k[f]:k[f]=h:i?k[f]=a[f]:'object'==_typeof(k[f])&&'object'==_typeof(a[f])?this.mergeConfigs_(k[f],a[f],h,c,g):_typeof(a[f])==_typeof(h)&&('function'==typeof k[f]&&(k[f].length,a[f].length),k[f]=a[f]))}} },{ key:'play',value:function(){null!=this.currentImplementation&&this.currentImplementation.play()} },{ key:'pause',value:function(){null!=this.currentImplementation&&this.currentImplementation.pause()} },{ key:'signalFullscreen',value:function(){} },{ key:'onTextTrackCueChange_',value:function(c){var a=[];null!=c&&(a=c.activeCues),this.buildDisplayForActiveCues_(a)} },{ key:'buildDisplayForActiveCues_',value:function(c){this._subtitleRenderingNode.innerHTML='';for(var a,g=0;g<c.length;g++)if((a=document.createElement('div')).className='sqp-subtitle-element',a.innerHTML=c[g].text.replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,'$1<br>$2'),0!=a.innerHTML.length||null!=c[g].backgroundImage){var h=document.createElement('div');if(h.style.width=c[g].size?c[g].size+'%':'100%','start'===c[g].align?(h.style['justify-content']='flex-start',a.style['text-align']='left'):'end'===c[g].align&&(h.style['justify-content']='flex-end',a.style['text-align']='right'),c[g].snapToLines?0<=c[g].line?h.style.top=c[g].line+' em':h.style.bottom=-1*c[g].line+' em':'auto'!==c[g].line&&(50>c[g].line?(h.style.top=c[g].line+'%',h.style.bottom='auto'):(h.style.bottom=100-c[g].line+'%',h.style.top='auto')),'auto'!==c[g].position&&(h.style.left=c[g].position+'%'),null!=c[g].backgroundImage&&null!=c[g].backgroundImage){var e=document.createElement('img');e.src=c[g].backgroundImage,e.style.width='100%',a.appendChild(e)}h.appendChild(a),this._subtitleRenderingNode.appendChild(h)}} },{ key:'bufferedAheadOf_',value:function(h,a){var b=0;if(!h)return b;if(1==h.length&&1e-6>h.end(0)-h.start(0))return b;for(var d=!1,j=1e-4,f=0;f<h.length;++f)if(a+j>=h.start(f)&&a<h.end(f))b+=h.end(f)-a,d=!0;else if(d&&h.start(f)-h.end(f-1)<=.04)b+=h.end(f)-h.start(f),b+=h.start(f)-h.end(f-1);else if(0<f&&a+j<h.start(f)&&a+j>=h.end(f-1)){if(!(h.start(f)-a<=.04))return b;b+=h.end(f)-a,d=!0}else d=!1;return b} },{ key:'bufferEnd_',value:function(b){return b?1==b.length&&1e-6>b.end(0)-b.start(0)?null:b.length?b.end(b.length-1):null:null} },{ key:'parseRepeatDelay',value:function(d){var a=d.split(':'),b=60*parseInt(a[0])*60;return b+=60*parseInt(a[1]),b+=parseInt(a[2].split('.')[0])} },{ key:'parseOffset',value:function(c){if('%'===c.substr(-1,1)){var a=parseFloat(c.substr(0,c.length));return this.duration*(a/100)}return-1<c.indexOf(':')?this.parseRepeatDelay(c):c} },{ key:'loadVMAP',value:function(){var b=_asyncToGenerator(regeneratorRuntime.mark(function g(h,b){var c,i,j=this;return regeneratorRuntime.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return this.liveHack=b,d.next=3,fetch(h);case 3:return d.next=5,d.sent.text();case 5:c=d.sent,i=new _vmap.default((new window.DOMParser).parseFromString(c,'text/xml')),this.currentVMAP=i,this.adBreaks=null,null!=this.adManager&&this.adManager.destroy(),this.adManager=new _adManager.default(this),this.prependOnceListener('durationchange',function(){j.adBreaks=[],i.adBreaks.forEach(function(d){if(j.adBreaks.push({ time:j.parseOffset(d.timeOffset),vmapBreak:d }),null!=d.repeatAfter){var a,e=j.parseRepeatDelay(d.repeatAfter);'start'==d.timeOffset&&(d.timeOffset=0),a='start'==d.timeOffset?0:d.timeOffset;do{a+=e,j.adBreaks.push({ time:a,vmapBreak:d })}while(a<j.duration)}}),b&&j.rewriteVMAPForLiveHack.bind(j),j.emit('adBreaksLoaded')});case 13:case'end':return d.stop()}},g,this)}));return function(){return b.apply(this,arguments)}}() },{ key:'rewriteVMAPForLiveHack',value:function(){if(this.isLive){var c=this.currentTime;this.adBreaks.forEach(function(a){a.time+=c})}} },{ key:'startAdBreak',value:function(){this.playingAd=!0,this.emit('adBreakStarted')} },{ key:'startAd',value:function(b){if(null!=this.currentImplementation){if(!this.playingAd)throw'Called startAd without being in an ad break.';this.currentImplementation.startAd(b),this.emit('adStarted')}} },{ key:'resumeFeatureContent',value:function(){null!=this.currentImplementation&&(this.currentImplementation.resumeFeatureContent(),this.playingAd=!1,this.emit('adBreakEnded'))} },{ key:'license',set:function(b){this.control.license=b,this.control.run()} },{ key:'videoElement',get:function(){return this.video_} },{ key:'qualities',get:function(){return this.levels_} },{ key:'quality',get:function(){return parseInt(this.currentQualityLevel_)},set:function(b){this.setQualityLevel_(b,!1)} },{ key:'audioTracks',get:function(){return this.audioTracks_} },{ key:'audioTrack',get:function(){return this.currentAudioTrackId_},set:function(b){this.internalSetAudioTrack(b,!0)} },{ key:'textTracks',get:function(){return this.textTracks_} },{ key:'textTrack',get:function(){return this.textTrack_},set:function(b){this.internalSetTextTrack(b,!0)} },{ key:'estimatedBandwidth',get:function(){if(PLAYER_TYPE.HLS==this.currentPlayer_||PLAYER_TYPE.DASH==this.currentPlayer_)return this.currentImplementation.estimatedBandwidth} },{ key:'currentTime',get:function(){if(null!=this.currentImplementation)return this.currentImplementation.currentTime},set:function(b){null!=this.currentImplementation&&(this.currentImplementation.currentTime=b)} },{ key:'duration',get:function(){var b=this.video_.duration;return(b==1/0||this.isLive())&&(b=0),b} },{ key:'volume',get:function(){return this.video_.volume},set:function(b){this.video_.volume=b} },{ key:'muted',get:function(){return this.video_.muted},set:function(b){this.video_.muted=b} },{ key:'ended',get:function(){return this.video_.ended} },{ key:'playing',get:function(){return this.playing_} }]),d;var b}();exports.Player=Player},{ 10:10,12:12,13:13,2:2,22:22,33:33,59:59,6:6,7:7,8:8 }],12:[function(_dereq_,module,exports){'use strict';function _typeof2(a){return(_typeof2='function'==typeof Symbol&&'symbol'==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&'function'==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?'symbol':typeof a})(a)}var b,_xhrLoader=(b=_dereq_(14))&&b.__esModule?b:{ default:b };function _typeof(b){return(_typeof='function'==typeof Symbol&&'symbol'==_typeof2(Symbol.iterator)?function(b){return _typeof2(b)}:function(b){return b&&'function'==typeof Symbol&&b.constructor===Symbol&&b!==Symbol.prototype?'symbol':_typeof2(b)})(b)}function _defineProperties(e,a){for(var b,f=0;f<a.length;f++)(b=a[f]).enumerable=b.enumerable||!1,b.configurable=!0,'value'in b&&(b.writable=!0),Object.defineProperty(e,b.key,b)}function _possibleConstructorReturn(c,a){return!a||'object'!==_typeof(a)&&'function'!=typeof a?function(b){if(void 0===b)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return b}(c):a}function _getPrototypeOf(b){return(_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function(b){return b.__proto__||Object.getPrototypeOf(b)})(b)}function _setPrototypeOf(c,a){return(_setPrototypeOf=Object.setPrototypeOf||function(c,a){return c.__proto__=a,c})(c,a)}Object.defineProperty(exports,'__esModule',{ value:!0 }),exports.default=void 0;var EventEmitter=_dereq_(22).EventEmitter,_default=function(c){function d(b){var a;return function(c,a){if(!(c instanceof a))throw new TypeError('Cannot call a class as a function')}(this,d),(a=_possibleConstructorReturn(this,_getPrototypeOf(d).call(this))).video_=b,a.srtTracks_={},a.trackNames_=[],a.currentTrackShown_,a.loadersCountId_=0,a.loaders_=[],a.createCue_=window.VTTCue||window.TextTrackCue,a.cueChangeEventListener_=null,a.innerCueChangeEventListener_=function(){this.cueChangeEventListener_&&this.cueChangeEventListener_(this.srtTracks_[this.currentTrackShown_].textTrack)},a}return function(c,a){if('function'!=typeof a&&null!==a)throw new TypeError('Super expression must either be null or a function');c.prototype=Object.create(a&&a.prototype,{ constructor:{ value:c,writable:!0,configurable:!0 } }),a&&_setPrototypeOf(c,a)}(d,EventEmitter),function(d,a,b){a&&_defineProperties(d.prototype,a),b&&_defineProperties(d,b)}(d,[{ key:'reset',value:function(){this.abort(),this.loaders_=[],this.trackName=void 0,this.srtTracks_={},this.trackNames_=[],this.loadersCountId_=0,this.currentTrackShown_=void 0} },{ key:'abort',value:function(){for(;0<this.loaders_.length;){var b=this.loaders_.pop();b&&4!==b.readyState&&(this.aborted=!0,b.abort())}} },{ key:'removeLoaderId_',value:function(c){for(var a=0;a<this.loaders_.length;a++)if(this.loaders_[a].strMgrId===c){this.loaders_.splice(a,1);break}} },{ key:'addSRTTrack',value:function(e,a,b){if(-1===this.trackNames_.indexOf(e)){var c={ url:b,trackName:e,srtManager:this };this.srtTracks_[e]={ name:e,language:a,loaded:!1 },this.trackNames_.push(e),this.load(c,{ timeout:2500 })}} },{ key:'onSRTLoaded',value:function(d,a,b){b.srtManager.parseSrt(d.data,b.trackName),b.srtManager.removeLoaderId_(b.srtMgrId)} },{ key:'onLoadError',value:function(c,a){a.srtManager.removeLoaderId_(a.srtMgrId)} },{ key:'onTimeout',value:function(c,a){a.srtManager.removeLoaderId_(a.srtMgrId)} },{ key:'load',value:function(e,a){var b=new _xhrLoader.default;e.srtMgrId=this.loadersCountId_++;var c={ onSuccess:this.onSRTLoaded.bind(e),onTimeout:this.onTimeout.bind(e),onError:this.onLoadError.bind(e) };b.srtMgrId=e.srtMgrId,this.loaders_.push(b),b.load(e,a,c)} },{ key:'srtTimeToSeconds',value:function(g){var a=g.match(/(\d\d):(\d\d):(\d\d),(\d\d\d)/);return 60*+a[1]*60+60*+a[2]+ +a[3]+ +a[4]/1e3} },{ key:'parseSrtLine',value:function(f){var i=f.match(/(\d\d:\d\d:\d\d,\d\d\d) --> (\d\d:\d\d:\d\d,\d\d\d)\n([\S\s]*)/m);return null==i?(i=f.match(/(\d\d:\d\d:\d\d,\d\d\d) --> (\d\d:\d\d:\d\d,\d\d\d)/m),this.srtTimeToSeconds(i[1]),this.srtTimeToSeconds(i[2]),''):(this.srtTimeToSeconds(i[1]),this.srtTimeToSeconds(i[2]),i[3].trim()),{ start:this.srtTimeToSeconds(i[1]),end:this.srtTimeToSeconds(i[2]),text:i[3].trim() }} },{ key:'parseSrt',value:function(c,a){for(var b,e=c.replace(/\r\n/g,'\n').replace(/\r/g,'\n').split(/(?:^|\n\n)\d+\n|\n+$/g),f=[],g=0;g<e.length;g++)0<(b=e[g].trim()).length&&f.push(this.parseSrtLine(b));if(this.video_){var n=this.srtTracks_[a],i=this.video_.addTextTrack('subtitles',n.name,n.language);i.mode='hidden';for(var j,o=0;o<f.length;o++)j=new this.createCue_(f[o].start,f[o].end,f[o].text),i.addCue(j);this.srtTracks_[a].textTrack=i,this.srtTracks_[a].loaded=!0,this.emit('trackavailable',{ type:'trackavailable' })}} },{ key:'srtTracks',get:function(){return this.srtTracks_} },{ key:'srtTrackNames',get:function(){return this.trackNames_} },{ key:'trackName',get:function(){return this.currentTrackShown_},set:function(b){if('string'==typeof b){if(b===this.currentTrackShown_)return;this.currentTrackShown_&&(this.srtTracks_[this.currentTrackShown_].textTrack.mode='hidden',this.srtTracks_[this.currentTrackShown_].textTrack.removeEventListener('cuechange',this.innerCueChangeEventListener_.bind(this))),0<=this.trackNames_.indexOf(b)?(this.currentTrackShown_=b,this.srtTracks_[this.currentTrackShown_].textTrack.addEventListener('cuechange',this.innerCueChangeEventListener_.bind(this))):this.currentTrackShown_=void 0}else this.currentTrackShown_&&(this.srtTracks_[this.currentTrackShown_].textTrack.mode='hidden',this.srtTracks_[this.currentTrackShown_].textTrack.removeEventListener('cuechange',this.innerCueChangeEventListener_.bind(this))),this.currentTrackShown_=void 0} },{ key:'cueChangeEventListener',get:function(){return this.cueChangeEventListener_},set:function(b){this.cueChangeEventListener_=b} }]),d}();exports.default=_default},{ 14:14,22:22 }],13:[function(_dereq_,module,exports){'use strict';function _defineProperties(e,a){for(var b,f=0;f<a.length;f++)(b=a[f]).enumerable=b.enumerable||!1,b.configurable=!0,'value'in b&&(b.writable=!0),Object.defineProperty(e,b.key,b)}Object.defineProperty(exports,'__esModule',{ value:!0 }),exports.default=void 0;var _default=function(){function f(){!function(c,a){if(!(c instanceof a))throw new TypeError('Cannot call a class as a function')}(this,f)}return d=f,b=[{ key:'stringToArray',value:function(f){for(var a=new ArrayBuffer(2*f.length),b=new Uint16Array(a),c=0,g=f.length;c<g;c++)b[c]=f.charCodeAt(c);return b} },{ key:'arrayToString',value:function(c){var a=new Uint16Array(c.buffer);return String.fromCharCode.apply(null,a)} },{ key:'base64DecodeUint8Array',value:function(e){var a=window.atob(e),b=a.length,c=new Uint8Array(new ArrayBuffer(b));for(i=0;i<b;i++)c[i]=a.charCodeAt(i);return c} },{ key:'base64EncodeUint8Array',value:function(m){for(var a,n,o,p,q,r,s,t='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=',j='',u=0;u<m.length;)p=(a=m[u++])>>2,q=(3&a)<<4|(n=u<m.length?m[u++]:Number.NaN)>>4,r=(15&n)<<2|(o=u<m.length?m[u++]:Number.NaN)>>6,s=63&o,isNaN(n)?r=s=64:isNaN(o)&&(s=64),j+=t.charAt(p)+t.charAt(q)+t.charAt(r)+t.charAt(s);return j} },{ key:'isoMap',value:function(){return{ aar:'aa',abk:'ab',afr:'af',aka:'ak',alb:'sq',amh:'am',ara:'ar',arg:'an',arm:'hy',asm:'as',ava:'av',ave:'ae',aym:'ay',aze:'az',bak:'ba',bam:'bm',baq:'eu',bel:'be',ben:'bn',bih:'bh',bis:'bi',bod:'bo',bos:'bs',bre:'br',bul:'bg',bur:'my',cat:'ca',ces:'cs',cha:'ch',che:'ce',chi:'zh',chu:'cu',chv:'cv',cor:'kw',cos:'co',cre:'cr',cym:'cy',cze:'cs',dan:'da',deu:'de',div:'dv',dut:'nl',dzo:'dz',ell:'el',eng:'en',epo:'eo',est:'et',eus:'eu',ewe:'ee',fao:'fo',fas:'fa',fij:'fj',fin:'fi',fra:'fr',fre:'fr',fry:'fy',ful:'ff',geo:'ka',ger:'de',gla:'gd',gle:'ga',glg:'gl',glv:'gv',gre:'el',grn:'gn',guj:'gu',hat:'ht',hau:'ha',heb:'he',her:'hz',hin:'hi',hmo:'ho',hrv:'hr',hun:'hu',hye:'hy',ibo:'ig',ice:'is',ido:'io',iii:'ii',iku:'iu',ile:'ie',ina:'ia',ind:'id',ipk:'ik',isl:'is',ita:'it',jav:'jv',jpn:'ja',kal:'kl',kan:'kn',kas:'ks',kat:'ka',kau:'kr',kaz:'kk',khm:'km',kik:'ki',kin:'rw',kir:'ky',kom:'kv',kon:'kg',kor:'ko',kua:'kj',kur:'ku',lao:'lo',lat:'la',lav:'lv',lim:'li',lin:'ln',lit:'lt',ltz:'lb',lub:'lu',lug:'lg',mac:'mk',mah:'mh',mal:'ml',mao:'mi',mar:'mr',may:'ms',mkd:'mk',mlg:'mg',mlt:'mt',mon:'mn',mri:'mi',msa:'ms',mya:'my',nau:'na',nav:'nv',nbl:'nr',nde:'nd',ndo:'ng',nep:'ne',nld:'nl',nno:'nn',nob:'nb',nor:'no',nya:'ny',oci:'oc',oji:'oj',ori:'or',orm:'om',oss:'os',pan:'pa',per:'fa',pli:'pi',pol:'pl',por:'pt',pus:'ps',que:'qu',roh:'rm',ron:'ro',rum:'ro',run:'rn',rus:'ru',sag:'sg',san:'sa',sin:'si',slk:'sk',slo:'sk',slv:'sl',sme:'se',smo:'sm',sna:'sn',snd:'sd',som:'so',sot:'st',spa:'es',sqi:'sq',srd:'sc',srp:'sr',ssw:'ss',sun:'su',swa:'sw',swe:'sv',tah:'ty',tam:'ta',tat:'tt',tel:'te',tgk:'tg',tgl:'tl',tha:'th',tib:'bo',tir:'ti',ton:'to',tsn:'tn',tso:'ts',tuk:'tk',tur:'tr',twi:'tw',uig:'ug',ukr:'uk',urd:'ur',uzb:'uz',ven:'ve',vie:'vi',vol:'vo',wel:'cy',wln:'wa',wol:'wo',xho:'xh',yid:'yi',yor:'yo',zha:'za',zho:'zh',zul:'zu' }} },{ key:'normalizeLanguage',value:function(a){var b=a.toLowerCase().split('-'),c=b[0],d=f.isoMap()[c];return d&&(b[0]=d),b.join('-')} },{ key:'languageMatch',value:function(a,b){var c=f.normalizeLanguage(b);return c==a||b==a||c==a.split('-')[0]} }],(a=null)&&_defineProperties(d.prototype,a),b&&_defineProperties(d,b),f;var d,a,b}();exports.default=_default},{}],14:[function(_dereq_,module,exports){'use strict';function _defineProperties(e,a){for(var b,f=0;f<a.length;f++)(b=a[f]).enumerable=b.enumerable||!1,b.configurable=!0,'value'in b&&(b.writable=!0),Object.defineProperty(e,b.key,b)}Object.defineProperty(exports,'__esModule',{ value:!0 }),exports.default=void 0;var _default=function(){function c(a){(function(c,a){if(!(c instanceof a))throw new TypeError('Cannot call a class as a function')})(this,c),a&&a.xhrSetup&&(this.xhrSetup=a.xhrSetup)}return d=c,(a=[{ key:'destroy',value:function(){this.abort(),this.loader=null} },{ key:'abort',value:function(){var b=this.loader;b&&4!==b.readyState&&(this.stats.aborted=!0,b.abort()),window.clearTimeout(this.requestTimeout),this.requestTimeout=null,window.clearTimeout(this.retryTimeout),this.retryTimeout=null} },{ key:'load',value:function(d,a,b){this.context=d,this.config=a,this.callbacks=b,this.stats={ trequest:performance.now(),retry:0 },this.retryDelay=a.retryDelay,this.loadInternal()} },{ key:'loadInternal',value:function(){var d,e=this.context;(d='undefined'==typeof XDomainRequest?this.loader=new XMLHttpRequest:this.loader=new XDomainRequest).onreadystatechange=this.readystatechange.bind(this),d.onprogress=this.loadprogress.bind(this),d.open('GET',e.url,!0),e.rangeEnd&&d.setRequestHeader('Range','bytes='+e.rangeStart+'-'+(e.rangeEnd-1)),d.responseType=e.responseType;var b=this.stats;b.tfirst=0,b.loaded=0,this.xhrSetup&&this.xhrSetup(d,e.url),this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),this.config.timeout),d.send()} },{ key:'readystatechange',value:function(k){var a=k.currentTarget,b=a.readyState,c=this.stats,d=this.context,e=this.config;if(!c.aborted&&(window.clearTimeout(this.requestTimeout),2<=b&&(0===c.tfirst&&(c.tfirst=Math.max(performance.now(),c.trequest),this.requestTimeout=window.setTimeout(this.loadtimeout.bind(this),e.timeout-(c.tfirst-c.trequest))),4===b))){var f=a.status;if(200<=f&&300>f){var g,l;c.tload=Math.max(c.tfirst,performance.now()),'arraybuffer'===d.responseType?l=(g=a.response).byteLength:l=(g=a.responseText).length,c.loaded=c.total=l;var m={ url:a.responseURL,data:g };this.callbacks.onSuccess(m,c,d)}else c.retry>=e.maxRetry||400<=f&&499>f?this.callbacks.onError({ code:f,text:a.statusText },d):(this.destroy(),this.retryTimeout=window.setTimeout(this.loadInternal.bind(this),this.retryDelay),this.retryDelay=Math.min(2*this.retryDelay,e.maxRetryDelay),c.retry++)}} },{ key:'loadtimeout',value:function(){this.callbacks.onTimeout(this.stats,this.context)} },{ key:'loadprogress',value:function(d){var a=this.stats;a.loaded=d.loaded,d.lengthComputable&&(a.total=d.total);var b=this.callbacks.onProgress;b&&b(a,this.context,null)} }])&&_defineProperties(d.prototype,a),b&&_defineProperties(d,b),c;var d,a,b}();exports.default=_default},{}],15:[function(_dereq_,module,exports){'use strict';exports.byteLength=function(b64){var lens=getLens(b64),validLen=lens[0],placeHoldersLen=lens[1];return 3*(validLen+placeHoldersLen)/4-placeHoldersLen},exports.toByteArray=function(b64){var tmp,i,lens=getLens(b64),validLen=lens[0],placeHoldersLen=lens[1],arr=new Arr(function(b64,validLen,placeHoldersLen){return 3*(validLen+placeHoldersLen)/4-placeHoldersLen}(0,validLen,placeHoldersLen)),curByte=0,len=placeHoldersLen>0?validLen-4:validLen;for(i=0;i<len;i+=4)tmp=revLookup[b64.charCodeAt(i)]<<18|revLookup[b64.charCodeAt(i+1)]<<12|revLookup[b64.charCodeAt(i+2)]<<6|revLookup[b64.charCodeAt(i+3)],arr[curByte++]=tmp>>16&255,arr[curByte++]=tmp>>8&255,arr[curByte++]=255&tmp;2===placeHoldersLen&&(tmp=revLookup[b64.charCodeAt(i)]<<2|revLookup[b64.charCodeAt(i+1)]>>4,arr[curByte++]=255&tmp);1===placeHoldersLen&&(tmp=revLookup[b64.charCodeAt(i)]<<10|revLookup[b64.charCodeAt(i+1)]<<4|revLookup[b64.charCodeAt(i+2)]>>2,arr[curByte++]=tmp>>8&255,arr[curByte++]=255&tmp);return arr},exports.fromByteArray=function(uint8){for(var tmp,len=uint8.length,extraBytes=len%3,parts=[],i=0,len2=len-extraBytes;i<len2;i+=16383)parts.push(encodeChunk(uint8,i,i+16383>len2?len2:i+16383));1===extraBytes?(tmp=uint8[len-1],parts.push(lookup[tmp>>2]+lookup[tmp<<4&63]+'==')):2===extraBytes&&(tmp=(uint8[len-2]<<8)+uint8[len-1],parts.push(lookup[tmp>>10]+lookup[tmp>>4&63]+lookup[tmp<<2&63]+'='));return parts.join('')};for(var lookup=[],revLookup=[],Arr='undefined'!=typeof Uint8Array?Uint8Array:Array,code='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/',i=0,len=code.length;i<len;++i)lookup[i]=code[i],revLookup[code.charCodeAt(i)]=i;function getLens(b64){var len=b64.length;if(len%4>0)throw new Error('Invalid string. Length must be a multiple of 4');var validLen=b64.indexOf('=');return-1===validLen&&(validLen=len),[validLen,validLen===len?0:4-validLen%4]}function encodeChunk(uint8,start,end){for(var tmp,num,output=[],i=start;i<end;i+=3)tmp=(uint8[i]<<16&16711680)+(uint8[i+1]<<8&65280)+(255&uint8[i+2]),output.push(lookup[(num=tmp)>>18&63]+lookup[num>>12&63]+lookup[num>>6&63]+lookup[63&num]);return output.join('')}revLookup['-'.charCodeAt(0)]=62,revLookup['_'.charCodeAt(0)]=63},{}],16:[function(_dereq_,module,exports){},{}],17:[function(_dereq_,module,exports){arguments[4][16][0].apply(exports,arguments)},{ 16:16 }],18:[function(_dereq_,module,exports){(function(Buffer){'use strict';var base64=_dereq_(15),ieee754=_dereq_(24),customInspectSymbol='function'==typeof Symbol&&'function'==typeof Symbol.for?Symbol.for('nodejs.util.inspect.custom'):null;exports.Buffer=Buffer,exports.SlowBuffer=function(length){+length!=length&&(length=0);return Buffer.alloc(+length)},exports.INSPECT_MAX_BYTES=50;var K_MAX_LENGTH=2147483647;function createBuffer(length){if(length>K_MAX_LENGTH)throw new RangeError('The value "'+length+'" is invalid for option "size"');var buf=new Uint8Array(length);return Object.setPrototypeOf(buf,Buffer.prototype),buf}function Buffer(arg,encodingOrOffset,length){if('number'==typeof arg){if('string'==typeof encodingOrOffset)throw new TypeError('The "string" argument must be of type string. Received type number');return allocUnsafe(arg)}return from(arg,encodingOrOffset,length)}function from(value,encodingOrOffset,length){if('string'==typeof value)return function(string,encoding){'string'==typeof encoding&&''!==encoding||(encoding='utf8');if(!Buffer.isEncoding(encoding))throw new TypeError('Unknown encoding: '+encoding);var length=0|byteLength(string,encoding),buf=createBuffer(length),actual=buf.write(string,encoding);actual!==length&&(buf=buf.slice(0,actual));return buf}(value,encodingOrOffset);if(ArrayBuffer.isView(value))return fromArrayLike(value);if(null==value)throw new TypeError('The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type '+typeof value);if(isInstance(value,ArrayBuffer)||value&&isInstance(value.buffer,ArrayBuffer))return function(array,byteOffset,length){if(byteOffset<0||array.byteLength<byteOffset)throw new RangeError('"offset" is outside of buffer bounds');if(array.byteLength<byteOffset+(length||0))throw new RangeError('"length" is outside of buffer bounds');var buf;buf=void 0===byteOffset&&void 0===length?new Uint8Array(array):void 0===length?new Uint8Array(array,byteOffset):new Uint8Array(array,byteOffset,length);return Object.setPrototypeOf(buf,Buffer.prototype),buf}(value,encodingOrOffset,length);if('number'==typeof value)throw new TypeError('The "value" argument must not be of type number. Received type number');var valueOf=value.valueOf&&value.valueOf();if(null!=valueOf&&valueOf!==value)return Buffer.from(valueOf,encodingOrOffset,length);var b=function(obj){if(Buffer.isBuffer(obj)){var len=0|checked(obj.length),buf=createBuffer(len);return 0===buf.length?buf:(obj.copy(buf,0,0,len),buf)}if(void 0!==obj.length)return'number'!=typeof obj.length||numberIsNaN(obj.length)?createBuffer(0):fromArrayLike(obj);if('Buffer'===obj.type&&Array.isArray(obj.data))return fromArrayLike(obj.data)}(value);if(b)return b;if('undefined'!=typeof Symbol&&null!=Symbol.toPrimitive&&'function'==typeof value[Symbol.toPrimitive])return Buffer.from(value[Symbol.toPrimitive]('string'),encodingOrOffset,length);throw new TypeError('The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type '+typeof value)}function assertSize(size){if('number'!=typeof size)throw new TypeError('"size" argument must be of type number');if(size<0)throw new RangeError('The value "'+size+'" is invalid for option "size"')}function allocUnsafe(size){return assertSize(size),createBuffer(size<0?0:0|checked(size))}function fromArrayLike(array){for(var length=array.length<0?0:0|checked(array.length),buf=createBuffer(length),i=0;i<length;i+=1)buf[i]=255&array[i];return buf}function checked(length){if(length>=K_MAX_LENGTH)throw new RangeError('Attempt to allocate Buffer larger than maximum size: 0x'+K_MAX_LENGTH.toString(16)+' bytes');return 0|length}function byteLength(string,encoding){if(Buffer.isBuffer(string))return string.length;if(ArrayBuffer.isView(string)||isInstance(string,ArrayBuffer))return string.byteLength;if('string'!=typeof string)throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof string);var len=string.length,mustMatch=arguments.length>2&&!0===arguments[2];if(!mustMatch&&0===len)return 0;for(var loweredCase=!1;;)switch(encoding){case'ascii':case'latin1':case'binary':return len;case'utf8':case'utf-8':return utf8ToBytes(string).length;case'ucs2':case'ucs-2':case'utf16le':case'utf-16le':return 2*len;case'hex':return len>>>1;case'base64':return base64ToBytes(string).length;default:if(loweredCase)return mustMatch?-1:utf8ToBytes(string).length;encoding=(''+encoding).toLowerCase(),loweredCase=!0}}function swap(b,n,m){var i=b[n];b[n]=b[m],b[m]=i}function bidirectionalIndexOf(buffer,val,byteOffset,encoding,dir){if(0===buffer.length)return-1;if('string'==typeof byteOffset?(encoding=byteOffset,byteOffset=0):byteOffset>2147483647?byteOffset=2147483647:byteOffset<-2147483648&&(byteOffset=-2147483648),numberIsNaN(byteOffset=+byteOffset)&&(byteOffset=dir?0:buffer.length-1),byteOffset<0&&(byteOffset=buffer.length+byteOffset),byteOffset>=buffer.length){if(dir)return-1;byteOffset=buffer.length-1}else if(byteOffset<0){if(!dir)return-1;byteOffset=0}if('string'==typeof val&&(val=Buffer.from(val,encoding)),Buffer.isBuffer(val))return 0===val.length?-1:arrayIndexOf(buffer,val,byteOffset,encoding,dir);if('number'==typeof val)return val&=255,'function'==typeof Uint8Array.prototype.indexOf?dir?Uint8Array.prototype.indexOf.call(buffer,val,byteOffset):Uint8Array.prototype.lastIndexOf.call(buffer,val,byteOffset):arrayIndexOf(buffer,[val],byteOffset,encoding,dir);throw new TypeError('val must be string, number or Buffer')}function arrayIndexOf(arr,val,byteOffset,encoding,dir){var i,indexSize=1,arrLength=arr.length,valLength=val.length;if(void 0!==encoding&&('ucs2'===(encoding=String(encoding).toLowerCase())||'ucs-2'===encoding||'utf16le'===encoding||'utf-16le'===encoding)){if(arr.length<2||val.length<2)return-1;indexSize=2,arrLength/=2,valLength/=2,byteOffset/=2}function read(buf,i){return 1===indexSize?buf[i]:buf.readUInt16BE(i*indexSize)}if(dir){var foundIndex=-1;for(i=byteOffset;i<arrLength;i++)if(read(arr,i)===read(val,-1===foundIndex?0:i-foundIndex)){if(-1===foundIndex&&(foundIndex=i),i-foundIndex+1===valLength)return foundIndex*indexSize}else-1!==foundIndex&&(i-=i-foundIndex),foundIndex=-1}else for(byteOffset+valLength>arrLength&&(byteOffset=arrLength-valLength),i=byteOffset;i>=0;i--){for(var found=!0,j=0;j<valLength;j++)if(read(arr,i+j)!==read(val,j)){found=!1;break}if(found)return i}return-1}function hexWrite(buf,string,offset,length){offset=Number(offset)||0;var remaining=buf.length-offset;length?(length=Number(length))>remaining&&(length=remaining):length=remaining;var strLen=string.length;length>strLen/2&&(length=strLen/2);for(var i=0;i<length;++i){var parsed=parseInt(string.substr(2*i,2),16);if(numberIsNaN(parsed))return i;buf[offset+i]=parsed}return i}function utf8Write(buf,string,offset,length){return blitBuffer(utf8ToBytes(string,buf.length-offset),buf,offset,length)}function asciiWrite(buf,string,offset,length){return blitBuffer(function(str){for(var byteArray=[],i=0;i<str.length;++i)byteArray.push(255&str.charCodeAt(i));return byteArray}(string),buf,offset,length)}function latin1Write(buf,string,offset,length){return asciiWrite(buf,string,offset,length)}function base64Write(buf,string,offset,length){return blitBuffer(base64ToBytes(string),buf,offset,length)}function ucs2Write(buf,string,offset,length){return blitBuffer(function(str,units){for(var c,hi,lo,byteArray=[],i=0;i<str.length&&!((units-=2)<0);++i)c=str.charCodeAt(i),hi=c>>8,lo=c%256,byteArray.push(lo),byteArray.push(hi);return byteArray}(string,buf.length-offset),buf,offset,length)}function base64Slice(buf,start,end){return 0===start&&end===buf.length?base64.fromByteArray(buf):base64.fromByteArray(buf.slice(start,end))}function utf8Slice(buf,start,end){end=Math.min(buf.length,end);for(var res=[],i=start;i<end;){var secondByte,thirdByte,fourthByte,tempCodePoint,firstByte=buf[i],codePoint=null,bytesPerSequence=firstByte>239?4:firstByte>223?3:firstByte>191?2:1;if(i+bytesPerSequence<=end)switch(bytesPerSequence){case 1:firstByte<128&&(codePoint=firstByte);break;case 2:128==(192&(secondByte=buf[i+1]))&&(tempCodePoint=(31&firstByte)<<6|63&secondByte)>127&&(codePoint=tempCodePoint);break;case 3:secondByte=buf[i+1],thirdByte=buf[i+2],128==(192&secondByte)&&128==(192&thirdByte)&&(tempCodePoint=(15&firstByte)<<12|(63&secondByte)<<6|63&thirdByte)>2047&&(tempCodePoint<55296||tempCodePoint>57343)&&(codePoint=tempCodePoint);break;case 4:secondByte=buf[i+1],thirdByte=buf[i+2],fourthByte=buf[i+3],128==(192&secondByte)&&128==(192&thirdByte)&&128==(192&fourthByte)&&(tempCodePoint=(15&firstByte)<<18|(63&secondByte)<<12|(63&thirdByte)<<6|63&fourthByte)>65535&&tempCodePoint<1114112&&(codePoint=tempCodePoint)}null===codePoint?(codePoint=65533,bytesPerSequence=1):codePoint>65535&&(codePoint-=65536,res.push(codePoint>>>10&1023|55296),codePoint=56320|1023&codePoint),res.push(codePoint),i+=bytesPerSequence}return function(codePoints){var len=codePoints.length;if(len<=MAX_ARGUMENTS_LENGTH)return String.fromCharCode.apply(String,codePoints);var res='',i=0;for(;i<len;)res+=String.fromCharCode.apply(String,codePoints.slice(i,i+=MAX_ARGUMENTS_LENGTH));return res}(res)}exports.kMaxLength=K_MAX_LENGTH,Buffer.TYPED_ARRAY_SUPPORT=function(){try{var arr=new Uint8Array(1),proto={ foo:function(){return 42} };return Object.setPrototypeOf(proto,Uint8Array.prototype),Object.setPrototypeOf(arr,proto),42===arr.foo()}catch(e){return!1}}(),!Buffer.TYPED_ARRAY_SUPPORT&&'undefined'!=typeof console&&console.error,Object.defineProperty(Buffer.prototype,'parent',{ enumerable:!0,get:function(){if(Buffer.isBuffer(this))return this.buffer} }),Object.defineProperty(Buffer.prototype,'offset',{ enumerable:!0,get:function(){if(Buffer.isBuffer(this))return this.byteOffset} }),'undefined'!=typeof Symbol&&null!=Symbol.species&&Buffer[Symbol.species]===Buffer&&Object.defineProperty(Buffer,Symbol.species,{ value:null,configurable:!0,enumerable:!1,writable:!1 }),Buffer.poolSize=8192,Buffer.from=function(value,encodingOrOffset,length){return from(value,encodingOrOffset,length)},Object.setPrototypeOf(Buffer.prototype,Uint8Array.prototype),Object.setPrototypeOf(Buffer,Uint8Array),Buffer.alloc=function(size,fill,encoding){return function(size,fill,encoding){return assertSize(size),size<=0?createBuffer(size):void 0!==fill?'string'==typeof encoding?createBuffer(size).fill(fill,encoding):createBuffer(size).fill(fill):createBuffer(size)}(size,fill,encoding)},Buffer.allocUnsafe=function(size){return allocUnsafe(size)},Buffer.allocUnsafeSlow=function(size){return allocUnsafe(size)},Buffer.isBuffer=function(b){return null!=b&&!0===b._isBuffer&&b!==Buffer.prototype},Buffer.compare=function(a,b){if(isInstance(a,Uint8Array)&&(a=Buffer.from(a,a.offset,a.byteLength)),isInstance(b,Uint8Array)&&(b=Buffer.from(b,b.offset,b.byteLength)),!Buffer.isBuffer(a)||!Buffer.isBuffer(b))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(a===b)return 0;for(var x=a.length,y=b.length,i=0,len=Math.min(x,y);i<len;++i)if(a[i]!==b[i]){x=a[i],y=b[i];break}return x<y?-1:y<x?1:0},Buffer.isEncoding=function(encoding){switch(String(encoding).toLowerCase()){case'hex':case'utf8':case'utf-8':case'ascii':case'latin1':case'binary':case'base64':case'ucs2':case'ucs-2':case'utf16le':case'utf-16le':return!0;default:return!1}},Buffer.concat=function(list,length){if(!Array.isArray(list))throw new TypeError('"list" argument must be an Array of Buffers');if(0===list.length)return Buffer.alloc(0);var i;if(void 0===length)for(length=0,i=0;i<list.length;++i)length+=list[i].length;var buffer=Buffer.allocUnsafe(length),pos=0;for(i=0;i<list.length;++i){var buf=list[i];if(isInstance(buf,Uint8Array)&&(buf=Buffer.from(buf)),!Buffer.isBuffer(buf))throw new TypeError('"list" argument must be an Array of Buffers');buf.copy(buffer,pos),pos+=buf.length}return buffer},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function(){var len=this.length;if(len%2!=0)throw new RangeError('Buffer size must be a multiple of 16-bits');for(var i=0;i<len;i+=2)swap(this,i,i+1);return this},Buffer.prototype.swap32=function(){var len=this.length;if(len%4!=0)throw new RangeError('Buffer size must be a multiple of 32-bits');for(var i=0;i<len;i+=4)swap(this,i,i+3),swap(this,i+1,i+2);return this},Buffer.prototype.swap64=function(){var len=this.length;if(len%8!=0)throw new RangeError('Buffer size must be a multiple of 64-bits');for(var i=0;i<len;i+=8)swap(this,i,i+7),swap(this,i+1,i+6),swap(this,i+2,i+5),swap(this,i+3,i+4);return this},Buffer.prototype.toString=function(){var length=this.length;return 0===length?'':0===arguments.length?utf8Slice(this,0,length):function(encoding,start,end){var loweredCase=!1;if((void 0===start||start<0)&&(start=0),start>this.length)return'';if((void 0===end||end>this.length)&&(end=this.length),end<=0)return'';if((end>>>=0)<=(start>>>=0))return'';for(encoding||(encoding='utf8');;)switch(encoding){case'hex':return hexSlice(this,start,end);case'utf8':case'utf-8':return utf8Slice(this,start,end);case'ascii':return asciiSlice(this,start,end);case'latin1':case'binary':return latin1Slice(this,start,end);case'base64':return base64Slice(this,start,end);case'ucs2':case'ucs-2':case'utf16le':case'utf-16le':return utf16leSlice(this,start,end);default:if(loweredCase)throw new TypeError('Unknown encoding: '+encoding);encoding=(encoding+'').toLowerCase(),loweredCase=!0}}.apply(this,arguments)},Buffer.prototype.toLocaleString=Buffer.prototype.toString,Buffer.prototype.equals=function(b){if(!Buffer.isBuffer(b))throw new TypeError('Argument must be a Buffer');return this===b||0===Buffer.compare(this,b)},Buffer.prototype.inspect=function(){var str='',max=exports.INSPECT_MAX_BYTES;return str=this.toString('hex',0,max).replace(/(.{2})/g,'$1 ').trim(),this.length>max&&(str+=' ... '),'<Buffer '+str+'>'},customInspectSymbol&&(Buffer.prototype[customInspectSymbol]=Buffer.prototype.inspect),Buffer.prototype.compare=function(target,start,end,thisStart,thisEnd){if(isInstance(target,Uint8Array)&&(target=Buffer.from(target,target.offset,target.byteLength)),!Buffer.isBuffer(target))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof target);if(void 0===start&&(start=0),void 0===end&&(end=target?target.length:0),void 0===thisStart&&(thisStart=0),void 0===thisEnd&&(thisEnd=this.length),start<0||end>target.length||thisStart<0||thisEnd>this.length)throw new RangeError('out of range index');if(thisStart>=thisEnd&&start>=end)return 0;if(thisStart>=thisEnd)return-1;if(start>=end)return 1;if(start>>>=0,end>>>=0,thisStart>>>=0,thisEnd>>>=0,this===target)return 0;for(var x=thisEnd-thisStart,y=end-start,len=Math.min(x,y),thisCopy=this.slice(thisStart,thisEnd),targetCopy=target.slice(start,end),i=0;i<len;++i)if(thisCopy[i]!==targetCopy[i]){x=thisCopy[i],y=targetCopy[i];break}return x<y?-1:y<x?1:0},Buffer.prototype.includes=function(val,byteOffset,encoding){return-1!==this.indexOf(val,byteOffset,encoding)},Buffer.prototype.indexOf=function(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!0)},Buffer.prototype.lastIndexOf=function(val,byteOffset,encoding){return bidirectionalIndexOf(this,val,byteOffset,encoding,!1)},Buffer.prototype.write=function(string,offset,length,encoding){if(void 0===offset)encoding='utf8',length=this.length,offset=0;else if(void 0===length&&'string'==typeof offset)encoding=offset,length=this.length,offset=0;else{if(!isFinite(offset))throw new Error('Buffer.write(string, encoding, offset[, length]) is no longer supported');offset>>>=0,isFinite(length)?(length>>>=0,void 0===encoding&&(encoding='utf8')):(encoding=length,length=void 0)}var remaining=this.length-offset;if((void 0===length||length>remaining)&&(length=remaining),string.length>0&&(length<0||offset<0)||offset>this.length)throw new RangeError('Attempt to write outside buffer bounds');encoding||(encoding='utf8');for(var loweredCase=!1;;)switch(encoding){case'hex':return hexWrite(this,string,offset,length);case'utf8':case'utf-8':return utf8Write(this,string,offset,length);case'ascii':return asciiWrite(this,string,offset,length);case'latin1':case'binary':return latin1Write(this,string,offset,length);case'base64':return base64Write(this,string,offset,length);case'ucs2':case'ucs-2':case'utf16le':case'utf-16le':return ucs2Write(this,string,offset,length);default:if(loweredCase)throw new TypeError('Unknown encoding: '+encoding);encoding=(''+encoding).toLowerCase(),loweredCase=!0}},Buffer.prototype.toJSON=function(){return{ type:'Buffer',data:Array.prototype.slice.call(this._arr||this,0) }};var MAX_ARGUMENTS_LENGTH=4096;function asciiSlice(buf,start,end){var ret='';end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(127&buf[i]);return ret}function latin1Slice(buf,start,end){var ret='';end=Math.min(buf.length,end);for(var i=start;i<end;++i)ret+=String.fromCharCode(buf[i]);return ret}function hexSlice(buf,start,end){var len=buf.length;(!start||start<0)&&(start=0),(!end||end<0||end>len)&&(end=len);for(var out='',i=start;i<end;++i)out+=toHex(buf[i]);return out}function utf16leSlice(buf,start,end){for(var bytes=buf.slice(start,end),res='',i=0;i<bytes.length;i+=2)res+=String.fromCharCode(bytes[i]+256*bytes[i+1]);return res}function checkOffset(offset,ext,length){if(offset%1!=0||offset<0)throw new RangeError('offset is not uint');if(offset+ext>length)throw new RangeError('Trying to access beyond buffer length')}function checkInt(buf,value,offset,ext,max,min){if(!Buffer.isBuffer(buf))throw new TypeError('"buffer" argument must be a Buffer instance');if(value>max||value<min)throw new RangeError('"value" argument is out of bounds');if(offset+ext>buf.length)throw new RangeError('Index out of range')}function checkIEEE754(buf,value,offset,ext,max,min){if(offset+ext>buf.length)throw new RangeError('Index out of range');if(offset<0)throw new RangeError('Index out of range')}function writeFloat(buf,value,offset,littleEndian,noAssert){return value=+value,offset>>>=0,noAssert||checkIEEE754(buf,0,offset,4),ieee754.write(buf,value,offset,littleEndian,23,4),offset+4}function writeDouble(buf,value,offset,littleEndian,noAssert){return value=+value,offset>>>=0,noAssert||checkIEEE754(buf,0,offset,8),ieee754.write(buf,value,offset,littleEndian,52,8),offset+8}Buffer.prototype.slice=function(start,end){var len=this.length;start=~~start,end=void 0===end?len:~~end,start<0?(start+=len)<0&&(start=0):start>len&&(start=len),end<0?(end+=len)<0&&(end=0):end>len&&(end=len),end<start&&(end=start);var newBuf=this.subarray(start,end);return Object.setPrototypeOf(newBuf,Buffer.prototype),newBuf},Buffer.prototype.readUIntLE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return val},Buffer.prototype.readUIntBE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset+--byteLength],mul=1;byteLength>0&&(mul*=256);)val+=this[offset+--byteLength]*mul;return val},Buffer.prototype.readUInt8=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,1,this.length),this[offset]},Buffer.prototype.readUInt16LE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,2,this.length),this[offset]|this[offset+1]<<8},Buffer.prototype.readUInt16BE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,2,this.length),this[offset]<<8|this[offset+1]},Buffer.prototype.readUInt32LE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),(this[offset]|this[offset+1]<<8|this[offset+2]<<16)+16777216*this[offset+3]},Buffer.prototype.readUInt32BE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),16777216*this[offset]+(this[offset+1]<<16|this[offset+2]<<8|this[offset+3])},Buffer.prototype.readIntLE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var val=this[offset],mul=1,i=0;++i<byteLength&&(mul*=256);)val+=this[offset+i]*mul;return val>=(mul*=128)&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readIntBE=function(offset,byteLength,noAssert){offset>>>=0,byteLength>>>=0,noAssert||checkOffset(offset,byteLength,this.length);for(var i=byteLength,mul=1,val=this[offset+--i];i>0&&(mul*=256);)val+=this[offset+--i]*mul;return val>=(mul*=128)&&(val-=Math.pow(2,8*byteLength)),val},Buffer.prototype.readInt8=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,1,this.length),128&this[offset]?-1*(255-this[offset]+1):this[offset]},Buffer.prototype.readInt16LE=function(offset,noAssert){offset>>>=0,noAssert||checkOffset(offset,2,this.length);var val=this[offset]|this[offset+1]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt16BE=function(offset,noAssert){offset>>>=0,noAssert||checkOffset(offset,2,this.length);var val=this[offset+1]|this[offset]<<8;return 32768&val?4294901760|val:val},Buffer.prototype.readInt32LE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),this[offset]|this[offset+1]<<8|this[offset+2]<<16|this[offset+3]<<24},Buffer.prototype.readInt32BE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),this[offset]<<24|this[offset+1]<<16|this[offset+2]<<8|this[offset+3]},Buffer.prototype.readFloatLE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!0,23,4)},Buffer.prototype.readFloatBE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,4,this.length),ieee754.read(this,offset,!1,23,4)},Buffer.prototype.readDoubleLE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!0,52,8)},Buffer.prototype.readDoubleBE=function(offset,noAssert){return offset>>>=0,noAssert||checkOffset(offset,8,this.length),ieee754.read(this,offset,!1,52,8)},Buffer.prototype.writeUIntLE=function(value,offset,byteLength,noAssert){(value=+value,offset>>>=0,byteLength>>>=0,noAssert)||checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength)-1,0);var mul=1,i=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUIntBE=function(value,offset,byteLength,noAssert){(value=+value,offset>>>=0,byteLength>>>=0,noAssert)||checkInt(this,value,offset,byteLength,Math.pow(2,8*byteLength)-1,0);var i=byteLength-1,mul=1;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)this[offset+i]=value/mul&255;return offset+byteLength},Buffer.prototype.writeUInt8=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,1,255,0),this[offset]=255&value,offset+1},Buffer.prototype.writeUInt16LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,65535,0),this[offset]=255&value,this[offset+1]=value>>>8,offset+2},Buffer.prototype.writeUInt16BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,65535,0),this[offset]=value>>>8,this[offset+1]=255&value,offset+2},Buffer.prototype.writeUInt32LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,4294967295,0),this[offset+3]=value>>>24,this[offset+2]=value>>>16,this[offset+1]=value>>>8,this[offset]=255&value,offset+4},Buffer.prototype.writeUInt32BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,4294967295,0),this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value,offset+4},Buffer.prototype.writeIntLE=function(value,offset,byteLength,noAssert){if(value=+value,offset>>>=0,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=0,mul=1,sub=0;for(this[offset]=255&value;++i<byteLength&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i-1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeIntBE=function(value,offset,byteLength,noAssert){if(value=+value,offset>>>=0,!noAssert){var limit=Math.pow(2,8*byteLength-1);checkInt(this,value,offset,byteLength,limit-1,-limit)}var i=byteLength-1,mul=1,sub=0;for(this[offset+i]=255&value;--i>=0&&(mul*=256);)value<0&&0===sub&&0!==this[offset+i+1]&&(sub=1),this[offset+i]=(value/mul>>0)-sub&255;return offset+byteLength},Buffer.prototype.writeInt8=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,1,127,-128),value<0&&(value=255+value+1),this[offset]=255&value,offset+1},Buffer.prototype.writeInt16LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,32767,-32768),this[offset]=255&value,this[offset+1]=value>>>8,offset+2},Buffer.prototype.writeInt16BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,2,32767,-32768),this[offset]=value>>>8,this[offset+1]=255&value,offset+2},Buffer.prototype.writeInt32LE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),this[offset]=255&value,this[offset+1]=value>>>8,this[offset+2]=value>>>16,this[offset+3]=value>>>24,offset+4},Buffer.prototype.writeInt32BE=function(value,offset,noAssert){return value=+value,offset>>>=0,noAssert||checkInt(this,value,offset,4,2147483647,-2147483648),value<0&&(value=4294967295+value+1),this[offset]=value>>>24,this[offset+1]=value>>>16,this[offset+2]=value>>>8,this[offset+3]=255&value,offset+4},Buffer.prototype.writeFloatLE=function(value,offset,noAssert){return writeFloat(this,value,offset,!0,noAssert)},Buffer.prototype.writeFloatBE=function(value,offset,noAssert){return writeFloat(this,value,offset,!1,noAssert)},Buffer.prototype.writeDoubleLE=function(value,offset,noAssert){return writeDouble(this,value,offset,!0,noAssert)},Buffer.prototype.writeDoubleBE=function(value,offset,noAssert){return writeDouble(this,value,offset,!1,noAssert)},Buffer.prototype.copy=function(target,targetStart,start,end){if(!Buffer.isBuffer(target))throw new TypeError('argument should be a Buffer');if(start||(start=0),end||0===end||(end=this.length),targetStart>=target.length&&(targetStart=target.length),targetStart||(targetStart=0),end>0&&end<start&&(end=start),end===start)return 0;if(0===target.length||0===this.length)return 0;if(targetStart<0)throw new RangeError('targetStart out of bounds');if(start<0||start>=this.length)throw new RangeError('Index out of range');if(end<0)throw new RangeError('sourceEnd out of bounds');end>this.length&&(end=this.length),target.length-targetStart<end-start&&(end=target.length-targetStart+start);var len=end-start;if(this===target&&'function'==typeof Uint8Array.prototype.copyWithin)this.copyWithin(targetStart,start,end);else if(this===target&&start<targetStart&&targetStart<end)for(var i=len-1;i>=0;--i)target[i+targetStart]=this[i+start];else Uint8Array.prototype.set.call(target,this.subarray(start,end),targetStart);return len},Buffer.prototype.fill=function(val,start,end,encoding){if('string'==typeof val){if('string'==typeof start?(encoding=start,start=0,end=this.length):'string'==typeof end&&(encoding=end,end=this.length),void 0!==encoding&&'string'!=typeof encoding)throw new TypeError('encoding must be a string');if('string'==typeof encoding&&!Buffer.isEncoding(encoding))throw new TypeError('Unknown encoding: '+encoding);if(1===val.length){var code=val.charCodeAt(0);('utf8'===encoding&&code<128||'latin1'===encoding)&&(val=code)}}else'number'==typeof val?val&=255:'boolean'==typeof val&&(val=Number(val));if(start<0||this.length<start||this.length<end)throw new RangeError('Out of range index');if(end<=start)return this;var i;if(start>>>=0,end=void 0===end?this.length:end>>>0,val||(val=0),'number'==typeof val)for(i=start;i<end;++i)this[i]=val;else{var bytes=Buffer.isBuffer(val)?val:Buffer.from(val,encoding),len=bytes.length;if(0===len)throw new TypeError('The value "'+val+'" is invalid for argument "value"');for(i=0;i<end-start;++i)this[i+start]=bytes[i%len]}return this};var INVALID_BASE64_RE=/[^+/0-9A-Za-z-_]/g;function toHex(n){return n<16?'0'+n.toString(16):n.toString(16)}function utf8ToBytes(string,units){var codePoint;units=units||1/0;for(var length=string.length,leadSurrogate=null,bytes=[],i=0;i<length;++i){if((codePoint=string.charCodeAt(i))>55295&&codePoint<57344){if(!leadSurrogate){if(codePoint>56319){(units-=3)>-1&&bytes.push(239,191,189);continue}if(i+1===length){(units-=3)>-1&&bytes.push(239,191,189);continue}leadSurrogate=codePoint;continue}if(codePoint<56320){(units-=3)>-1&&bytes.push(239,191,189),leadSurrogate=codePoint;continue}codePoint=65536+(leadSurrogate-55296<<10|codePoint-56320)}else leadSurrogate&&(units-=3)>-1&&bytes.push(239,191,189);if(leadSurrogate=null,codePoint<128){if((units-=1)<0)break;bytes.push(codePoint)}else if(codePoint<2048){if((units-=2)<0)break;bytes.push(codePoint>>6|192,63&codePoint|128)}else if(codePoint<65536){if((units-=3)<0)break;bytes.push(codePoint>>12|224,codePoint>>6&63|128,63&codePoint|128)}else{if(!(codePoint<1114112))throw new Error('Invalid code point');if((units-=4)<0)break;bytes.push(codePoint>>18|240,codePoint>>12&63|128,codePoint>>6&63|128,63&codePoint|128)}}return bytes}function base64ToBytes(str){return base64.toByteArray(function(str){if((str=(str=str.split('=')[0]).trim().replace(INVALID_BASE64_RE,'')).length<2)return'';for(;str.length%4!=0;)str+='=';return str}(str))}function blitBuffer(src,dst,offset,length){for(var i=0;i<length&&!(i+offset>=dst.length||i>=src.length);++i)dst[i+offset]=src[i];return i}function isInstance(obj,type){return obj instanceof type||null!=obj&&null!=obj.constructor&&null!=obj.constructor.name&&obj.constructor.name===type.name}function numberIsNaN(obj){return obj!=obj}}).call(this,_dereq_(18).Buffer)},{ 15:15,18:18,24:24 }],19:[function(_dereq_,module,exports){module.exports={ 100:'Continue',101:'Switching Protocols',102:'Processing',200:'OK',201:'Created',202:'Accepted',203:'Non-Authoritative Information',204:'No Content',205:'Reset Content',206:'Partial Content',207:'Multi-Status',208:'Already Reported',226:'IM Used',300:'Multiple Choices',301:'Moved Permanently',302:'Found',303:'See Other',304:'Not Modified',305:'Use Proxy',307:'Temporary Redirect',308:'Permanent Redirect',400:'Bad Request',401:'Unauthorized',402:'Payment Required',403:'Forbidden',404:'Not Found',405:'Method Not Allowed',406:'Not Acceptable',407:'Proxy Authentication Required',408:'Request Timeout',409:'Conflict',410:'Gone',411:'Length Required',412:'Precondition Failed',413:'Payload Too Large',414:'URI Too Long',415:'Unsupported Media Type',416:'Range Not Satisfiable',417:'Expectation Failed',418:"I'm a teapot",421:'Misdirected Request',422:'Unprocessable Entity',423:'Locked',424:'Failed Dependency',425:'Unordered Collection',426:'Upgrade Required',428:'Precondition Required',429:'Too Many Requests',431:'Request Header Fields Too Large',451:'Unavailable For Legal Reasons',500:'Internal Server Error',501:'Not Implemented',502:'Bad Gateway',503:'Service Unavailable',504:'Gateway Timeout',505:'HTTP Version Not Supported',506:'Variant Also Negotiates',507:'Insufficient Storage',508:'Loop Detected',509:'Bandwidth Limit Exceeded',510:'Not Extended',511:'Network Authentication Required' }},{}],20:[function(_dereq_,module,exports){var charenc={ utf8:{ stringToBytes:function(str){return charenc.bin.stringToBytes(unescape(encodeURIComponent(str)))},bytesToString:function(bytes){return decodeURIComponent(escape(charenc.bin.bytesToString(bytes)))} },bin:{ stringToBytes:function(str){for(var bytes=[],i=0;i<str.length;i++)bytes.push(255&str.charCodeAt(i));return bytes},bytesToString:function(bytes){for(var str=[],i=0;i<bytes.length;i++)str.push(String.fromCharCode(bytes[i]));return str.join('')} } };module.exports=charenc},{}],21:[function(_dereq_,module,exports){var base64map,crypt;base64map='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/',crypt={ rotl:function(n,b){return n<<b|n>>>32-b},rotr:function(n,b){return n<<32-b|n>>>b},endian:function(n){if(n.constructor==Number)return 16711935&crypt.rotl(n,8)|4278255360&crypt.rotl(n,24);for(var i=0;i<n.length;i++)n[i]=crypt.endian(n[i]);return n},randomBytes:function(n){for(var bytes=[];n>0;n--)bytes.push(Math.floor(256*Math.random()));return bytes},bytesToWords:function(bytes){for(var words=[],i=0,b=0;i<bytes.length;i++,b+=8)words[b>>>5]|=bytes[i]<<24-b%32;return words},wordsToBytes:function(words){for(var bytes=[],b=0;b<32*words.length;b+=8)bytes.push(words[b>>>5]>>>24-b%32&255);return bytes},bytesToHex:function(bytes){for(var hex=[],i=0;i<bytes.length;i++)hex.push((bytes[i]>>>4).toString(16)),hex.push((15&bytes[i]).toString(16));return hex.join('')},hexToBytes:function(hex){for(var bytes=[],c=0;c<hex.length;c+=2)bytes.push(parseInt(hex.substr(c,2),16));return bytes},bytesToBase64:function(bytes){for(var base64=[],i=0;i<bytes.length;i+=3)for(var triplet=bytes[i]<<16|bytes[i+1]<<8|bytes[i+2],j=0;j<4;j++)8*i+6*j<=8*bytes.length?base64.push(base64map.charAt(triplet>>>6*(3-j)&63)):base64.push('=');return base64.join('')},base64ToBytes:function(base64){base64=base64.replace(/[^A-Z0-9+\/]/gi,'');for(var bytes=[],i=0,imod4=0;i<base64.length;imod4=++i%4)0!=imod4&&bytes.push((base64map.indexOf(base64.charAt(i-1))&Math.pow(2,-2*imod4+8)-1)<<2*imod4|base64map.indexOf(base64.charAt(i))>>>6-2*imod4);return bytes} },module.exports=crypt},{}],22:[function(_dereq_,module,exports){var objectCreate=Object.create||function(proto){var F=function(){};return F.prototype=proto,new F},objectKeys=Object.keys||function(obj){var keys=[];for(var k in obj)Object.prototype.hasOwnProperty.call(obj,k)&&keys.push(k);return k},bind=Function.prototype.bind||function(context){var fn=this;return function(){return fn.apply(context,arguments)}};function EventEmitter(){this._events&&Object.prototype.hasOwnProperty.call(this,'_events')||(this._events=objectCreate(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0}module.exports=EventEmitter,EventEmitter.EventEmitter=EventEmitter,EventEmitter.prototype._events=void 0,EventEmitter.prototype._maxListeners=void 0;var hasDefineProperty,defaultMaxListeners=10;try{var o={};Object.defineProperty&&Object.defineProperty(o,'x',{ value:0 }),hasDefineProperty=0===o.x}catch(err){hasDefineProperty=!1}function $getMaxListeners(that){return void 0===that._maxListeners?EventEmitter.defaultMaxListeners:that._maxListeners}function _addListener(target,type,listener,prepend){var m,events,existing;if('function'!=typeof listener)throw new TypeError('"listener" argument must be a function');if((events=target._events)?(events.newListener&&(target.emit('newListener',type,listener.listener?listener.listener:listener),events=target._events),existing=events[type]):(events=target._events=objectCreate(null),target._eventsCount=0),existing){if('function'==typeof existing?existing=events[type]=prepend?[listener,existing]:[existing,listener]:prepend?existing.unshift(listener):existing.push(listener),!existing.warned&&(m=$getMaxListeners(target))&&m>0&&existing.length>m){existing.warned=!0;var w=new Error('Possible EventEmitter memory leak detected. '+existing.length+' "'+String(type)+'" listeners added. Use emitter.setMaxListeners() to increase limit.');w.name='MaxListenersExceededWarning',w.emitter=target,w.type=type,w.count=existing.length,'object'==typeof console&&console.warn}}else existing=events[type]=listener,++target._eventsCount;return target}function onceWrapper(){if(!this.fired)switch(this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length){case 0:return this.listener.call(this.target);case 1:return this.listener.call(this.target,arguments[0]);case 2:return this.listener.call(this.target,arguments[0],arguments[1]);case 3:return this.listener.call(this.target,arguments[0],arguments[1],arguments[2]);default:for(var args=new Array(arguments.length),i=0;i<args.length;++i)args[i]=arguments[i];this.listener.apply(this.target,args)}}function _onceWrap(target,type,listener){var state={ fired:!1,wrapFn:void 0,target:target,type:type,listener:listener },wrapped=bind.call(onceWrapper,state);return wrapped.listener=listener,state.wrapFn=wrapped,wrapped}function _listeners(target,type,unwrap){var events=target._events;if(!events)return[];var evlistener=events[type];return evlistener?'function'==typeof evlistener?unwrap?[evlistener.listener||evlistener]:[evlistener]:unwrap?function(arr){for(var ret=new Array(arr.length),i=0;i<ret.length;++i)ret[i]=arr[i].listener||arr[i];return ret}(evlistener):arrayClone(evlistener,evlistener.length):[]}function listenerCount(type){var events=this._events;if(events){var evlistener=events[type];if('function'==typeof evlistener)return 1;if(evlistener)return evlistener.length}return 0}function arrayClone(arr,n){for(var copy=new Array(n),i=0;i<n;++i)copy[i]=arr[i];return copy}hasDefineProperty?Object.defineProperty(EventEmitter,'defaultMaxListeners',{ enumerable:!0,get:function(){return defaultMaxListeners},set:function(arg){if('number'!=typeof arg||arg<0||arg!=arg)throw new TypeError('"defaultMaxListeners" must be a positive number');defaultMaxListeners=arg} }):EventEmitter.defaultMaxListeners=defaultMaxListeners,EventEmitter.prototype.setMaxListeners=function(n){if('number'!=typeof n||n<0||isNaN(n))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=n,this},EventEmitter.prototype.getMaxListeners=function(){return $getMaxListeners(this)},EventEmitter.prototype.emit=function(type){var er,handler,len,args,i,events,doError='error'===type;if(events=this._events)doError=doError&&null==events.error;else if(!doError)return!1;if(doError){if(arguments.length>1&&(er=arguments[1]),er instanceof Error)throw er;var err=new Error('Unhandled "error" event. ('+er+')');throw err.context=er,err}if(!(handler=events[type]))return!1;var isFn='function'==typeof handler;switch(len=arguments.length){case 1:!function(handler,isFn,self){if(isFn)handler.call(self);else for(var len=handler.length,listeners=arrayClone(handler,len),i=0;i<len;++i)listeners[i].call(self)}(handler,isFn,this);break;case 2:!function(handler,isFn,self,arg1){if(isFn)handler.call(self,arg1);else for(var len=handler.length,listeners=arrayClone(handler,len),i=0;i<len;++i)listeners[i].call(self,arg1)}(handler,isFn,this,arguments[1]);break;case 3:!function(handler,isFn,self,arg1,arg2){if(isFn)handler.call(self,arg1,arg2);else for(var len=handler.length,listeners=arrayClone(handler,len),i=0;i<len;++i)listeners[i].call(self,arg1,arg2)}(handler,isFn,this,arguments[1],arguments[2]);break;case 4:!function(handler,isFn,self,arg1,arg2,arg3){if(isFn)handler.call(self,arg1,arg2,arg3);else for(var len=handler.length,listeners=arrayClone(handler,len),i=0;i<len;++i)listeners[i].call(self,arg1,arg2,arg3)}(handler,isFn,this,arguments[1],arguments[2],arguments[3]);break;default:for(args=new Array(len-1),i=1;i<len;i++)args[i-1]=arguments[i];!function(handler,isFn,self,args){if(isFn)handler.apply(self,args);else for(var len=handler.length,listeners=arrayClone(handler,len),i=0;i<len;++i)listeners[i].apply(self,args)}(handler,isFn,this,args)}return!0},EventEmitter.prototype.addListener=function(type,listener){return _addListener(this,type,listener,!1)},EventEmitter.prototype.on=EventEmitter.prototype.addListener,EventEmitter.prototype.prependListener=function(type,listener){return _addListener(this,type,listener,!0)},EventEmitter.prototype.once=function(type,listener){if('function'!=typeof listener)throw new TypeError('"listener" argument must be a function');return this.on(type,_onceWrap(this,type,listener)),this},EventEmitter.prototype.prependOnceListener=function(type,listener){if('function'!=typeof listener)throw new TypeError('"listener" argument must be a function');return this.prependListener(type,_onceWrap(this,type,listener)),this},EventEmitter.prototype.removeListener=function(type,listener){var list,events,position,i,originalListener;if('function'!=typeof listener)throw new TypeError('"listener" argument must be a function');if(!(events=this._events))return this;if(!(list=events[type]))return this;if(list===listener||list.listener===listener)0==--this._eventsCount?this._events=objectCreate(null):(delete events[type],events.removeListener&&this.emit('removeListener',type,list.listener||listener));else if('function'!=typeof list){for(position=-1,i=list.length-1;i>=0;i--)if(list[i]===listener||list[i].listener===listener){originalListener=list[i].listener,position=i;break}if(position<0)return this;0===position?list.shift():function(list,index){for(var i=index,k=i+1,n=list.length;k<n;i+=1,k+=1)list[i]=list[k];list.pop()}(list,position),1===list.length&&(events[type]=list[0]),events.removeListener&&this.emit('removeListener',type,originalListener||listener)}return this},EventEmitter.prototype.removeAllListeners=function(type){var listeners,events,i;if(!(events=this._events))return this;if(!events.removeListener)return 0===arguments.length?(this._events=objectCreate(null),this._eventsCount=0):events[type]&&(0==--this._eventsCount?this._events=objectCreate(null):delete events[type]),this;if(0===arguments.length){var key,keys=objectKeys(events);for(i=0;i<keys.length;++i)'removeListener'!==(key=keys[i])&&this.removeAllListeners(key);return this.removeAllListeners('removeListener'),this._events=objectCreate(null),this._eventsCount=0,this}if('function'==typeof(listeners=events[type]))this.removeListener(type,listeners);else if(listeners)for(i=listeners.length-1;i>=0;i--)this.removeListener(type,listeners[i]);return this},EventEmitter.prototype.listeners=function(type){return _listeners(this,type,!0)},EventEmitter.prototype.rawListeners=function(type){return _listeners(this,type,!1)},EventEmitter.listenerCount=function(emitter,type){return'function'==typeof emitter.listenerCount?emitter.listenerCount(type):listenerCount.call(emitter,type)},EventEmitter.prototype.listenerCount=listenerCount,EventEmitter.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]}},{}],23:[function(_dereq_,module,exports){var http=_dereq_(35),url=_dereq_(55),https=module.exports;for(var key in http)http.hasOwnProperty(key)&&(https[key]=http[key]);function validateParams(params){if('string'==typeof params&&(params=url.parse(params)),params.protocol||(params.protocol='https:'),'https:'!==params.protocol)throw new Error('Protocol "'+params.protocol+'" not supported. Expected "https:"');return params}https.request=function(params,cb){return params=validateParams(params),http.request.call(this,params,cb)},https.get=function(params,cb){return params=validateParams(params),http.get.call(this,params,cb)}},{ 35:35,55:55 }],24:[function(_dereq_,module,exports){exports.read=function(buffer,offset,isLE,mLen,nBytes){var e,m,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,nBits=-7,i=isLE?nBytes-1:0,d=isLE?-1:1,s=buffer[offset+i];for(i+=d,e=s&(1<<-nBits)-1,s>>=-nBits,nBits+=eLen;nBits>0;e=256*e+buffer[offset+i],i+=d,nBits-=8);for(m=e&(1<<-nBits)-1,e>>=-nBits,nBits+=mLen;nBits>0;m=256*m+buffer[offset+i],i+=d,nBits-=8);if(0===e)e=1-eBias;else{if(e===eMax)return m?NaN:1/0*(s?-1:1);m+=Math.pow(2,mLen),e-=eBias}return(s?-1:1)*m*Math.pow(2,e-mLen)},exports.write=function(buffer,value,offset,isLE,mLen,nBytes){var e,m,c,eLen=8*nBytes-mLen-1,eMax=(1<<eLen)-1,eBias=eMax>>1,rt=23===mLen?Math.pow(2,-24)-Math.pow(2,-77):0,i=isLE?0:nBytes-1,d=isLE?1:-1,s=value<0||0===value&&1/value<0?1:0;for(value=Math.abs(value),isNaN(value)||value===1/0?(m=isNaN(value)?1:0,e=eMax):(e=Math.floor(Math.log(value)/Math.LN2),value*(c=Math.pow(2,-e))<1&&(e--,c*=2),(value+=e+eBias>=1?rt/c:rt*Math.pow(2,1-eBias))*c>=2&&(e++,c/=2),e+eBias>=eMax?(m=0,e=eMax):e+eBias>=1?(m=(value*c-1)*Math.pow(2,mLen),e+=eBias):(m=value*Math.pow(2,eBias-1)*Math.pow(2,mLen),e=0));mLen>=8;buffer[offset+i]=255&m,i+=d,m/=256,mLen-=8);for(e=e<<mLen|m,eLen+=mLen;eLen>0;buffer[offset+i]=255&e,i+=d,e/=256,eLen-=8);buffer[offset+i-d]|=128*s}},{}],25:[function(_dereq_,module,exports){'function'==typeof Object.create?module.exports=function(ctor,superCtor){superCtor&&(ctor.super_=superCtor,ctor.prototype=Object.create(superCtor.prototype,{ constructor:{ value:ctor,enumerable:!1,writable:!0,configurable:!0 } }))}:module.exports=function(ctor,superCtor){if(superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype,ctor.prototype=new TempCtor,ctor.prototype.constructor=ctor}}},{}],26:[function(_dereq_,module,exports){function isBuffer(obj){return!!obj.constructor&&'function'==typeof obj.constructor.isBuffer&&obj.constructor.isBuffer(obj)}module.exports=function(obj){return null!=obj&&(isBuffer(obj)||function(obj){return'function'==typeof obj.readFloatLE&&'function'==typeof obj.slice&&isBuffer(obj.slice(0,0))}(obj)||!!obj._isBuffer)}},{}],27:[function(_dereq_,module,exports){var crypt,utf8,isBuffer,bin,md5;crypt=_dereq_(21),utf8=_dereq_(20).utf8,isBuffer=_dereq_(26),bin=_dereq_(20).bin,(md5=function(message,options){message.constructor==String?message=options&&'binary'===options.encoding?bin.stringToBytes(message):utf8.stringToBytes(message):isBuffer(message)?message=Array.prototype.slice.call(message,0):Array.isArray(message)||(message=message.toString());for(var m=crypt.bytesToWords(message),l=8*message.length,a=1732584193,b=-271733879,c=-1732584194,d=271733878,i=0;i<m.length;i++)m[i]=16711935&(m[i]<<8|m[i]>>>24)|4278255360&(m[i]<<24|m[i]>>>8);m[l>>>5]|=128<<l%32,m[14+(l+64>>>9<<4)]=l;var FF=md5._ff,GG=md5._gg,HH=md5._hh,II=md5._ii;for(i=0;i<m.length;i+=16){var aa=a,bb=b,cc=c,dd=d;b=II(b=II(b=II(b=II(b=HH(b=HH(b=HH(b=HH(b=GG(b=GG(b=GG(b=GG(b=FF(b=FF(b=FF(b=FF(b,c=FF(c,d=FF(d,a=FF(a,b,c,d,m[i+0],7,-680876936),b,c,m[i+1],12,-389564586),a,b,m[i+2],17,606105819),d,a,m[i+3],22,-1044525330),c=FF(c,d=FF(d,a=FF(a,b,c,d,m[i+4],7,-176418897),b,c,m[i+5],12,1200080426),a,b,m[i+6],17,-1473231341),d,a,m[i+7],22,-45705983),c=FF(c,d=FF(d,a=FF(a,b,c,d,m[i+8],7,1770035416),b,c,m[i+9],12,-1958414417),a,b,m[i+10],17,-42063),d,a,m[i+11],22,-1990404162),c=FF(c,d=FF(d,a=FF(a,b,c,d,m[i+12],7,1804603682),b,c,m[i+13],12,-40341101),a,b,m[i+14],17,-1502002290),d,a,m[i+15],22,1236535329),c=GG(c,d=GG(d,a=GG(a,b,c,d,m[i+1],5,-165796510),b,c,m[i+6],9,-1069501632),a,b,m[i+11],14,643717713),d,a,m[i+0],20,-373897302),c=GG(c,d=GG(d,a=GG(a,b,c,d,m[i+5],5,-701558691),b,c,m[i+10],9,38016083),a,b,m[i+15],14,-660478335),d,a,m[i+4],20,-405537848),c=GG(c,d=GG(d,a=GG(a,b,c,d,m[i+9],5,568446438),b,c,m[i+14],9,-1019803690),a,b,m[i+3],14,-187363961),d,a,m[i+8],20,1163531501),c=GG(c,d=GG(d,a=GG(a,b,c,d,m[i+13],5,-1444681467),b,c,m[i+2],9,-51403784),a,b,m[i+7],14,1735328473),d,a,m[i+12],20,-1926607734),c=HH(c,d=HH(d,a=HH(a,b,c,d,m[i+5],4,-378558),b,c,m[i+8],11,-2022574463),a,b,m[i+11],16,1839030562),d,a,m[i+14],23,-35309556),c=HH(c,d=HH(d,a=HH(a,b,c,d,m[i+1],4,-1530992060),b,c,m[i+4],11,1272893353),a,b,m[i+7],16,-155497632),d,a,m[i+10],23,-1094730640),c=HH(c,d=HH(d,a=HH(a,b,c,d,m[i+13],4,681279174),b,c,m[i+0],11,-358537222),a,b,m[i+3],16,-722521979),d,a,m[i+6],23,76029189),c=HH(c,d=HH(d,a=HH(a,b,c,d,m[i+9],4,-640364487),b,c,m[i+12],11,-421815835),a,b,m[i+15],16,530742520),d,a,m[i+2],23,-995338651),c=II(c,d=II(d,a=II(a,b,c,d,m[i+0],6,-198630844),b,c,m[i+7],10,1126891415),a,b,m[i+14],15,-1416354905),d,a,m[i+5],21,-57434055),c=II(c,d=II(d,a=II(a,b,c,d,m[i+12],6,1700485571),b,c,m[i+3],10,-1894986606),a,b,m[i+10],15,-1051523),d,a,m[i+1],21,-2054922799),c=II(c,d=II(d,a=II(a,b,c,d,m[i+8],6,1873313359),b,c,m[i+15],10,-30611744),a,b,m[i+6],15,-1560198380),d,a,m[i+13],21,1309151649),c=II(c,d=II(d,a=II(a,b,c,d,m[i+4],6,-145523070),b,c,m[i+11],10,-1120210379),a,b,m[i+2],15,718787259),d,a,m[i+9],21,-343485551),a=a+aa>>>0,b=b+bb>>>0,c=c+cc>>>0,d=d+dd>>>0}return crypt.endian([a,b,c,d])})._ff=function(a,b,c,d,x,s,t){var n=a+(b&c|~b&d)+(x>>>0)+t;return(n<<s|n>>>32-s)+b},md5._gg=function(a,b,c,d,x,s,t){var n=a+(b&d|c&~d)+(x>>>0)+t;return(n<<s|n>>>32-s)+b},md5._hh=function(a,b,c,d,x,s,t){var n=a+(b^c^d)+(x>>>0)+t;return(n<<s|n>>>32-s)+b},md5._ii=function(a,b,c,d,x,s,t){var n=a+(c^(b|~d))+(x>>>0)+t;return(n<<s|n>>>32-s)+b},md5._blocksize=16,md5._digestsize=16,module.exports=function(message,options){if(void 0===message||null===message)throw new Error('Illegal argument '+message);var digestbytes=crypt.wordsToBytes(md5(message,options));return options&&options.asBytes?digestbytes:options&&options.asString?bin.bytesToString(digestbytes):crypt.bytesToHex(digestbytes)}},{ 20:20,21:21,26:26 }],28:[function(_dereq_,module,exports){var cachedSetTimeout,cachedClearTimeout,process=module.exports={};function defaultSetTimout(){throw new Error('setTimeout has not been defined')}function defaultClearTimeout(){throw new Error('clearTimeout has not been defined')}function runTimeout(fun){if(cachedSetTimeout===setTimeout)return setTimeout(fun,0);if((cachedSetTimeout===defaultSetTimout||!cachedSetTimeout)&&setTimeout)return cachedSetTimeout=setTimeout,setTimeout(fun,0);try{return cachedSetTimeout(fun,0)}catch(e){try{return cachedSetTimeout.call(null,fun,0)}catch(e){return cachedSetTimeout.call(this,fun,0)}}}!function(){try{cachedSetTimeout='function'==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){cachedSetTimeout=defaultSetTimout}try{cachedClearTimeout='function'==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){cachedClearTimeout=defaultClearTimeout}}();var currentQueue,queue=[],draining=!1,queueIndex=-1;function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var timeout=runTimeout(cleanUpNextTick);draining=!0;for(var len=queue.length;len;){for(currentQueue=queue,queue=[];++queueIndex<len;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,len=queue.length}currentQueue=null,draining=!1,function(marker){if(cachedClearTimeout===clearTimeout)return clearTimeout(marker);if((cachedClearTimeout===defaultClearTimeout||!cachedClearTimeout)&&clearTimeout)return cachedClearTimeout=clearTimeout,clearTimeout(marker);try{cachedClearTimeout(marker)}catch(e){try{return cachedClearTimeout.call(null,marker)}catch(e){return cachedClearTimeout.call(this,marker)}}}(timeout)}}function Item(fun,array){this.fun=fun,this.array=array}function noop(){}process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args)),1!==queue.length||draining||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title='browser',process.browser=!0,process.env={},process.argv=[],process.version='',process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.prependListener=noop,process.prependOnceListener=noop,process.listeners=function(name){return[]},process.binding=function(name){throw new Error('process.binding is not supported')},process.cwd=function(){return'/'},process.chdir=function(dir){throw new Error('process.chdir is not supported')},process.umask=function(){return 0}},{}],29:[function(_dereq_,module,exports){(function(global){!function(root){var freeExports='object'==typeof exports&&exports&&!exports.nodeType&&exports,freeModule='object'==typeof module&&module&&!module.nodeType&&module,freeGlobal='object'==typeof global&&global;freeGlobal.global!==freeGlobal&&freeGlobal.window!==freeGlobal&&freeGlobal.self!==freeGlobal||(root=freeGlobal);var punycode,key,maxInt=2147483647,base=36,tMin=1,tMax=26,skew=38,damp=700,initialBias=72,initialN=128,delimiter='-',regexPunycode=/^xn--/,regexNonASCII=/[^\x20-\x7E]/,regexSeparators=/[\x2E\u3002\uFF0E\uFF61]/g,errors={ overflow:'Overflow: input needs wider integers to process','not-basic':'Illegal input >= 0x80 (not a basic code point)','invalid-input':'Invalid input' },baseMinusTMin=base-tMin,floor=Math.floor,stringFromCharCode=String.fromCharCode;function error(type){throw new RangeError(errors[type])}function map(array,fn){for(var length=array.length,result=[];length--;)result[length]=fn(array[length]);return result}function mapDomain(string,fn){var parts=string.split('@'),result='';return parts.length>1&&(result=parts[0]+'@',string=parts[1]),result+map((string=string.replace(regexSeparators,'.')).split('.'),fn).join('.')}function ucs2decode(string){for(var value,extra,output=[],counter=0,length=string.length;counter<length;)(value=string.charCodeAt(counter++))>=55296&&value<=56319&&counter<length?56320==(64512&(extra=string.charCodeAt(counter++)))?output.push(((1023&value)<<10)+(1023&extra)+65536):(output.push(value),counter--):output.push(value);return output}function ucs2encode(array){return map(array,function(value){var output='';return value>65535&&(output+=stringFromCharCode((value-=65536)>>>10&1023|55296),value=56320|1023&value),output+=stringFromCharCode(value)}).join('')}function digitToBasic(digit,flag){return digit+22+75*(digit<26)-((0!=flag)<<5)}function adapt(delta,numPoints,firstTime){var k=0;for(delta=firstTime?floor(delta/damp):delta>>1,delta+=floor(delta/numPoints);delta>baseMinusTMin*tMax>>1;k+=base)delta=floor(delta/baseMinusTMin);return floor(k+(baseMinusTMin+1)*delta/(delta+skew))}function decode(input){var out,basic,j,index,oldi,w,k,digit,t,baseMinusT,codePoint,output=[],inputLength=input.length,i=0,n=initialN,bias=initialBias;for((basic=input.lastIndexOf(delimiter))<0&&(basic=0),j=0;j<basic;++j)input.charCodeAt(j)>=128&&error('not-basic'),output.push(input.charCodeAt(j));for(index=basic>0?basic+1:0;index<inputLength;){for(oldi=i,w=1,k=base;index>=inputLength&&error('invalid-input'),((digit=(codePoint=input.charCodeAt(index++))-48<10?codePoint-22:codePoint-65<26?codePoint-65:codePoint-97<26?codePoint-97:base)>=base||digit>floor((maxInt-i)/w))&&error('overflow'),i+=digit*w,!(digit<(t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias));k+=base)w>floor(maxInt/(baseMinusT=base-t))&&error('overflow'),w*=baseMinusT;bias=adapt(i-oldi,out=output.length+1,0==oldi),floor(i/out)>maxInt-n&&error('overflow'),n+=floor(i/out),i%=out,output.splice(i++,0,n)}return ucs2encode(output)}function encode(input){var n,delta,handledCPCount,basicLength,bias,j,m,q,k,t,currentValue,inputLength,handledCPCountPlusOne,baseMinusT,qMinusT,output=[];for(inputLength=(input=ucs2decode(input)).length,n=initialN,delta=0,bias=initialBias,j=0;j<inputLength;++j)(currentValue=input[j])<128&&output.push(stringFromCharCode(currentValue));for(handledCPCount=basicLength=output.length,basicLength&&output.push(delimiter);handledCPCount<inputLength;){for(m=maxInt,j=0;j<inputLength;++j)(currentValue=input[j])>=n&&currentValue<m&&(m=currentValue);for(m-n>floor((maxInt-delta)/(handledCPCountPlusOne=handledCPCount+1))&&error('overflow'),delta+=(m-n)*handledCPCountPlusOne,n=m,j=0;j<inputLength;++j)if((currentValue=input[j])<n&&++delta>maxInt&&error('overflow'),currentValue==n){for(q=delta,k=base;!(q<(t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias));k+=base)qMinusT=q-t,baseMinusT=base-t,output.push(stringFromCharCode(digitToBasic(t+qMinusT%baseMinusT,0))),q=floor(qMinusT/baseMinusT);output.push(stringFromCharCode(digitToBasic(q,0))),bias=adapt(delta,handledCPCountPlusOne,handledCPCount==basicLength),delta=0,++handledCPCount}++delta,++n}return output.join('')}if(punycode={ version:'1.4.1',ucs2:{ decode:ucs2decode,encode:ucs2encode },decode:decode,encode:encode,toASCII:function(input){return mapDomain(input,function(string){return regexNonASCII.test(string)?'xn--'+encode(string):string})},toUnicode:function(input){return mapDomain(input,function(string){return regexPunycode.test(string)?decode(string.slice(4).toLowerCase()):string})} },freeExports&&freeModule)if(module.exports==freeExports)freeModule.exports=punycode;else for(key in punycode)punycode.hasOwnProperty(key)&&(freeExports[key]=punycode[key]);else root.punycode=punycode}(this)}).call(this,'undefined'!=typeof global?global:'undefined'!=typeof self?self:'undefined'!=typeof window?window:{})},{}],30:[function(_dereq_,module,exports){'use strict';function hasOwnProperty(obj,prop){return Object.prototype.hasOwnProperty.call(obj,prop)}module.exports=function(qs,sep,eq,options){sep=sep||'&',eq=eq||'=';var obj={};if('string'!=typeof qs||0===qs.length)return obj;var regexp=/\+/g;qs=qs.split(sep);var maxKeys=1e3;options&&'number'==typeof options.maxKeys&&(maxKeys=options.maxKeys);var len=qs.length;maxKeys>0&&len>maxKeys&&(len=maxKeys);for(var i=0;i<len;++i){var kstr,vstr,k,v,x=qs[i].replace(regexp,'%20'),idx=x.indexOf(eq);idx>=0?(kstr=x.substr(0,idx),vstr=x.substr(idx+1)):(kstr=x,vstr=''),k=decodeURIComponent(kstr),v=decodeURIComponent(vstr),hasOwnProperty(obj,k)?isArray(obj[k])?obj[k].push(v):obj[k]=[obj[k],v]:obj[k]=v}return obj};var isArray=Array.isArray||function(xs){return'[object Array]'===Object.prototype.toString.call(xs)}},{}],31:[function(_dereq_,module,exports){'use strict';var stringifyPrimitive=function(v){switch(typeof v){case'string':return v;case'boolean':return v?'true':'false';case'number':return isFinite(v)?v:'';default:return''}};module.exports=function(obj,sep,eq,name){return sep=sep||'&',eq=eq||'=',null===obj&&(obj=void 0),'object'==typeof obj?map(objectKeys(obj),function(k){var ks=encodeURIComponent(stringifyPrimitive(k))+eq;return isArray(obj[k])?map(obj[k],function(v){return ks+encodeURIComponent(stringifyPrimitive(v))}).join(sep):ks+encodeURIComponent(stringifyPrimitive(obj[k]))}).join(sep):name?encodeURIComponent(stringifyPrimitive(name))+eq+encodeURIComponent(stringifyPrimitive(obj)):''};var isArray=Array.isArray||function(xs){return'[object Array]'===Object.prototype.toString.call(xs)};function map(xs,f){if(xs.map)return xs.map(f);for(var res=[],i=0;i<xs.length;i++)res.push(f(xs[i],i));return res}var objectKeys=Object.keys||function(obj){var res=[];for(var key in obj)Object.prototype.hasOwnProperty.call(obj,key)&&res.push(key);return res}},{}],32:[function(_dereq_,module,exports){'use strict';exports.decode=exports.parse=_dereq_(30),exports.encode=exports.stringify=_dereq_(31)},{ 30:30,31:31 }],33:[function(_dereq_,module,exports){!function(global){'use strict';var undefined,Op=Object.prototype,hasOwn=Op.hasOwnProperty,$Symbol='function'==typeof Symbol?Symbol:{},iteratorSymbol=$Symbol.iterator||'@@iterator',asyncIteratorSymbol=$Symbol.asyncIterator||'@@asyncIterator',toStringTagSymbol=$Symbol.toStringTag||'@@toStringTag',inModule='object'==typeof module,runtime=global.regeneratorRuntime;if(runtime)inModule&&(module.exports=runtime);else{(runtime=global.regeneratorRuntime=inModule?module.exports:{}).wrap=wrap;var GenStateSuspendedStart='suspendedStart',GenStateSuspendedYield='suspendedYield',GenStateExecuting='executing',GenStateCompleted='completed',ContinueSentinel={},IteratorPrototype={};IteratorPrototype[iteratorSymbol]=function(){return this};var getProto=Object.getPrototypeOf,NativeIteratorPrototype=getProto&&getProto(getProto(values([])));NativeIteratorPrototype&&NativeIteratorPrototype!==Op&&hasOwn.call(NativeIteratorPrototype,iteratorSymbol)&&(IteratorPrototype=NativeIteratorPrototype);var Gp=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(IteratorPrototype);GeneratorFunction.prototype=Gp.constructor=GeneratorFunctionPrototype,GeneratorFunctionPrototype.constructor=GeneratorFunction,GeneratorFunctionPrototype[toStringTagSymbol]=GeneratorFunction.displayName='GeneratorFunction',runtime.isGeneratorFunction=function(genFun){var ctor='function'==typeof genFun&&genFun.constructor;return!!ctor&&(ctor===GeneratorFunction||'GeneratorFunction'===(ctor.displayName||ctor.name))},runtime.mark=function(genFun){return Object.setPrototypeOf?Object.setPrototypeOf(genFun,GeneratorFunctionPrototype):(genFun.__proto__=GeneratorFunctionPrototype,toStringTagSymbol in genFun||(genFun[toStringTagSymbol]='GeneratorFunction')),genFun.prototype=Object.create(Gp),genFun},runtime.awrap=function(arg){return{ __await:arg }},defineIteratorMethods(AsyncIterator.prototype),AsyncIterator.prototype[asyncIteratorSymbol]=function(){return this},runtime.AsyncIterator=AsyncIterator,runtime.async=function(innerFn,outerFn,self,tryLocsList){var iter=new AsyncIterator(wrap(innerFn,outerFn,self,tryLocsList));return runtime.isGeneratorFunction(outerFn)?iter:iter.next().then(function(result){return result.done?result.value:iter.next()})},defineIteratorMethods(Gp),Gp[toStringTagSymbol]='Generator',Gp[iteratorSymbol]=function(){return this},Gp.toString=function(){return'[object Generator]'},runtime.keys=function(object){var keys=[];for(var key in object)keys.push(key);return keys.reverse(),function next(){for(;keys.length;){var key=keys.pop();if(key in object)return next.value=key,next.done=!1,next}return next.done=!0,next}},runtime.values=values,Context.prototype={ constructor:Context,reset:function(skipTempReset){if(this.prev=0,this.next=0,this.sent=this._sent=undefined,this.done=!1,this.delegate=null,this.method='next',this.arg=undefined,this.tryEntries.forEach(resetTryEntry),!skipTempReset)for(var name in this)'t'===name.charAt(0)&&hasOwn.call(this,name)&&!isNaN(+name.slice(1))&&(this[name]=undefined)},stop:function(){this.done=!0;var rootRecord=this.tryEntries[0].completion;if('throw'===rootRecord.type)throw rootRecord.arg;return this.rval},dispatchException:function(exception){if(this.done)throw exception;var context=this;function handle(loc,caught){return record.type='throw',record.arg=exception,context.next=loc,caught&&(context.method='next',context.arg=undefined),!!caught}for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i],record=entry.completion;if('root'===entry.tryLoc)return handle('end');if(entry.tryLoc<=this.prev){var hasCatch=hasOwn.call(entry,'catchLoc'),hasFinally=hasOwn.call(entry,'finallyLoc');if(hasCatch&&hasFinally){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0);if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc)}else if(hasCatch){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0)}else{if(!hasFinally)throw new Error('try statement without catch or finally');if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc)}}}},abrupt:function(type,arg){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc<=this.prev&&hasOwn.call(entry,'finallyLoc')&&this.prev<entry.finallyLoc){var finallyEntry=entry;break}}finallyEntry&&('break'===type||'continue'===type)&&finallyEntry.tryLoc<=arg&&arg<=finallyEntry.finallyLoc&&(finallyEntry=null);var record=finallyEntry?finallyEntry.completion:{};return record.type=type,record.arg=arg,finallyEntry?(this.method='next',this.next=finallyEntry.finallyLoc,ContinueSentinel):this.complete(record)},complete:function(record,afterLoc){if('throw'===record.type)throw record.arg;return'break'===record.type||'continue'===record.type?this.next=record.arg:'return'===record.type?(this.rval=this.arg=record.arg,this.method='return',this.next='end'):'normal'===record.type&&afterLoc&&(this.next=afterLoc),ContinueSentinel},finish:function(finallyLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.finallyLoc===finallyLoc)return this.complete(entry.completion,entry.afterLoc),resetTryEntry(entry),ContinueSentinel}},catch:function(tryLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc===tryLoc){var record=entry.completion;if('throw'===record.type){var thrown=record.arg;resetTryEntry(entry)}return thrown}}throw new Error('illegal catch attempt')},delegateYield:function(iterable,resultName,nextLoc){return this.delegate={ iterator:values(iterable),resultName:resultName,nextLoc:nextLoc },'next'===this.method&&(this.arg=undefined),ContinueSentinel} }}function wrap(innerFn,outerFn,self,tryLocsList){var protoGenerator=outerFn&&outerFn.prototype instanceof Generator?outerFn:Generator,generator=Object.create(protoGenerator.prototype),context=new Context(tryLocsList||[]);return generator._invoke=function(innerFn,self,context){var state=GenStateSuspendedStart;return function(method,arg){if(state===GenStateExecuting)throw new Error('Generator is already running');if(state===GenStateCompleted){if('throw'===method)throw arg;return doneResult()}for(context.method=method,context.arg=arg;;){var delegate=context.delegate;if(delegate){var delegateResult=maybeInvokeDelegate(delegate,context);if(delegateResult){if(delegateResult===ContinueSentinel)continue;return delegateResult}}if('next'===context.method)context.sent=context._sent=context.arg;else if('throw'===context.method){if(state===GenStateSuspendedStart)throw state=GenStateCompleted,context.arg;context.dispatchException(context.arg)}else'return'===context.method&&context.abrupt('return',context.arg);state=GenStateExecuting;var record=tryCatch(innerFn,self,context);if('normal'===record.type){if(state=context.done?GenStateCompleted:GenStateSuspendedYield,record.arg===ContinueSentinel)continue;return{ value:record.arg,done:context.done }}'throw'===record.type&&(state=GenStateCompleted,context.method='throw',context.arg=record.arg)}}}(innerFn,self,context),generator}function tryCatch(fn,obj,arg){try{return{ type:'normal',arg:fn.call(obj,arg) }}catch(err){return{ type:'throw',arg:err }}}function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}function defineIteratorMethods(prototype){['next','throw','return'].forEach(function(method){prototype[method]=function(arg){return this._invoke(method,arg)}})}function AsyncIterator(generator){var previousPromise;this._invoke=function(method,arg){function callInvokeWithMethodAndArg(){return new Promise(function(resolve,reject){!function invoke(method,arg,resolve,reject){var record=tryCatch(generator[method],generator,arg);if('throw'!==record.type){var result=record.arg,value=result.value;return value&&'object'==typeof value&&hasOwn.call(value,'__await')?Promise.resolve(value.__await).then(function(value){invoke('next',value,resolve,reject)},function(err){invoke('throw',err,resolve,reject)}):Promise.resolve(value).then(function(unwrapped){result.value=unwrapped,resolve(result)},reject)}reject(record.arg)}(method,arg,resolve,reject)})}return previousPromise=previousPromise?previousPromise.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}}function maybeInvokeDelegate(delegate,context){var method=delegate.iterator[context.method];if(method===undefined){if(context.delegate=null,'throw'===context.method){if(delegate.iterator.return&&(context.method='return',context.arg=undefined,maybeInvokeDelegate(delegate,context),'throw'===context.method))return ContinueSentinel;context.method='throw',context.arg=new TypeError("The iterator does not provide a 'throw' method")}return ContinueSentinel}var record=tryCatch(method,delegate.iterator,context.arg);if('throw'===record.type)return context.method='throw',context.arg=record.arg,context.delegate=null,ContinueSentinel;var info=record.arg;return info?info.done?(context[delegate.resultName]=info.value,context.next=delegate.nextLoc,'return'!==context.method&&(context.method='next',context.arg=undefined),context.delegate=null,ContinueSentinel):info:(context.method='throw',context.arg=new TypeError('iterator result is not an object'),context.delegate=null,ContinueSentinel)}function pushTryEntry(locs){var entry={ tryLoc:locs[0] };1 in locs&&(entry.catchLoc=locs[1]),2 in locs&&(entry.finallyLoc=locs[2],entry.afterLoc=locs[3]),this.tryEntries.push(entry)}function resetTryEntry(entry){var record=entry.completion||{};record.type='normal',delete record.arg,entry.completion=record}function Context(tryLocsList){this.tryEntries=[{ tryLoc:'root' }],tryLocsList.forEach(pushTryEntry,this),this.reset(!0)}function values(iterable){if(iterable){var iteratorMethod=iterable[iteratorSymbol];if(iteratorMethod)return iteratorMethod.call(iterable);if('function'==typeof iterable.next)return iterable;if(!isNaN(iterable.length)){var i=-1,next=function next(){for(;++i<iterable.length;)if(hasOwn.call(iterable,i))return next.value=iterable[i],next.done=!1,next;return next.value=undefined,next.done=!0,next};return next.next=next}}return{ next:doneResult }}function doneResult(){return{ value:undefined,done:!0 }}}(function(){return this}()||Function('return this')())},{}],34:[function(_dereq_,module,exports){var buffer=_dereq_(18),Buffer=buffer.Buffer;function copyProps(src,dst){for(var key in src)dst[key]=src[key]}function SafeBuffer(arg,encodingOrOffset,length){return Buffer(arg,encodingOrOffset,length)}Buffer.from&&Buffer.alloc&&Buffer.allocUnsafe&&Buffer.allocUnsafeSlow?module.exports=buffer:(copyProps(buffer,exports),exports.Buffer=SafeBuffer),copyProps(Buffer,SafeBuffer),SafeBuffer.from=function(arg,encodingOrOffset,length){if('number'==typeof arg)throw new TypeError('Argument must not be a number');return Buffer(arg,encodingOrOffset,length)},SafeBuffer.alloc=function(size,fill,encoding){if('number'!=typeof size)throw new TypeError('Argument must be a number');var buf=Buffer(size);return void 0!==fill?'string'==typeof encoding?buf.fill(fill,encoding):buf.fill(fill):buf.fill(0),buf},SafeBuffer.allocUnsafe=function(size){if('number'!=typeof size)throw new TypeError('Argument must be a number');return Buffer(size)},SafeBuffer.allocUnsafeSlow=function(size){if('number'!=typeof size)throw new TypeError('Argument must be a number');return buffer.SlowBuffer(size)}},{ 18:18 }],35:[function(_dereq_,module,exports){(function(global){var ClientRequest=_dereq_(37),response=_dereq_(38),extend=_dereq_(63),statusCodes=_dereq_(19),url=_dereq_(55),http=exports;http.request=function(opts,cb){opts='string'==typeof opts?url.parse(opts):extend(opts);var defaultProtocol=-1===global.location.protocol.search(/^https?:$/)?'http:':'',protocol=opts.protocol||defaultProtocol,host=opts.hostname||opts.host,port=opts.port,path=opts.path||'/';host&&-1!==host.indexOf(':')&&(host='['+host+']'),opts.url=(host?protocol+'//'+host:'')+(port?':'+port:'')+path,opts.method=(opts.method||'GET').toUpperCase(),opts.headers=opts.headers||{};var req=new ClientRequest(opts);return cb&&req.on('response',cb),req},http.get=function(opts,cb){var req=http.request(opts,cb);return req.end(),req},http.ClientRequest=ClientRequest,http.IncomingMessage=response.IncomingMessage,http.Agent=function(){},http.Agent.defaultMaxSockets=4,http.globalAgent=new http.Agent,http.STATUS_CODES=statusCodes,http.METHODS=['CHECKOUT','CONNECT','COPY','DELETE','GET','HEAD','LOCK','M-SEARCH','MERGE','MKACTIVITY','MKCOL','MOVE','NOTIFY','OPTIONS','PATCH','POST','PROPFIND','PROPPATCH','PURGE','PUT','REPORT','SEARCH','SUBSCRIBE','TRACE','UNLOCK','UNSUBSCRIBE']}).call(this,'undefined'!=typeof global?global:'undefined'!=typeof self?self:'undefined'!=typeof window?window:{})},{ 19:19,37:37,38:38,55:55,63:63 }],36:[function(_dereq_,module,exports){(function(global){var xhr;function getXHR(){if(void 0!==xhr)return xhr;if(global.XMLHttpRequest){xhr=new global.XMLHttpRequest;try{xhr.open('GET',global.XDomainRequest?'/':'https://example.com')}catch(e){xhr=null}}else xhr=null;return xhr}function checkTypeSupport(type){var xhr=getXHR();if(!xhr)return!1;try{return xhr.responseType=type,xhr.responseType===type}catch(e){}return!1}function isFunction(value){return'function'==typeof value}exports.fetch=isFunction(global.fetch)&&isFunction(global.ReadableStream),exports.writableStream=isFunction(global.WritableStream),exports.abortController=isFunction(global.AbortController),exports.arraybuffer=exports.fetch||checkTypeSupport('arraybuffer'),exports.msstream=!exports.fetch&&checkTypeSupport('ms-stream'),exports.mozchunkedarraybuffer=!exports.fetch&&checkTypeSupport('moz-chunked-arraybuffer'),exports.overrideMimeType=exports.fetch||!!getXHR()&&isFunction(getXHR().overrideMimeType),xhr=null}).call(this,'undefined'!=typeof global?global:'undefined'!=typeof self?self:'undefined'!=typeof window?window:{})},{}],37:[function(_dereq_,module,exports){(function(process,global,Buffer){var capability=_dereq_(36),inherits=_dereq_(25),response=_dereq_(38),stream=_dereq_(53),IncomingMessage=response.IncomingMessage,rStates=response.readyStates;var ClientRequest=module.exports=function(opts){var preferBinary,self=this;stream.Writable.call(self),self._opts=opts,self._body=[],self._headers={},opts.auth&&self.setHeader('Authorization','Basic '+Buffer.from(opts.auth).toString('base64')),Object.keys(opts.headers).forEach(function(name){self.setHeader(name,opts.headers[name])});var useFetch=!0;if('disable-fetch'===opts.mode||'requestTimeout'in opts&&!capability.abortController)useFetch=!1,preferBinary=!0;else if('prefer-streaming'===opts.mode)preferBinary=!1;else if('allow-wrong-content-type'===opts.mode)preferBinary=!capability.overrideMimeType;else{if(opts.mode&&'default'!==opts.mode&&'prefer-fast'!==opts.mode)throw new Error('Invalid value for opts.mode');preferBinary=!0}self._mode=function(preferBinary,useFetch){return capability.fetch&&useFetch?'fetch':capability.mozchunkedarraybuffer?'moz-chunked-arraybuffer':capability.msstream?'ms-stream':capability.arraybuffer&&preferBinary?'arraybuffer':'text'}(preferBinary,useFetch),self._fetchTimer=null,self.on('finish',function(){self._onFinish()})};inherits(ClientRequest,stream.Writable),ClientRequest.prototype.setHeader=function(name,value){var lowerName=name.toLowerCase();-1===unsafeHeaders.indexOf(lowerName)&&(this._headers[lowerName]={ name:name,value:value })},ClientRequest.prototype.getHeader=function(name){var header=this._headers[name.toLowerCase()];return header?header.value:null},ClientRequest.prototype.removeHeader=function(name){delete this._headers[name.toLowerCase()]},ClientRequest.prototype._onFinish=function(){var self=this;if(!self._destroyed){var opts=self._opts,headersObj=self._headers,body=null;'GET'!==opts.method&&'HEAD'!==opts.method&&(body=new Blob(self._body,{ type:(headersObj['content-type']||{}).value||'' }));var headersList=[];if(Object.keys(headersObj).forEach(function(keyName){var name=headersObj[keyName].name,value=headersObj[keyName].value;Array.isArray(value)?value.forEach(function(v){headersList.push([name,v])}):headersList.push([name,value])}),'fetch'===self._mode){var signal=null;if(capability.abortController){var controller=new AbortController;signal=controller.signal,self._fetchAbortController=controller,'requestTimeout'in opts&&0!==opts.requestTimeout&&(self._fetchTimer=global.setTimeout(function(){self.emit('requestTimeout'),self._fetchAbortController&&self._fetchAbortController.abort()},opts.requestTimeout))}global.fetch(self._opts.url,{ method:self._opts.method,headers:headersList,body:body||void 0,mode:'cors',credentials:opts.withCredentials?'include':'same-origin',signal:signal }).then(function(response){self._fetchResponse=response,self._connect()},function(reason){global.clearTimeout(self._fetchTimer),self._destroyed||self.emit('error',reason)})}else{var xhr=self._xhr=new global.XMLHttpRequest;try{xhr.open(self._opts.method,self._opts.url,!0)}catch(err){return void process.nextTick(function(){self.emit('error',err)})}'responseType'in xhr&&(xhr.responseType=self._mode),'withCredentials'in xhr&&(xhr.withCredentials=!!opts.withCredentials),'text'===self._mode&&'overrideMimeType'in xhr&&xhr.overrideMimeType('text/plain; charset=x-user-defined'),'requestTimeout'in opts&&(xhr.timeout=opts.requestTimeout,xhr.ontimeout=function(){self.emit('requestTimeout')}),headersList.forEach(function(header){xhr.setRequestHeader(header[0],header[1])}),self._response=null,xhr.onreadystatechange=function(){switch(xhr.readyState){case rStates.LOADING:case rStates.DONE:self._onXHRProgress()}},'moz-chunked-arraybuffer'===self._mode&&(xhr.onprogress=function(){self._onXHRProgress()}),xhr.onerror=function(){self._destroyed||self.emit('error',new Error('XHR error'))};try{xhr.send(body)}catch(err){return void process.nextTick(function(){self.emit('error',err)})}}}},ClientRequest.prototype._onXHRProgress=function(){(function(xhr){try{var status=xhr.status;return null!==status&&0!==status}catch(e){return!1}})(this._xhr)&&!this._destroyed&&(this._response||this._connect(),this._response._onXHRProgress())},ClientRequest.prototype._connect=function(){var self=this;self._destroyed||(self._response=new IncomingMessage(self._xhr,self._fetchResponse,self._mode,self._fetchTimer),self._response.on('error',function(err){self.emit('error',err)}),self.emit('response',self._response))},ClientRequest.prototype._write=function(chunk,encoding,cb){this._body.push(chunk),cb()},ClientRequest.prototype.abort=ClientRequest.prototype.destroy=function(){this._destroyed=!0,global.clearTimeout(this._fetchTimer),this._response&&(this._response._destroyed=!0),this._xhr?this._xhr.abort():this._fetchAbortController&&this._fetchAbortController.abort()},ClientRequest.prototype.end=function(data,encoding,cb){'function'==typeof data&&(cb=data,data=void 0),stream.Writable.prototype.end.call(this,data,encoding,cb)},ClientRequest.prototype.flushHeaders=function(){},ClientRequest.prototype.setTimeout=function(){},ClientRequest.prototype.setNoDelay=function(){},ClientRequest.prototype.setSocketKeepAlive=function(){};var unsafeHeaders=['accept-charset','accept-encoding','access-control-request-headers','access-control-request-method','connection','content-length','cookie','cookie2','date','dnt','expect','host','keep-alive','origin','referer','te','trailer','transfer-encoding','upgrade','via']}).call(this,_dereq_(28),'undefined'!=typeof global?global:'undefined'!=typeof self?self:'undefined'!=typeof window?window:{},_dereq_(18).Buffer)},{ 18:18,25:25,28:28,36:36,38:38,53:53 }],38:[function(_dereq_,module,exports){(function(process,global,Buffer){var capability=_dereq_(36),inherits=_dereq_(25),stream=_dereq_(53),rStates=exports.readyStates={ UNSENT:0,OPENED:1,HEADERS_RECEIVED:2,LOADING:3,DONE:4 },IncomingMessage=exports.IncomingMessage=function(xhr,response,mode,fetchTimer){var self=this;if(stream.Readable.call(self),self._mode=mode,self.headers={},self.rawHeaders=[],self.trailers={},self.rawTrailers=[],self.on('end',function(){process.nextTick(function(){self.emit('close')})}),'fetch'===mode){if(self._fetchResponse=response,self.url=response.url,self.statusCode=response.status,self.statusMessage=response.statusText,response.headers.forEach(function(header,key){self.headers[key.toLowerCase()]=header,self.rawHeaders.push(key,header)}),capability.writableStream){var writable=new WritableStream({ write:function(chunk){return new Promise(function(resolve,reject){self._destroyed?reject():self.push(Buffer.from(chunk))?resolve():self._resumeFetch=resolve})},close:function(){global.clearTimeout(fetchTimer),self._destroyed||self.push(null)},abort:function(err){self._destroyed||self.emit('error',err)} });try{return void response.body.pipeTo(writable).catch(function(err){global.clearTimeout(fetchTimer),self._destroyed||self.emit('error',err)})}catch(e){}}var reader=response.body.getReader();!function read(){reader.read().then(function(result){if(!self._destroyed){if(result.done)return global.clearTimeout(fetchTimer),void self.push(null);self.push(Buffer.from(result.value)),read()}}).catch(function(err){global.clearTimeout(fetchTimer),self._destroyed||self.emit('error',err)})}()}else{if(self._xhr=xhr,self._pos=0,self.url=xhr.responseURL,self.statusCode=xhr.status,self.statusMessage=xhr.statusText,xhr.getAllResponseHeaders().split(/\r?\n/).forEach(function(header){var matches=header.match(/^([^:]+):\s*(.*)/);if(matches){var key=matches[1].toLowerCase();'set-cookie'===key?(void 0===self.headers[key]&&(self.headers[key]=[]),self.headers[key].push(matches[2])):void 0!==self.headers[key]?self.headers[key]+=', '+matches[2]:self.headers[key]=matches[2],self.rawHeaders.push(matches[1],matches[2])}}),self._charset='x-user-defined',!capability.overrideMimeType){var mimeType=self.rawHeaders['mime-type'];if(mimeType){var charsetMatch=mimeType.match(/;\s*charset=([^;])(;|$)/);charsetMatch&&(self._charset=charsetMatch[1].toLowerCase())}self._charset||(self._charset='utf-8')}}};inherits(IncomingMessage,stream.Readable),IncomingMessage.prototype._read=function(){var resolve=this._resumeFetch;resolve&&(this._resumeFetch=null,resolve())},IncomingMessage.prototype._onXHRProgress=function(){var self=this,xhr=self._xhr,response=null;switch(self._mode){case'text':if((response=xhr.responseText).length>self._pos){var newData=response.substr(self._pos);if('x-user-defined'===self._charset){for(var buffer=Buffer.alloc(newData.length),i=0;i<newData.length;i++)buffer[i]=255&newData.charCodeAt(i);self.push(buffer)}else self.push(newData,self._charset);self._pos=response.length}break;case'arraybuffer':if(xhr.readyState!==rStates.DONE||!xhr.response)break;response=xhr.response,self.push(Buffer.from(new Uint8Array(response)));break;case'moz-chunked-arraybuffer':if(response=xhr.response,xhr.readyState!==rStates.LOADING||!response)break;self.push(Buffer.from(new Uint8Array(response)));break;case'ms-stream':if(response=xhr.response,xhr.readyState!==rStates.LOADING)break;var reader=new global.MSStreamReader;reader.onprogress=function(){reader.result.byteLength>self._pos&&(self.push(Buffer.from(new Uint8Array(reader.result.slice(self._pos)))),self._pos=reader.result.byteLength)},reader.onload=function(){self.push(null)},reader.readAsArrayBuffer(response)}self._xhr.readyState===rStates.DONE&&'ms-stream'!==self._mode&&self.push(null)}}).call(this,_dereq_(28),'undefined'!=typeof global?global:'undefined'!=typeof self?self:'undefined'!=typeof window?window:{},_dereq_(18).Buffer)},{ 18:18,25:25,28:28,36:36,53:53 }],39:[function(_dereq_,module,exports){'use strict';var codes={};function createErrorType(code,message,Base){Base||(Base=Error);var NodeError=function(_Base){var subClass,superClass;function NodeError(arg1,arg2,arg3){return _Base.call(this,function(arg1,arg2,arg3){return'string'==typeof message?message:message(arg1,arg2,arg3)}(arg1,arg2,arg3))||this}return superClass=_Base,(subClass=NodeError).prototype=Object.create(superClass.prototype),subClass.prototype.constructor=subClass,subClass.__proto__=superClass,NodeError}(Base);NodeError.prototype.name=Base.name,NodeError.prototype.code=code,codes[code]=NodeError}function oneOf(expected,thing){if(Array.isArray(expected)){var len=expected.length;return expected=expected.map(function(i){return String(i)}),len>2?'one of '.concat(thing,' ').concat(expected.slice(0,len-1).join(', '),', or ')+expected[len-1]:2===len?'one of '.concat(thing,' ').concat(expected[0],' or ').concat(expected[1]):'of '.concat(thing,' ').concat(expected[0])}return'of '.concat(thing,' ').concat(String(expected))}createErrorType('ERR_INVALID_OPT_VALUE',function(name,value){return'The value "'+value+'" is invalid for option "'+name+'"'},TypeError),createErrorType('ERR_INVALID_ARG_TYPE',function(name,expected,actual){var determiner,search,pos,msg;if('string'==typeof expected&&(search='not ',expected.substr(!pos||pos<0?0:+pos,search.length)===search)?(determiner='must not be',expected=expected.replace(/^not /,'')):determiner='must be',function(str,search,this_len){return(void 0===this_len||this_len>str.length)&&(this_len=str.length),str.substring(this_len-search.length,this_len)===search}(name,' argument'))msg='The '.concat(name,' ').concat(determiner,' ').concat(oneOf(expected,'type'));else{var type=function(str,search,start){return'number'!=typeof start&&(start=0),!(start+search.length>str.length)&&-1!==str.indexOf(search,start)}(name,'.')?'property':'argument';msg='The "'.concat(name,'" ').concat(type,' ').concat(determiner,' ').concat(oneOf(expected,'type'))}return msg+='. Received type '.concat(typeof actual)},TypeError),createErrorType('ERR_STREAM_PUSH_AFTER_EOF','stream.push() after EOF'),createErrorType('ERR_METHOD_NOT_IMPLEMENTED',function(name){return'The '+name+' method is not implemented'}),createErrorType('ERR_STREAM_PREMATURE_CLOSE','Premature close'),createErrorType('ERR_STREAM_DESTROYED',function(name){return'Cannot call '+name+' after a stream was destroyed'}),createErrorType('ERR_MULTIPLE_CALLBACK','Callback called multiple times'),createErrorType('ERR_STREAM_CANNOT_PIPE','Cannot pipe, not readable'),createErrorType('ERR_STREAM_WRITE_AFTER_END','write after end'),createErrorType('ERR_STREAM_NULL_VALUES','May not write null values to stream',TypeError),createErrorType('ERR_UNKNOWN_ENCODING',function(arg){return'Unknown encoding: '+arg},TypeError),createErrorType('ERR_STREAM_UNSHIFT_AFTER_END_EVENT','stream.unshift() after end event'),module.exports.codes=codes},{}],40:[function(_dereq_,module,exports){(function(process){'use strict';var experimentalWarnings=new Set;module.exports.emitExperimentalWarning=process.emitWarning?function(feature){if(!experimentalWarnings.has(feature)){var msg=feature+' is an experimental feature. This feature could change at any time';experimentalWarnings.add(feature),process.emitWarning(msg,'ExperimentalWarning')}}:function(){}}).call(this,_dereq_(28))},{ 28:28 }],41:[function(_dereq_,module,exports){(function(process){'use strict';var objectKeys=Object.keys||function(obj){var keys=[];for(var key in obj)keys.push(key);return keys};module.exports=Duplex;var Readable=_dereq_(43),Writable=_dereq_(45);_dereq_(25)(Duplex,Readable);for(var keys=objectKeys(Writable.prototype),v=0;v<keys.length;v++){var method=keys[v];Duplex.prototype[method]||(Duplex.prototype[method]=Writable.prototype[method])}function Duplex(options){if(!(this instanceof Duplex))return new Duplex(options);Readable.call(this,options),Writable.call(this,options),this.allowHalfOpen=!0,options&&(!1===options.readable&&(this.readable=!1),!1===options.writable&&(this.writable=!1),!1===options.allowHalfOpen&&(this.allowHalfOpen=!1,this.once('end',onend)))}function onend(){this._writableState.ended||process.nextTick(onEndNT,this)}function onEndNT(self){self.end()}Object.defineProperty(Duplex.prototype,'writableHighWaterMark',{ enumerable:!1,get:function(){return this._writableState.highWaterMark} }),Object.defineProperty(Duplex.prototype,'writableBuffer',{ enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()} }),Object.defineProperty(Duplex.prototype,'writableLength',{ enumerable:!1,get:function(){return this._writableState.length} }),Object.defineProperty(Duplex.prototype,'destroyed',{ enumerable:!1,get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed&&this._writableState.destroyed)},set:function(value){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=value,this._writableState.destroyed=value)} })}).call(this,_dereq_(28))},{ 25:25,28:28,43:43,45:45 }],42:[function(_dereq_,module,exports){'use strict';module.exports=PassThrough;var Transform=_dereq_(44);function PassThrough(options){if(!(this instanceof PassThrough))return new PassThrough(options);Transform.call(this,options)}_dereq_(25)(PassThrough,Transform),PassThrough.prototype._transform=function(chunk,encoding,cb){cb(null,chunk)}},{ 25:25,44:44 }],43:[function(_dereq_,module,exports){(function(process,global){'use strict';var Duplex;module.exports=Readable,Readable.ReadableState=ReadableState;_dereq_(22).EventEmitter;var EElistenerCount=function(emitter,type){return emitter.listeners(type).length},Stream=_dereq_(52),Buffer=_dereq_(18).Buffer,OurUint8Array=global.Uint8Array||function(){};var debug,debugUtil=_dereq_(16);debug=debugUtil&&debugUtil.debuglog?debugUtil.debuglog('stream'):function(){};var StringDecoder,createReadableStreamAsyncIterator,BufferList=_dereq_(47),destroyImpl=_dereq_(48),getHighWaterMark=_dereq_(51).getHighWaterMark,_require$codes=_dereq_(39).codes,ERR_INVALID_ARG_TYPE=_require$codes.ERR_INVALID_ARG_TYPE,ERR_STREAM_PUSH_AFTER_EOF=_require$codes.ERR_STREAM_PUSH_AFTER_EOF,ERR_METHOD_NOT_IMPLEMENTED=_require$codes.ERR_METHOD_NOT_IMPLEMENTED,ERR_STREAM_UNSHIFT_AFTER_END_EVENT=_require$codes.ERR_STREAM_UNSHIFT_AFTER_END_EVENT,emitExperimentalWarning=_dereq_(40).emitExperimentalWarning;_dereq_(25)(Readable,Stream);var kProxyEvents=['error','close','destroy','pause','resume'];function ReadableState(options,stream,isDuplex){Duplex=Duplex||_dereq_(41),options=options||{},'boolean'!=typeof isDuplex&&(isDuplex=stream instanceof Duplex),this.objectMode=!!options.objectMode,isDuplex&&(this.objectMode=this.objectMode||!!options.readableObjectMode),this.highWaterMark=getHighWaterMark(this,options,'readableHighWaterMark',isDuplex),this.buffer=new BufferList,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.paused=!0,this.emitClose=!1!==options.emitClose,this.destroyed=!1,this.defaultEncoding=options.defaultEncoding||'utf8',this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,options.encoding&&(StringDecoder||(StringDecoder=_dereq_(54).StringDecoder),this.decoder=new StringDecoder(options.encoding),this.encoding=options.encoding)}function Readable(options){if(Duplex=Duplex||_dereq_(41),!(this instanceof Readable))return new Readable(options);var isDuplex=this instanceof Duplex;this._readableState=new ReadableState(options,this,isDuplex),this.readable=!0,options&&('function'==typeof options.read&&(this._read=options.read),'function'==typeof options.destroy&&(this._destroy=options.destroy)),Stream.call(this)}function readableAddChunk(stream,chunk,encoding,addToFront,skipChunkCheck){debug('readableAddChunk',chunk);var er,state=stream._readableState;if(null===chunk)state.reading=!1,function(stream,state){if(state.ended)return;if(state.decoder){var chunk=state.decoder.end();chunk&&chunk.length&&(state.buffer.push(chunk),state.length+=state.objectMode?1:chunk.length)}state.ended=!0,state.sync?emitReadable(stream):(state.needReadable=!1,state.emittedReadable||(state.emittedReadable=!0,emitReadable_(stream)))}(stream,state);else if(skipChunkCheck||(er=function(state,chunk){var er;obj=chunk,Buffer.isBuffer(obj)||obj instanceof OurUint8Array||'string'==typeof chunk||void 0===chunk||state.objectMode||(er=new ERR_INVALID_ARG_TYPE('chunk',['string','Buffer','Uint8Array'],chunk));var obj;return er}(state,chunk)),er)stream.emit('error',er);else if(state.objectMode||chunk&&chunk.length>0)if('string'==typeof chunk||state.objectMode||Object.getPrototypeOf(chunk)===Buffer.prototype||(chunk=function(chunk){return Buffer.from(chunk)}(chunk)),addToFront)state.endEmitted?stream.emit('error',new ERR_STREAM_UNSHIFT_AFTER_END_EVENT):addChunk(stream,state,chunk,!0);else if(state.ended)stream.emit('error',new ERR_STREAM_PUSH_AFTER_EOF);else{if(state.destroyed)return!1;state.reading=!1,state.decoder&&!encoding?(chunk=state.decoder.write(chunk),state.objectMode||0!==chunk.length?addChunk(stream,state,chunk,!1):maybeReadMore(stream,state)):addChunk(stream,state,chunk,!1)}else addToFront||(state.reading=!1,maybeReadMore(stream,state));return!state.ended&&(state.length<state.highWaterMark||0===state.length)}function addChunk(stream,state,chunk,addToFront){state.flowing&&0===state.length&&!state.sync?(state.awaitDrain=0,stream.emit('data',chunk)):(state.length+=state.objectMode?1:chunk.length,addToFront?state.buffer.unshift(chunk):state.buffer.push(chunk),state.needReadable&&emitReadable(stream)),maybeReadMore(stream,state)}Object.defineProperty(Readable.prototype,'destroyed',{ enumerable:!1,get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(value){this._readableState&&(this._readableState.destroyed=value)} }),Readable.prototype.destroy=destroyImpl.destroy,Readable.prototype._undestroy=destroyImpl.undestroy,Readable.prototype._destroy=function(err,cb){cb(err)},Readable.prototype.push=function(chunk,encoding){var skipChunkCheck,state=this._readableState;return state.objectMode?skipChunkCheck=!0:'string'==typeof chunk&&((encoding=encoding||state.defaultEncoding)!==state.encoding&&(chunk=Buffer.from(chunk,encoding),encoding=''),skipChunkCheck=!0),readableAddChunk(this,chunk,encoding,!1,skipChunkCheck)},Readable.prototype.unshift=function(chunk){return readableAddChunk(this,chunk,null,!0,!1)},Readable.prototype.isPaused=function(){return!1===this._readableState.flowing},Readable.prototype.setEncoding=function(enc){return StringDecoder||(StringDecoder=_dereq_(54).StringDecoder),this._readableState.decoder=new StringDecoder(enc),this._readableState.encoding=this._readableState.decoder.encoding,this};var MAX_HWM=8388608;function howMuchToRead(n,state){return n<=0||0===state.length&&state.ended?0:state.objectMode?1:n!=n?state.flowing&&state.length?state.buffer.head.data.length:state.length:(n>state.highWaterMark&&(state.highWaterMark=function(n){return n>=MAX_HWM?n=MAX_HWM:(n--,n|=n>>>1,n|=n>>>2,n|=n>>>4,n|=n>>>8,n|=n>>>16,n++),n}(n)),n<=state.length?n:state.ended?state.length:(state.needReadable=!0,0))}function emitReadable(stream){var state=stream._readableState;state.needReadable=!1,state.emittedReadable||(debug('emitReadable',state.flowing),state.emittedReadable=!0,process.nextTick(emitReadable_,stream))}function emitReadable_(stream){var state=stream._readableState;debug('emitReadable_',state.destroyed,state.length,state.ended),state.destroyed||!state.length&&!state.ended||stream.emit('readable'),state.needReadable=!state.flowing&&!state.ended&&state.length<=state.highWaterMark,flow(stream)}function maybeReadMore(stream,state){state.readingMore||(state.readingMore=!0,process.nextTick(maybeReadMore_,stream,state))}function maybeReadMore_(stream,state){for(;!state.reading&&!state.ended&&(state.length<state.highWaterMark||state.flowing&&0===state.length);){var len=state.length;if(debug('maybeReadMore read 0'),stream.read(0),len===state.length)break}state.readingMore=!1}function updateReadableListening(self){var state=self._readableState;state.readableListening=self.listenerCount('readable')>0,state.resumeScheduled&&!state.paused?state.flowing=!0:self.listenerCount('data')>0&&self.resume()}function nReadingNextTick(self){debug('readable nexttick read 0'),self.read(0)}function resume_(stream,state){debug('resume',state.reading),state.reading||stream.read(0),state.resumeScheduled=!1,stream.emit('resume'),flow(stream),state.flowing&&!state.reading&&stream.read(0)}function flow(stream){var state=stream._readableState;for(debug('flow',state.flowing);state.flowing&&null!==stream.read(););}function fromList(n,state){return 0===state.length?null:(state.objectMode?ret=state.buffer.shift():!n||n>=state.length?(ret=state.decoder?state.buffer.join(''):1===state.buffer.length?state.buffer.first():state.buffer.concat(state.length),state.buffer.clear()):ret=state.buffer.consume(n,state.decoder),ret);var ret}function endReadable(stream){var state=stream._readableState;debug('endReadable',state.endEmitted),state.endEmitted||(state.ended=!0,process.nextTick(endReadableNT,state,stream))}function endReadableNT(state,stream){debug('endReadableNT',state.endEmitted,state.length),state.endEmitted||0!==state.length||(state.endEmitted=!0,stream.readable=!1,stream.emit('end'))}function indexOf(xs,x){for(var i=0,l=xs.length;i<l;i++)if(xs[i]===x)return i;return-1}Readable.prototype.read=function(n){debug('read',n),n=parseInt(n,10);var state=this._readableState,nOrig=n;if(0!==n&&(state.emittedReadable=!1),0===n&&state.needReadable&&((0!==state.highWaterMark?state.length>=state.highWaterMark:state.length>0)||state.ended))return debug('read: emitReadable',state.length,state.ended),0===state.length&&state.ended?endReadable(this):emitReadable(this),null;if(0===(n=howMuchToRead(n,state))&&state.ended)return 0===state.length&&endReadable(this),null;var ret,doRead=state.needReadable;return debug('need readable',doRead),(0===state.length||state.length-n<state.highWaterMark)&&debug('length less than watermark',doRead=!0),state.ended||state.reading?debug('reading or ended',doRead=!1):doRead&&(debug('do read'),state.reading=!0,state.sync=!0,0===state.length&&(state.needReadable=!0),this._read(state.highWaterMark),state.sync=!1,state.reading||(n=howMuchToRead(nOrig,state))),null===(ret=n>0?fromList(n,state):null)?(state.needReadable=!0,n=0):(state.length-=n,state.awaitDrain=0),0===state.length&&(state.ended||(state.needReadable=!0),nOrig!==n&&state.ended&&endReadable(this)),null!==ret&&this.emit('data',ret),ret},Readable.prototype._read=function(n){this.emit('error',new ERR_METHOD_NOT_IMPLEMENTED('_read()'))},Readable.prototype.pipe=function(dest,pipeOpts){var src=this,state=this._readableState;switch(state.pipesCount){case 0:state.pipes=dest;break;case 1:state.pipes=[state.pipes,dest];break;default:state.pipes.push(dest)}state.pipesCount+=1,debug('pipe count=%d opts=%j',state.pipesCount,pipeOpts);var endFn=(!pipeOpts||!1!==pipeOpts.end)&&dest!==process.stdout&&dest!==process.stderr?onend:unpipe;function onunpipe(readable,unpipeInfo){debug('onunpipe'),readable===src&&unpipeInfo&&!1===unpipeInfo.hasUnpiped&&(unpipeInfo.hasUnpiped=!0,debug('cleanup'),dest.removeListener('close',onclose),dest.removeListener('finish',onfinish),dest.removeListener('drain',ondrain),dest.removeListener('error',onerror),dest.removeListener('unpipe',onunpipe),src.removeListener('end',onend),src.removeListener('end',unpipe),src.removeListener('data',ondata),cleanedUp=!0,!state.awaitDrain||dest._writableState&&!dest._writableState.needDrain||ondrain())}function onend(){debug('onend'),dest.end()}state.endEmitted?process.nextTick(endFn):src.once('end',endFn),dest.on('unpipe',onunpipe);var ondrain=function(src){return function(){var state=src._readableState;debug('pipeOnDrain',state.awaitDrain),state.awaitDrain&&state.awaitDrain--,0===state.awaitDrain&&EElistenerCount(src,'data')&&(state.flowing=!0,flow(src))}}(src);dest.on('drain',ondrain);var cleanedUp=!1;function ondata(chunk){debug('ondata');var ret=dest.write(chunk);debug('dest.write',ret),!1===ret&&((1===state.pipesCount&&state.pipes===dest||state.pipesCount>1&&-1!==indexOf(state.pipes,dest))&&!cleanedUp&&(debug('false write response, pause',state.awaitDrain),state.awaitDrain++),src.pause())}function onerror(er){debug('onerror',er),unpipe(),dest.removeListener('error',onerror),0===EElistenerCount(dest,'error')&&dest.emit('error',er)}function onclose(){dest.removeListener('finish',onfinish),unpipe()}function onfinish(){debug('onfinish'),dest.removeListener('close',onclose),unpipe()}function unpipe(){debug('unpipe'),src.unpipe(dest)}return src.on('data',ondata),function(emitter,event,fn){if('function'==typeof emitter.prependListener)return emitter.prependListener(event,fn);emitter._events&&emitter._events[event]?Array.isArray(emitter._events[event])?emitter._events[event].unshift(fn):emitter._events[event]=[fn,emitter._events[event]]:emitter.on(event,fn)}(dest,'error',onerror),dest.once('close',onclose),dest.once('finish',onfinish),dest.emit('pipe',src),state.flowing||(debug('pipe resume'),src.resume()),dest},Readable.prototype.unpipe=function(dest){var state=this._readableState,unpipeInfo={ hasUnpiped:!1 };if(0===state.pipesCount)return this;if(1===state.pipesCount)return dest&&dest!==state.pipes?this:(dest||(dest=state.pipes),state.pipes=null,state.pipesCount=0,state.flowing=!1,dest&&dest.emit('unpipe',this,unpipeInfo),this);if(!dest){var dests=state.pipes,len=state.pipesCount;state.pipes=null,state.pipesCount=0,state.flowing=!1;for(var i=0;i<len;i++)dests[i].emit('unpipe',this,{ hasUnpiped:!1 });return this}var index=indexOf(state.pipes,dest);return-1===index?this:(state.pipes.splice(index,1),state.pipesCount-=1,1===state.pipesCount&&(state.pipes=state.pipes[0]),dest.emit('unpipe',this,unpipeInfo),this)},Readable.prototype.on=function(ev,fn){var res=Stream.prototype.on.call(this,ev,fn),state=this._readableState;return'data'===ev?(state.readableListening=this.listenerCount('readable')>0,!1!==state.flowing&&this.resume()):'readable'===ev&&(state.endEmitted||state.readableListening||(state.readableListening=state.needReadable=!0,state.flowing=!1,state.emittedReadable=!1,debug('on readable',state.length,state.reading),state.length?emitReadable(this):state.reading||process.nextTick(nReadingNextTick,this))),res},Readable.prototype.addListener=Readable.prototype.on,Readable.prototype.removeListener=function(ev,fn){var res=Stream.prototype.removeListener.call(this,ev,fn);return'readable'===ev&&process.nextTick(updateReadableListening,this),res},Readable.prototype.removeAllListeners=function(ev){var res=Stream.prototype.removeAllListeners.apply(this,arguments);return'readable'!==ev&&void 0!==ev||process.nextTick(updateReadableListening,this),res},Readable.prototype.resume=function(){var state=this._readableState;return state.flowing||(debug('resume'),state.flowing=!state.readableListening,function(stream,state){state.resumeScheduled||(state.resumeScheduled=!0,process.nextTick(resume_,stream,state))}(this,state)),state.paused=!1,this},Readable.prototype.pause=function(){return debug('call pause flowing=%j',this._readableState.flowing),!1!==this._readableState.flowing&&(debug('pause'),this._readableState.flowing=!1,this.emit('pause')),this._readableState.paused=!0,this},Readable.prototype.wrap=function(stream){var _this=this,state=this._readableState,paused=!1;for(var i in stream.on('end',function(){if(debug('wrapped end'),state.decoder&&!state.ended){var chunk=state.decoder.end();chunk&&chunk.length&&_this.push(chunk)}_this.push(null)}),stream.on('data',function(chunk){(debug('wrapped data'),state.decoder&&(chunk=state.decoder.write(chunk)),!state.objectMode||null!==chunk&&void 0!==chunk)&&((state.objectMode||chunk&&chunk.length)&&(_this.push(chunk)||(paused=!0,stream.pause())))}),stream)void 0===this[i]&&'function'==typeof stream[i]&&(this[i]=function(method){return function(){return stream[method].apply(stream,arguments)}}(i));for(var n=0;n<kProxyEvents.length;n++)stream.on(kProxyEvents[n],this.emit.bind(this,kProxyEvents[n]));return this._read=function(n){debug('wrapped _read',n),paused&&(paused=!1,stream.resume())},this},'function'==typeof Symbol&&(Readable.prototype[Symbol.asyncIterator]=function(){return emitExperimentalWarning('Readable[Symbol.asyncIterator]'),void 0===createReadableStreamAsyncIterator&&(createReadableStreamAsyncIterator=_dereq_(46)),createReadableStreamAsyncIterator(this)}),Object.defineProperty(Readable.prototype,'readableHighWaterMark',{ enumerable:!1,get:function(){return this._readableState.highWaterMark} }),Object.defineProperty(Readable.prototype,'readableBuffer',{ enumerable:!1,get:function(){return this._readableState&&this._readableState.buffer} }),Object.defineProperty(Readable.prototype,'readableFlowing',{ enumerable:!1,get:function(){return this._readableState.flowing},set:function(state){this._readableState&&(this._readableState.flowing=state)} }),Readable._fromList=fromList,Object.defineProperty(Readable.prototype,'readableLength',{ enumerable:!1,get:function(){return this._readableState.length} })}).call(this,_dereq_(28),'undefined'!=typeof global?global:'undefined'!=typeof self?self:'undefined'!=typeof window?window:{})},{ 16:16,18:18,22:22,25:25,28:28,39:39,40:40,41:41,46:46,47:47,48:48,51:51,52:52,54:54 }],44:[function(_dereq_,module,exports){'use strict';module.exports=Transform;var _require$codes=_dereq_(39).codes,ERR_METHOD_NOT_IMPLEMENTED=_require$codes.ERR_METHOD_NOT_IMPLEMENTED,ERR_MULTIPLE_CALLBACK=_require$codes.ERR_MULTIPLE_CALLBACK,ERR_TRANSFORM_ALREADY_TRANSFORMING=_require$codes.ERR_TRANSFORM_ALREADY_TRANSFORMING,ERR_TRANSFORM_WITH_LENGTH_0=_require$codes.ERR_TRANSFORM_WITH_LENGTH_0,Duplex=_dereq_(41);function Transform(options){if(!(this instanceof Transform))return new Transform(options);Duplex.call(this,options),this._transformState={ afterTransform:function(er,data){var ts=this._transformState;ts.transforming=!1;var cb=ts.writecb;if(null===cb)return this.emit('error',new ERR_MULTIPLE_CALLBACK);ts.writechunk=null,ts.writecb=null,null!=data&&this.push(data),cb(er);var rs=this._readableState;rs.reading=!1,(rs.needReadable||rs.length<rs.highWaterMark)&&this._read(rs.highWaterMark)}.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null },this._readableState.needReadable=!0,this._readableState.sync=!1,options&&('function'==typeof options.transform&&(this._transform=options.transform),'function'==typeof options.flush&&(this._flush=options.flush)),this.on('prefinish',prefinish)}function prefinish(){var _this=this;'function'!=typeof this._flush||this._readableState.destroyed?done(this,null,null):this._flush(function(er,data){done(_this,er,data)})}function done(stream,er,data){if(er)return stream.emit('error',er);if(null!=data&&stream.push(data),stream._writableState.length)throw new ERR_TRANSFORM_WITH_LENGTH_0;if(stream._transformState.transforming)throw new ERR_TRANSFORM_ALREADY_TRANSFORMING;return stream.push(null)}_dereq_(25)(Transform,Duplex),Transform.prototype.push=function(chunk,encoding){return this._transformState.needTransform=!1,Duplex.prototype.push.call(this,chunk,encoding)},Transform.prototype._transform=function(chunk,encoding,cb){cb(new ERR_METHOD_NOT_IMPLEMENTED('_transform()'))},Transform.prototype._write=function(chunk,encoding,cb){var ts=this._transformState;if(ts.writecb=cb,ts.writechunk=chunk,ts.writeencoding=encoding,!ts.transforming){var rs=this._readableState;(ts.needTransform||rs.needReadable||rs.length<rs.highWaterMark)&&this._read(rs.highWaterMark)}},Transform.prototype._read=function(n){var ts=this._transformState;null===ts.writechunk||ts.transforming?ts.needTransform=!0:(ts.transforming=!0,this._transform(ts.writechunk,ts.writeencoding,ts.afterTransform))},Transform.prototype._destroy=function(err,cb){Duplex.prototype._destroy.call(this,err,function(err2){cb(err2)})}},{ 25:25,39:39,41:41 }],45:[function(_dereq_,module,exports){(function(process,global){'use strict';function CorkedRequest(state){var _this=this;this.next=null,this.entry=null,this.finish=function(){!function(corkReq,state,err){var entry=corkReq.entry;corkReq.entry=null;for(;entry;){var cb=entry.callback;state.pendingcb--,cb(err),entry=entry.next}state.corkedRequestsFree.next=corkReq}(_this,state)}}var Duplex;module.exports=Writable,Writable.WritableState=WritableState;var internalUtil={ deprecate:_dereq_(57) },Stream=_dereq_(52),Buffer=_dereq_(18).Buffer,OurUint8Array=global.Uint8Array||function(){};var realHasInstance,destroyImpl=_dereq_(48),getHighWaterMark=_dereq_(51).getHighWaterMark,_require$codes=_dereq_(39).codes,ERR_INVALID_ARG_TYPE=_require$codes.ERR_INVALID_ARG_TYPE,ERR_METHOD_NOT_IMPLEMENTED=_require$codes.ERR_METHOD_NOT_IMPLEMENTED,ERR_MULTIPLE_CALLBACK=_require$codes.ERR_MULTIPLE_CALLBACK,ERR_STREAM_CANNOT_PIPE=_require$codes.ERR_STREAM_CANNOT_PIPE,ERR_STREAM_DESTROYED=_require$codes.ERR_STREAM_DESTROYED,ERR_STREAM_NULL_VALUES=_require$codes.ERR_STREAM_NULL_VALUES,ERR_STREAM_WRITE_AFTER_END=_require$codes.ERR_STREAM_WRITE_AFTER_END,ERR_UNKNOWN_ENCODING=_require$codes.ERR_UNKNOWN_ENCODING;function nop(){}function WritableState(options,stream,isDuplex){Duplex=Duplex||_dereq_(41),options=options||{},'boolean'!=typeof isDuplex&&(isDuplex=stream instanceof Duplex),this.objectMode=!!options.objectMode,isDuplex&&(this.objectMode=this.objectMode||!!options.writableObjectMode),this.highWaterMark=getHighWaterMark(this,options,'writableHighWaterMark',isDuplex),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1,this.destroyed=!1;var noDecode=!1===options.decodeStrings;this.decodeStrings=!noDecode,this.defaultEncoding=options.defaultEncoding||'utf8',this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(er){!function(stream,er){var state=stream._writableState,sync=state.sync,cb=state.writecb;if('function'!=typeof cb)throw new ERR_MULTIPLE_CALLBACK;if(function(state){state.writing=!1,state.writecb=null,state.length-=state.writelen,state.writelen=0}(state),er)!function(stream,state,sync,er,cb){--state.pendingcb,sync?(process.nextTick(cb,er),process.nextTick(finishMaybe,stream,state),stream._writableState.errorEmitted=!0,stream.emit('error',er)):(cb(er),stream._writableState.errorEmitted=!0,stream.emit('error',er),finishMaybe(stream,state))}(stream,state,sync,er,cb);else{var finished=needFinish(state)||stream.destroyed;finished||state.corked||state.bufferProcessing||!state.bufferedRequest||clearBuffer(stream,state),sync?process.nextTick(afterWrite,stream,state,finished,cb):afterWrite(stream,state,finished,cb)}}(stream,er)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.emitClose=!1!==options.emitClose,this.bufferedRequestCount=0,this.corkedRequestsFree=new CorkedRequest(this)}function Writable(options){var isDuplex=this instanceof(Duplex=Duplex||_dereq_(41));if(!isDuplex&&!realHasInstance.call(Writable,this))return new Writable(options);this._writableState=new WritableState(options,this,isDuplex),this.writable=!0,options&&('function'==typeof options.write&&(this._write=options.write),'function'==typeof options.writev&&(this._writev=options.writev),'function'==typeof options.destroy&&(this._destroy=options.destroy),'function'==typeof options.final&&(this._final=options.final)),Stream.call(this)}function doWrite(stream,state,writev,len,chunk,encoding,cb){state.writelen=len,state.writecb=cb,state.writing=!0,state.sync=!0,state.destroyed?state.onwrite(new ERR_STREAM_DESTROYED('write')):writev?stream._writev(chunk,state.onwrite):stream._write(chunk,encoding,state.onwrite),state.sync=!1}function afterWrite(stream,state,finished,cb){finished||function(stream,state){0===state.length&&state.needDrain&&(state.needDrain=!1,stream.emit('drain'))}(stream,state),state.pendingcb--,cb(),finishMaybe(stream,state)}function clearBuffer(stream,state){state.bufferProcessing=!0;var entry=state.bufferedRequest;if(stream._writev&&entry&&entry.next){var l=state.bufferedRequestCount,buffer=new Array(l),holder=state.corkedRequestsFree;holder.entry=entry;for(var count=0,allBuffers=!0;entry;)buffer[count]=entry,entry.isBuf||(allBuffers=!1),entry=entry.next,count+=1;buffer.allBuffers=allBuffers,doWrite(stream,state,!0,state.length,buffer,'',holder.finish),state.pendingcb++,state.lastBufferedRequest=null,holder.next?(state.corkedRequestsFree=holder.next,holder.next=null):state.corkedRequestsFree=new CorkedRequest(state),state.bufferedRequestCount=0}else{for(;entry;){var chunk=entry.chunk,encoding=entry.encoding,cb=entry.callback;if(doWrite(stream,state,!1,state.objectMode?1:chunk.length,chunk,encoding,cb),entry=entry.next,state.bufferedRequestCount--,state.writing)break}null===entry&&(state.lastBufferedRequest=null)}state.bufferedRequest=entry,state.bufferProcessing=!1}function needFinish(state){return state.ending&&0===state.length&&null===state.bufferedRequest&&!state.finished&&!state.writing}function callFinal(stream,state){stream._final(function(err){state.pendingcb--,err&&stream.emit('error',err),state.prefinished=!0,stream.emit('prefinish'),finishMaybe(stream,state)})}function finishMaybe(stream,state){var need=needFinish(state);return need&&(!function(stream,state){state.prefinished||state.finalCalled||('function'!=typeof stream._final||state.destroyed?(state.prefinished=!0,stream.emit('prefinish')):(state.pendingcb++,state.finalCalled=!0,process.nextTick(callFinal,stream,state)))}(stream,state),0===state.pendingcb&&(state.finished=!0,stream.emit('finish'))),need}_dereq_(25)(Writable,Stream),WritableState.prototype.getBuffer=function(){for(var current=this.bufferedRequest,out=[];current;)out.push(current),current=current.next;return out},function(){try{Object.defineProperty(WritableState.prototype,'buffer',{ get:internalUtil.deprecate(function(){return this.getBuffer()},'_writableState.buffer is deprecated. Use _writableState.getBuffer instead.','DEP0003') })}catch(_){}}(),'function'==typeof Symbol&&Symbol.hasInstance&&'function'==typeof Function.prototype[Symbol.hasInstance]?(realHasInstance=Function.prototype[Symbol.hasInstance],Object.defineProperty(Writable,Symbol.hasInstance,{ value:function(object){return!!realHasInstance.call(this,object)||this===Writable&&(object&&object._writableState instanceof WritableState)} })):realHasInstance=function(object){return object instanceof this},Writable.prototype.pipe=function(){this.emit('error',new ERR_STREAM_CANNOT_PIPE)},Writable.prototype.write=function(chunk,encoding,cb){var obj,state=this._writableState,ret=!1,isBuf=!state.objectMode&&(obj=chunk,Buffer.isBuffer(obj)||obj instanceof OurUint8Array);return isBuf&&!Buffer.isBuffer(chunk)&&(chunk=function(chunk){return Buffer.from(chunk)}(chunk)),'function'==typeof encoding&&(cb=encoding,encoding=null),isBuf?encoding='buffer':encoding||(encoding=state.defaultEncoding),'function'!=typeof cb&&(cb=nop),state.ending?function(stream,cb){var er=new ERR_STREAM_WRITE_AFTER_END;stream.emit('error',er),process.nextTick(cb,er)}(this,cb):(isBuf||function(stream,state,chunk,cb){var er;return null===chunk?er=new ERR_STREAM_NULL_VALUES:'string'==typeof chunk||state.objectMode||(er=new ERR_INVALID_ARG_TYPE('chunk',['string','Buffer'],chunk)),!er||(stream.emit('error',er),process.nextTick(cb,er),!1)}(this,state,chunk,cb))&&(state.pendingcb++,ret=function(stream,state,isBuf,chunk,encoding,cb){if(!isBuf){var newChunk=function(state,chunk,encoding){state.objectMode||!1===state.decodeStrings||'string'!=typeof chunk||(chunk=Buffer.from(chunk,encoding));return chunk}(state,chunk,encoding);chunk!==newChunk&&(isBuf=!0,encoding='buffer',chunk=newChunk)}var len=state.objectMode?1:chunk.length;state.length+=len;var ret=state.length<state.highWaterMark;ret||(state.needDrain=!0);if(state.writing||state.corked){var last=state.lastBufferedRequest;state.lastBufferedRequest={ chunk:chunk,encoding:encoding,isBuf:isBuf,callback:cb,next:null },last?last.next=state.lastBufferedRequest:state.bufferedRequest=state.lastBufferedRequest,state.bufferedRequestCount+=1}else doWrite(stream,state,!1,len,chunk,encoding,cb);return ret}(this,state,isBuf,chunk,encoding,cb)),ret},Writable.prototype.cork=function(){this._writableState.corked++},Writable.prototype.uncork=function(){var state=this._writableState;state.corked&&(state.corked--,state.writing||state.corked||state.bufferProcessing||!state.bufferedRequest||clearBuffer(this,state))},Writable.prototype.setDefaultEncoding=function(encoding){if('string'==typeof encoding&&(encoding=encoding.toLowerCase()),!(['hex','utf8','utf-8','ascii','binary','base64','ucs2','ucs-2','utf16le','utf-16le','raw'].indexOf((encoding+'').toLowerCase())>-1))throw new ERR_UNKNOWN_ENCODING(encoding);return this._writableState.defaultEncoding=encoding,this},Object.defineProperty(Writable.prototype,'writableBuffer',{ enumerable:!1,get:function(){return this._writableState&&this._writableState.getBuffer()} }),Object.defineProperty(Writable.prototype,'writableHighWaterMark',{ enumerable:!1,get:function(){return this._writableState.highWaterMark} }),Writable.prototype._write=function(chunk,encoding,cb){cb(new ERR_METHOD_NOT_IMPLEMENTED('_write()'))},Writable.prototype._writev=null,Writable.prototype.end=function(chunk,encoding,cb){var state=this._writableState;return'function'==typeof chunk?(cb=chunk,chunk=null,encoding=null):'function'==typeof encoding&&(cb=encoding,encoding=null),null!==chunk&&void 0!==chunk&&this.write(chunk,encoding),state.corked&&(state.corked=1,this.uncork()),state.ending||function(stream,state,cb){state.ending=!0,finishMaybe(stream,state),cb&&(state.finished?process.nextTick(cb):stream.once('finish',cb));state.ended=!0,stream.writable=!1}(this,state,cb),this},Object.defineProperty(Writable.prototype,'writableLength',{ enumerable:!1,get:function(){return this._writableState.length} }),Object.defineProperty(Writable.prototype,'destroyed',{ enumerable:!1,get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(value){this._writableState&&(this._writableState.destroyed=value)} }),Writable.prototype.destroy=destroyImpl.destroy,Writable.prototype._undestroy=destroyImpl.undestroy,Writable.prototype._destroy=function(err,cb){cb(err)}}).call(this,_dereq_(28),'undefined'!=typeof global?global:'undefined'!=typeof self?self:'undefined'!=typeof window?window:{})},{ 18:18,25:25,28:28,39:39,41:41,48:48,51:51,52:52,57:57 }],46:[function(_dereq_,module,exports){(function(process){'use strict';var _Object$setPrototypeO;function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{ value:value,enumerable:!0,configurable:!0,writable:!0 }):obj[key]=value,obj}var finished=_dereq_(49),kLastResolve=Symbol('lastResolve'),kLastReject=Symbol('lastReject'),kError=Symbol('error'),kEnded=Symbol('ended'),kLastPromise=Symbol('lastPromise'),kHandlePromise=Symbol('handlePromise'),kStream=Symbol('stream');function createIterResult(value,done){return{ value:value,done:done }}function readAndResolve(iter){var resolve=iter[kLastResolve];if(null!==resolve){var data=iter[kStream].read();null!==data&&(iter[kLastPromise]=null,iter[kLastResolve]=null,iter[kLastReject]=null,resolve(createIterResult(data,!1)))}}var AsyncIteratorPrototype=Object.getPrototypeOf(function(){}),ReadableStreamAsyncIteratorPrototype=Object.setPrototypeOf((_defineProperty(_Object$setPrototypeO={ get stream(){return this[kStream]},next:function(){var _this=this,error=this[kError];if(null!==error)return Promise.reject(error);if(this[kEnded])return Promise.resolve(createIterResult(void 0,!0));if(this[kStream].destroyed)return new Promise(function(resolve,reject){process.nextTick(function(){_this[kError]?reject(_this[kError]):resolve(createIterResult(void 0,!0))})});var promise,lastPromise=this[kLastPromise];if(lastPromise)promise=new Promise(function(lastPromise,iter){return function(resolve,reject){lastPromise.then(function(){iter[kEnded]?resolve(createIterResult(void 0,!0)):iter[kHandlePromise](resolve,reject)},reject)}}(lastPromise,this));else{var data=this[kStream].read();if(null!==data)return Promise.resolve(createIterResult(data,!1));promise=new Promise(this[kHandlePromise])}return this[kLastPromise]=promise,promise} },Symbol.asyncIterator,function(){return this}),_defineProperty(_Object$setPrototypeO,'return',function(){var _this2=this;return new Promise(function(resolve,reject){_this2[kStream].destroy(null,function(err){err?reject(err):resolve(createIterResult(void 0,!0))})})}),_Object$setPrototypeO),AsyncIteratorPrototype);module.exports=function(stream){var _Object$create,iterator=Object.create(ReadableStreamAsyncIteratorPrototype,(_defineProperty(_Object$create={},kStream,{ value:stream,writable:!0 }),_defineProperty(_Object$create,kLastResolve,{ value:null,writable:!0 }),_defineProperty(_Object$create,kLastReject,{ value:null,writable:!0 }),_defineProperty(_Object$create,kError,{ value:null,writable:!0 }),_defineProperty(_Object$create,kEnded,{ value:stream._readableState.endEmitted,writable:!0 }),_defineProperty(_Object$create,kHandlePromise,{ value:function(resolve,reject){var data=iterator[kStream].read();data?(iterator[kLastPromise]=null,iterator[kLastResolve]=null,iterator[kLastReject]=null,resolve(createIterResult(data,!1))):(iterator[kLastResolve]=resolve,iterator[kLastReject]=reject)},writable:!0 }),_Object$create));return iterator[kLastPromise]=null,finished(stream,function(err){if(err&&'ERR_STREAM_PREMATURE_CLOSE'!==err.code){var reject=iterator[kLastReject];return null!==reject&&(iterator[kLastPromise]=null,iterator[kLastResolve]=null,iterator[kLastReject]=null,reject(err)),void(iterator[kError]=err)}var resolve=iterator[kLastResolve];null!==resolve&&(iterator[kLastPromise]=null,iterator[kLastResolve]=null,iterator[kLastReject]=null,resolve(createIterResult(void 0,!0))),iterator[kEnded]=!0}),stream.on('readable',function(iter){process.nextTick(readAndResolve,iter)}.bind(null,iterator)),iterator}}).call(this,_dereq_(28))},{ 28:28,49:49 }],47:[function(_dereq_,module,exports){'use strict';function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{ value:value,enumerable:!0,configurable:!0,writable:!0 }):obj[key]=value,obj}var Buffer=_dereq_(18).Buffer,inspect=_dereq_(16).inspect,custom=inspect&&inspect.custom||'inspect';module.exports=function(){function BufferList(){this.head=null,this.tail=null,this.length=0}var _proto=BufferList.prototype;return _proto.push=function(v){var entry={ data:v,next:null };this.length>0?this.tail.next=entry:this.head=entry,this.tail=entry,++this.length},_proto.unshift=function(v){var entry={ data:v,next:this.head };0===this.length&&(this.tail=entry),this.head=entry,++this.length},_proto.shift=function(){if(0!==this.length){var ret=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,ret}},_proto.clear=function(){this.head=this.tail=null,this.length=0},_proto.join=function(s){if(0===this.length)return'';for(var p=this.head,ret=''+p.data;p=p.next;)ret+=s+p.data;return ret},_proto.concat=function(n){if(0===this.length)return Buffer.alloc(0);for(var src,target,offset,ret=Buffer.allocUnsafe(n>>>0),p=this.head,i=0;p;)src=p.data,target=ret,offset=i,Buffer.prototype.copy.call(src,target,offset),i+=p.data.length,p=p.next;return ret},_proto.consume=function(n,hasStrings){var ret;return n<this.head.data.length?(ret=this.head.data.slice(0,n),this.head.data=this.head.data.slice(n)):ret=n===this.head.data.length?this.shift():hasStrings?this._getString(n):this._getBuffer(n),ret},_proto.first=function(){return this.head.data},_proto._getString=function(n){var p=this.head,c=1,ret=p.data;for(n-=ret.length;p=p.next;){var str=p.data,nb=n>str.length?str.length:n;if(nb===str.length?ret+=str:ret+=str.slice(0,n),0===(n-=nb)){nb===str.length?(++c,p.next?this.head=p.next:this.head=this.tail=null):(this.head=p,p.data=str.slice(nb));break}++c}return this.length-=c,ret},_proto._getBuffer=function(n){var ret=Buffer.allocUnsafe(n),p=this.head,c=1;for(p.data.copy(ret),n-=p.data.length;p=p.next;){var buf=p.data,nb=n>buf.length?buf.length:n;if(buf.copy(ret,ret.length-n,0,nb),0===(n-=nb)){nb===buf.length?(++c,p.next?this.head=p.next:this.head=this.tail=null):(this.head=p,p.data=buf.slice(nb));break}++c}return this.length-=c,ret},_proto[custom]=function(_,options){return inspect(this,function(target){for(var i=1;i<arguments.length;i++){var source=null!=arguments[i]?arguments[i]:{},ownKeys=Object.keys(source);'function'==typeof Object.getOwnPropertySymbols&&(ownKeys=ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function(sym){return Object.getOwnPropertyDescriptor(source,sym).enumerable}))),ownKeys.forEach(function(key){_defineProperty(target,key,source[key])})}return target}({},options,{ depth:0,customInspect:!1 }))},BufferList}()},{ 16:16,18:18 }],48:[function(_dereq_,module,exports){(function(process){'use strict';function emitErrorAndCloseNT(self,err){emitErrorNT(self,err),emitCloseNT(self)}function emitCloseNT(self){self._writableState&&!self._writableState.emitClose||self._readableState&&!self._readableState.emitClose||self.emit('close')}function emitErrorNT(self,err){self.emit('error',err)}module.exports={ destroy:function(err,cb){var _this=this,readableDestroyed=this._readableState&&this._readableState.destroyed,writableDestroyed=this._writableState&&this._writableState.destroyed;return readableDestroyed||writableDestroyed?(cb?cb(err):!err||this._writableState&&this._writableState.errorEmitted||process.nextTick(emitErrorNT,this,err),this):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(err||null,function(err){!cb&&err?(process.nextTick(emitErrorAndCloseNT,_this,err),_this._writableState&&(_this._writableState.errorEmitted=!0)):cb?(process.nextTick(emitCloseNT,_this),cb(err)):process.nextTick(emitCloseNT,_this)}),this)},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finalCalled=!1,this._writableState.prefinished=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)} }}).call(this,_dereq_(28))},{ 28:28 }],49:[function(_dereq_,module,exports){'use strict';var ERR_STREAM_PREMATURE_CLOSE=_dereq_(39).codes.ERR_STREAM_PREMATURE_CLOSE;function noop(){}module.exports=function eos(stream,opts,callback){if('function'==typeof opts)return eos(stream,null,opts);opts||(opts={}),callback=function(callback){var called=!1;return function(){if(!called){called=!0;for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++)args[_key]=arguments[_key];callback.apply(this,args)}}}(callback||noop);var readable=opts.readable||!1!==opts.readable&&stream.readable,writable=opts.writable||!1!==opts.writable&&stream.writable,onlegacyfinish=function(){stream.writable||onfinish()},writableEnded=stream._writableState&&stream._writableState.finished,onfinish=function(){writable=!1,writableEnded=!0,readable||callback.call(stream)},readableEnded=stream._readableState&&stream._readableState.endEmitted,onend=function(){readable=!1,readableEnded=!0,writable||callback.call(stream)},onerror=function(err){callback.call(stream,err)},onclose=function(){var err;return readable&&!readableEnded?(stream._readableState&&stream._readableState.ended||(err=new ERR_STREAM_PREMATURE_CLOSE),callback.call(stream,err)):writable&&!writableEnded?(stream._writableState&&stream._writableState.ended||(err=new ERR_STREAM_PREMATURE_CLOSE),callback.call(stream,err)):void 0},onrequest=function(){stream.req.on('finish',onfinish)};return function(stream){return stream.setHeader&&'function'==typeof stream.abort}(stream)?(stream.on('complete',onfinish),stream.on('abort',onclose),stream.req?onrequest():stream.on('request',onrequest)):writable&&!stream._writableState&&(stream.on('end',onlegacyfinish),stream.on('close',onlegacyfinish)),stream.on('end',onend),stream.on('finish',onfinish),!1!==opts.error&&stream.on('error',onerror),stream.on('close',onclose),function(){stream.removeListener('complete',onfinish),stream.removeListener('abort',onclose),stream.removeListener('request',onrequest),stream.req&&stream.req.removeListener('finish',onfinish),stream.removeListener('end',onlegacyfinish),stream.removeListener('close',onlegacyfinish),stream.removeListener('finish',onfinish),stream.removeListener('end',onend),stream.removeListener('error',onerror),stream.removeListener('close',onclose)}}},{ 39:39 }],50:[function(_dereq_,module,exports){'use strict';var eos;var _require$codes=_dereq_(39).codes,ERR_MISSING_ARGS=_require$codes.ERR_MISSING_ARGS,ERR_STREAM_DESTROYED=_require$codes.ERR_STREAM_DESTROYED;function noop(err){if(err)throw err}function call(fn){fn()}function pipe(from,to){return from.pipe(to)}module.exports=function(){for(var _len=arguments.length,streams=new Array(_len),_key=0;_key<_len;_key++)streams[_key]=arguments[_key];var error,callback=function(streams){return streams.length?'function'!=typeof streams[streams.length-1]?noop:streams.pop():noop}(streams);if(Array.isArray(streams[0])&&(streams=streams[0]),streams.length<2)throw new ERR_MISSING_ARGS('streams');var destroys=streams.map(function(stream,i){var reading=i<streams.length-1;return function(stream,reading,writing,callback){callback=function(callback){var called=!1;return function(){called||(called=!0,callback.apply(void 0,arguments))}}(callback);var closed=!1;stream.on('close',function(){closed=!0}),void 0===eos&&(eos=_dereq_(49)),eos(stream,{ readable:reading,writable:writing },function(err){if(err)return callback(err);closed=!0,callback()});var destroyed=!1;return function(err){if(!closed&&!destroyed)return destroyed=!0,function(stream){return stream.setHeader&&'function'==typeof stream.abort}(stream)?stream.abort():'function'==typeof stream.destroy?stream.destroy():void callback(err||new ERR_STREAM_DESTROYED('pipe'))}}(stream,reading,i>0,function(err){error||(error=err),err&&destroys.forEach(call),reading||(destroys.forEach(call),callback(error))})});return streams.reduce(pipe)}},{ 39:39,49:49 }],51:[function(_dereq_,module,exports){'use strict';var ERR_INVALID_OPT_VALUE=_dereq_(39).codes.ERR_INVALID_OPT_VALUE;module.exports={ getHighWaterMark:function(state,options,duplexKey,isDuplex){var hwm=function(options,isDuplex,duplexKey){return null!=options.highWaterMark?options.highWaterMark:isDuplex?options[duplexKey]:null}(options,isDuplex,duplexKey);if(null!=hwm){if(!isFinite(hwm)||Math.floor(hwm)!==hwm||hwm<0)throw new ERR_INVALID_OPT_VALUE(isDuplex?duplexKey:'highWaterMark',hwm);return Math.floor(hwm)}return state.objectMode?16:16384} }},{ 39:39 }],52:[function(_dereq_,module,exports){module.exports=_dereq_(22).EventEmitter},{ 22:22 }],53:[function(_dereq_,module,exports){(exports=module.exports=_dereq_(43)).Stream=exports,exports.Readable=exports,exports.Writable=_dereq_(45),exports.Duplex=_dereq_(41),exports.Transform=_dereq_(44),exports.PassThrough=_dereq_(42),exports.finished=_dereq_(49),exports.pipeline=_dereq_(50)},{ 41:41,42:42,43:43,44:44,45:45,49:49,50:50 }],54:[function(_dereq_,module,exports){'use strict';var Buffer=_dereq_(34).Buffer,isEncoding=Buffer.isEncoding||function(encoding){switch((encoding=''+encoding)&&encoding.toLowerCase()){case'hex':case'utf8':case'utf-8':case'ascii':case'binary':case'base64':case'ucs2':case'ucs-2':case'utf16le':case'utf-16le':case'raw':return!0;default:return!1}};function StringDecoder(encoding){var nb;switch(this.encoding=function(enc){var nenc=function(enc){if(!enc)return'utf8';for(var retried;;)switch(enc){case'utf8':case'utf-8':return'utf8';case'ucs2':case'ucs-2':case'utf16le':case'utf-16le':return'utf16le';case'latin1':case'binary':return'latin1';case'base64':case'ascii':case'hex':return enc;default:if(retried)return;enc=(''+enc).toLowerCase(),retried=!0}}(enc);if('string'!=typeof nenc&&(Buffer.isEncoding===isEncoding||!isEncoding(enc)))throw new Error('Unknown encoding: '+enc);return nenc||enc}(encoding),this.encoding){case'utf16le':this.text=utf16Text,this.end=utf16End,nb=4;break;case'utf8':this.fillLast=utf8FillLast,nb=4;break;case'base64':this.text=base64Text,this.end=base64End,nb=3;break;default:return this.write=simpleWrite,void(this.end=simpleEnd)}this.lastNeed=0,this.lastTotal=0,this.lastChar=Buffer.allocUnsafe(nb)}function utf8CheckByte(byte){return byte<=127?0:byte>>5==6?2:byte>>4==14?3:byte>>3==30?4:byte>>6==2?-1:-2}function utf8FillLast(buf){var p=this.lastTotal-this.lastNeed,r=function(self,buf,p){if(128!=(192&buf[0]))return self.lastNeed=0,'';if(self.lastNeed>1&&buf.length>1){if(128!=(192&buf[1]))return self.lastNeed=1,'';if(self.lastNeed>2&&buf.length>2&&128!=(192&buf[2]))return self.lastNeed=2,''}}(this,buf);return void 0!==r?r:this.lastNeed<=buf.length?(buf.copy(this.lastChar,p,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(buf.copy(this.lastChar,p,0,buf.length),void(this.lastNeed-=buf.length))}function utf16Text(buf,i){if((buf.length-i)%2==0){var r=buf.toString('utf16le',i);if(r){var c=r.charCodeAt(r.length-1);if(c>=55296&&c<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=buf[buf.length-2],this.lastChar[1]=buf[buf.length-1],r.slice(0,-1)}return r}return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=buf[buf.length-1],buf.toString('utf16le',i,buf.length-1)}function utf16End(buf){var r=buf&&buf.length?this.write(buf):'';if(this.lastNeed){var end=this.lastTotal-this.lastNeed;return r+this.lastChar.toString('utf16le',0,end)}return r}function base64Text(buf,i){var n=(buf.length-i)%3;return 0===n?buf.toString('base64',i):(this.lastNeed=3-n,this.lastTotal=3,1===n?this.lastChar[0]=buf[buf.length-1]:(this.lastChar[0]=buf[buf.length-2],this.lastChar[1]=buf[buf.length-1]),buf.toString('base64',i,buf.length-n))}function base64End(buf){var r=buf&&buf.length?this.write(buf):'';return this.lastNeed?r+this.lastChar.toString('base64',0,3-this.lastNeed):r}function simpleWrite(buf){return buf.toString(this.encoding)}function simpleEnd(buf){return buf&&buf.length?this.write(buf):''}exports.StringDecoder=StringDecoder,StringDecoder.prototype.write=function(buf){if(0===buf.length)return'';var r,i;if(this.lastNeed){if(void 0===(r=this.fillLast(buf)))return'';i=this.lastNeed,this.lastNeed=0}else i=0;return i<buf.length?r?r+this.text(buf,i):this.text(buf,i):r||''},StringDecoder.prototype.end=function(buf){var r=buf&&buf.length?this.write(buf):'';return this.lastNeed?r+'':r},StringDecoder.prototype.text=function(buf,i){var total=function(self,buf,i){var j=buf.length-1;if(j<i)return 0;var nb=utf8CheckByte(buf[j]);if(nb>=0)return nb>0&&(self.lastNeed=nb-1),nb;if(--j<i||-2===nb)return 0;if((nb=utf8CheckByte(buf[j]))>=0)return nb>0&&(self.lastNeed=nb-2),nb;if(--j<i||-2===nb)return 0;if((nb=utf8CheckByte(buf[j]))>=0)return nb>0&&(2===nb?nb=0:self.lastNeed=nb-3),nb;return 0}(this,buf,i);if(!this.lastNeed)return buf.toString('utf8',i);this.lastTotal=total;var end=buf.length-(total-this.lastNeed);return buf.copy(this.lastChar,0,end),buf.toString('utf8',i,end)},StringDecoder.prototype.fillLast=function(buf){if(this.lastNeed<=buf.length)return buf.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);buf.copy(this.lastChar,this.lastTotal-this.lastNeed,0,buf.length),this.lastNeed-=buf.length}},{ 34:34 }],55:[function(_dereq_,module,exports){'use strict';var punycode=_dereq_(29),util=_dereq_(56);function Url(){this.protocol=null,this.slashes=null,this.auth=null,this.host=null,this.port=null,this.hostname=null,this.hash=null,this.search=null,this.query=null,this.pathname=null,this.path=null,this.href=null}exports.parse=urlParse,exports.resolve=function(source,relative){return urlParse(source,!1,!0).resolve(relative)},exports.resolveObject=function(source,relative){return source?urlParse(source,!1,!0).resolveObject(relative):relative},exports.format=function(obj){util.isString(obj)&&(obj=urlParse(obj));return obj instanceof Url?obj.format():Url.prototype.format.call(obj)},exports.Url=Url;var protocolPattern=/^([a-z0-9.+-]+:)/i,portPattern=/:[0-9]*$/,simplePathPattern=/^(\/\/?(?!\/)[^\?\s]*)(\?[^\s]*)?$/,unwise=['{','}','|','\\','^','`'].concat(['<','>','"','`',' ','\r','\n','\t']),autoEscape=["'"].concat(unwise),nonHostChars=['%','/','?',';','#'].concat(autoEscape),hostEndingChars=['/','?','#'],hostnamePartPattern=/^[+a-z0-9A-Z_-]{0,63}$/,hostnamePartStart=/^([+a-z0-9A-Z_-]{0,63})(.*)$/,unsafeProtocol={ javascript:!0,'javascript:':!0 },hostlessProtocol={ javascript:!0,'javascript:':!0 },slashedProtocol={ http:!0,https:!0,ftp:!0,gopher:!0,file:!0,'http:':!0,'https:':!0,'ftp:':!0,'gopher:':!0,'file:':!0 },querystring=_dereq_(32);function urlParse(url,parseQueryString,slashesDenoteHost){if(url&&util.isObject(url)&&url instanceof Url)return url;var u=new Url;return u.parse(url,parseQueryString,slashesDenoteHost),u}Url.prototype.parse=function(url,parseQueryString,slashesDenoteHost){if(!util.isString(url))throw new TypeError("Parameter 'url' must be a string, not "+typeof url);var queryIndex=url.indexOf('?'),splitter=-1!==queryIndex&&queryIndex<url.indexOf('#')?'?':'#',uSplit=url.split(splitter);uSplit[0]=uSplit[0].replace(/\\/g,'/');var rest=url=uSplit.join(splitter);if(rest=rest.trim(),!slashesDenoteHost&&1===url.split('#').length){var simplePath=simplePathPattern.exec(rest);if(simplePath)return this.path=rest,this.href=rest,this.pathname=simplePath[1],simplePath[2]?(this.search=simplePath[2],this.query=parseQueryString?querystring.parse(this.search.substr(1)):this.search.substr(1)):parseQueryString&&(this.search='',this.query={}),this}var proto=protocolPattern.exec(rest);if(proto){var lowerProto=(proto=proto[0]).toLowerCase();this.protocol=lowerProto,rest=rest.substr(proto.length)}if(slashesDenoteHost||proto||rest.match(/^\/\/[^@\/]+@[^@\/]+/)){var slashes='//'===rest.substr(0,2);!slashes||proto&&hostlessProtocol[proto]||(rest=rest.substr(2),this.slashes=!0)}if(!hostlessProtocol[proto]&&(slashes||proto&&!slashedProtocol[proto])){for(var auth,atSign,hostEnd=-1,i=0;i<hostEndingChars.length;i++){-1!==(hec=rest.indexOf(hostEndingChars[i]))&&(-1===hostEnd||hec<hostEnd)&&(hostEnd=hec)}-1!==(atSign=-1===hostEnd?rest.lastIndexOf('@'):rest.lastIndexOf('@',hostEnd))&&(auth=rest.slice(0,atSign),rest=rest.slice(atSign+1),this.auth=decodeURIComponent(auth)),hostEnd=-1;for(i=0;i<nonHostChars.length;i++){var hec;-1!==(hec=rest.indexOf(nonHostChars[i]))&&(-1===hostEnd||hec<hostEnd)&&(hostEnd=hec)}-1===hostEnd&&(hostEnd=rest.length),this.host=rest.slice(0,hostEnd),rest=rest.slice(hostEnd),this.parseHost(),this.hostname=this.hostname||'';var ipv6Hostname='['===this.hostname[0]&&']'===this.hostname[this.hostname.length-1];if(!ipv6Hostname)for(var hostparts=this.hostname.split(/\./),l=(i=0,hostparts.length);i<l;i++){var part=hostparts[i];if(part&&!part.match(hostnamePartPattern)){for(var newpart='',j=0,k=part.length;j<k;j++)part.charCodeAt(j)>127?newpart+='x':newpart+=part[j];if(!newpart.match(hostnamePartPattern)){var validParts=hostparts.slice(0,i),notHost=hostparts.slice(i+1),bit=part.match(hostnamePartStart);bit&&(validParts.push(bit[1]),notHost.unshift(bit[2])),notHost.length&&(rest='/'+notHost.join('.')+rest),this.hostname=validParts.join('.');break}}}this.hostname.length>255?this.hostname='':this.hostname=this.hostname.toLowerCase(),ipv6Hostname||(this.hostname=punycode.toASCII(this.hostname));var p=this.port?':'+this.port:'',h=this.hostname||'';this.host=h+p,this.href+=this.host,ipv6Hostname&&(this.hostname=this.hostname.substr(1,this.hostname.length-2),'/'!==rest[0]&&(rest='/'+rest))}if(!unsafeProtocol[lowerProto])for(i=0,l=autoEscape.length;i<l;i++){var ae=autoEscape[i];if(-1!==rest.indexOf(ae)){var esc=encodeURIComponent(ae);esc===ae&&(esc=escape(ae)),rest=rest.split(ae).join(esc)}}var hash=rest.indexOf('#');-1!==hash&&(this.hash=rest.substr(hash),rest=rest.slice(0,hash));var qm=rest.indexOf('?');if(-1!==qm?(this.search=rest.substr(qm),this.query=rest.substr(qm+1),parseQueryString&&(this.query=querystring.parse(this.query)),rest=rest.slice(0,qm)):parseQueryString&&(this.search='',this.query={}),rest&&(this.pathname=rest),slashedProtocol[lowerProto]&&this.hostname&&!this.pathname&&(this.pathname='/'),this.pathname||this.search){p=this.pathname||'';var s=this.search||'';this.path=p+s}return this.href=this.format(),this},Url.prototype.format=function(){var auth=this.auth||'';auth&&(auth=(auth=encodeURIComponent(auth)).replace(/%3A/i,':'),auth+='@');var protocol=this.protocol||'',pathname=this.pathname||'',hash=this.hash||'',host=!1,query='';this.host?host=auth+this.host:this.hostname&&(host=auth+(-1===this.hostname.indexOf(':')?this.hostname:'['+this.hostname+']'),this.port&&(host+=':'+this.port)),this.query&&util.isObject(this.query)&&Object.keys(this.query).length&&(query=querystring.stringify(this.query));var search=this.search||query&&'?'+query||'';return protocol&&':'!==protocol.substr(-1)&&(protocol+=':'),this.slashes||(!protocol||slashedProtocol[protocol])&&!1!==host?(host='//'+(host||''),pathname&&'/'!==pathname.charAt(0)&&(pathname='/'+pathname)):host||(host=''),hash&&'#'!==hash.charAt(0)&&(hash='#'+hash),search&&'?'!==search.charAt(0)&&(search='?'+search),protocol+host+(pathname=pathname.replace(/[?#]/g,function(match){return encodeURIComponent(match)}))+(search=search.replace('#','%23'))+hash},Url.prototype.resolve=function(relative){return this.resolveObject(urlParse(relative,!1,!0)).format()},Url.prototype.resolveObject=function(relative){if(util.isString(relative)){var rel=new Url;rel.parse(relative,!1,!0),relative=rel}for(var result=new Url,tkeys=Object.keys(this),tk=0;tk<tkeys.length;tk++){var tkey=tkeys[tk];result[tkey]=this[tkey]}if(result.hash=relative.hash,''===relative.href)return result.href=result.format(),result;if(relative.slashes&&!relative.protocol){for(var rkeys=Object.keys(relative),rk=0;rk<rkeys.length;rk++){var rkey=rkeys[rk];'protocol'!==rkey&&(result[rkey]=relative[rkey])}return slashedProtocol[result.protocol]&&result.hostname&&!result.pathname&&(result.path=result.pathname='/'),result.href=result.format(),result}if(relative.protocol&&relative.protocol!==result.protocol){if(!slashedProtocol[relative.protocol]){for(var keys=Object.keys(relative),v=0;v<keys.length;v++){var k=keys[v];result[k]=relative[k]}return result.href=result.format(),result}if(result.protocol=relative.protocol,relative.host||hostlessProtocol[relative.protocol])result.pathname=relative.pathname;else{for(var relPath=(relative.pathname||'').split('/');relPath.length&&!(relative.host=relPath.shift()););relative.host||(relative.host=''),relative.hostname||(relative.hostname=''),''!==relPath[0]&&relPath.unshift(''),relPath.length<2&&relPath.unshift(''),result.pathname=relPath.join('/')}if(result.search=relative.search,result.query=relative.query,result.host=relative.host||'',result.auth=relative.auth,result.hostname=relative.hostname||relative.host,result.port=relative.port,result.pathname||result.search){var p=result.pathname||'',s=result.search||'';result.path=p+s}return result.slashes=result.slashes||relative.slashes,result.href=result.format(),result}var isSourceAbs=result.pathname&&'/'===result.pathname.charAt(0),isRelAbs=relative.host||relative.pathname&&'/'===relative.pathname.charAt(0),mustEndAbs=isRelAbs||isSourceAbs||result.host&&relative.pathname,removeAllDots=mustEndAbs,srcPath=result.pathname&&result.pathname.split('/')||[],psychotic=(relPath=relative.pathname&&relative.pathname.split('/')||[],result.protocol&&!slashedProtocol[result.protocol]);if(psychotic&&(result.hostname='',result.port=null,result.host&&(''===srcPath[0]?srcPath[0]=result.host:srcPath.unshift(result.host)),result.host='',relative.protocol&&(relative.hostname=null,relative.port=null,relative.host&&(''===relPath[0]?relPath[0]=relative.host:relPath.unshift(relative.host)),relative.host=null),mustEndAbs=mustEndAbs&&(''===relPath[0]||''===srcPath[0])),isRelAbs)result.host=relative.host||''===relative.host?relative.host:result.host,result.hostname=relative.hostname||''===relative.hostname?relative.hostname:result.hostname,result.search=relative.search,result.query=relative.query,srcPath=relPath;else if(relPath.length)srcPath||(srcPath=[]),srcPath.pop(),srcPath=srcPath.concat(relPath),result.search=relative.search,result.query=relative.query;else if(!util.isNullOrUndefined(relative.search)){if(psychotic)result.hostname=result.host=srcPath.shift(),(authInHost=!!(result.host&&result.host.indexOf('@')>0)&&result.host.split('@'))&&(result.auth=authInHost.shift(),result.host=result.hostname=authInHost.shift());return result.search=relative.search,result.query=relative.query,util.isNull(result.pathname)&&util.isNull(result.search)||(result.path=(result.pathname?result.pathname:'')+(result.search?result.search:'')),result.href=result.format(),result}if(!srcPath.length)return result.pathname=null,result.search?result.path='/'+result.search:result.path=null,result.href=result.format(),result;for(var last=srcPath.slice(-1)[0],hasTrailingSlash=(result.host||relative.host||srcPath.length>1)&&('.'===last||'..'===last)||''===last,up=0,i=srcPath.length;i>=0;i--)'.'===(last=srcPath[i])?srcPath.splice(i,1):'..'===last?(srcPath.splice(i,1),up++):up&&(srcPath.splice(i,1),up--);if(!mustEndAbs&&!removeAllDots)for(;up--;up)srcPath.unshift('..');!mustEndAbs||''===srcPath[0]||srcPath[0]&&'/'===srcPath[0].charAt(0)||srcPath.unshift(''),hasTrailingSlash&&'/'!==srcPath.join('/').substr(-1)&&srcPath.push('');var authInHost,isAbsolute=''===srcPath[0]||srcPath[0]&&'/'===srcPath[0].charAt(0);psychotic&&(result.hostname=result.host=isAbsolute?'':srcPath.length?srcPath.shift():'',(authInHost=!!(result.host&&result.host.indexOf('@')>0)&&result.host.split('@'))&&(result.auth=authInHost.shift(),result.host=result.hostname=authInHost.shift()));return(mustEndAbs=mustEndAbs||result.host&&srcPath.length)&&!isAbsolute&&srcPath.unshift(''),srcPath.length?result.pathname=srcPath.join('/'):(result.pathname=null,result.path=null),util.isNull(result.pathname)&&util.isNull(result.search)||(result.path=(result.pathname?result.pathname:'')+(result.search?result.search:'')),result.auth=relative.auth||result.auth,result.slashes=result.slashes||relative.slashes,result.href=result.format(),result},Url.prototype.parseHost=function(){var host=this.host,port=portPattern.exec(host);port&&(':'!==(port=port[0])&&(this.port=port.substr(1)),host=host.substr(0,host.length-port.length)),host&&(this.hostname=host)}},{ 29:29,32:32,56:56 }],56:[function(_dereq_,module,exports){'use strict';module.exports={ isString:function(arg){return'string'==typeof arg},isObject:function(arg){return'object'==typeof arg&&null!==arg},isNull:function(arg){return null===arg},isNullOrUndefined:function(arg){return null==arg} }},{}],57:[function(_dereq_,module,exports){(function(global){function config(name){try{if(!global.localStorage)return!1}catch(_){return!1}var val=global.localStorage[name];return null!=val&&'true'===String(val).toLowerCase()}module.exports=function(fn,msg){if(config('noDeprecation'))return fn;var warned=!1;return function(){if(!warned){if(config('throwDeprecation'))throw new Error(msg);config('traceDeprecation'),warned=!0}return fn.apply(this,arguments)}}}).call(this,'undefined'!=typeof global?global:'undefined'!=typeof self?self:'undefined'!=typeof window?window:{})},{}],58:[function(_dereq_,module,exports){'use strict';Object.defineProperty(exports,'__esModule',{ value:!0 });var events=_dereq_(22),classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')},createClass=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,'value'in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}(),inherits=function(e,t){if('function'!=typeof t&&null!==t)throw new TypeError('Super expression must either be null or a function, not '+typeof t);e.prototype=Object.create(t&&t.prototype,{ constructor:{ value:e,enumerable:!1,writable:!0,configurable:!0 } }),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)},possibleConstructorReturn=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||'object'!=typeof t&&'function'!=typeof t?e:t},Ad=function e(){classCallCheck(this,e),this.id=null,this.sequence=null,this.system=null,this.title=null,this.description=null,this.advertiser=null,this.pricing=null,this.survey=null,this.errorURLTemplates=[],this.impressionURLTemplates=[],this.creatives=[],this.extensions=[]},AdExtension=function e(){classCallCheck(this,e),this.attributes={},this.children=[]},AdExtensionChild=function e(){classCallCheck(this,e),this.name=null,this.value=null,this.attributes={}},CompanionAd=function e(){classCallCheck(this,e),this.id=null,this.width=0,this.height=0,this.type=null,this.staticResource=null,this.htmlResource=null,this.iframeResource=null,this.altText=null,this.companionClickThroughURLTemplate=null,this.companionClickTrackingURLTemplates=[],this.trackingEvents={}},Creative=function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};classCallCheck(this,e),this.id=t.id||null,this.adId=t.adId||null,this.sequence=t.sequence||null,this.apiFramework=t.apiFramework||null,this.trackingEvents={}},CreativeCompanion=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};classCallCheck(this,t);var r=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.type='companion',r.variations=[],r}return inherits(t,Creative),t}();function resolveURLTemplates(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=[];for(var a in t.ASSETURI&&(t.ASSETURI=encodeURIComponentRFC3986(t.ASSETURI)),t.CONTENTPLAYHEAD&&(t.CONTENTPLAYHEAD=encodeURIComponentRFC3986(t.CONTENTPLAYHEAD)),!t.ERRORCODE||r.isCustomCode||/^[0-9]{3}$/.test(t.ERRORCODE)||(t.ERRORCODE=900),t.CACHEBUSTING=leftpad(Math.round(1e8*Math.random()).toString()),t.TIMESTAMP=encodeURIComponentRFC3986((new Date).toISOString()),t.RANDOM=t.random=t.CACHEBUSTING,e){var n=e[a];if('string'==typeof n){for(var s in t){var o=t[s],l='['+s+']',c='%%'+s+'%%';n=(n=n.replace(l,o)).replace(c,o)}i.push(n)}}return i}function encodeURIComponentRFC3986(e){return encodeURIComponent(e).replace(/[!'()*]/g,function(e){return'%'+e.charCodeAt(0).toString(16)})}function leftpad(e){return e.length<8?range(0,8-e.length,!1).map(function(){return'0'}).join('')+e:e}function range(e,t,r){for(var i=[],a=e<t,n=r?a?t+1:t-1:t,s=e;a?s<n:s>n;a?s++:s--)i.push(s);return i}var util={ track:function(e,t,r){resolveURLTemplates(e,t,r).forEach(function(e){'undefined'!=typeof window&&null!==window&&((new Image).src=e)})},resolveURLTemplates:resolveURLTemplates,encodeURIComponentRFC3986:encodeURIComponentRFC3986,leftpad:leftpad,range:range,isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},flatten:function flatten(e){return e.reduce(function(e,t){return e.concat(Array.isArray(t)?flatten(t):t)},[])} };var parserUtils={ childByName:function(e,t){var r=e.childNodes;for(var i in r){var a=r[i];if(a.nodeName===t)return a}},childrenByName:function(e,t){var r=[],i=e.childNodes;for(var a in i){var n=i[a];n.nodeName===t&&r.push(n)}return r},resolveVastAdTagURI:function(e,t){return t?0===e.indexOf('//')?''+location.protocol+e:-1===e.indexOf('://')?t.slice(0,t.lastIndexOf('/'))+'/'+e:e:e},parseBoolean:function(e){return-1!==['true','TRUE','1'].indexOf(e)},parseNodeText:function(e){return e&&(e.textContent||e.text||'').trim()},copyNodeAttribute:function(e,t,r){var i=t.getAttribute(e);i&&r.setAttribute(e,i)},parseDuration:function(e){if(null===e||void 0===e)return-1;if(util.isNumeric(e))return parseInt(e);var t=e.split(':');if(3!==t.length)return-1;var r=t[2].split('.'),i=parseInt(r[0]);2===r.length&&(i+=parseFloat('0.'+r[1]));var a=parseInt(60*t[1]),n=parseInt(60*t[0]*60);return isNaN(n)||isNaN(a)||isNaN(i)||a>3600||i>60?-1:n+a+i},splitVAST:function(e){var t=[],r=null;return e.forEach(function(i,a){if(i.sequence&&(i.sequence=parseInt(i.sequence,10)),i.sequence>1){var n=e[a-1];if(n&&n.sequence===i.sequence-1)return void(r&&r.push(i));delete i.sequence}r=[i],t.push(r)}),t},mergeWrapperAdData:function(e,t){e.errorURLTemplates=t.errorURLTemplates.concat(e.errorURLTemplates),e.impressionURLTemplates=t.impressionURLTemplates.concat(e.impressionURLTemplates),e.extensions=t.extensions.concat(e.extensions),e.creatives.forEach(function(e){if(t.trackingEvents&&t.trackingEvents[e.type])for(var r in t.trackingEvents[e.type]){var i=t.trackingEvents[e.type][r];Array.isArray(e.trackingEvents[r])||(e.trackingEvents[r]=[]),e.trackingEvents[r]=e.trackingEvents[r].concat(i)}}),t.videoClickTrackingURLTemplates&&t.videoClickTrackingURLTemplates.length&&e.creatives.forEach(function(e){'linear'===e.type&&(e.videoClickTrackingURLTemplates=e.videoClickTrackingURLTemplates.concat(t.videoClickTrackingURLTemplates))}),t.videoCustomClickURLTemplates&&t.videoCustomClickURLTemplates.length&&e.creatives.forEach(function(e){'linear'===e.type&&(e.videoCustomClickURLTemplates=e.videoCustomClickURLTemplates.concat(t.videoCustomClickURLTemplates))}),t.videoClickThroughURLTemplate&&e.creatives.forEach(function(e){'linear'!==e.type||null!==e.videoClickThroughURLTemplate&&void 0!==e.videoClickThroughURLTemplate||(e.videoClickThroughURLTemplate=t.videoClickThroughURLTemplate)})} };function parseCreativeCompanion(e,t){var r=new CreativeCompanion(t);return parserUtils.childrenByName(e,'Companion').forEach(function(e){var t=new CompanionAd;t.id=e.getAttribute('id')||null,t.width=e.getAttribute('width'),t.height=e.getAttribute('height'),t.companionClickTrackingURLTemplates=[],parserUtils.childrenByName(e,'HTMLResource').forEach(function(e){t.type=e.getAttribute('creativeType')||'text/html',t.htmlResource=parserUtils.parseNodeText(e)}),parserUtils.childrenByName(e,'IFrameResource').forEach(function(e){t.type=e.getAttribute('creativeType')||0,t.iframeResource=parserUtils.parseNodeText(e)}),parserUtils.childrenByName(e,'StaticResource').forEach(function(r){t.type=r.getAttribute('creativeType')||0,parserUtils.childrenByName(e,'AltText').forEach(function(e){t.altText=parserUtils.parseNodeText(e)}),t.staticResource=parserUtils.parseNodeText(r)}),parserUtils.childrenByName(e,'TrackingEvents').forEach(function(e){parserUtils.childrenByName(e,'Tracking').forEach(function(e){var r=e.getAttribute('event'),i=parserUtils.parseNodeText(e);r&&i&&(Array.isArray(t.trackingEvents[r])||(t.trackingEvents[r]=[]),t.trackingEvents[r].push(i))})}),parserUtils.childrenByName(e,'CompanionClickTracking').forEach(function(e){t.companionClickTrackingURLTemplates.push(parserUtils.parseNodeText(e))}),t.companionClickThroughURLTemplate=parserUtils.parseNodeText(parserUtils.childByName(e,'CompanionClickThrough')),t.companionClickTrackingURLTemplate=parserUtils.parseNodeText(parserUtils.childByName(e,'CompanionClickTracking')),r.variations.push(t)}),r}var CreativeLinear=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};classCallCheck(this,t);var r=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.type='linear',r.duration=0,r.skipDelay=null,r.mediaFiles=[],r.videoClickThroughURLTemplate=null,r.videoClickTrackingURLTemplates=[],r.videoCustomClickURLTemplates=[],r.adParameters=null,r.icons=[],r}return inherits(t,Creative),t}(),Icon=function e(){classCallCheck(this,e),this.program=null,this.height=0,this.width=0,this.xPosition=0,this.yPosition=0,this.apiFramework=null,this.offset=null,this.duration=0,this.type=null,this.staticResource=null,this.htmlResource=null,this.iframeResource=null,this.iconClickThroughURLTemplate=null,this.iconClickTrackingURLTemplates=[],this.iconViewTrackingURLTemplate=null},MediaFile=function e(){classCallCheck(this,e),this.id=null,this.fileURL=null,this.deliveryType='progressive',this.mimeType=null,this.codec=null,this.bitrate=0,this.minBitrate=0,this.maxBitrate=0,this.width=0,this.height=0,this.apiFramework=null,this.scalable=null,this.maintainAspectRatio=null};function parseCreativeLinear(e,t){var r=void 0,i=new CreativeLinear(t);i.duration=parserUtils.parseDuration(parserUtils.parseNodeText(parserUtils.childByName(e,'Duration')));var a=e.getAttribute('skipoffset');if(void 0===a||null===a)i.skipDelay=null;else if('%'===a.charAt(a.length-1)&&-1!==i.duration){var n=parseInt(a,10);i.skipDelay=i.duration*(n/100)}else i.skipDelay=parserUtils.parseDuration(a);var s=parserUtils.childByName(e,'VideoClicks');s&&(i.videoClickThroughURLTemplate=parserUtils.parseNodeText(parserUtils.childByName(s,'ClickThrough')),parserUtils.childrenByName(s,'ClickTracking').forEach(function(e){i.videoClickTrackingURLTemplates.push(parserUtils.parseNodeText(e))}),parserUtils.childrenByName(s,'CustomClick').forEach(function(e){i.videoCustomClickURLTemplates.push(parserUtils.parseNodeText(e))}));var o=parserUtils.childByName(e,'AdParameters');o&&(i.adParameters=parserUtils.parseNodeText(o)),parserUtils.childrenByName(e,'TrackingEvents').forEach(function(e){parserUtils.childrenByName(e,'Tracking').forEach(function(e){var t=e.getAttribute('event'),a=parserUtils.parseNodeText(e);if(t&&a){if('progress'===t){if(!(r=e.getAttribute('offset')))return;t='%'===r.charAt(r.length-1)?'progress-'+r:'progress-'+Math.round(parserUtils.parseDuration(r))}Array.isArray(i.trackingEvents[t])||(i.trackingEvents[t]=[]),i.trackingEvents[t].push(a)}})}),parserUtils.childrenByName(e,'MediaFiles').forEach(function(e){parserUtils.childrenByName(e,'MediaFile').forEach(function(e){var t=new MediaFile;t.id=e.getAttribute('id'),t.fileURL=parserUtils.parseNodeText(e),t.deliveryType=e.getAttribute('delivery'),t.codec=e.getAttribute('codec'),t.mimeType=e.getAttribute('type'),t.apiFramework=e.getAttribute('apiFramework'),t.bitrate=parseInt(e.getAttribute('bitrate')||0),t.minBitrate=parseInt(e.getAttribute('minBitrate')||0),t.maxBitrate=parseInt(e.getAttribute('maxBitrate')||0),t.width=parseInt(e.getAttribute('width')||0),t.height=parseInt(e.getAttribute('height')||0);var r=e.getAttribute('scalable');r&&'string'==typeof r&&('true'===(r=r.toLowerCase())?t.scalable=!0:'false'===r&&(t.scalable=!1));var a=e.getAttribute('maintainAspectRatio');a&&'string'==typeof a&&('true'===(a=a.toLowerCase())?t.maintainAspectRatio=!0:'false'===a&&(t.maintainAspectRatio=!1)),i.mediaFiles.push(t)})});var l=parserUtils.childByName(e,'Icons');return l&&parserUtils.childrenByName(l,'Icon').forEach(function(e){var t=new Icon;t.program=e.getAttribute('program'),t.height=parseInt(e.getAttribute('height')||0),t.width=parseInt(e.getAttribute('width')||0),t.xPosition=function(e){return-1!==['left','right'].indexOf(e)?e:parseInt(e||0)}(e.getAttribute('xPosition')),t.yPosition=function(e){return-1!==['top','bottom'].indexOf(e)?e:parseInt(e||0)}(e.getAttribute('yPosition')),t.apiFramework=e.getAttribute('apiFramework'),t.offset=parserUtils.parseDuration(e.getAttribute('offset')),t.duration=parserUtils.parseDuration(e.getAttribute('duration')),parserUtils.childrenByName(e,'HTMLResource').forEach(function(e){t.type=e.getAttribute('creativeType')||'text/html',t.htmlResource=parserUtils.parseNodeText(e)}),parserUtils.childrenByName(e,'IFrameResource').forEach(function(e){t.type=e.getAttribute('creativeType')||0,t.iframeResource=parserUtils.parseNodeText(e)}),parserUtils.childrenByName(e,'StaticResource').forEach(function(e){t.type=e.getAttribute('creativeType')||0,t.staticResource=parserUtils.parseNodeText(e)});var r=parserUtils.childByName(e,'IconClicks');r&&(t.iconClickThroughURLTemplate=parserUtils.parseNodeText(parserUtils.childByName(r,'IconClickThrough')),parserUtils.childrenByName(r,'IconClickTracking').forEach(function(e){t.iconClickTrackingURLTemplates.push(parserUtils.parseNodeText(e))})),t.iconViewTrackingURLTemplate=parserUtils.parseNodeText(parserUtils.childByName(e,'IconViewTracking')),i.icons.push(t)}),i}var CreativeNonLinear=function(e){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};classCallCheck(this,t);var r=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r.type='nonlinear',r.variations=[],r}return inherits(t,Creative),t}(),NonLinearAd=function e(){classCallCheck(this,e),this.id=null,this.width=0,this.height=0,this.expandedWidth=0,this.expandedHeight=0,this.scalable=!0,this.maintainAspectRatio=!0,this.minSuggestedDuration=0,this.apiFramework='static',this.type=null,this.staticResource=null,this.htmlResource=null,this.iframeResource=null,this.nonlinearClickThroughURLTemplate=null,this.nonlinearClickTrackingURLTemplates=[],this.adParameters=null};function parseCreativeNonLinear(e,t){var r=new CreativeNonLinear(t);return parserUtils.childrenByName(e,'TrackingEvents').forEach(function(e){var t=void 0,i=void 0;parserUtils.childrenByName(e,'Tracking').forEach(function(e){t=e.getAttribute('event'),i=parserUtils.parseNodeText(e),t&&i&&(Array.isArray(r.trackingEvents[t])||(r.trackingEvents[t]=[]),r.trackingEvents[t].push(i))})}),parserUtils.childrenByName(e,'NonLinear').forEach(function(e){var t=new NonLinearAd;t.id=e.getAttribute('id')||null,t.width=e.getAttribute('width'),t.height=e.getAttribute('height'),t.expandedWidth=e.getAttribute('expandedWidth'),t.expandedHeight=e.getAttribute('expandedHeight'),t.scalable=parserUtils.parseBoolean(e.getAttribute('scalable')),t.maintainAspectRatio=parserUtils.parseBoolean(e.getAttribute('maintainAspectRatio')),t.minSuggestedDuration=parserUtils.parseDuration(e.getAttribute('minSuggestedDuration')),t.apiFramework=e.getAttribute('apiFramework'),parserUtils.childrenByName(e,'HTMLResource').forEach(function(e){t.type=e.getAttribute('creativeType')||'text/html',t.htmlResource=parserUtils.parseNodeText(e)}),parserUtils.childrenByName(e,'IFrameResource').forEach(function(e){t.type=e.getAttribute('creativeType')||0,t.iframeResource=parserUtils.parseNodeText(e)}),parserUtils.childrenByName(e,'StaticResource').forEach(function(e){t.type=e.getAttribute('creativeType')||0,t.staticResource=parserUtils.parseNodeText(e)});var i=parserUtils.childByName(e,'AdParameters');i&&(t.adParameters=parserUtils.parseNodeText(i)),t.nonlinearClickThroughURLTemplate=parserUtils.parseNodeText(parserUtils.childByName(e,'NonLinearClickThrough')),parserUtils.childrenByName(e,'NonLinearClickTracking').forEach(function(e){t.nonlinearClickTrackingURLTemplates.push(parserUtils.parseNodeText(e))}),r.variations.push(t)}),r}function parseAd(e){var t=e.childNodes;for(var r in t){var i=t[r];if(-1!==['Wrapper','InLine'].indexOf(i.nodeName)){if(parserUtils.copyNodeAttribute('id',e,i),parserUtils.copyNodeAttribute('sequence',e,i),'Wrapper'===i.nodeName)return parseWrapper(i);if('InLine'===i.nodeName)return parseInLine(i)}}}function parseInLine(e){var t=e.childNodes,r=new Ad;for(var i in r.id=e.getAttribute('id')||null,r.sequence=e.getAttribute('sequence')||null,t){var a=t[i];switch(a.nodeName){case'Error':r.errorURLTemplates.push(parserUtils.parseNodeText(a));break;case'Impression':r.impressionURLTemplates.push(parserUtils.parseNodeText(a));break;case'Creatives':parserUtils.childrenByName(a,'Creative').forEach(function(e){var t={ id:e.getAttribute('id')||null,adId:parseCreativeAdIdAttribute(e),sequence:e.getAttribute('sequence')||null,apiFramework:e.getAttribute('apiFramework')||null };for(var i in e.childNodes){var a=e.childNodes[i],n=void 0;switch(a.nodeName){case'Linear':(n=parseCreativeLinear(a,t))&&r.creatives.push(n);break;case'NonLinearAds':(n=parseCreativeNonLinear(a,t))&&r.creatives.push(n);break;case'CompanionAds':(n=parseCreativeCompanion(a,t))&&r.creatives.push(n)}}});break;case'Extensions':parseExtensions(r.extensions,parserUtils.childrenByName(a,'Extension'));break;case'AdSystem':r.system={ value:parserUtils.parseNodeText(a),version:a.getAttribute('version')||null };break;case'AdTitle':r.title=parserUtils.parseNodeText(a);break;case'Description':r.description=parserUtils.parseNodeText(a);break;case'Advertiser':r.advertiser=parserUtils.parseNodeText(a);break;case'Pricing':r.pricing={ value:parserUtils.parseNodeText(a),model:a.getAttribute('model')||null,currency:a.getAttribute('currency')||null };break;case'Survey':r.survey=parserUtils.parseNodeText(a)}}return r}function parseWrapper(e){var t=parseInLine(e),r=parserUtils.childByName(e,'VASTAdTagURI');if(r?t.nextWrapperURL=parserUtils.parseNodeText(r):(r=parserUtils.childByName(e,'VASTAdTagURL'))&&(t.nextWrapperURL=parserUtils.parseNodeText(parserUtils.childByName(r,'URL'))),t.creatives.forEach(function(e){if(-1!==['linear','nonlinear'].indexOf(e.type)){if(e.trackingEvents){t.trackingEvents||(t.trackingEvents={}),t.trackingEvents[e.type]||(t.trackingEvents[e.type]={});var r=function(r){var i=e.trackingEvents[r];Array.isArray(t.trackingEvents[e.type][r])||(t.trackingEvents[e.type][r]=[]),i.forEach(function(i){t.trackingEvents[e.type][r].push(i)})};for(var i in e.trackingEvents)r(i)}e.videoClickTrackingURLTemplates&&(Array.isArray(t.videoClickTrackingURLTemplates)||(t.videoClickTrackingURLTemplates=[]),e.videoClickTrackingURLTemplates.forEach(function(e){t.videoClickTrackingURLTemplates.push(e)})),e.videoClickThroughURLTemplate&&(t.videoClickThroughURLTemplate=e.videoClickThroughURLTemplate),e.videoCustomClickURLTemplates&&(Array.isArray(t.videoCustomClickURLTemplates)||(t.videoCustomClickURLTemplates=[]),e.videoCustomClickURLTemplates.forEach(function(e){t.videoCustomClickURLTemplates.push(e)}))}}),t.nextWrapperURL)return t}function parseExtensions(e,t){t.forEach(function(t){var r=new AdExtension,i=t.attributes,a=t.childNodes;if(t.attributes)for(var n in i){var s=i[n];s.nodeName&&s.nodeValue&&(r.attributes[s.nodeName]=s.nodeValue)}for(var o in a){var l=a[o],c=parserUtils.parseNodeText(l);if('#comment'!==l.nodeName&&''!==c){var u=new AdExtensionChild;if(u.name=l.nodeName,u.value=c,l.attributes){var p=l.attributes;for(var h in p){var d=p[h];u.attributes[d.nodeName]=d.nodeValue}}r.children.push(u)}}e.push(r)})}function parseCreativeAdIdAttribute(e){return e.getAttribute('AdID')||e.getAttribute('adID')||e.getAttribute('adId')||null}function xdr(){var e=void 0;return window.XDomainRequest&&(e=new XDomainRequest),e}var flashURLHandler={ get:function(e,t,r){var i='function'==typeof window.ActiveXObject?new window.ActiveXObject('Microsoft.XMLDOM'):void 0;if(!i)return r(new Error('FlashURLHandler: Microsoft.XMLDOM format not supported'));i.async=!1;var a=xdr();a.open('GET',e),a.timeout=t.timeout||0,a.withCredentials=t.withCredentials||!1,a.send(),a.onprogress=function(){},a.onload=function(){i.loadXML(a.responseText),r(null,i)}},supported:function(){return!!xdr()} },uri=_dereq_(55),fs=_dereq_(17),http=_dereq_(35),https=_dereq_(23),DOMParser=_dereq_(60).DOMParser;var nodeURLHandler={ get:function(e,t,r){var i='https:'===(e=uri.parse(e)).protocol?https:http;if('file:'===e.protocol)fs.readFile(e.pathname,'utf8',function(e,t){if(e)return r(e);var i=(new DOMParser).parseFromString(t);r(null,i)});else{var a=void 0,n='',s=i.get(e.href,function(e){e.on('data',function(e){n+=e,clearTimeout(a),a=setTimeout(o,t.timeout||12e4)}),e.on('end',function(){clearTimeout(a);var e=(new DOMParser).parseFromString(n);r(null,e)})});s.on('error',function(e){clearTimeout(a),r(e)});var o=function(e){return function(){return e.abort()}}(s);a=setTimeout(o,t.timeout||12e4)}} };function xhr(){try{var e=new window.XMLHttpRequest;return'withCredentials'in e?e:null}catch(e){return null}}var XHRURLHandler={ get:function(e,t,r){if('https:'===window.location.protocol&&0===e.indexOf('http://'))return r(new Error('XHRURLHandler: Cannot go from HTTPS to HTTP.'));try{var i=xhr();i.open('GET',e),i.timeout=t.timeout||0,i.withCredentials=t.withCredentials||!1,i.overrideMimeType&&i.overrideMimeType('text/xml'),i.onreadystatechange=function(){4===i.readyState&&(200===i.status?r(null,i.responseXML):r(new Error('XHRURLHandler: '+i.statusText)))},i.send()}catch(e){r(new Error('XHRURLHandler: Unexpected error'))}},supported:function(){return!!xhr()} };var urlHandler={ get:function(e,t,r){return r||('function'==typeof t&&(r=t),t={}),'undefined'==typeof window||null===window?nodeURLHandler.get(e,t,r):XHRURLHandler.supported()?XHRURLHandler.get(e,t,r):flashURLHandler.supported()?flashURLHandler.get(e,t,r):r(new Error('Current context is not supported by any of the default URLHandlers. Please provide a custom URLHandler'))} },DEFAULT_EVENT_DATA={ ERRORCODE:900,extensions:[] },VASTParser=function(e){function t(){classCallCheck(this,t);var e=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.remainingAds=[],e.parentURLs=[],e.errorURLTemplates=[],e.rootErrorURLTemplates=[],e.maxWrapperDepth=null,e.URLTemplateFilters=[],e.fetchingOptions={},e}return inherits(t,e),createClass(t,[{ key:'addURLTemplateFilter',value:function(e){'function'==typeof e&&this.URLTemplateFilters.push(e)} },{ key:'removeURLTemplateFilter',value:function(){this.URLTemplateFilters.pop()} },{ key:'countURLTemplateFilters',value:function(){return this.URLTemplateFilters.length} },{ key:'clearURLTemplateFilters',value:function(){this.URLTemplateFilters=[]} },{ key:'trackVastError',value:function(e,t){for(var r=arguments.length,i=Array(r>2?r-2:0),a=2;a<r;a++)i[a-2]=arguments[a];this.emit('VAST-error',Object.assign.apply(Object,[DEFAULT_EVENT_DATA,t].concat(i))),util.track(e,t)} },{ key:'getErrorURLTemplates',value:function(){return this.rootErrorURLTemplates.concat(this.errorURLTemplates)} },{ key:'fetchVAST',value:function(e,t,r){var i=this;return new Promise(function(a,n){i.URLTemplateFilters.forEach(function(t){e=t(e)}),i.parentURLs.push(e),i.emit('VAST-resolving',{ url:e,wrapperDepth:t,originalUrl:r }),i.urlHandler.get(e,i.fetchingOptions,function(t,r){i.emit('VAST-resolved',{ url:e,error:t }),t?n(t):a(r)})})} },{ key:'initParsingStatus',value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.rootURL='',this.remainingAds=[],this.parentURLs=[],this.errorURLTemplates=[],this.rootErrorURLTemplates=[],this.maxWrapperDepth=e.wrapperLimit||10,this.fetchingOptions={ timeout:e.timeout,withCredentials:e.withCredentials },this.urlHandler=e.urlHandler||e.urlhandler||urlHandler,this.vastVersion=null} },{ key:'getRemainingAds',value:function(e){var t=this;if(0===this.remainingAds.length)return Promise.reject(new Error('No more ads are available for the given VAST'));var r=e?util.flatten(this.remainingAds):this.remainingAds.shift();return this.errorURLTemplates=[],this.parentURLs=[],this.resolveAds(r,{ wrapperDepth:0,originalUrl:this.rootURL }).then(function(e){return t.buildVASTResponse(e)})} },{ key:'getAndParseVAST',value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.initParsingStatus(r),this.rootURL=e,this.fetchVAST(e).then(function(i){return r.originalUrl=e,r.isRootVAST=!0,t.parse(i,r).then(function(e){return t.buildVASTResponse(e)})})} },{ key:'parseVAST',value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.initParsingStatus(r),r.isRootVAST=!0,this.parse(e,r).then(function(e){return t.buildVASTResponse(e)})} },{ key:'buildVASTResponse',value:function(e){var t=new function e(){classCallCheck(this,e),this.ads=[],this.errorURLTemplates=[],this.version=null};return t.ads=e,t.errorURLTemplates=this.getErrorURLTemplates(),t.version=this.vastVersion,this.completeWrapperResolving(t),t} },{ key:'parseVastXml',value:function(e,t){var r=t.isRootVAST,i=void 0!==r&&r;if(!e||!e.documentElement||'VAST'!==e.documentElement.nodeName)throw new Error('Invalid VAST XMLDocument');var a=[],n=e.documentElement.childNodes;if(i){var s=e.documentElement.getAttribute('version');s&&(this.vastVersion=s)}for(var o in n){var l=n[o];if('Error'===l.nodeName){var c=parserUtils.parseNodeText(l);i?this.rootErrorURLTemplates.push(c):this.errorURLTemplates.push(c)}if('Ad'===l.nodeName){var u=parseAd(l);u?a.push(u):this.trackVastError(this.getErrorURLTemplates(),{ ERRORCODE:101 })}}return a} },{ key:'parse',value:function(e,t){var r=t.resolveAll,i=void 0===r||r,a=t.wrapperSequence,n=void 0===a?null:a,s=t.originalUrl,o=void 0===s?null:s,l=t.wrapperDepth,c=void 0===l?0:l,u=t.isRootVAST,p=void 0!==u&&u,h=[];try{h=this.parseVastXml(e,{ isRootVAST:p })}catch(e){return Promise.reject(e)}var d=h.length,v=h[d-1];return 1===d&&void 0!==n&&null!==n&&v&&!v.sequence&&(v.sequence=n),!1===i&&(this.remainingAds=parserUtils.splitVAST(h),h=this.remainingAds.shift()),this.resolveAds(h,{ wrapperDepth:c,originalUrl:o })} },{ key:'resolveAds',value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments[1],i=r.wrapperDepth,a=r.originalUrl,n=[];return t.forEach(function(t){var r=e.resolveWrappers(t,i,a);n.push(r)}),Promise.all(n).then(function(t){var r=util.flatten(t);if(!r&&e.remainingAds.length>0){var n=e.remainingAds.shift();return e.resolveAds(n,{ wrapperDepth:i,originalUrl:a })}return r})} },{ key:'resolveWrappers',value:function(e,t,r){var i=this;return new Promise(function(a){if(t++,!e.nextWrapperURL)return delete e.nextWrapperURL,a(e);if(t>=i.maxWrapperDepth||-1!==i.parentURLs.indexOf(e.nextWrapperURL))return e.errorCode=302,delete e.nextWrapperURL,a(e);e.nextWrapperURL=parserUtils.resolveVastAdTagURI(e.nextWrapperURL,r);var n=e.sequence;r=e.nextWrapperURL,i.fetchVAST(e.nextWrapperURL,t,r).then(function(s){return i.parse(s,{ originalUrl:r,wrapperSequence:n,wrapperDepth:t }).then(function(t){if(delete e.nextWrapperURL,0===t.length)return e.creatives=[],a(e);t.forEach(function(t){t&&parserUtils.mergeWrapperAdData(t,e)}),a(t)})}).catch(function(t){e.errorCode=301,e.errorMessage=t.message,a(e)})})} },{ key:'completeWrapperResolving',value:function(e){if(0===e.ads.length)this.trackVastError(e.errorURLTemplates,{ ERRORCODE:303 });else for(var t=e.ads.length-1;t>=0;t--){var r=e.ads[t];(r.errorCode||0===r.creatives.length)&&(this.trackVastError(r.errorURLTemplates.concat(e.errorURLTemplates),{ ERRORCODE:r.errorCode||303 },{ ERRORMESSAGE:r.errorMessage||'' },{ extensions:r.extensions },{ system:r.system }),e.ads.splice(t,1))}} }]),t}(events.EventEmitter),storage=null,DEFAULT_STORAGE={ data:{},length:0,getItem:function(e){return this.data[e]},setItem:function(e,t){this.data[e]=t,this.length=Object.keys(this.data).length},removeItem:function(e){delete this.data[e],this.length=Object.keys(this.data).length},clear:function(){this.data={},this.length=0} },Storage=function(){function e(){classCallCheck(this,e),this.storage=this.initStorage()}return createClass(e,[{ key:'initStorage',value:function(){if(storage)return storage;try{storage='undefined'!=typeof window&&null!==window?window.localStorage||window.sessionStorage:null}catch(e){storage=null}return storage&&!this.isStorageDisabled(storage)||(storage=DEFAULT_STORAGE).clear(),storage} },{ key:'isStorageDisabled',value:function(e){var t='__VASTStorage__';try{if(e.setItem(t,t),e.getItem(t)!==t)return e.removeItem(t),!0}catch(e){return!0}return e.removeItem(t),!1} },{ key:'getItem',value:function(e){return this.storage.getItem(e)} },{ key:'setItem',value:function(e,t){return this.storage.setItem(e,t)} },{ key:'removeItem',value:function(e){return this.storage.removeItem(e)} },{ key:'clear',value:function(){return this.storage.clear()} }]),e}(),VASTClient=function(){function e(t,r,i){classCallCheck(this,e),this.cappingFreeLunch=t||0,this.cappingMinimumTimeInterval=r||0,this.defaultOptions={ withCredentials:!1,timeout:0 },this.vastParser=new VASTParser,this.storage=i||new Storage,void 0===this.lastSuccessfulAd&&(this.lastSuccessfulAd=0),void 0===this.totalCalls&&(this.totalCalls=0),void 0===this.totalCallsTimeout&&(this.totalCallsTimeout=0)}return createClass(e,[{ key:'getParser',value:function(){return this.vastParser} },{ key:'hasRemainingAds',value:function(){return this.vastParser.remainingAds.length>0} },{ key:'getNextAds',value:function(e){return this.vastParser.getRemainingAds(e)} },{ key:'get',value:function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=Date.now();return(r=Object.assign(this.defaultOptions,r)).hasOwnProperty('resolveAll')||(r.resolveAll=!1),this.totalCallsTimeout<i?(this.totalCalls=1,this.totalCallsTimeout=i+36e5):this.totalCalls++,new Promise(function(a,n){if(t.cappingFreeLunch>=t.totalCalls)return n(new Error('VAST call canceled  FreeLunch capping not reached yet '+t.totalCalls+'/'+t.cappingFreeLunch));var s=i-t.lastSuccessfulAd;if(s<0)t.lastSuccessfulAd=0;else if(s<t.cappingMinimumTimeInterval)return n(new Error('VAST call canceled  ('+t.cappingMinimumTimeInterval+')ms minimum interval reached'));t.vastParser.getAndParseVAST(e,r).then(function(e){return a(e)}).catch(function(e){return n(e)})})} },{ key:'lastSuccessfulAd',get:function(){return this.storage.getItem('vast-client-last-successful-ad')},set:function(e){this.storage.setItem('vast-client-last-successful-ad',e)} },{ key:'totalCalls',get:function(){return this.storage.getItem('vast-client-total-calls')},set:function(e){this.storage.setItem('vast-client-total-calls',e)} },{ key:'totalCallsTimeout',get:function(){return this.storage.getItem('vast-client-total-calls-timeout')},set:function(e){this.storage.setItem('vast-client-total-calls-timeout',e)} }]),e}(),VASTTracker=function(e){function t(e,r,i){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;classCallCheck(this,t);var n=possibleConstructorReturn(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));for(var s in n.ad=r,n.creative=i,n.variation=a,n.muted=!1,n.impressed=!1,n.skippable=!1,n.trackingEvents={},n._alreadyTriggeredQuartiles={},n.emitAlwaysEvents=['creativeView','start','firstQuartile','midpoint','thirdQuartile','complete','resume','pause','rewind','skip','closeLinear','close'],n.creative.trackingEvents){var o=n.creative.trackingEvents[s];n.trackingEvents[s]=o.slice(0)}return n.creative instanceof CreativeLinear?n._initLinearTracking():n._initVariationTracking(),e&&n.on('start',function(){e.lastSuccessfulAd=Date.now()}),n}return inherits(t,e),createClass(t,[{ key:'_initLinearTracking',value:function(){this.linear=!0,this.skipDelay=this.creative.skipDelay,this.setDuration(this.creative.duration),this.clickThroughURLTemplate=this.creative.videoClickThroughURLTemplate,this.clickTrackingURLTemplates=this.creative.videoClickTrackingURLTemplates} },{ key:'_initVariationTracking',value:function(){if(this.linear=!1,this.skipDelay=-1,this.variation){for(var e in this.variation.trackingEvents){var t=this.variation.trackingEvents[e];this.trackingEvents[e]?this.trackingEvents[e]=this.trackingEvents[e].concat(t.slice(0)):this.trackingEvents[e]=t.slice(0)}this.variation instanceof NonLinearAd?(this.clickThroughURLTemplate=this.variation.nonlinearClickThroughURLTemplate,this.clickTrackingURLTemplates=this.variation.nonlinearClickTrackingURLTemplates,this.setDuration(this.variation.minSuggestedDuration)):this.variation instanceof CompanionAd&&(this.clickThroughURLTemplate=this.variation.companionClickThroughURLTemplate,this.clickTrackingURLTemplates=this.variation.companionClickTrackingURLTemplates)}} },{ key:'setDuration',value:function(e){this.assetDuration=e,this.quartiles={ firstQuartile:Math.round(25*this.assetDuration)/100,midpoint:Math.round(50*this.assetDuration)/100,thirdQuartile:Math.round(75*this.assetDuration)/100 }} },{ key:'setProgress',value:function(e){var t=this,r=this.skipDelay||-1;if(-1===r||this.skippable||(r>e?this.emit('skip-countdown',r-e):(this.skippable=!0,this.emit('skip-countdown',0))),this.assetDuration>0){var i=[];if(e>0){var a=Math.round(e/this.assetDuration*100);for(var n in i.push('start'),i.push('progress-'+a+'%'),i.push('progress-'+Math.round(e)),this.quartiles)this.isQuartileReached(n,this.quartiles[n],e)&&(i.push(n),this._alreadyTriggeredQuartiles[n]=!0)}i.forEach(function(e){t.track(e,!0)}),e<this.progress&&this.track('rewind')}this.progress=e} },{ key:'isQuartileReached',value:function(e,t,r){var i=!1;return t<=r&&!this._alreadyTriggeredQuartiles[e]&&(i=!0),i} },{ key:'setMuted',value:function(e){this.muted!==e&&this.track(e?'mute':'unmute'),this.muted=e} },{ key:'setPaused',value:function(e){this.paused!==e&&this.track(e?'pause':'resume'),this.paused=e} },{ key:'setFullscreen',value:function(e){this.fullscreen!==e&&this.track(e?'fullscreen':'exitFullscreen'),this.fullscreen=e} },{ key:'setExpand',value:function(e){this.expanded!==e&&this.track(e?'expand':'collapse'),this.expanded=e} },{ key:'setSkipDelay',value:function(e){'number'==typeof e&&(this.skipDelay=e)} },{ key:'trackImpression',value:function(){this.impressed||(this.impressed=!0,this.trackURLs(this.ad.impressionURLTemplates),this.track('creativeView'))} },{ key:'errorWithCode',value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.trackURLs(this.ad.errorURLTemplates,{ ERRORCODE:e },{ isCustomCode:t })} },{ key:'complete',value:function(){this.track('complete')} },{ key:'close',value:function(){this.track(this.linear?'closeLinear':'close')} },{ key:'skip',value:function(){this.track('skip')} },{ key:'click',value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.clickTrackingURLTemplates&&this.clickTrackingURLTemplates.length&&this.trackURLs(this.clickTrackingURLTemplates);var t=this.clickThroughURLTemplate||e;if(t){var r=this.linear?{ CONTENTPLAYHEAD:this.progressFormatted() }:{},i=util.resolveURLTemplates([t],r)[0];this.emit('clickthrough',i)}} },{ key:'track',value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];'closeLinear'===e&&!this.trackingEvents[e]&&this.trackingEvents.close&&(e='close');var r=this.trackingEvents[e],i=this.emitAlwaysEvents.indexOf(e)>-1;r?(this.emit(e,''),this.trackURLs(r)):i&&this.emit(e,''),t&&(delete this.trackingEvents[e],i&&this.emitAlwaysEvents.splice(this.emitAlwaysEvents.indexOf(e),1))} },{ key:'trackURLs',value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.linear&&(this.creative&&this.creative.mediaFiles&&this.creative.mediaFiles[0]&&this.creative.mediaFiles[0].fileURL&&(t.ASSETURI=this.creative.mediaFiles[0].fileURL),t.CONTENTPLAYHEAD=this.progressFormatted()),util.track(e,t,r)} },{ key:'progressFormatted',value:function(){var e=parseInt(this.progress),t=e/3600;t.length<2&&(t='0'+t);var r=e/60%60;r.length<2&&(r='0'+r);var i=e%60;return i.length<2&&(i='0'+r),t+':'+r+':'+i+'.'+parseInt(100*(this.progress-e))} }]),t}(events.EventEmitter);exports.VASTClient=VASTClient,exports.VASTParser=VASTParser,exports.VASTTracker=VASTTracker},{ 17:17,22:22,23:23,35:35,55:55,60:60 }],59:[function(_dereq_,module,exports){'use strict';var classCallCheck=function(e,t){if(!(e instanceof t))throw new TypeError('Cannot call a class as a function')},createClass=function(){function e(e,t){for(var a=0;a<t.length;a++){var r=t[a];r.enumerable=r.enumerable||!1,r.configurable=!0,'value'in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,a,r){return a&&e(t.prototype,a),r&&e(t,r),t}}(),toConsumableArray=function(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)},VMAPAdSource=function e(t){for(var a in classCallCheck(this,e),this.id=t.getAttribute('id'),this.allowMultipleAds=t.getAttribute('allowMultipleAds'),this.followRedirects=t.getAttribute('followRedirects'),this.vastAdData=null,this.adTagURI=null,this.customData=null,t.childNodes){var r=t.childNodes[a];switch(r.localName){case'AdTagURI':this.adTagURI={ templateType:r.getAttribute('templateType'),uri:(r.textContent||r.text||'').trim() };break;case'VASTAdData':for(this.vastAdData=r.firstChild;this.vastAdData&&1!==this.vastAdData.nodeType;)this.vastAdData=this.vastAdData.nextSibling;break;case'CustomAdData':this.customData=r}}};function childrenByName(e,t){return[].concat(toConsumableArray(e.childNodes)).filter(function(e){return e.nodeName===t||t==='vmap:'+e.nodeName||e.nodeName==='vmap:'+t})}function parseXMLNode(e){var t={ attributes:{},children:{},value:{} };return t.value=function(e){var t=e&&e.childNodes&&[].concat(toConsumableArray(e.childNodes));if(!t)return{};var a=t.filter(function(e){return'#cdata-section'===e.nodeName});if(a&&a.length>0)try{return JSON.parse(a[0].data)}catch(e){}return t.reduce(function(e,t){var a='';switch(t.nodeName){case'#text':a=t.textContent.trim();break;case'#cdata-section':a=t.data}return e+a},'')}(e),e.attributes&&[].concat(toConsumableArray(e.attributes)).forEach(function(e){e.nodeName&&void 0!==e.nodeValue&&null!==e.nodeValue&&(t.attributes[e.nodeName]=e.nodeValue)}),e.childNodes&&[].concat(toConsumableArray(e.childNodes)).filter(function(e){return'#'!==e.nodeName.substring(0,1)}).forEach(function(e){t.children[e.nodeName]=parseXMLNode(e)}),t}var VMAPAdBreak=function(){function e(t){for(var a in classCallCheck(this,e),this.timeOffset=t.getAttribute('timeOffset'),this.breakType=t.getAttribute('breakType'),this.breakId=t.getAttribute('breakId'),this.repeatAfter=t.getAttribute('repeatAfter'),this.adSource=null,this.trackingEvents=[],this.extensions=[],t.childNodes){var r=t.childNodes[a];switch(r.localName){case'AdSource':this.adSource=new VMAPAdSource(r);break;case'TrackingEvents':for(var n in r.childNodes){var i=r.childNodes[n];'Tracking'===i.localName&&this.trackingEvents.push({ event:i.getAttribute('event'),uri:(i.textContent||i.text||'').trim() })}break;case'Extensions':this.extensions=childrenByName(r,'Extension').map(function(e){return parseXMLNode(e)})}}}return createClass(e,[{ key:'track',value:function(e,t){for(var a in this.trackingEvents){var r=this.trackingEvents[a];if(r.event===e){var n=r.uri;'error'===r.event&&(n=n.replace('[ERRORCODE]',t)),this.tracker(n)}}} },{ key:'tracker',value:function(e){'undefined'!=typeof window&&null!==window&&((new Image).src=e)} }]),e}();module.exports=function e(t){if(classCallCheck(this,e),!t||!t.documentElement||'VMAP'!==t.documentElement.localName)throw new Error('Not a VMAP document');for(var a in this.version=t.documentElement.getAttribute('version'),this.adBreaks=[],this.extensions=[],t.documentElement.childNodes){var r=t.documentElement.childNodes[a];switch(r.localName){case'AdBreak':this.adBreaks.push(new VMAPAdBreak(r));break;case'Extensions':this.extensions=childrenByName(r,'Extension').map(function(e){return parseXMLNode(e)})}}}},{}],60:[function(_dereq_,module,exports){function DOMParser(options){this.options=options||{ locator:{} }}function DOMHandler(){this.cdata=!1}function position(locator,node){node.lineNumber=locator.lineNumber,node.columnNumber=locator.columnNumber}function _locator(l){if(l)return'\n@'+(l.systemId||'')+'#[line:'+l.lineNumber+',col:'+l.columnNumber+']'}function _toString(chars,start,length){return'string'==typeof chars?chars.substr(start,length):chars.length>=start+length||start?new java.lang.String(chars,start,length)+'':chars}function appendElement(hander,node){hander.currentElement?hander.currentElement.appendChild(node):hander.doc.appendChild(node)}DOMParser.prototype.parseFromString=function(source,mimeType){var options=this.options,sax=new XMLReader,domBuilder=options.domBuilder||new DOMHandler,errorHandler=options.errorHandler,locator=options.locator,defaultNSMap=options.xmlns||{},entityMap={ lt:'<',gt:'>',amp:'&',quot:'"',apos:"'" };return locator&&domBuilder.setDocumentLocator(locator),sax.errorHandler=function(errorImpl,domBuilder,locator){if(!errorImpl){if(domBuilder instanceof DOMHandler)return domBuilder;errorImpl=domBuilder}var errorHandler={},isCallback=errorImpl instanceof Function;function build(key){var fn=errorImpl[key];!fn&&isCallback&&(fn=2==errorImpl.length?function(msg){errorImpl(key,msg)}:errorImpl),errorHandler[key]=fn&&function(msg){fn('[xmldom '+key+']\t'+msg+_locator(locator))}||function(){}}return locator=locator||{},build('warning'),build('error'),build('fatalError'),errorHandler}(errorHandler,domBuilder,locator),sax.domBuilder=options.domBuilder||domBuilder,/\/x?html?$/.test(mimeType)&&(entityMap.nbsp='',entityMap.copy='',defaultNSMap['']='http://www.w3.org/1999/xhtml'),defaultNSMap.xml=defaultNSMap.xml||'http://www.w3.org/XML/1998/namespace',source?sax.parse(source,defaultNSMap,entityMap):sax.errorHandler.error('invalid doc source'),domBuilder.doc},DOMHandler.prototype={ startDocument:function(){this.doc=(new DOMImplementation).createDocument(null,null,null),this.locator&&(this.doc.documentURI=this.locator.systemId)},startElement:function(namespaceURI,localName,qName,attrs){var doc=this.doc,el=doc.createElementNS(namespaceURI,qName||localName),len=attrs.length;appendElement(this,el),this.currentElement=el,this.locator&&position(this.locator,el);for(var i=0;i<len;i++){namespaceURI=attrs.getURI(i);var value=attrs.getValue(i),attr=(qName=attrs.getQName(i),doc.createAttributeNS(namespaceURI,qName));this.locator&&position(attrs.getLocator(i),attr),attr.value=attr.nodeValue=value,el.setAttributeNode(attr)}},endElement:function(namespaceURI,localName,qName){var current=this.currentElement;current.tagName;this.currentElement=current.parentNode},startPrefixMapping:function(prefix,uri){},endPrefixMapping:function(prefix){},processingInstruction:function(target,data){var ins=this.doc.createProcessingInstruction(target,data);this.locator&&position(this.locator,ins),appendElement(this,ins)},ignorableWhitespace:function(ch,start,length){},characters:function(chars,start,length){if(chars=_toString.apply(this,arguments)){if(this.cdata)var charNode=this.doc.createCDATASection(chars);else charNode=this.doc.createTextNode(chars);this.currentElement?this.currentElement.appendChild(charNode):/^\s*$/.test(chars)&&this.doc.appendChild(charNode),this.locator&&position(this.locator,charNode)}},skippedEntity:function(name){},endDocument:function(){this.doc.normalize()},setDocumentLocator:function(locator){(this.locator=locator)&&(locator.lineNumber=0)},comment:function(chars,start,length){chars=_toString.apply(this,arguments);var comm=this.doc.createComment(chars);this.locator&&position(this.locator,comm),appendElement(this,comm)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(name,publicId,systemId){var impl=this.doc.implementation;if(impl&&impl.createDocumentType){var dt=impl.createDocumentType(name,publicId,systemId);this.locator&&position(this.locator,dt),appendElement(this,dt)}},warning:function(error){},error:function(error){},fatalError:function(error){throw error} },'endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl'.replace(/\w+/g,function(key){DOMHandler.prototype[key]=function(){return null}});var XMLReader=_dereq_(62).XMLReader,DOMImplementation=exports.DOMImplementation=_dereq_(61).DOMImplementation;exports.XMLSerializer=_dereq_(61).XMLSerializer,exports.DOMParser=DOMParser},{ 61:61,62:62 }],61:[function(_dereq_,module,exports){function copy(src,dest){for(var p in src)dest[p]=src[p]}function _extends(Class,Super){var pt=Class.prototype;if(Object.create){var ppt=Object.create(Super.prototype);pt.__proto__=ppt}if(!(pt instanceof Super)){function t(){}t.prototype=Super.prototype,copy(pt,t=new t),Class.prototype=pt=t}pt.constructor!=Class&&(pt.constructor=Class)}var htmlns='http://www.w3.org/1999/xhtml',NodeType={},ELEMENT_NODE=NodeType.ELEMENT_NODE=1,ATTRIBUTE_NODE=NodeType.ATTRIBUTE_NODE=2,TEXT_NODE=NodeType.TEXT_NODE=3,CDATA_SECTION_NODE=NodeType.CDATA_SECTION_NODE=4,ENTITY_REFERENCE_NODE=NodeType.ENTITY_REFERENCE_NODE=5,ENTITY_NODE=NodeType.ENTITY_NODE=6,PROCESSING_INSTRUCTION_NODE=NodeType.PROCESSING_INSTRUCTION_NODE=7,COMMENT_NODE=NodeType.COMMENT_NODE=8,DOCUMENT_NODE=NodeType.DOCUMENT_NODE=9,DOCUMENT_TYPE_NODE=NodeType.DOCUMENT_TYPE_NODE=10,DOCUMENT_FRAGMENT_NODE=NodeType.DOCUMENT_FRAGMENT_NODE=11,NOTATION_NODE=NodeType.NOTATION_NODE=12,ExceptionCode={},ExceptionMessage={},HIERARCHY_REQUEST_ERR=(ExceptionCode.INDEX_SIZE_ERR=(ExceptionMessage[1]='Index size error',1),ExceptionCode.DOMSTRING_SIZE_ERR=(ExceptionMessage[2]='DOMString size error',2),ExceptionCode.HIERARCHY_REQUEST_ERR=(ExceptionMessage[3]='Hierarchy request error',3)),NOT_FOUND_ERR=(ExceptionCode.WRONG_DOCUMENT_ERR=(ExceptionMessage[4]='Wrong document',4),ExceptionCode.INVALID_CHARACTER_ERR=(ExceptionMessage[5]='Invalid character',5),ExceptionCode.NO_DATA_ALLOWED_ERR=(ExceptionMessage[6]='No data allowed',6),ExceptionCode.NO_MODIFICATION_ALLOWED_ERR=(ExceptionMessage[7]='No modification allowed',7),ExceptionCode.NOT_FOUND_ERR=(ExceptionMessage[8]='Not found',8)),INUSE_ATTRIBUTE_ERR=(ExceptionCode.NOT_SUPPORTED_ERR=(ExceptionMessage[9]='Not supported',9),ExceptionCode.INUSE_ATTRIBUTE_ERR=(ExceptionMessage[10]='Attribute in use',10));ExceptionCode.INVALID_STATE_ERR=(ExceptionMessage[11]='Invalid state',11),ExceptionCode.SYNTAX_ERR=(ExceptionMessage[12]='Syntax error',12),ExceptionCode.INVALID_MODIFICATION_ERR=(ExceptionMessage[13]='Invalid modification',13),ExceptionCode.NAMESPACE_ERR=(ExceptionMessage[14]='Invalid namespace',14),ExceptionCode.INVALID_ACCESS_ERR=(ExceptionMessage[15]='Invalid access',15);function DOMException(code,message){if(message instanceof Error)var error=message;else error=this,Error.call(this,ExceptionMessage[code]),this.message=ExceptionMessage[code],Error.captureStackTrace&&Error.captureStackTrace(this,DOMException);return error.code=code,message&&(this.message=this.message+': '+message),error}function NodeList(){}function LiveNodeList(node,refresh){this._node=node,this._refresh=refresh,_updateLiveList(this)}function _updateLiveList(list){var inc=list._node._inc||list._node.ownerDocument._inc;if(list._inc!=inc){var ls=list._refresh(list._node);__set__(list,'length',ls.length),copy(ls,list),list._inc=inc}}function NamedNodeMap(){}function _findNodeIndex(list,node){for(var i=list.length;i--;)if(list[i]===node)return i}function _addNamedNode(el,list,newAttr,oldAttr){if(oldAttr?list[_findNodeIndex(list,oldAttr)]=newAttr:list[list.length++]=newAttr,el){newAttr.ownerElement=el;var doc=el.ownerDocument;doc&&(oldAttr&&_onRemoveAttribute(doc,el,oldAttr),function(doc,el,newAttr){doc&&doc._inc++,'http://www.w3.org/2000/xmlns/'==newAttr.namespaceURI&&(el._nsMap[newAttr.prefix?newAttr.localName:'']=newAttr.value)}(doc,el,newAttr))}}function _removeNamedNode(el,list,attr){var i=_findNodeIndex(list,attr);if(!(i>=0))throw DOMException(NOT_FOUND_ERR,new Error(el.tagName+'@'+attr));for(var lastIndex=list.length-1;i<lastIndex;)list[i]=list[++i];if(list.length=lastIndex,el){var doc=el.ownerDocument;doc&&(_onRemoveAttribute(doc,el,attr),attr.ownerElement=null)}}function DOMImplementation(features){if(this._features={},features)for(var feature in features)this._features=features[feature]}function Node(){}function _xmlEncoder(c){return('<'==c?'&lt;':'>'==c&&'&gt;')||'&'==c&&'&amp;'||'"'==c&&'&quot;'||'&#'+c.charCodeAt()+';'}function _visitNode(node,callback){if(callback(node))return!0;if(node=node.firstChild)do{if(_visitNode(node,callback))return!0}while(node=node.nextSibling)}function Document(){}function _onRemoveAttribute(doc,el,newAttr,remove){doc&&doc._inc++,'http://www.w3.org/2000/xmlns/'==newAttr.namespaceURI&&delete el._nsMap[newAttr.prefix?newAttr.localName:'']}function _onUpdateChild(doc,el,newChild){if(doc&&doc._inc){doc._inc++;var cs=el.childNodes;if(newChild)cs[cs.length++]=newChild;else{for(var child=el.firstChild,i=0;child;)cs[i++]=child,child=child.nextSibling;cs.length=i}}}function _removeChild(parentNode,child){var previous=child.previousSibling,next=child.nextSibling;return previous?previous.nextSibling=next:parentNode.firstChild=next,next?next.previousSibling=previous:parentNode.lastChild=previous,_onUpdateChild(parentNode.ownerDocument,parentNode),child}function _insertBefore(parentNode,newChild,nextChild){var cp=newChild.parentNode;if(cp&&cp.removeChild(newChild),newChild.nodeType===DOCUMENT_FRAGMENT_NODE){var newFirst=newChild.firstChild;if(null==newFirst)return newChild;var newLast=newChild.lastChild}else newFirst=newLast=newChild;var pre=nextChild?nextChild.previousSibling:parentNode.lastChild;newFirst.previousSibling=pre,newLast.nextSibling=nextChild,pre?pre.nextSibling=newFirst:parentNode.firstChild=newFirst,null==nextChild?parentNode.lastChild=newLast:nextChild.previousSibling=newLast;do{newFirst.parentNode=parentNode}while(newFirst!==newLast&&(newFirst=newFirst.nextSibling));return _onUpdateChild(parentNode.ownerDocument||parentNode,parentNode),newChild.nodeType==DOCUMENT_FRAGMENT_NODE&&(newChild.firstChild=newChild.lastChild=null),newChild}function Element(){this._nsMap={}}function Attr(){}function CharacterData(){}function Text(){}function Comment(){}function CDATASection(){}function DocumentType(){}function Notation(){}function Entity(){}function EntityReference(){}function DocumentFragment(){}function ProcessingInstruction(){}function XMLSerializer(){}function nodeSerializeToString(isHtml,nodeFilter){var buf=[],refNode=9==this.nodeType?this.documentElement:this,prefix=refNode.prefix,uri=refNode.namespaceURI;if(uri&&null==prefix&&null==(prefix=refNode.lookupPrefix(uri)))var visibleNamespaces=[{ namespace:uri,prefix:null }];return serializeToString(this,buf,isHtml,nodeFilter,visibleNamespaces),buf.join('')}function needNamespaceDefine(node,isHTML,visibleNamespaces){var prefix=node.prefix||'',uri=node.namespaceURI;if(!prefix&&!uri)return!1;if('xml'===prefix&&'http://www.w3.org/XML/1998/namespace'===uri||'http://www.w3.org/2000/xmlns/'==uri)return!1;for(var i=visibleNamespaces.length;i--;){var ns=visibleNamespaces[i];if(ns.prefix==prefix)return ns.namespace!=uri}return!0}function serializeToString(node,buf,isHTML,nodeFilter,visibleNamespaces){if(nodeFilter){if(!(node=nodeFilter(node)))return;if('string'==typeof node)return void buf.push(node)}switch(node.nodeType){case ELEMENT_NODE:visibleNamespaces||(visibleNamespaces=[]);visibleNamespaces.length;var attrs=node.attributes,len=attrs.length,child=node.firstChild,nodeName=node.tagName;isHTML=htmlns===node.namespaceURI||isHTML,buf.push('<',nodeName);for(var i=0;i<len;i++){'xmlns'==(attr=attrs.item(i)).prefix?visibleNamespaces.push({ prefix:attr.localName,namespace:attr.value }):'xmlns'==attr.nodeName&&visibleNamespaces.push({ prefix:'',namespace:attr.value })}for(i=0;i<len;i++){var attr;if(needNamespaceDefine(attr=attrs.item(i),0,visibleNamespaces)){var prefix=attr.prefix||'',uri=attr.namespaceURI,ns=prefix?' xmlns:'+prefix:' xmlns';buf.push(ns,'="',uri,'"'),visibleNamespaces.push({ prefix:prefix,namespace:uri })}serializeToString(attr,buf,isHTML,nodeFilter,visibleNamespaces)}if(needNamespaceDefine(node,0,visibleNamespaces)){prefix=node.prefix||'',uri=node.namespaceURI,ns=prefix?' xmlns:'+prefix:' xmlns';buf.push(ns,'="',uri,'"'),visibleNamespaces.push({ prefix:prefix,namespace:uri })}if(child||isHTML&&!/^(?:meta|link|img|br|hr|input)$/i.test(nodeName)){if(buf.push('>'),isHTML&&/^script$/i.test(nodeName))for(;child;)child.data?buf.push(child.data):serializeToString(child,buf,isHTML,nodeFilter,visibleNamespaces),child=child.nextSibling;else for(;child;)serializeToString(child,buf,isHTML,nodeFilter,visibleNamespaces),child=child.nextSibling;buf.push('</',nodeName,'>')}else buf.push('/>');return;case DOCUMENT_NODE:case DOCUMENT_FRAGMENT_NODE:for(child=node.firstChild;child;)serializeToString(child,buf,isHTML,nodeFilter,visibleNamespaces),child=child.nextSibling;return;case ATTRIBUTE_NODE:return buf.push(' ',node.name,'="',node.value.replace(/[<&"]/g,_xmlEncoder),'"');case TEXT_NODE:return buf.push(node.data.replace(/[<&]/g,_xmlEncoder));case CDATA_SECTION_NODE:return buf.push('<![CDATA[',node.data,']]>');case COMMENT_NODE:return buf.push('\x3c!--',node.data,'--\x3e');case DOCUMENT_TYPE_NODE:var pubid=node.publicId,sysid=node.systemId;if(buf.push('<!DOCTYPE ',node.name),pubid)buf.push(' PUBLIC "',pubid),sysid&&'.'!=sysid&&buf.push('" "',sysid),buf.push('">');else if(sysid&&'.'!=sysid)buf.push(' SYSTEM "',sysid,'">');else{var sub=node.internalSubset;sub&&buf.push(' [',sub,']'),buf.push('>')}return;case PROCESSING_INSTRUCTION_NODE:return buf.push('<?',node.target,' ',node.data,'?>');case ENTITY_REFERENCE_NODE:return buf.push('&',node.nodeName,';');default:buf.push('??',node.nodeName)}}function __set__(object,key,value){object[key]=value}DOMException.prototype=Error.prototype,copy(ExceptionCode,DOMException),NodeList.prototype={ length:0,item:function(index){return this[index]||null},toString:function(isHTML,nodeFilter){for(var buf=[],i=0;i<this.length;i++)serializeToString(this[i],buf,isHTML,nodeFilter);return buf.join('')} },LiveNodeList.prototype.item=function(i){return _updateLiveList(this),this[i]},_extends(LiveNodeList,NodeList),NamedNodeMap.prototype={ length:0,item:NodeList.prototype.item,getNamedItem:function(key){for(var i=this.length;i--;){var attr=this[i];if(attr.nodeName==key)return attr}},setNamedItem:function(attr){var el=attr.ownerElement;if(el&&el!=this._ownerElement)throw new DOMException(INUSE_ATTRIBUTE_ERR);var oldAttr=this.getNamedItem(attr.nodeName);return _addNamedNode(this._ownerElement,this,attr,oldAttr),oldAttr},setNamedItemNS:function(attr){var oldAttr,el=attr.ownerElement;if(el&&el!=this._ownerElement)throw new DOMException(INUSE_ATTRIBUTE_ERR);return oldAttr=this.getNamedItemNS(attr.namespaceURI,attr.localName),_addNamedNode(this._ownerElement,this,attr,oldAttr),oldAttr},removeNamedItem:function(key){var attr=this.getNamedItem(key);return _removeNamedNode(this._ownerElement,this,attr),attr},removeNamedItemNS:function(namespaceURI,localName){var attr=this.getNamedItemNS(namespaceURI,localName);return _removeNamedNode(this._ownerElement,this,attr),attr},getNamedItemNS:function(namespaceURI,localName){for(var i=this.length;i--;){var node=this[i];if(node.localName==localName&&node.namespaceURI==namespaceURI)return node}return null} },DOMImplementation.prototype={ hasFeature:function(feature,version){var versions=this._features[feature.toLowerCase()];return!(!versions||version&&!(version in versions))},createDocument:function(namespaceURI,qualifiedName,doctype){var doc=new Document;if(doc.implementation=this,doc.childNodes=new NodeList,doc.doctype=doctype,doctype&&doc.appendChild(doctype),qualifiedName){var root=doc.createElementNS(namespaceURI,qualifiedName);doc.appendChild(root)}return doc},createDocumentType:function(qualifiedName,publicId,systemId){var node=new DocumentType;return node.name=qualifiedName,node.nodeName=qualifiedName,node.publicId=publicId,node.systemId=systemId,node} },Node.prototype={ firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(newChild,refChild){return _insertBefore(this,newChild,refChild)},replaceChild:function(newChild,oldChild){this.insertBefore(newChild,oldChild),oldChild&&this.removeChild(oldChild)},removeChild:function(oldChild){return _removeChild(this,oldChild)},appendChild:function(newChild){return this.insertBefore(newChild,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(deep){return function cloneNode(doc,node,deep){var node2=new node.constructor;for(var n in node){var v=node[n];'object'!=typeof v&&v!=node2[n]&&(node2[n]=v)}node.childNodes&&(node2.childNodes=new NodeList);node2.ownerDocument=doc;switch(node2.nodeType){case ELEMENT_NODE:var attrs=node.attributes,attrs2=node2.attributes=new NamedNodeMap,len=attrs.length;attrs2._ownerElement=node2;for(var i=0;i<len;i++)node2.setAttributeNode(cloneNode(doc,attrs.item(i),!0));break;case ATTRIBUTE_NODE:deep=!0}if(deep)for(var child=node.firstChild;child;)node2.appendChild(cloneNode(doc,child,deep)),child=child.nextSibling;return node2}(this.ownerDocument||this,this,deep)},normalize:function(){for(var child=this.firstChild;child;){var next=child.nextSibling;next&&next.nodeType==TEXT_NODE&&child.nodeType==TEXT_NODE?(this.removeChild(next),child.appendData(next.data)):(child.normalize(),child=next)}},isSupported:function(feature,version){return this.ownerDocument.implementation.hasFeature(feature,version)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(namespaceURI){for(var el=this;el;){var map=el._nsMap;if(map)for(var n in map)if(map[n]==namespaceURI)return n;el=el.nodeType==ATTRIBUTE_NODE?el.ownerDocument:el.parentNode}return null},lookupNamespaceURI:function(prefix){for(var el=this;el;){var map=el._nsMap;if(map&&prefix in map)return map[prefix];el=el.nodeType==ATTRIBUTE_NODE?el.ownerDocument:el.parentNode}return null},isDefaultNamespace:function(namespaceURI){return null==this.lookupPrefix(namespaceURI)} },copy(NodeType,Node),copy(NodeType,Node.prototype),Document.prototype={ nodeName:'#document',nodeType:DOCUMENT_NODE,doctype:null,documentElement:null,_inc:1,insertBefore:function(newChild,refChild){if(newChild.nodeType==DOCUMENT_FRAGMENT_NODE){for(var child=newChild.firstChild;child;){var next=child.nextSibling;this.insertBefore(child,refChild),child=next}return newChild}return null==this.documentElement&&newChild.nodeType==ELEMENT_NODE&&(this.documentElement=newChild),_insertBefore(this,newChild,refChild),newChild.ownerDocument=this,newChild},removeChild:function(oldChild){return this.documentElement==oldChild&&(this.documentElement=null),_removeChild(this,oldChild)},importNode:function(importedNode,deep){return function importNode(doc,node,deep){var node2;switch(node.nodeType){case ELEMENT_NODE:(node2=node.cloneNode(!1)).ownerDocument=doc;case DOCUMENT_FRAGMENT_NODE:break;case ATTRIBUTE_NODE:deep=!0}node2||(node2=node.cloneNode(!1));node2.ownerDocument=doc;node2.parentNode=null;if(deep)for(var child=node.firstChild;child;)node2.appendChild(importNode(doc,child,deep)),child=child.nextSibling;return node2}(this,importedNode,deep)},getElementById:function(id){var rtv=null;return _visitNode(this.documentElement,function(node){if(node.nodeType==ELEMENT_NODE&&node.getAttribute('id')==id)return rtv=node,!0}),rtv},createElement:function(tagName){var node=new Element;return node.ownerDocument=this,node.nodeName=tagName,node.tagName=tagName,node.childNodes=new NodeList,(node.attributes=new NamedNodeMap)._ownerElement=node,node},createDocumentFragment:function(){var node=new DocumentFragment;return node.ownerDocument=this,node.childNodes=new NodeList,node},createTextNode:function(data){var node=new Text;return node.ownerDocument=this,node.appendData(data),node},createComment:function(data){var node=new Comment;return node.ownerDocument=this,node.appendData(data),node},createCDATASection:function(data){var node=new CDATASection;return node.ownerDocument=this,node.appendData(data),node},createProcessingInstruction:function(target,data){var node=new ProcessingInstruction;return node.ownerDocument=this,node.tagName=node.target=target,node.nodeValue=node.data=data,node},createAttribute:function(name){var node=new Attr;return node.ownerDocument=this,node.name=name,node.nodeName=name,node.localName=name,node.specified=!0,node},createEntityReference:function(name){var node=new EntityReference;return node.ownerDocument=this,node.nodeName=name,node},createElementNS:function(namespaceURI,qualifiedName){var node=new Element,pl=qualifiedName.split(':'),attrs=node.attributes=new NamedNodeMap;return node.childNodes=new NodeList,node.ownerDocument=this,node.nodeName=qualifiedName,node.tagName=qualifiedName,node.namespaceURI=namespaceURI,2==pl.length?(node.prefix=pl[0],node.localName=pl[1]):node.localName=qualifiedName,attrs._ownerElement=node,node},createAttributeNS:function(namespaceURI,qualifiedName){var node=new Attr,pl=qualifiedName.split(':');return node.ownerDocument=this,node.nodeName=qualifiedName,node.name=qualifiedName,node.namespaceURI=namespaceURI,node.specified=!0,2==pl.length?(node.prefix=pl[0],node.localName=pl[1]):node.localName=qualifiedName,node} },_extends(Document,Node),Element.prototype={ nodeType:ELEMENT_NODE,hasAttribute:function(name){return null!=this.getAttributeNode(name)},getAttribute:function(name){var attr=this.getAttributeNode(name);return attr&&attr.value||''},getAttributeNode:function(name){return this.attributes.getNamedItem(name)},setAttribute:function(name,value){var attr=this.ownerDocument.createAttribute(name);attr.value=attr.nodeValue=''+value,this.setAttributeNode(attr)},removeAttribute:function(name){var attr=this.getAttributeNode(name);attr&&this.removeAttributeNode(attr)},appendChild:function(newChild){return newChild.nodeType===DOCUMENT_FRAGMENT_NODE?this.insertBefore(newChild,null):function(parentNode,newChild){var cp=newChild.parentNode;if(cp){var pre=parentNode.lastChild;cp.removeChild(newChild),pre=parentNode.lastChild}return pre=parentNode.lastChild,newChild.parentNode=parentNode,newChild.previousSibling=pre,newChild.nextSibling=null,pre?pre.nextSibling=newChild:parentNode.firstChild=newChild,parentNode.lastChild=newChild,_onUpdateChild(parentNode.ownerDocument,parentNode,newChild),newChild}(this,newChild)},setAttributeNode:function(newAttr){return this.attributes.setNamedItem(newAttr)},setAttributeNodeNS:function(newAttr){return this.attributes.setNamedItemNS(newAttr)},removeAttributeNode:function(oldAttr){return this.attributes.removeNamedItem(oldAttr.nodeName)},removeAttributeNS:function(namespaceURI,localName){var old=this.getAttributeNodeNS(namespaceURI,localName);old&&this.removeAttributeNode(old)},hasAttributeNS:function(namespaceURI,localName){return null!=this.getAttributeNodeNS(namespaceURI,localName)},getAttributeNS:function(namespaceURI,localName){var attr=this.getAttributeNodeNS(namespaceURI,localName);return attr&&attr.value||''},setAttributeNS:function(namespaceURI,qualifiedName,value){var attr=this.ownerDocument.createAttributeNS(namespaceURI,qualifiedName);attr.value=attr.nodeValue=''+value,this.setAttributeNode(attr)},getAttributeNodeNS:function(namespaceURI,localName){return this.attributes.getNamedItemNS(namespaceURI,localName)},getElementsByTagName:function(tagName){return new LiveNodeList(this,function(base){var ls=[];return _visitNode(base,function(node){node===base||node.nodeType!=ELEMENT_NODE||'*'!==tagName&&node.tagName!=tagName||ls.push(node)}),ls})},getElementsByTagNameNS:function(namespaceURI,localName){return new LiveNodeList(this,function(base){var ls=[];return _visitNode(base,function(node){node===base||node.nodeType!==ELEMENT_NODE||'*'!==namespaceURI&&node.namespaceURI!==namespaceURI||'*'!==localName&&node.localName!=localName||ls.push(node)}),ls})} },Document.prototype.getElementsByTagName=Element.prototype.getElementsByTagName,Document.prototype.getElementsByTagNameNS=Element.prototype.getElementsByTagNameNS,_extends(Element,Node),Attr.prototype.nodeType=ATTRIBUTE_NODE,_extends(Attr,Node),CharacterData.prototype={ data:'',substringData:function(offset,count){return this.data.substring(offset,offset+count)},appendData:function(text){text=this.data+text,this.nodeValue=this.data=text,this.length=text.length},insertData:function(offset,text){this.replaceData(offset,0,text)},appendChild:function(newChild){throw new Error(ExceptionMessage[HIERARCHY_REQUEST_ERR])},deleteData:function(offset,count){this.replaceData(offset,count,'')},replaceData:function(offset,count,text){text=this.data.substring(0,offset)+text+this.data.substring(offset+count),this.nodeValue=this.data=text,this.length=text.length} },_extends(CharacterData,Node),Text.prototype={ nodeName:'#text',nodeType:TEXT_NODE,splitText:function(offset){var text=this.data,newText=text.substring(offset);text=text.substring(0,offset),this.data=this.nodeValue=text,this.length=text.length;var newNode=this.ownerDocument.createTextNode(newText);return this.parentNode&&this.parentNode.insertBefore(newNode,this.nextSibling),newNode} },_extends(Text,CharacterData),Comment.prototype={ nodeName:'#comment',nodeType:COMMENT_NODE },_extends(Comment,CharacterData),CDATASection.prototype={ nodeName:'#cdata-section',nodeType:CDATA_SECTION_NODE },_extends(CDATASection,CharacterData),DocumentType.prototype.nodeType=DOCUMENT_TYPE_NODE,_extends(DocumentType,Node),Notation.prototype.nodeType=NOTATION_NODE,_extends(Notation,Node),Entity.prototype.nodeType=ENTITY_NODE,_extends(Entity,Node),EntityReference.prototype.nodeType=ENTITY_REFERENCE_NODE,_extends(EntityReference,Node),DocumentFragment.prototype.nodeName='#document-fragment',DocumentFragment.prototype.nodeType=DOCUMENT_FRAGMENT_NODE,_extends(DocumentFragment,Node),ProcessingInstruction.prototype.nodeType=PROCESSING_INSTRUCTION_NODE,_extends(ProcessingInstruction,Node),XMLSerializer.prototype.serializeToString=function(node,isHtml,nodeFilter){return nodeSerializeToString.call(node,isHtml,nodeFilter)},Node.prototype.toString=nodeSerializeToString;try{if(Object.defineProperty){Object.defineProperty(LiveNodeList.prototype,'length',{ get:function(){return _updateLiveList(this),this.$$length} }),Object.defineProperty(Node.prototype,'textContent',{ get:function(){return function getTextContent(node){switch(node.nodeType){case ELEMENT_NODE:case DOCUMENT_FRAGMENT_NODE:var buf=[];for(node=node.firstChild;node;)7!==node.nodeType&&8!==node.nodeType&&buf.push(getTextContent(node)),node=node.nextSibling;return buf.join('');default:return node.nodeValue}}(this)},set:function(data){switch(this.nodeType){case ELEMENT_NODE:case DOCUMENT_FRAGMENT_NODE:for(;this.firstChild;)this.removeChild(this.firstChild);(data||String(data))&&this.appendChild(this.ownerDocument.createTextNode(data));break;default:this.data=data,this.value=data,this.nodeValue=data}} }),__set__=function(object,key,value){object['$$'+key]=value}}}catch(e){}exports.DOMImplementation=DOMImplementation,exports.XMLSerializer=XMLSerializer},{}],62:[function(_dereq_,module,exports){var nameStartChar=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,nameChar=new RegExp('[\\-\\.0-9'+nameStartChar.source.slice(1,-1)+'\\u00B7\\u0300-\\u036F\\u203F-\\u2040]'),tagNamePattern=new RegExp('^'+nameStartChar.source+nameChar.source+'*(?::'+nameStartChar.source+nameChar.source+'*)?$'),S_TAG=0,S_ATTR=1,S_ATTR_SPACE=2,S_EQ=3,S_ATTR_NOQUOT_VALUE=4,S_ATTR_END=5,S_TAG_SPACE=6,S_TAG_CLOSE=7;function XMLReader(){}function copyLocator(f,t){return t.lineNumber=f.lineNumber,t.columnNumber=f.columnNumber,t}function parseElementStartPart(source,start,el,currentNSMap,entityReplacer,errorHandler){for(var attrName,p=++start,s=S_TAG;;){var c=source.charAt(p);switch(c){case'=':if(s===S_ATTR)attrName=source.slice(start,p),s=S_EQ;else{if(s!==S_ATTR_SPACE)throw new Error('attribute equal must after attrName');s=S_EQ}break;case"'":case'"':if(s===S_EQ||s===S_ATTR){if(s===S_ATTR&&(errorHandler.warning('attribute value must after "="'),attrName=source.slice(start,p)),start=p+1,!((p=source.indexOf(c,start))>0))throw new Error("attribute value no end '"+c+"' match");value=source.slice(start,p).replace(/&#?\w+;/g,entityReplacer),el.add(attrName,value,start-1),s=S_ATTR_END}else{if(s!=S_ATTR_NOQUOT_VALUE)throw new Error('attribute value must after "="');value=source.slice(start,p).replace(/&#?\w+;/g,entityReplacer),el.add(attrName,value,start),errorHandler.warning('attribute "'+attrName+'" missed start quot('+c+')!!'),start=p+1,s=S_ATTR_END}break;case'/':switch(s){case S_TAG:el.setTagName(source.slice(start,p));case S_ATTR_END:case S_TAG_SPACE:case S_TAG_CLOSE:s=S_TAG_CLOSE,el.closed=!0;case S_ATTR_NOQUOT_VALUE:case S_ATTR:case S_ATTR_SPACE:break;default:throw new Error("attribute invalid close char('/')")}break;case'':return errorHandler.error('unexpected end of input'),s==S_TAG&&el.setTagName(source.slice(start,p)),p;case'>':switch(s){case S_TAG:el.setTagName(source.slice(start,p));case S_ATTR_END:case S_TAG_SPACE:case S_TAG_CLOSE:break;case S_ATTR_NOQUOT_VALUE:case S_ATTR:'/'===(value=source.slice(start,p)).slice(-1)&&(el.closed=!0,value=value.slice(0,-1));case S_ATTR_SPACE:s===S_ATTR_SPACE&&(value=attrName),s==S_ATTR_NOQUOT_VALUE?(errorHandler.warning('attribute "'+value+'" missed quot(")!!'),el.add(attrName,value.replace(/&#?\w+;/g,entityReplacer),start)):('http://www.w3.org/1999/xhtml'===currentNSMap['']&&value.match(/^(?:disabled|checked|selected)$/i)||errorHandler.warning('attribute "'+value+'" missed value!! "'+value+'" instead!!'),el.add(value,value,start));break;case S_EQ:throw new Error('attribute value missed!!')}return p;case'':c=' ';default:if(c<=' ')switch(s){case S_TAG:el.setTagName(source.slice(start,p)),s=S_TAG_SPACE;break;case S_ATTR:attrName=source.slice(start,p),s=S_ATTR_SPACE;break;case S_ATTR_NOQUOT_VALUE:var value=source.slice(start,p).replace(/&#?\w+;/g,entityReplacer);errorHandler.warning('attribute "'+value+'" missed quot(")!!'),el.add(attrName,value,start);case S_ATTR_END:s=S_TAG_SPACE}else switch(s){case S_ATTR_SPACE:el.tagName;'http://www.w3.org/1999/xhtml'===currentNSMap['']&&attrName.match(/^(?:disabled|checked|selected)$/i)||errorHandler.warning('attribute "'+attrName+'" missed value!! "'+attrName+'" instead2!!'),el.add(attrName,attrName,start),start=p,s=S_ATTR;break;case S_ATTR_END:errorHandler.warning('attribute space is required"'+attrName+'"!!');case S_TAG_SPACE:s=S_ATTR,start=p;break;case S_EQ:s=S_ATTR_NOQUOT_VALUE,start=p;break;case S_TAG_CLOSE:throw new Error("elements closed character '/' and '>' must be connected to")}}p++}}function appendElement(el,domBuilder,currentNSMap){for(var tagName=el.tagName,localNSMap=null,i=el.length;i--;){var a=el[i],qName=a.qName,value=a.value;if((nsp=qName.indexOf(':'))>0)var prefix=a.prefix=qName.slice(0,nsp),localName=qName.slice(nsp+1),nsPrefix='xmlns'===prefix&&localName;else localName=qName,prefix=null,nsPrefix='xmlns'===qName&&'';a.localName=localName,!1!==nsPrefix&&(null==localNSMap&&(localNSMap={},_copy(currentNSMap,currentNSMap={})),currentNSMap[nsPrefix]=localNSMap[nsPrefix]=value,a.uri='http://www.w3.org/2000/xmlns/',domBuilder.startPrefixMapping(nsPrefix,value))}for(i=el.length;i--;){(prefix=(a=el[i]).prefix)&&('xml'===prefix&&(a.uri='http://www.w3.org/XML/1998/namespace'),'xmlns'!==prefix&&(a.uri=currentNSMap[prefix||'']))}var nsp;(nsp=tagName.indexOf(':'))>0?(prefix=el.prefix=tagName.slice(0,nsp),localName=el.localName=tagName.slice(nsp+1)):(prefix=null,localName=el.localName=tagName);var ns=el.uri=currentNSMap[prefix||''];if(domBuilder.startElement(ns,localName,tagName,el),!el.closed)return el.currentNSMap=currentNSMap,el.localNSMap=localNSMap,!0;if(domBuilder.endElement(ns,localName,tagName),localNSMap)for(prefix in localNSMap)domBuilder.endPrefixMapping(prefix)}function parseHtmlSpecialContent(source,elStartEnd,tagName,entityReplacer,domBuilder){if(/^(?:script|textarea)$/i.test(tagName)){var elEndStart=source.indexOf('</'+tagName+'>',elStartEnd),text=source.substring(elStartEnd+1,elEndStart);if(/[&<]/.test(text))return/^script$/i.test(tagName)?(domBuilder.characters(text,0,text.length),elEndStart):(text=text.replace(/&#?\w+;/g,entityReplacer),domBuilder.characters(text,0,text.length),elEndStart)}return elStartEnd+1}function fixSelfClosed(source,elStartEnd,tagName,closeMap){var pos=closeMap[tagName];return null==pos&&((pos=source.lastIndexOf('</'+tagName+'>'))<elStartEnd&&(pos=source.lastIndexOf('</'+tagName)),closeMap[tagName]=pos),pos<elStartEnd}function _copy(source,target){for(var n in source)target[n]=source[n]}function parseDCC(source,start,domBuilder,errorHandler){switch(source.charAt(start+2)){case'-':return'-'===source.charAt(start+3)?(end=source.indexOf('--\x3e',start+4))>start?(domBuilder.comment(source,start+4,end-start-4),end+3):(errorHandler.error('Unclosed comment'),-1):-1;default:if('CDATA['==source.substr(start+3,6)){var end=source.indexOf(']]>',start+9);return domBuilder.startCDATA(),domBuilder.characters(source,start+9,end-start-9),domBuilder.endCDATA(),end+3}var matchs=function(source,start){var match,buf=[],reg=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;reg.lastIndex=start,reg.exec(source);for(;match=reg.exec(source);)if(buf.push(match),match[1])return buf}(source,start),len=matchs.length;if(len>1&&/!doctype/i.test(matchs[0][0])){var name=matchs[1][0],pubid=len>3&&/^public$/i.test(matchs[2][0])&&matchs[3][0],sysid=len>4&&matchs[4][0],lastMatch=matchs[len-1];return domBuilder.startDTD(name,pubid&&pubid.replace(/^(['"])(.*?)\1$/,'$2'),sysid&&sysid.replace(/^(['"])(.*?)\1$/,'$2')),domBuilder.endDTD(),lastMatch.index+lastMatch[0].length}}return-1}function parseInstruction(source,start,domBuilder){var end=source.indexOf('?>',start);if(end){var match=source.substring(start,end).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);if(match){match[0].length;return domBuilder.processingInstruction(match[1],match[2]),end+2}return-1}return-1}function ElementAttributes(source){}function _set_proto_(thiz,parent){return thiz.__proto__=parent,thiz}XMLReader.prototype={ parse:function(source,defaultNSMap,entityMap){var domBuilder=this.domBuilder;domBuilder.startDocument(),_copy(defaultNSMap,defaultNSMap={}),function(source,defaultNSMapCopy,entityMap,domBuilder,errorHandler){function entityReplacer(a){var k=a.slice(1,-1);return k in entityMap?entityMap[k]:'#'===k.charAt(0)?function(code){if(code>65535){var surrogate1=55296+((code-=65536)>>10),surrogate2=56320+(1023&code);return String.fromCharCode(surrogate1,surrogate2)}return String.fromCharCode(code)}(parseInt(k.substr(1).replace('x','0x'))):(errorHandler.error('entity not found:'+a),a)}function appendText(end){if(end>start){var xt=source.substring(start,end).replace(/&#?\w+;/g,entityReplacer);locator&&position(start),domBuilder.characters(xt,0,end-start),start=end}}function position(p,m){for(;p>=lineEnd&&(m=linePattern.exec(source));)lineStart=m.index,lineEnd=lineStart+m[0].length,locator.lineNumber++;locator.columnNumber=p-lineStart+1}var lineStart=0,lineEnd=0,linePattern=/.*(?:\r\n?|\n)|.*$/g,locator=domBuilder.locator,parseStack=[{ currentNSMap:defaultNSMapCopy }],closeMap={},start=0;for(;;){try{var tagStart=source.indexOf('<',start);if(tagStart<0){if(!source.substr(start).match(/^\s*$/)){var doc=domBuilder.doc,text=doc.createTextNode(source.substr(start));doc.appendChild(text),domBuilder.currentElement=text}return}switch(tagStart>start&&appendText(tagStart),source.charAt(tagStart+1)){case'/':var end=source.indexOf('>',tagStart+3),tagName=source.substring(tagStart+2,end),config=parseStack.pop();end<0?(tagName=source.substring(tagStart+2).replace(/[\s<].*/,''),errorHandler.error('end tag name: '+tagName+' is not complete:'+config.tagName),end=tagStart+1+tagName.length):tagName.match(/\s</)&&(tagName=tagName.replace(/[\s<].*/,''),errorHandler.error('end tag name: '+tagName+' maybe not complete'),end=tagStart+1+tagName.length);var localNSMap=config.localNSMap,endMatch=config.tagName==tagName,endIgnoreCaseMach=endMatch||config.tagName&&config.tagName.toLowerCase()==tagName.toLowerCase();if(endIgnoreCaseMach){if(domBuilder.endElement(config.uri,config.localName,tagName),localNSMap)for(var prefix in localNSMap)domBuilder.endPrefixMapping(prefix);endMatch||errorHandler.fatalError('end tag name: '+tagName+' is not match the current start tagName:'+config.tagName)}else parseStack.push(config);end++;break;case'?':locator&&position(tagStart),end=parseInstruction(source,tagStart,domBuilder);break;case'!':locator&&position(tagStart),end=parseDCC(source,tagStart,domBuilder,errorHandler);break;default:locator&&position(tagStart);var el=new ElementAttributes,currentNSMap=parseStack[parseStack.length-1].currentNSMap,end=parseElementStartPart(source,tagStart,el,currentNSMap,entityReplacer,errorHandler),len=el.length;if(!el.closed&&fixSelfClosed(source,end,el.tagName,closeMap)&&(el.closed=!0,entityMap.nbsp||errorHandler.warning('unclosed xml attribute')),locator&&len){for(var locator2=copyLocator(locator,{}),i=0;i<len;i++){var a=el[i];position(a.offset),a.locator=copyLocator(locator,{})}domBuilder.locator=locator2,appendElement(el,domBuilder,currentNSMap)&&parseStack.push(el),domBuilder.locator=locator}else appendElement(el,domBuilder,currentNSMap)&&parseStack.push(el);'http://www.w3.org/1999/xhtml'!==el.uri||el.closed?end++:end=parseHtmlSpecialContent(source,end,el.tagName,entityReplacer,domBuilder)}}catch(e){errorHandler.error('element parse error: '+e),end=-1}end>start?start=end:appendText(Math.max(tagStart,start)+1)}}(source,defaultNSMap,entityMap,domBuilder,this.errorHandler),domBuilder.endDocument()} },ElementAttributes.prototype={ setTagName:function(tagName){if(!tagNamePattern.test(tagName))throw new Error('invalid tagName:'+tagName);this.tagName=tagName},add:function(qName,value,offset){if(!tagNamePattern.test(qName))throw new Error('invalid attribute:'+qName);this[this.length++]={ qName:qName,value:value,offset:offset }},length:0,getLocalName:function(i){return this[i].localName},getLocator:function(i){return this[i].locator},getQName:function(i){return this[i].qName},getURI:function(i){return this[i].uri},getValue:function(i){return this[i].value} },_set_proto_({},_set_proto_.prototype)instanceof _set_proto_||(_set_proto_=function(thiz,parent){function p(){}for(parent in p.prototype=parent,p=new p,thiz)p[parent]=thiz[parent];return p}),exports.XMLReader=XMLReader},{}],63:[function(_dereq_,module,exports){module.exports=function(){for(var target={},i=0;i<arguments.length;i++){var source=arguments[i];for(var key in source)hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target};var hasOwnProperty=Object.prototype.hasOwnProperty},{}] },{},[11])(11)});
(function(){var innerGlobal=typeof window!='undefined'?window:global;var exportTo={};(function(window,global){var p,aa='function'==typeof Object.defineProperties?Object.defineProperty:function(b,c,d){b!=Array.prototype&&b!=Object.prototype&&(b[c]=d.value)},ca='undefined'!=typeof window&&window===this?this:'undefined'!=typeof global&&null!=global?global:this;function ea(){ea=function(){};ca.Symbol||(ca.Symbol=fa)}var fa=function(){var b=0;return function(c){return'jscomp_symbol_'+(c||'')+b++}}();
function ha(){ea();var b=ca.Symbol.iterator;b||(b=ca.Symbol.iterator=ca.Symbol('iterator'));'function'!=typeof Array.prototype[b]&&aa(Array.prototype,b,{ configurable:!0,writable:!0,value:function(){return ia(this)} });ha=function(){}}function ia(b){var c=0;return ja(function(){return c<b.length?{ done:!1,value:b[c++] }:{ done:!0 }})}function ja(b){ha();b={ next:b };b[ca.Symbol.iterator]=function(){return this};return b}function r(b){ha();var c=b[Symbol.iterator];return c?c.call(b):ia(b)}
function la(b,c){if(c){for(var d=ca,e=b.split('.'),f=0;f<e.length-1;f++){var g=e[f];g in d||(d[g]={});d=d[g]}e=e[e.length-1];f=d[e];g=c(f);g!=f&&null!=g&&aa(d,e,{ configurable:!0,writable:!0,value:g })}}
la('Promise',function(b){function c(b){this.b=0;this.g=void 0;this.a=[];var c=this.c();try{b(c.resolve,c.reject)}catch(l){c.reject(l)}}function d(){this.a=null}function e(b){return b instanceof c?b:new c(function(c){c(b)})}if(b)return b;d.prototype.b=function(b){null==this.a&&(this.a=[],this.f());this.a.push(b)};d.prototype.f=function(){var b=this;this.c(function(){b.h()})};var f=ca.setTimeout;d.prototype.c=function(b){f(b,0)};d.prototype.h=function(){for(;this.a&&this.a.length;){var b=this.a;this.a=
[];for(var c=0;c<b.length;++c){var d=b[c];b[c]=null;try{d()}catch(m){this.g(m)}}}this.a=null};d.prototype.g=function(b){this.c(function(){throw b;})};c.prototype.c=function(){function b(b){return function(e){d||(d=!0,b.call(c,e))}}var c=this,d=!1;return{ resolve:b(this.o),reject:b(this.f) }};c.prototype.o=function(b){if(b===this)this.f(new TypeError('A Promise cannot resolve to itself'));else if(b instanceof c)this.u(b);else{a:switch(typeof b){case 'object':var d=null!=b;break a;case 'function':d=!0;
break a;default:d=!1}d?this.m(b):this.h(b)}};c.prototype.m=function(b){var c=void 0;try{c=b.then}catch(l){this.f(l);return}'function'==typeof c?this.w(c,b):this.h(b)};c.prototype.f=function(b){this.i(2,b)};c.prototype.h=function(b){this.i(1,b)};c.prototype.i=function(b,c){if(0!=this.b)throw Error('Cannot settle('+b+', '+c+'): Promise already settled in state'+this.b);this.b=b;this.g=c;this.j()};c.prototype.j=function(){if(null!=this.a){for(var b=0;b<this.a.length;++b)g.b(this.a[b]);this.a=null}};
var g=new d;c.prototype.u=function(b){var c=this.c();b.Wb(c.resolve,c.reject)};c.prototype.w=function(b,c){var d=this.c();try{b.call(c,d.resolve,d.reject)}catch(m){d.reject(m)}};c.prototype.then=function(b,d){function e(b,c){return'function'==typeof b?function(c){try{f(b(c))}catch(D){g(D)}}:c}var f,g,h=new c(function(b,c){f=b;g=c});this.Wb(e(b,f),e(d,g));return h};c.prototype['catch']=function(b){return this.then(void 0,b)};c.prototype.Wb=function(b,c){function d(){switch(e.b){case 1:b(e.g);break;
case 2:c(e.g);break;default:throw Error('Unexpected state: '+e.b);}}var e=this;null==this.a?g.b(d):this.a.push(d)};c.resolve=e;c.reject=function(b){return new c(function(c,d){d(b)})};c.race=function(b){return new c(function(c,d){for(var f=r(b),g=f.next();!g.done;g=f.next())e(g.value).Wb(c,d)})};c.all=function(b){var d=r(b),f=d.next();return f.done?e([]):new c(function(b,c){function g(c){return function(d){h[c]=d;k--;0==k&&b(h)}}var h=[],k=0;do h.push(void 0),k++,e(f.value).Wb(g(h.length-1),c),f=d.next();
while(!f.done)})};return c});la('Promise.prototype.finally',function(b){return b?b:function(b){return this.then(function(c){return Promise.resolve(b()).then(function(){return c})},function(c){return Promise.resolve(b()).then(function(){throw c;})})}});function ma(b){function c(c){return b.next(c)}function d(c){return b['throw'](c)}return new Promise(function(e,f){function g(b){b.done?e(b.value):Promise.resolve(b.value).then(c,d).then(g,f)}g(b.next())})}function t(b){return ma(b())}
var na='function'==typeof Object.create?Object.create:function(b){function c(){}c.prototype=b;return new c},oa;if('function'==typeof Object.setPrototypeOf)oa=Object.setPrototypeOf;else{var pa;a:{var qa={ pe:!0 },ra={};try{ra.__proto__=qa;pa=ra.pe;break a}catch(b){}pa=!1}oa=pa?function(b,c){b.__proto__=c;if(b.__proto__!==c)throw new TypeError(b+' is not extensible');return b}:null}var sa=oa;function ta(){this.g=!1;this.c=null;this.s=void 0;this.l=1;this.b=this.f=0;this.i=this.a=null}
function ua(b){if(b.g)throw new TypeError('Generator is already running');b.g=!0}ta.prototype.h=function(b){this.s=b};function va(b,c){b.a={ xd:c,Hd:!0 };b.l=b.f||b.b}ta.prototype['return']=function(b){this.a={ 'return':b };this.l=this.b};function u(b,c,d){b.l=d;return{ value:c }}ta.prototype.A=function(b){this.l=b};function v(b){b.l=0}function ya(b,c,d){b.f=c;void 0!=d&&(b.b=d)}function za(b,c){b.f=0;b.b=c||0}function Aa(b,c){b.l=c;b.f=0}function Da(b){b.f=0;var c=b.a.xd;b.a=null;return c}
function Ea(b){b.i=[b.a];b.f=0;b.b=0}function Fa(b,c){var d=b.i.splice(0)[0];(d=b.a=b.a||d)?d.Hd?b.l=b.f||b.b:void 0!=d.A&&b.b<d.A?(b.l=d.A,b.a=null):b.l=b.b:b.l=c}function Ga(b){this.a=new ta;this.b=b}function Ha(b,c){ua(b.a);var d=b.a.c;if(d)return Ja(b,'return'in d?d['return']:function(b){return{ value:b,done:!0 }},c,b.a['return']);b.a['return'](c);return Ka(b)}
function Ja(b,c,d,e){try{var f=c.call(b.a.c,d);if(!(f instanceof Object))throw new TypeError('Iterator result '+f+' is not an object');if(!f.done)return b.a.g=!1,f;var g=f.value}catch(h){return b.a.c=null,va(b.a,h),Ka(b)}b.a.c=null;e.call(b.a,g);return Ka(b)}
function Ka(b){for(;b.a.l;)try{var c=b.b(b.a);if(c)return b.a.g=!1,{ value:c.value,done:!1 }}catch(d){b.a.s=void 0,va(b.a,d)}b.a.g=!1;if(b.a.a){c=b.a.a;b.a.a=null;if(c.Hd)throw c.xd;return{ value:c['return'],done:!0 }}return{ value:void 0,done:!0 }}
function La(b){this.next=function(c){ua(b.a);b.a.c?c=Ja(b,b.a.c.next,c,b.a.h):(b.a.h(c),c=Ka(b));return c};this['throw']=function(c){ua(b.a);b.a.c?c=Ja(b,b.a.c['throw'],c,b.a.h):(va(b.a,c),c=Ka(b));return c};this['return']=function(c){return Ha(b,c)};ha();this[Symbol.iterator]=function(){return this}}function y(b,c){La.prototype=b.prototype;return new La(new Ga(c))}function Ma(b,c){return Object.prototype.hasOwnProperty.call(b,c)}
la('WeakMap',function(b){function c(b){this.a=(g+=Math.random()+1).toString();if(b){ea();ha();b=r(b);for(var c;!(c=b.next()).done;)c=c.value,this.set(c[0],c[1])}}function d(b){Ma(b,f)||aa(b,f,{ value:{} })}function e(b){var c=Object[b];c&&(Object[b]=function(b){d(b);return c(b)})}if(function(){if(!b||!Object.seal)return!1;try{var c=Object.seal({}),d=Object.seal({}),e=new b([[c,2],[d,3]]);if(2!=e.get(c)||3!=e.get(d))return!1;e['delete'](c);e.set(d,4);return!e.has(c)&&4==e.get(d)}catch(m){return!1}}())return b;
var f='$jscomp_hidden_'+Math.random();e('freeze');e('preventExtensions');e('seal');var g=0;c.prototype.set=function(b,c){d(b);if(!Ma(b,f))throw Error('WeakMap key fail: '+b);b[f][this.a]=c;return this};c.prototype.get=function(b){return Ma(b,f)?b[f][this.a]:void 0};c.prototype.has=function(b){return Ma(b,f)&&Ma(b[f],this.a)};c.prototype['delete']=function(b){return Ma(b,f)&&Ma(b[f],this.a)?delete b[f][this.a]:!1};return c});
la('Map',function(b){function c(){var b={};return b.Ca=b.next=b.head=b}function d(b,c){var d=b.a;return ja(function(){if(d){for(;d.head!=b.a;)d=d.Ca;for(;d.next!=d.head;)return d=d.next,{ done:!1,value:c(d) };d=null}return{ done:!0,value:void 0 }})}function e(b,c){var d=c&&typeof c;'object'==d||'function'==d?g.has(c)?d=g.get(c):(d=''+ ++h,g.set(c,d)):d='p_'+c;var e=b.b[d];if(e&&Ma(b.b,d))for(var f=0;f<e.length;f++){var k=e[f];if(c!==c&&k.key!==k.key||c===k.key)return{ id:d,list:e,index:f,Y:k }}return{ id:d,
list:e,index:-1,Y:void 0 }}function f(b){this.b={};this.a=c();this.size=0;if(b){b=r(b);for(var d;!(d=b.next()).done;)d=d.value,this.set(d[0],d[1])}}if(function(){if(!b||'function'!=typeof b||!b.prototype.entries||'function'!=typeof Object.seal)return!1;try{var c=Object.seal({ x:4 }),d=new b(r([[c,'s']]));if('s'!=d.get(c)||1!=d.size||d.get({ x:4 })||d.set({ x:4 },'t')!=d||2!=d.size)return!1;var e=d.entries(),f=e.next();if(f.done||f.value[0]!=c||'s'!=f.value[1])return!1;f=e.next();return f.done||4!=f.value[0].x||
't'!=f.value[1]||!e.next().done?!1:!0}catch(q){return!1}}())return b;ea();ha();var g=new WeakMap;f.prototype.set=function(b,c){var d=e(this,b);d.list||(d.list=this.b[d.id]=[]);d.Y?d.Y.value=c:(d.Y={ next:this.a,Ca:this.a.Ca,head:this.a,key:b,value:c },d.list.push(d.Y),this.a.Ca.next=d.Y,this.a.Ca=d.Y,this.size++);return this};f.prototype['delete']=function(b){b=e(this,b);return b.Y&&b.list?(b.list.splice(b.index,1),b.list.length||delete this.b[b.id],b.Y.Ca.next=b.Y.next,b.Y.next.Ca=b.Y.Ca,b.Y.head=
null,this.size--,!0):!1};f.prototype.clear=function(){this.b={};this.a=this.a.Ca=c();this.size=0};f.prototype.has=function(b){return!!e(this,b).Y};f.prototype.get=function(b){return(b=e(this,b).Y)&&b.value};f.prototype.entries=function(){return d(this,function(b){return[b.key,b.value]})};f.prototype.keys=function(){return d(this,function(b){return b.key})};f.prototype.values=function(){return d(this,function(b){return b.value})};f.prototype.forEach=function(b,c){for(var d=this.entries(),e;!(e=d.next()).done;)e=
e.value,b.call(c,e[1],e[0],this)};f.prototype[Symbol.iterator]=f.prototype.entries;var h=0;return f});
la('Set',function(b){function c(b){this.a=new Map;if(b){b=r(b);for(var c;!(c=b.next()).done;)this.add(c.value)}this.size=this.a.size}if(function(){if(!b||'function'!=typeof b||!b.prototype.entries||'function'!=typeof Object.seal)return!1;try{var c=Object.seal({ x:4 }),e=new b(r([c]));if(!e.has(c)||1!=e.size||e.add(c)!=e||1!=e.size||e.add({ x:4 })!=e||2!=e.size)return!1;var f=e.entries(),g=f.next();if(g.done||g.value[0]!=c||g.value[1]!=c)return!1;g=f.next();return g.done||g.value[0]==c||4!=g.value[0].x||
g.value[1]!=g.value[0]?!1:f.next().done}catch(h){return!1}}())return b;ea();ha();c.prototype.add=function(b){this.a.set(b,b);this.size=this.a.size;return this};c.prototype['delete']=function(b){b=this.a['delete'](b);this.size=this.a.size;return b};c.prototype.clear=function(){this.a.clear();this.size=0};c.prototype.has=function(b){return this.a.has(b)};c.prototype.entries=function(){return this.a.entries()};c.prototype.values=function(){return this.a.values()};c.prototype.keys=c.prototype.values;
c.prototype[Symbol.iterator]=c.prototype.values;c.prototype.forEach=function(b,c){var d=this;this.a.forEach(function(e){return b.call(c,e,e,d)})};return c});function Na(b,c,d){b instanceof String&&(b=String(b));for(var e=b.length,f=0;f<e;f++){var g=b[f];if(c.call(d,g,f,b))return{ Dd:f,ke:g }}return{ Dd:-1,ke:void 0 }}la('Array.prototype.findIndex',function(b){return b?b:function(b,d){return Na(this,b,d).Dd}});
function Oa(b,c){ha();b instanceof String&&(b+='');var d=0,e={ next:function(){if(d<b.length){var f=d++;return{ value:c(f,b[f]),done:!1 }}e.next=function(){return{ done:!0,value:void 0 }};return e.next()} };e[Symbol.iterator]=function(){return e};return e}la('Array.prototype.keys',function(b){return b?b:function(){return Oa(this,function(b){return b})}});la('Object.is',function(b){return b?b:function(b,d){return b===d?0!==b||1/b===1/d:b!==b&&d!==d}});
la('Array.prototype.includes',function(b){return b?b:function(b,d){var c=this;c instanceof String&&(c=String(c));var f=c.length,g=d||0;for(0>g&&(g=Math.max(g+f,0));g<f;g++){var h=c[g];if(h===b||Object.is(h,b))return!0}return!1}});function Pa(b,c,d){if(null==b)throw new TypeError("The 'this' value for String.prototype."+d+' must not be null or undefined');if(c instanceof RegExp)throw new TypeError('First argument to String.prototype.'+d+' must not be a regular expression');return b+''}
la('String.prototype.includes',function(b){return b?b:function(b,d){return-1!==Pa(this,b,'includes').indexOf(b,d||0)}});la('Array.from',function(b){return b?b:function(b,d,e){ha();d=null!=d?d:function(b){return b};var c=[],g=b[Symbol.iterator];if('function'==typeof g)for(b=g.call(b);!(g=b.next()).done;)c.push(d.call(e,g.value));else{g=b.length;for(var h=0;h<g;h++)c.push(d.call(e,b[h]))}return c}});
la('String.prototype.startsWith',function(b){return b?b:function(b,d){for(var c=Pa(this,b,'startsWith'),f=c.length,g=b.length,h=Math.max(0,Math.min(d|0,c.length)),k=0;k<g&&h<f;)if(c[h++]!=b[k++])return!1;return k>=g}});la('Array.prototype.find',function(b){return b?b:function(b,d){return Na(this,b,d).ke}});var Qa=this;Qa.a=!0;
function z(b,c){var d=b.split('.'),e=Qa;d[0]in e||!e.execScript||e.execScript('var '+d[0]);for(var f;d.length&&(f=d.shift());)d.length||void 0===c?e[f]?e=e[f]:e=e[f]={}:e[f]=c}function Ra(b,c){function d(){}d.prototype=c.prototype;b.hg=c.prototype;b.prototype=new d;b.prototype.constructor=b;b.vg=function(b,d,g){return c.prototype[d].apply(b,Array.prototype.slice.call(arguments,2))}};/*

 Copyright 2016 Google Inc.

 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at

     http://www.apache.org/licenses/LICENSE-2.0

 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License.
*/
function Sa(b){this.c=Math.exp(Math.log(.5)/b);this.b=this.a=0}function Wa(b,c,d){var e=Math.pow(b.c,c);d=d*(1-e)+e*b.a;isNaN(d)||(b.a=d,b.b+=c)}function Xa(b){return b.a/(1-Math.pow(b.c,b.b))};function Ya(){this.b=new Sa(2);this.c=new Sa(5);this.a=0}Ya.prototype.getBandwidthEstimate=function(b){return 128E3>this.a?b:Math.min(Xa(this.b),Xa(this.c))};function Za(){}function $a(){}function ab(){}window.console&&window.console.log.bind&&($a=console.warn.bind(console),Za=console.error.bind(console));var bb=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^/?#]*)@)?([^/#?]*?)(?::([0-9]+))?(?=[/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#(.*))?$/;function cb(b){var c;b instanceof cb?(db(this,b.ta),this.ab=b.ab,this.oa=b.oa,ib(this,b.ub),this.fa=b.fa,jb(this,b.a.clone()),this.Ra=b.Ra):b&&(c=String(b).match(bb))?(db(this,c[1]||'',!0),this.ab=kb(c[2]||''),this.oa=kb(c[3]||'',!0),ib(this,c[4]),this.fa=kb(c[5]||'',!0),jb(this,c[6]||'',!0),this.Ra=kb(c[7]||'')):this.a=new lb(null)}p=cb.prototype;p.ta='';p.ab='';p.oa='';p.ub=null;p.fa='';p.Ra='';
p.toString=function(){var b=[],c=this.ta;c&&b.push(mb(c,nb,!0),':');if(c=this.oa){b.push('//');var d=this.ab;d&&b.push(mb(d,nb,!0),'@');b.push(encodeURIComponent(c).replace(/%25([0-9a-fA-F]{2})/g,'%$1'));c=this.ub;null!=c&&b.push(':',String(c))}if(c=this.fa)this.oa&&'/'!=c.charAt(0)&&b.push('/'),b.push(mb(c,'/'==c.charAt(0)?ob:pb,!0));(c=this.a.toString())&&b.push('?',c);(c=this.Ra)&&b.push('#',mb(c,qb));return b.join('')};
p.resolve=function(b){var c=this.clone();'data'===c.ta&&(c=new cb);var d=!!b.ta;d?db(c,b.ta):d=!!b.ab;d?c.ab=b.ab:d=!!b.oa;d?c.oa=b.oa:d=null!=b.ub;var e=b.fa;if(d)ib(c,b.ub);else if(d=!!b.fa){if('/'!=e.charAt(0))if(this.oa&&!this.fa)e='/'+e;else{var f=c.fa.lastIndexOf('/');-1!=f&&(e=c.fa.substr(0,f+1)+e)}if('..'==e||'.'==e)e='';else if(-1!=e.indexOf('./')||-1!=e.indexOf('/.')){f=0==e.lastIndexOf('/',0);e=e.split('/');for(var g=[],h=0;h<e.length;){var k=e[h++];'.'==k?f&&h==e.length&&g.push(''):'..'==
k?((1<g.length||1==g.length&&''!=g[0])&&g.pop(),f&&h==e.length&&g.push('')):(g.push(k),f=!0)}e=g.join('/')}}d?c.fa=e:d=''!==b.a.toString();d?jb(c,b.a.clone()):d=!!b.Ra;d&&(c.Ra=b.Ra);return c};p.clone=function(){return new cb(this)};function db(b,c,d){b.ta=d?kb(c,!0):c;b.ta&&(b.ta=b.ta.replace(/:$/,''))}function ib(b,c){if(c){c=Number(c);if(isNaN(c)||0>c)throw Error('Bad port number '+c);b.ub=c}else b.ub=null}function jb(b,c,d){c instanceof lb?b.a=c:(d||(c=mb(c,rb)),b.a=new lb(c))}
function kb(b,c){return b?c?decodeURI(b):decodeURIComponent(b):''}function mb(b,c,d){return'string'==typeof b?(b=encodeURI(b).replace(c,sb),d&&(b=b.replace(/%25([0-9a-fA-F]{2})/g,'%$1')),b):null}function sb(b){b=b.charCodeAt(0);return'%'+(b>>4&15).toString(16)+(b&15).toString(16)}var nb=/[#\/\?@]/g,pb=/[#\?:]/g,ob=/[#\?]/g,rb=/[#\?@]/g,qb=/#/g;function lb(b){this.a=b||null}p=lb.prototype;p.ea=null;p.Yb=null;
p.add=function(b,c){if(!this.ea&&(this.ea={},this.Yb=0,this.a))for(var d=this.a.split('&'),e=0;e<d.length;e++){var f=d[e].indexOf('='),g=null;if(0<=f){var h=d[e].substring(0,f);g=d[e].substring(f+1)}else h=d[e];h=decodeURIComponent(h.replace(/\+/g,' '));g=g||'';this.add(h,decodeURIComponent(g.replace(/\+/g,' ')))}this.a=null;(d=this.ea.hasOwnProperty(b)&&this.ea[b])||(this.ea[b]=d=[]);d.push(c);this.Yb++;return this};
p.toString=function(){if(this.a)return this.a;if(!this.ea)return'';var b=[],c;for(c in this.ea)for(var d=encodeURIComponent(c),e=this.ea[c],f=0;f<e.length;f++){var g=d;''!==e[f]&&(g+='='+encodeURIComponent(e[f]));b.push(g)}return this.a=b.join('&')};p.clone=function(){var b=new lb;b.a=this.a;if(this.ea){var c={},d;for(d in this.ea)c[d]=this.ea[d].concat();b.ea=c;b.Yb=this.Yb}return b};function tb(b){this.b=b;this.a=null}tb.prototype.P=function(b){var c=this;this.stop();var d=!0,e=null;this.a=function(){window.clearTimeout(e);d=!1};e=window.setTimeout(function(){d&&c.b()},1E3*b);return this};tb.prototype.stop=function(){this.a&&(this.a(),this.a=null)};function A(b){this.b=b;this.a=null}z('shaka.util.Timer',A);A.prototype.pc=function(){this.stop();this.b();return this};A.prototype.tickNow=A.prototype.pc;A.prototype.P=function(b){var c=this;this.stop();this.a=(new tb(function(){c.b()})).P(b);return this};A.prototype.tickAfter=A.prototype.P;A.prototype.Ka=function(b){var c=this;this.stop();this.a=(new tb(function(){c.a.P(b);c.b()})).P(b);return this};A.prototype.tickEvery=A.prototype.Ka;A.prototype.stop=function(){this.a&&(this.a.stop(),this.a=null)};
A.prototype.stop=A.prototype.stop;function ub(b,c){var d=vb();this.i=null==b.maxAttempts?d.maxAttempts:b.maxAttempts;this.f=null==b.baseDelay?d.baseDelay:b.baseDelay;this.h=null==b.fuzzFactor?d.fuzzFactor:b.fuzzFactor;this.g=null==b.backoffFactor?d.backoffFactor:b.backoffFactor;this.a=0;this.b=this.f;if(this.c=void 0===c?!1:c)this.a=1}
function yb(b){return t(function d(){var e,f;return y(d,function(d){switch(d.l){case 1:if(b.a>=b.i)if(b.c)b.a=1,b.b=b.f;else return d['return'](Promise.reject());e=b.a;b.a++;if(0==e)return d['return']();f=b.b*(1+(2*Math.random()-1)*b.h);return u(d,new Promise(function(b){(new A(b)).P(f/1E3)}),2);case 2:b.b*=b.g,v(d)}})})}function vb(){return{ maxAttempts:2,baseDelay:1E3,backoffFactor:2,fuzzFactor:.5,timeout:0 }};function C(b,c,d,e){for(var f=[],g=3;g<arguments.length;++g)f[g-3]=arguments[g];this.severity=b;this.category=c;this.code=d;this.data=f;this.handled=!1}z('shaka.util.Error',C);C.prototype.toString=function(){return'shaka.util.Error '+JSON.stringify(this,null,'  ')};C.Severity={ RECOVERABLE:1,CRITICAL:2 };C.Category={ NETWORK:1,TEXT:2,MEDIA:3,MANIFEST:4,STREAMING:5,DRM:6,PLAYER:7,CAST:8,STORAGE:9 };
C.Code={ UNSUPPORTED_SCHEME:1E3,BAD_HTTP_STATUS:1001,HTTP_ERROR:1002,TIMEOUT:1003,MALFORMED_DATA_URI:1004,UNKNOWN_DATA_URI_ENCODING:1005,REQUEST_FILTER_ERROR:1006,RESPONSE_FILTER_ERROR:1007,MALFORMED_TEST_URI:1008,UNEXPECTED_TEST_REQUEST:1009,INVALID_TEXT_HEADER:2E3,INVALID_TEXT_CUE:2001,UNABLE_TO_DETECT_ENCODING:2003,BAD_ENCODING:2004,INVALID_XML:2005,INVALID_MP4_TTML:2007,INVALID_MP4_VTT:2008,UNABLE_TO_EXTRACT_CUE_START_TIME:2009,BUFFER_READ_OUT_OF_BOUNDS:3E3,JS_INTEGER_OVERFLOW:3001,EBML_OVERFLOW:3002,
EBML_BAD_FLOATING_POINT_SIZE:3003,MP4_SIDX_WRONG_BOX_TYPE:3004,MP4_SIDX_INVALID_TIMESCALE:3005,MP4_SIDX_TYPE_NOT_SUPPORTED:3006,WEBM_CUES_ELEMENT_MISSING:3007,WEBM_EBML_HEADER_ELEMENT_MISSING:3008,WEBM_SEGMENT_ELEMENT_MISSING:3009,WEBM_INFO_ELEMENT_MISSING:3010,WEBM_DURATION_ELEMENT_MISSING:3011,WEBM_CUE_TRACK_POSITIONS_ELEMENT_MISSING:3012,WEBM_CUE_TIME_ELEMENT_MISSING:3013,MEDIA_SOURCE_OPERATION_FAILED:3014,MEDIA_SOURCE_OPERATION_THREW:3015,VIDEO_ERROR:3016,QUOTA_EXCEEDED_ERROR:3017,TRANSMUXING_FAILED:3018,
UNABLE_TO_GUESS_MANIFEST_TYPE:4E3,DASH_INVALID_XML:4001,DASH_NO_SEGMENT_INFO:4002,DASH_EMPTY_ADAPTATION_SET:4003,DASH_EMPTY_PERIOD:4004,DASH_WEBM_MISSING_INIT:4005,DASH_UNSUPPORTED_CONTAINER:4006,DASH_PSSH_BAD_ENCODING:4007,DASH_NO_COMMON_KEY_SYSTEM:4008,DASH_MULTIPLE_KEY_IDS_NOT_SUPPORTED:4009,DASH_CONFLICTING_KEY_IDS:4010,UNPLAYABLE_PERIOD:4011,RESTRICTIONS_CANNOT_BE_MET:4012,NO_PERIODS:4014,HLS_PLAYLIST_HEADER_MISSING:4015,INVALID_HLS_TAG:4016,HLS_INVALID_PLAYLIST_HIERARCHY:4017,DASH_DUPLICATE_REPRESENTATION_ID:4018,
HLS_MULTIPLE_MEDIA_INIT_SECTIONS_FOUND:4020,HLS_COULD_NOT_GUESS_MIME_TYPE:4021,HLS_MASTER_PLAYLIST_NOT_PROVIDED:4022,HLS_REQUIRED_ATTRIBUTE_MISSING:4023,HLS_REQUIRED_TAG_MISSING:4024,HLS_COULD_NOT_GUESS_CODECS:4025,HLS_KEYFORMATS_NOT_SUPPORTED:4026,DASH_UNSUPPORTED_XLINK_ACTUATE:4027,DASH_XLINK_DEPTH_LIMIT:4028,HLS_COULD_NOT_PARSE_SEGMENT_START_TIME:4030,CONTENT_UNSUPPORTED_BY_BROWSER:4032,CANNOT_ADD_EXTERNAL_TEXT_TO_LIVE_STREAM:4033,HLS_AES_128_ENCRYPTION_NOT_SUPPORTED:4034,INVALID_STREAMS_CHOSEN:5005,
NO_RECOGNIZED_KEY_SYSTEMS:6E3,REQUESTED_KEY_SYSTEM_CONFIG_UNAVAILABLE:6001,FAILED_TO_CREATE_CDM:6002,FAILED_TO_ATTACH_TO_VIDEO:6003,INVALID_SERVER_CERTIFICATE:6004,FAILED_TO_CREATE_SESSION:6005,FAILED_TO_GENERATE_LICENSE_REQUEST:6006,LICENSE_REQUEST_FAILED:6007,LICENSE_RESPONSE_REJECTED:6008,ENCRYPTED_CONTENT_WITHOUT_DRM_INFO:6010,NO_LICENSE_SERVER_GIVEN:6012,OFFLINE_SESSION_REMOVED:6013,EXPIRED:6014,LOAD_INTERRUPTED:7E3,OPERATION_ABORTED:7001,NO_VIDEO_ELEMENT:7002,CAST_API_UNAVAILABLE:8E3,NO_CAST_RECEIVERS:8001,
ALREADY_CASTING:8002,UNEXPECTED_CAST_ERROR:8003,CAST_CANCELED_BY_USER:8004,CAST_CONNECTION_TIMED_OUT:8005,CAST_RECEIVER_APP_UNAVAILABLE:8006,STORAGE_NOT_SUPPORTED:9E3,INDEXED_DB_ERROR:9001,DEPRECATED_OPERATION_ABORTED:9002,REQUESTED_ITEM_NOT_FOUND:9003,MALFORMED_OFFLINE_URI:9004,CANNOT_STORE_LIVE_OFFLINE:9005,STORE_ALREADY_IN_PROGRESS:9006,NO_INIT_DATA_FOR_OFFLINE:9007,LOCAL_PLAYER_INSTANCE_REQUIRED:9008,NEW_KEY_OPERATION_NOT_SUPPORTED:9011,KEY_NOT_FOUND:9012,MISSING_STORAGE_CELL:9013 };function G(){var b,c,d=new Promise(function(d,f){b=d;c=f});d.resolve=b;d.reject=c;return d}G.prototype.resolve=function(){};G.prototype.reject=function(){};function H(b,c){this.promise=b;this.Kd=c;this.a=!1}z('shaka.util.AbortableOperation',H);function zb(b){return new H(Promise.reject(b),function(){return Promise.resolve()})}H.failed=zb;function Ab(){var b=Promise.reject(new C(2,7,7001));b['catch'](function(){});return new H(b,function(){return Promise.resolve()})}H.aborted=Ab;function Bb(b){return new H(Promise.resolve(b),function(){return Promise.resolve()})}H.completed=Bb;
function Cb(b){return new H(b,function(){return b['catch'](function(){})})}H.notAbortable=Cb;H.prototype.abort=function(){this.a=!0;return this.Kd()};H.prototype.abort=H.prototype.abort;function Db(b){return new H(Promise.all(b.map(function(b){return b.promise})),function(){return Promise.all(b.map(function(b){return b.abort()}))})}H.all=Db;H.prototype['finally']=function(b){this.promise.then(function(){return b(!0)},function(){return b(!1)});return this};H.prototype['finally']=H.prototype['finally'];
H.prototype.T=function(b,c){function d(){f.reject(new C(2,7,7001));return e.abort()}var e=this,f=new G;this.promise.then(function(c){e.a?f.reject(new C(2,7,7001)):b?d=Eb(b,c,f):f.resolve(c)},function(b){c?d=Eb(c,b,f):f.reject(b)});return new H(f,function(){return d()})};H.prototype.chain=H.prototype.T;
function Eb(b,c,d){try{var e=b(c);if(e&&e.promise&&e.abort)return d.resolve(e.promise),function(){return e.abort()};d.resolve(e);return function(){return Promise.resolve(e).then(function(){})['catch'](function(){})}}catch(f){return d.reject(f),function(){return Promise.resolve()}}};function I(b,c){c=void 0===c?{}:c;for(var d in c)this[d]=c[d];this.defaultPrevented=this.cancelable=this.bubbles=!1;this.timeStamp=window.performance&&window.performance.now?window.performance.now():Date.now();this.type=b;this.isTrusted=!1;this.target=this.currentTarget=null;this.a=!1}I.prototype.preventDefault=function(){this.cancelable&&(this.defaultPrevented=!0)};I.prototype.stopImmediatePropagation=function(){this.a=!0};I.prototype.stopPropagation=function(){};function Fb(){this.a={}}p=Fb.prototype;p.push=function(b,c){this.a.hasOwnProperty(b)?this.a[b].push(c):this.a[b]=[c]};p.get=function(b){return(b=this.a[b])?b.slice():null};p.getAll=function(){var b=[],c;for(c in this.a)b.push.apply(b,this.a[c]);return b};p.remove=function(b,c){var d=this.a[b];if(d)for(var e=0;e<d.length;++e)d[e]==c&&(d.splice(e,1),--e)};p.forEach=function(b){for(var c in this.a)b(c,this.a[c])};function Ib(){this.yc=new Fb;this.Tb=this}Ib.prototype.addEventListener=function(b,c){this.yc.push(b,c)};Ib.prototype.removeEventListener=function(b,c){this.yc.remove(b,c)};Ib.prototype.dispatchEvent=function(b){for(var c=this.yc.get(b.type)||[],d=0;d<c.length;++d){b.target=this.Tb;b.currentTarget=this.Tb;var e=c[d];try{e.handleEvent?e.handleEvent(b):e.call(this,b)}catch(f){}if(b.a)break}return b.defaultPrevented};function Jb(b){function c(b){switch(typeof b){case 'undefined':case 'boolean':case 'number':case 'string':case 'symbol':case 'function':return b;default:if(!b||b.buffer&&b.buffer.constructor==ArrayBuffer)return b;if(d.has(b))return null;var e=b.constructor==Array;if(b.constructor!=Object&&!e)return null;d.add(b);var g=e?[]:{},h;for(h in b)g[h]=c(b[h]);e&&(g.length=b.length);return g}}var d=new Set;return c(b)};function Kb(b,c){return'number'===typeof b&&'number'===typeof c&&isNaN(b)&&isNaN(c)?!0:b===c}function Lb(b,c){var d=b.indexOf(c);-1<d&&b.splice(d,1)}function Mb(b,c){var d=0;b.forEach(function(b){d+=c(b)?1:0});return d}
function Nb(b,c,d){d||(d=Kb);if(b.length!=c.length)return!1;c=c.slice();var e={};b=r(b);for(var f=b.next();!f.done;e={ item:e.item },f=b.next()){e.item=f.value;f=c.findIndex(function(b){return function(c){return d(b.item,c)}}(e));if(-1==f)return!1;c[f]=c[c.length-1];c.pop()}return 0==c.length};function Ob(){this.a=[]}function Pb(b,c){b.a.push(c['finally'](function(){Lb(b.a,c)}))}Ob.prototype.destroy=function(){var b=[];this.a.forEach(function(c){c.promise['catch'](function(){});b.push(c.abort())});this.a=[];return Promise.all(b)};function J(b){Ib.call(this);this.f=!1;this.g=new Ob;this.a=new Set;this.b=new Set;this.c=b||null}Ra(J,Ib);z('shaka.net.NetworkingEngine',J);var Qb={ MANIFEST:0,SEGMENT:1,LICENSE:2,APP:3,TIMING:4 };J.RequestType=Qb;J.PluginPriority={ FALLBACK:1,PREFERRED:2,APPLICATION:3 };var Rb={};function Sb(b,c,d){d=d||3;var e=Rb[b];if(!e||d>=e.priority)Rb[b]={ priority:d,Cf:c }}J.registerScheme=Sb;J.unregisterScheme=function(b){delete Rb[b]};J.prototype.Ef=function(b){this.a.add(b)};
J.prototype.registerRequestFilter=J.prototype.Ef;J.prototype.jg=function(b){this.a['delete'](b)};J.prototype.unregisterRequestFilter=J.prototype.jg;J.prototype.xe=function(){this.a.clear()};J.prototype.clearAllRequestFilters=J.prototype.xe;J.prototype.Ff=function(b){this.b.add(b)};J.prototype.registerResponseFilter=J.prototype.Ff;J.prototype.kg=function(b){this.b['delete'](b)};J.prototype.unregisterResponseFilter=J.prototype.kg;J.prototype.ye=function(){this.b.clear()};
J.prototype.clearAllResponseFilters=J.prototype.ye;function Tb(b,c){return{ uris:b,method:'GET',body:null,headers:{},allowCrossSiteCredentials:!1,retryParameters:c,licenseRequestType:null }}J.prototype.destroy=function(){this.f=!0;this.a.clear();this.b.clear();return this.g.destroy()};J.prototype.destroy=J.prototype.destroy;
J.prototype.request=function(b,c){var d=this,e=new Ub;if(this.f){var f=Promise.reject(new C(2,7,7001));f['catch'](function(){});return new Vb(f,function(){return Promise.resolve()},e)}c.method=c.method||'GET';c.headers=c.headers||{};c.retryParameters=c.retryParameters?Jb(c.retryParameters):vb();c.uris=Jb(c.uris);f=Wb(this,b,c);var g=f.T(function(){return Xb(d,b,c,new ub(c.retryParameters,!1),0,null,e)}),h=g.T(function(c){return Yb(d,b,c)}),k=Date.now(),l=0;f.promise.then(function(){l=Date.now()-k},
function(){});var m=0;g.promise.then(function(){m=Date.now()},function(){});f=h.T(function(c){var e=Date.now()-m,f=c.response;f.timeMs+=l;f.timeMs+=e;c.af||!d.c||f.fromCache||1!=b||d.c(f.timeMs,f.data.byteLength);return f},function(b){b&&(b.severity=2);throw b;});f=new Vb(f.promise,f.Kd,e);Pb(this.g,f);return f};J.prototype.request=J.prototype.request;
function Wb(b,c,d){var e=Bb(void 0),f={};b=r(b.a);for(var g=b.next();!g.done;f={ dd:f.dd },g=b.next())f.dd=g.value,e=e.T(function(b){return function(){return b.dd(c,d)}}(f));return e.T(void 0,function(b){if(b&&7001==b.code)throw b;throw new C(2,1,1006,b);})}
function Xb(b,c,d,e,f,g,h){var k=new cb(d.uris[f]),l=k.ta,m=!1;l||(l=location.protocol,l=l.slice(0,-1),db(k,l),d.uris[f]=k.toString());var n=(l=Rb[l])?l.Cf:null;if(!n)return zb(new C(2,1,1E3,k));var q;return Cb(yb(e)).T(function(){if(b.f)return Ab();q=Date.now();return n(d.uris[f],d,c,function(d,e,f){b.c&&1==c&&(b.c(d,e),m=!0,h.a=f)})}).T(function(b){void 0==b.timeMs&&(b.timeMs=Date.now()-q);return{ response:b,af:m }},function(k){if(k&&7001==k.code)throw k;if(b.f)return Ab();if(k&&1==k.severity)return b.dispatchEvent(new I('retry',
{ error:k instanceof C?k:null })),f=(f+1)%d.uris.length,Xb(b,c,d,e,f,k,h);throw k||g;})}function Yb(b,c,d){var e=Bb(void 0);b=r(b.b);for(var f=b.next();!f.done;f=b.next())e=e.T(f.value.bind(null,c,d.response));return e.T(function(){return d},function(b){if(b&&7001==b.code)throw b;var c=2;b instanceof C&&(c=b.severity);throw new C(c,1,1007,b);})}function Ub(){this.a=0}J.NumBytesRemainingClass=Ub;function Vb(b,c,d){H.call(this,b,c);this.b=d}var Zb=Vb;Zb.prototype=na(H.prototype);
Zb.prototype.constructor=Zb;if(sa)sa(Zb,H);else for(var $b in H)if('prototype'!=$b)if(Object.defineProperties){var ac=Object.getOwnPropertyDescriptor(H,$b);ac&&Object.defineProperty(Zb,$b,ac)}else Zb[$b]=H[$b];Zb.hg=H.prototype;J.PendingRequest=Vb;Vb.all=Db;Vb.notAbortable=Cb;Vb.completed=Bb;Vb.aborted=Ab;Vb.failed=zb;function bc(){this.b=new Fb}bc.prototype.a=function(){cc(this);this.b=null};function K(b,c,d,e,f){b.b&&(c=new dc(c,d,e,f),b.b.push(d,c))}function ec(b,c,d,e){function f(g){b.ma(c,d,f);e(g)}K(b,c,d,f,void 0)}bc.prototype.ma=function(b,c,d){if(this.b){var e=this.b.get(c)||[];e=r(e);for(var f=e.next();!f.done;f=e.next())f=f.value,f.target!=b||d!=f.listener&&d||(f.ma(),this.b.remove(c,f))}};function cc(b){if(b.b){var c=b.b.getAll();c=r(c);for(var d=c.next();!d.done;d=c.next())d.value.ma();b.b.a={}}}
function dc(b,c,d,e){this.target=b;this.type=c;this.listener=d;this.a=fc(b,e);this.target.addEventListener(c,d,this.a)}dc.prototype.ma=function(){this.target.removeEventListener(this.type,this.listener,this.a);this.listener=this.target=null;this.a=!1};function fc(b,c){if(void 0==c)return!1;if('boolean'==typeof c)return c;var d=new Set(['passive','capture']);Object.keys(c).filter(function(b){return!d.has(b)});return gc(b)?c:c.capture||!1}
function gc(b){var c=hc;if(void 0==c){c=!1;try{var d={},e={ get:function(){c=!0;return!1} };Object.defineProperty(d,'passive',e);Object.defineProperty(d,'capture',e);e=function(){};b.addEventListener('test',e,d);b.removeEventListener('test',e,d)}catch(f){c=!1}hc=c}return c||!1}var hc=void 0;function ic(b,c){for(var d=[],e=r(b),f=e.next();!f.done;f=e.next())d.push(c(f.value));return d}function jc(b,c){for(var d=r(b),e=d.next();!e.done;e=d.next())if(!c(e.value))return!1;return!0};function kc(b){var c=new Map;Object.keys(b).forEach(function(d){c.set(d,b[d])});return c}function lc(b){var c={};b.forEach(function(b,e){c[e]=b});return c};function mc(b,c){var d=b;c&&(d+='; codecs="'+c+'"');return d}function nc(b){var c=[b.mimeType];oc.forEach(function(d,e){var f=b[e];f&&c.push(d+'="'+f+'"')});return c.join(';')}function pc(b){b=b.split('.');var c=b[0];b.pop();return[c,b.join('.')]}var oc=(new Map).set('codecs','codecs').set('frameRate','framerate').set('bandwidth','bitrate').set('width','width').set('height','height').set('channelsCount','channels');function qc(){return window.MediaSource&&MediaSource.isTypeSupported?!0:!1}function rc(b){return''!=sc().canPlayType(b)}function tc(b){return(navigator.userAgent||'').includes(b)}function sc(){if(uc)return uc;vc||(vc=new A(function(){uc=null}));(uc=document.querySelector('video')||document.querySelector('audio'))||(uc=document.createElement('video'));vc.P(1);return uc}var vc=null,uc=null;function xc(b){if(!b)return'';b=new Uint8Array(b);239==b[0]&&187==b[1]&&191==b[2]&&(b=b.subarray(3));b=escape(yc(b));try{return decodeURIComponent(b)}catch(c){throw new C(2,2,2004);}}z('shaka.util.StringUtils.fromUTF8',xc);
function zc(b,c,d){if(!b)return'';if(!d&&0!=b.byteLength%2)throw new C(2,2,2004);if(b instanceof ArrayBuffer)var e=b;else d=new Uint8Array(b.byteLength),d.set(new Uint8Array(b)),e=d.buffer;b=Math.floor(b.byteLength/2);d=new Uint16Array(b);e=new DataView(e);for(var f=0;f<b;f++)d[f]=e.getUint16(2*f,c);return yc(d)}z('shaka.util.StringUtils.fromUTF16',zc);
function Ac(b){var c=new Uint8Array(b);if(239==c[0]&&187==c[1]&&191==c[2])return xc(c);if(254==c[0]&&255==c[1])return zc(c.subarray(2),!1);if(255==c[0]&&254==c[1])return zc(c.subarray(2),!0);var d=function(b,c){return b.byteLength<=c||32<=b[c]&&126>=b[c]}.bind(null,c);if(0==c[0]&&0==c[2])return zc(b,!1);if(0==c[1]&&0==c[3])return zc(b,!0);if(d(0)&&d(1)&&d(2)&&d(3))return xc(b);throw new C(2,2,2003);}z('shaka.util.StringUtils.fromBytesAutoDetect',Ac);
function Bc(b){b=encodeURIComponent(b);b=unescape(b);for(var c=new Uint8Array(b.length),d=0;d<b.length;++d)c[d]=b.charCodeAt(d);return c.buffer}z('shaka.util.StringUtils.toUTF8',Bc);function Cc(b,c){for(var d=new Uint8Array(2*b.length),e=new DataView(d.buffer),f=0;f<b.length;++f)e.setUint16(2*f,b.charCodeAt(f),c);return d.buffer}z('shaka.util.StringUtils.toUTF16',Cc);function yc(b){for(var c='',d=0;d<b.length;d+=16E3)c+=String.fromCharCode.apply(null,b.subarray(d,d+16E3));return c};function Dc(b,c){var d=yc(b);c=void 0==c?!0:c;d=window.btoa(d).replace(/\+/g,'-').replace(/\//g,'_');return c?d:d.replace(/=*$/,'')}z('shaka.util.Uint8ArrayUtils.toBase64',Dc);function Ec(b){b=window.atob(b.replace(/-/g,'+').replace(/_/g,'/'));for(var c=new Uint8Array(b.length),d=0;d<b.length;++d)c[d]=b.charCodeAt(d);return c}z('shaka.util.Uint8ArrayUtils.fromBase64',Ec);function Fc(b){for(var c=new Uint8Array(b.length/2),d=0;d<b.length;d+=2)c[d/2]=window.parseInt(b.substr(d,2),16);return c}
z('shaka.util.Uint8ArrayUtils.fromHex',Fc);function Gc(b){for(var c='',d=0;d<b.length;++d){var e=b[d].toString(16);1==e.length&&(e='0'+e);c+=e}return c}z('shaka.util.Uint8ArrayUtils.toHex',Gc);function Hc(b,c){if(!b&&!c)return!0;if(!b||!c||b.length!=c.length)return!1;for(var d=0;d<b.length;++d)if(b[d]!=c[d])return!1;return!0}z('shaka.util.Uint8ArrayUtils.equal',Hc);
function Ic(b){for(var c=[],d=0;d<arguments.length;++d)c[d]=arguments[d];for(var e=d=0;e<c.length;++e)d+=c[e].length;d=new Uint8Array(d);for(var f=e=0;f<c.length;++f)d.set(c[f],e),e+=c[f].length;return d}z('shaka.util.Uint8ArrayUtils.concat',Ic);function Jc(b){var c=this;this.w=b;this.u=new Set;this.m=this.h=null;this.N=!1;this.a=null;this.i=new bc;this.b=new Map;this.o=[];this.j=new G;this.f=null;this.g=function(d){c.j.reject(d);b.onError(d)};this.ka=new Map;this.S=new Map;this.M=new A(function(){return Kc(c)});this.c=!1;this.X=new G;this.C=!1;this.F=[];this.ja=!1;this.W=(new A(function(){Lc(c)})).Ka(1);this.j['catch'](function(){})}p=Jc.prototype;
p.destroy=function(){var b=this;return t(function d(){return y(d,function(d){switch(d.l){case 1:if(b.c)return u(d,b.X,0);b.c=!0;return u(d,Mc(b),4);case 4:b.X.resolve(),d.A(0)}})})};
function Mc(b){return t(function d(){var e;return y(d,function(d){switch(d.l){case 1:return b.i.a(),b.i=null,b.j.reject(),b.W.stop(),b.W=null,b.M.stop(),b.M=null,e=Array.from(b.b.keys()),b.b.clear(),u(d,Promise.all(e.map(function(b){return Promise.resolve().then(function(){return t(function k(){return y(k,function(d){switch(d.l){case 1:return ya(d,2),u(d,Nc(b),4);case 4:Aa(d,0);break;case 2:Da(d),v(d)}})})})})),2);case 2:if(!b.m){d.A(3);break}ya(d,4);return u(d,b.m.setMediaKeys(null),6);case 6:Aa(d,
5);break;case 4:Da(d);case 5:b.m=null;case 3:b.a=null,b.u.clear(),b.h=null,b.o=[],b.f=null,b.g=null,b.w=null,v(d)}})})}p.configure=function(b){this.f=b};function Oc(b,c,d){b.o=[];b.C=d;return Pc(b,c)}function Qc(b,c,d){b.o=d;b.C=0<d.length;return Pc(b,c)}
function Rc(b,c,d,e,f,g){var h=new Map;h.set(c,{ audioCapabilities:f,videoCapabilities:g,distinctiveIdentifier:'optional',persistentState:'required',sessionTypes:['persistent-license'],label:c,drmInfos:[{ keySystem:c,licenseServerUri:d,distinctiveIdentifierRequired:!1,persistentStateRequired:!0,audioRobustness:'',videoRobustness:'',serverCertificate:e,initData:null,keyIds:null }] });return Sc(b,h)}
function Pc(b,c){var d=c.some(function(b){return 0<b.drmInfos.length});if(!d){var e=kc(b.f.servers);Tc(c,e)}var f=Uc(b);if(f){var g=r(c);for(e=g.next();!e.done;e=g.next())e.value.drmInfos=[f]}f=r(c);for(e=f.next();!e.done;e=f.next())for(e=r(e.value.drmInfos),g=e.next();!g.done;g=e.next())Vc(g.value,kc(b.f.servers),kc(b.f.advanced||{}));e=Wc(b,c);if(!e.size)return b.N=!0,Promise.resolve();e=Sc(b,e);return d?e:e['catch'](function(){})}
p.Ab=function(b){var c=this;if(!this.h)return ec(this.i,b,'encrypted',function(){c.g(new C(2,6,6010))}),Promise.resolve();this.m=b;ec(this.i,this.m,'play',function(){for(var b=0;b<c.F.length;b++)Xc(c,c.F[b]);c.ja=!0;c.F=[]});b=this.m.setMediaKeys(this.h);b=b['catch'](function(b){return Promise.reject(new C(2,6,6003,b.message))});var d=Yc(this);return Promise.all([b,d]).then(function(){if(c.c)return Promise.reject();Zc(c);c.a.initData.length||c.o.length||K(c.i,c.m,'encrypted',function(b){return $c(c,
b.initDataType,new Uint8Array(b.initData))})})['catch'](function(b){if(!c.c)return Promise.reject(b)})};function Yc(b){return t(function d(){var e;return y(d,function(d){switch(d.l){case 1:if(!(b.h&&b.a&&b.a.serverCertificate&&b.a.serverCertificate.length)){d.A(0);break}ya(d,3);return u(d,b.h.setServerCertificate(b.a.serverCertificate),5);case 5:Aa(d,0);break;case 3:return e=Da(d),d['return'](Promise.reject(new C(2,6,6004,e.message)))}})})}
function ad(b,c){return t(function e(){var f,g,h;return y(e,function(e){switch(e.l){case 1:return u(e,bd(b,c),2);case 2:f=e.s;if(!f)return e['return']();g=[];if(h=b.b.get(f))h.wa=new G,g.push(h.wa);g.push(f.remove());return u(e,Promise.all(g),0)}})})}function Zc(b){var c=b.a?b.a.initData:[];c.forEach(function(c){return cd(b,c.initDataType,c.initData)});b.o.forEach(function(c){return bd(b,c)});c.length||b.o.length||b.j.resolve();return b.j}
function $c(b,c,d){var e=b.b.values();e=r(e);for(var f=e.next();!f.done;f=e.next())if(Hc(d,f.value.initData))return;cd(b,c,d)}p.keySystem=function(){return this.a?this.a.keySystem:''};function dd(b,c){return tc('Edge/')?!0:b.u.has(c)}function ed(b){b=b.b.keys();b=ic(b,function(b){return b.sessionId});return Array.from(b)}p.cc=function(){var b=Infinity,c=this.b.keys();c=r(c);for(var d=c.next();!d.done;d=c.next())d=d.value,isNaN(d.expiration)||(b=Math.min(b,d.expiration));return b};
function Wc(b,c){for(var d=new Set,e=r(c),f=e.next();!f.done;f=e.next()){var g=r(f.value.drmInfos);for(f=g.next();!f.done;f=g.next())d.add(f.value)}e=r(d);for(f=e.next();!f.done;f=e.next())Vc(f.value,kc(b.f.servers),kc(b.f.advanced||{}));g=b.C?'required':'optional';var h=b.C?['persistent-license']:['temporary'];e=new Map;d=r(d);for(f=d.next();!f.done;f=d.next())f=f.value,e.set(f.keySystem,{ audioCapabilities:[],videoCapabilities:[],distinctiveIdentifier:'optional',persistentState:g,sessionTypes:h,
label:f.keySystem,drmInfos:[] });d=r(c);for(f=d.next();!f.done;f=d.next()){f=f.value;g=f.audio;h=f.video;var k=g?mc(g.mimeType,g.codecs):'',l=h?mc(h.mimeType,h.codecs):'',m=r(f.drmInfos);for(f=m.next();!f.done;f=m.next()){f=f.value;var n=e.get(f.keySystem);n.drmInfos.push(f);f.distinctiveIdentifierRequired&&(n.distinctiveIdentifier='required');f.persistentStateRequired&&(n.persistentState='required');g&&n.audioCapabilities.push({ robustness:f.audioRobustness||'',contentType:k });h&&n.videoCapabilities.push({ robustness:f.videoRobustness||
'',contentType:l })}}return e}
function Sc(b,c){if(1==c.size&&c.has(''))return Promise.reject(new C(2,6,6E3));for(var d=r(c.values()),e=d.next();!e.done;e=d.next())e=e.value,0==e.audioCapabilities.length&&delete e.audioCapabilities,0==e.videoCapabilities.length&&delete e.videoCapabilities;var f=d=new G;[!0,!1].forEach(function(b){var d=this;c.forEach(function(c,e){c.drmInfos.some(function(b){return!!b.licenseServerUri})==b&&(f=f['catch'](function(){if(!this.c)return navigator.requestMediaKeySystemAccess(e,[c])}.bind(d)))})}.bind(b));
f=f['catch'](function(){return Promise.reject(new C(2,6,6001))});f=f.then(function(b){if(this.c)return Promise.reject();this.u.clear();var d=b.getConfiguration(),e=d.videoCapabilities||[],f=r(d.audioCapabilities||[]);for(d=f.next();!d.done;d=f.next())this.u.add(d.value.contentType);e=r(e);for(d=e.next();!d.done;d=e.next())this.u.add(d.value.contentType);e=b.keySystem;d=c.get(b.keySystem);f=[];var g=[],n=[],q=[];fd(d.drmInfos,f,g,n,q);this.a={ keySystem:e,licenseServerUri:f[0],distinctiveIdentifierRequired:'required'==
d.distinctiveIdentifier,persistentStateRequired:'required'==d.persistentState,audioRobustness:d.audioCapabilities?d.audioCapabilities[0].robustness:'',videoRobustness:d.videoCapabilities?d.videoCapabilities[0].robustness:'',serverCertificate:g[0],initData:n,keyIds:q };return this.a.licenseServerUri?b.createMediaKeys():Promise.reject(new C(2,6,6012,this.a.keySystem))}.bind(b)).then(function(b){if(this.c)return Promise.reject();this.h=b;this.N=!0}.bind(b))['catch'](function(b){if(!this.c)return this.a=
null,this.u.clear(),b instanceof C?Promise.reject(b):Promise.reject(new C(2,6,6002,b.message))}.bind(b));d.reject();return f}
function Uc(b){b=kc(b.f.clearKeys);if(0==b.size)return null;var c=[],d=[];b.forEach(function(b,e){var f=Fc(e),g=Fc(b);f={ kty:'oct',kid:Dc(f,!1),k:Dc(g,!1) };c.push(f);d.push(f.kid)});b=JSON.stringify({ keys:c });var e=JSON.stringify({ kids:d });e=[{ initData:new Uint8Array(Bc(e)),initDataType:'keyids' }];return{ keySystem:'org.w3.clearkey',licenseServerUri:'data:application/json;base64,'+window.btoa(b),distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:'',videoRobustness:'',serverCertificate:null,
initData:e,keyIds:[] }}
function bd(b,c){try{var d=b.h.createSession('persistent-license')}catch(g){var e=new C(2,6,6005,g.message);b.g(e);return Promise.reject(e)}K(b.i,d,'message',b.Sd.bind(b));K(b.i,d,'keystatuseschange',b.Qd.bind(b));var f={ initData:null,loaded:!1,Wc:Infinity,wa:null };b.b.set(d,f);return d.load(c).then(function(b){if(this.c)return Promise.reject();if(b)return f.loaded=!0,gd(this)&&this.j.resolve(),d;this.b['delete'](d);this.g(new C(2,6,6013))}.bind(b),function(b){this.c||(this.b['delete'](d),this.g(new C(2,
6,6005,b.message)))}.bind(b))}
function cd(b,c,d){try{var e=b.C?b.h.createSession('persistent-license'):b.h.createSession()}catch(f){b.g(new C(2,6,6005,f.message));return}K(b.i,e,'message',b.Sd.bind(b));K(b.i,e,'keystatuseschange',b.Qd.bind(b));b.b.set(e,{ initData:d,loaded:!1,Wc:Infinity,wa:null });e.generateRequest(c,d.buffer)['catch'](function(c){if(!b.c){b.b['delete'](e);if(c.errorCode&&c.errorCode.systemCode){var d=c.errorCode.systemCode;0>d&&(d+=Math.pow(2,32));d='0x'+d.toString(16)}b.g(new C(2,6,6006,c.message,c,d))}})}
p.Sd=function(b){this.f.delayLicenseRequestUntilPlayed&&this.m.paused&&!this.ja?this.F.push(b):Xc(this,b)};
function Xc(b,c){var d=c.target,e=b.b.get(d),f=b.a.licenseServerUri,g=b.f.advanced[b.a.keySystem];'individualization-request'==c.messageType&&g&&g.individualizationServer&&(f=g.individualizationServer);f=Tb([f],b.f.retryParameters);f.body=c.message;f.method='POST';f.licenseRequestType=c.messageType;'com.microsoft.playready'!=b.a.keySystem&&'com.chromecast.playready'!=b.a.keySystem||hd(f);b.a.keySystem.startsWith('com.apple.fps')&&id(f);b.w.ob.request(2,f).promise.then(function(b){if(this.c)return Promise.reject();
this.a.keySystem.startsWith('com.apple.fps')&&jd(b);return d.update(b.data).then(function(){var b=this;this.w.onEvent(new I('drmsessionupdate'));e&&(e.wa&&e.wa.resolve(),(new A(function(){e.loaded=!0;gd(b)&&b.j.resolve()})).P(kd))}.bind(this))}.bind(b),function(b){this.c||(b=new C(2,6,6007,b),this.g(b),e&&e.wa&&e.wa.reject(b))}.bind(b))['catch'](function(b){this.c||(b=new C(2,6,6008,b.message),this.g(b),e&&e.wa&&e.wa.reject(b))}.bind(b))}
function hd(b){var c=zc(b.body,!0,!0);if(c.includes('PlayReadyKeyMessage')){c=(new DOMParser).parseFromString(c,'application/xml');for(var d=c.getElementsByTagName('HttpHeader'),e=0;e<d.length;++e)b.headers[d[e].querySelector('name').textContent]=d[e].querySelector('value').textContent;b.body=Ec(c.querySelector('Challenge').textContent).buffer}else b.headers['Content-Type']='text/xml; charset=utf-8'}
function id(b){var c=new Uint8Array(b.body);c='spc='+Dc(c);b.headers['Content-Type']='application/x-www-form-urlencoded';b.body=Bc(c)}function jd(b){try{var c=xc(b.data)}catch(d){return}c=c.trim();'<ckc>'===c.substr(0,5)&&'</ckc>'===c.substr(-6)&&(c=c.slice(5,-6));try{c=JSON.parse(c).ckc}catch(d){}b.data=Ec(c).buffer}
p.Qd=function(b){b=b.target;var c=this.b.get(b),d=!1;b.keyStatuses.forEach(function(b,e){if('string'==typeof e){var f=e;e=b;b=f}if('com.microsoft.playready'==this.a.keySystem&&16==e.byteLength&&!tc('Tizen')){f=new DataView(e);var g=f.getUint32(0,!0),l=f.getUint16(4,!0),m=f.getUint16(6,!0);f.setUint32(0,g,!1);f.setUint16(4,l,!1);f.setUint16(6,m,!1)}'com.microsoft.playready'==this.a.keySystem&&'status-pending'==b&&(b='usable');'status-pending'!=b&&(c.loaded=!0);'expired'==b&&(d=!0);f=Gc(new Uint8Array(e));
this.ka.set(f,b)}.bind(this));var e=b.expiration-Date.now();(0>e||d&&1E3>e)&&c&&!c.wa&&(this.b['delete'](b),b.close()['catch'](function(){}));gd(this)&&(this.j.resolve(),this.M.P(ld))};function Kc(b){var c=b.ka,d=b.S;d.clear();c.forEach(function(b,c){return d.set(c,b)});c=Array.from(d.values());c.length&&c.every(function(b){return'expired'==b})&&b.g(new C(2,6,6014));b.w.hc(lc(d))}
function md(){function b(b){return t(function h(){var c,f,m;return y(h,function(h){switch(h.l){case 1:return ya(h,2),u(h,navigator.requestMediaKeySystemAccess(b,d),4);case 4:return c=h.s,m=(f=c.getConfiguration().sessionTypes)?f.includes('persistent-license'):!1,tc('Tizen 3')&&(m=!1),e.set(b,{ persistentState:m }),u(h,c.createMediaKeys(),5);case 5:Aa(h,0);break;case 2:Da(h),e.set(b,null),v(h)}})})}var c=[{ contentType:'video/mp4; codecs="avc1.42E01E"' },{ contentType:'video/webm; codecs="vp8"' }],d=[{ videoCapabilities:c,
persistentState:'required',sessionTypes:['persistent-license'] },{ videoCapabilities:c }],e=new Map;c='org.w3.clearkey com.widevine.alpha com.microsoft.playready com.apple.fps.3_0 com.apple.fps.2_0 com.apple.fps.1_0 com.apple.fps com.adobe.primetime'.split(' ').map(function(c){return b(c)});return Promise.all(c).then(function(){return lc(e)})}
function nd(b,c){var d=c.audio,e=c.video;if(d&&d.encrypted&&!dd(b,mc(d.mimeType,d.codecs))||e&&e.encrypted&&!dd(b,mc(e.mimeType,e.codecs)))return!1;var f=b.keySystem();return 0==c.drmInfos.length||c.drmInfos.some(function(b){return b.keySystem==f})}
function od(b,c){if(!b.length)return c;if(!c.length)return b;for(var d=[],e=0;e<b.length;e++)for(var f=0;f<c.length;f++)if(b[e].keySystem==c[f].keySystem){var g=b[e];f=c[f];var h=[];h=h.concat(g.initData||[]);h=h.concat(f.initData||[]);var k=[];k=k.concat(g.keyIds);k=k.concat(f.keyIds);d.push({ keySystem:g.keySystem,licenseServerUri:g.licenseServerUri||f.licenseServerUri,distinctiveIdentifierRequired:g.distinctiveIdentifierRequired||f.distinctiveIdentifierRequired,persistentStateRequired:g.persistentStateRequired||
f.persistentStateRequired,videoRobustness:g.videoRobustness||f.videoRobustness,audioRobustness:g.audioRobustness||f.audioRobustness,serverCertificate:g.serverCertificate||f.serverCertificate,initData:h,keyIds:k });break}return d}function Lc(b){b.b.forEach(function(c,d){var e=c.Wc,f=d.expiration;isNaN(f)&&(f=Infinity);f!=e&&(b.w.onExpirationUpdated(d.sessionId,f),c.Wc=f)})}function gd(b){b=b.b.values();return jc(b,function(b){return b.loaded})}
function Tc(b,c){var d=[];c.forEach(function(b,c){d.push({ keySystem:c,licenseServerUri:b,distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:'',videoRobustness:'',serverCertificate:null,initData:[],keyIds:[] })});for(var e=r(b),f=e.next();!f.done;f=e.next())f.value.drmInfos=d}
function fd(b,c,d,e,f){b.forEach(function(b){c.includes(b.licenseServerUri)||c.push(b.licenseServerUri);b.serverCertificate&&(d.some(function(c){return Hc(c,b.serverCertificate)})||d.push(b.serverCertificate));b.initData&&b.initData.forEach(function(b){e.some(function(c){return c.keyId&&c.keyId==b.keyId?!0:c.initDataType==b.initDataType&&Hc(c.initData,b.initData)})||e.push(b)});if(b.keyIds)for(var g=0;g<b.keyIds.length;++g)f.includes(b.keyIds[g])||f.push(b.keyIds[g])})}
function Vc(b,c,d){if(b.keySystem&&('org.w3.clearkey'!=b.keySystem||!b.licenseServerUri)){c.size&&(c=c.get(b.keySystem)||'',b.licenseServerUri=c);b.keyIds||(b.keyIds=[]);if(d=d.get(b.keySystem))b.distinctiveIdentifierRequired||(b.distinctiveIdentifierRequired=d.distinctiveIdentifierRequired),b.persistentStateRequired||(b.persistentStateRequired=d.persistentStateRequired),b.videoRobustness||(b.videoRobustness=d.videoRobustness),b.audioRobustness||(b.audioRobustness=d.audioRobustness),b.serverCertificate||
(b.serverCertificate=d.serverCertificate);window.cast&&window.cast.__platform__&&'com.microsoft.playready'==b.keySystem&&(b.keySystem='com.chromecast.playready')}}function Nc(b){return t(function d(){var e;return y(d,function(d){switch(d.l){case 1:return e=new Promise(function(b){(new A(b)).P(pd)}),u(d,Promise.race([b.close().then(function(){return!0}),e.then(function(){return!1})]),2);case 2:v(d)}})})}var pd=1,kd=5,ld=.5;function qd(){this.a=new muxjs.mp4.CaptionParser;this.g=[];this.f={}}qd.prototype.init=function(b){var c=muxjs.mp4.probe;b=new Uint8Array(b);this.g=c.videoTrackIds(b);this.f=c.timescale(b);this.a.init()};qd.prototype.b=function(b,c){var d=new Uint8Array(b);(d=this.a.parse(d,this.g,this.f))&&d.captions&&c(d.captions);this.a.clearParsedCaptions()};qd.prototype.c=function(){this.a.resetCaptionStream()};function rd(){}rd.prototype.init=function(){};rd.prototype.b=function(){};rd.prototype.c=function(){};function sd(b){return!b||1==b.length&&1E-6>b.end(0)-b.start(0)?null:b.length?b.end(b.length-1):null}function td(b,c,d){d=void 0===d?0:d;return!b||!b.length||1==b.length&&1E-6>b.end(0)-b.start(0)||c>b.end(b.length-1)?!1:c+d>=b.start(0)}function ud(b,c){if(!b||!b.length||1==b.length&&1E-6>b.end(0)-b.start(0))return 0;for(var d=0,e=b.length-1;0<=e&&b.end(e)>c;--e)d+=b.end(e)-Math.max(b.start(e),c);return d}
function vd(b){if(!b)return[];for(var c=[],d=0;d<b.length;d++)c.push({ start:b.start(d),end:b.end(d) });return c};var wd={ ze:function(b,c){return b.reduce(function(b,c,f){return c['catch'](b.bind(null,f))}.bind(null,c),Promise.reject())},vc:function(b,c){return b.concat(c)},Hb:function(){},Fa:function(b){return null!=b} };function xd(b,c){if(0==c.length)return b;var d=c.map(function(b){return new cb(b)});return b.map(function(b){return new cb(b)}).map(function(b){return d.map(b.resolve.bind(b))}).reduce(wd.vc,[]).map(function(b){return b.toString()})}function Ad(b,c){return{ keySystem:b,licenseServerUri:'',distinctiveIdentifierRequired:!1,persistentStateRequired:!1,audioRobustness:'',videoRobustness:'',serverCertificate:null,initData:c||[],keyIds:[] }}var Bd={ Na:'video',xb:'audio',na:'text',rg:'application' },Cd=1/15;function Dd(){this.a=new muxjs.mp4.Transmuxer({ keepOriginalTimestamps:!0 });this.b=null;this.g=[];this.c=[];this.f=!1;this.a.on('data',this.i.bind(this));this.a.on('done',this.h.bind(this))}Dd.prototype.destroy=function(){this.a.dispose();this.a=null;return Promise.resolve()};function Ed(b,c){return window.muxjs&&'mp2t'==b.split(';')[0].split('/')[1]?c?MediaSource.isTypeSupported(Fd(c,b)):MediaSource.isTypeSupported(Fd('audio',b))||MediaSource.isTypeSupported(Fd('video',b)):!1}
function Fd(b,c){var d=c.replace('mp2t','mp4');'audio'==b&&(d=d.replace('video','audio'));var e=/avc1\.(66|77|100)\.(\d+)/.exec(d);if(e){var f='avc1.',g=e[1],h=Number(e[2]);f=('66'==g?f+'4200':'77'==g?f+'4d00':f+'6400')+(h>>4).toString(16);f+=(h&15).toString(16);d=d.replace(e[0],f)}return d}function Gd(b,c){b.f=!0;b.b=new G;b.g=[];b.c=[];var d=new Uint8Array(c);b.a.push(d);b.a.flush();b.f&&b.b.reject(new C(2,3,3018));return b.b}
Dd.prototype.i=function(b){this.c=b.captions;var c=new Uint8Array(b.data.byteLength+b.initSegment.byteLength);c.set(b.initSegment,0);c.set(b.data,b.initSegment.byteLength);this.g.push(c)};Dd.prototype.h=function(){var b={ data:Ic.apply(null,this.g),captions:this.c };this.b.resolve(b);this.f=!1};function Hd(b,c,d){this.startTime=b;this.direction=Id;this.endTime=c;this.payload=d;this.region=new Jd;this.position=null;this.positionAlign=Kd;this.size=100;this.textAlign=Ld;this.writingMode=Md;this.lineInterpretation=Nd;this.line=null;this.lineHeight='';this.lineAlign=Od;this.displayAlign=Pd;this.backgroundColor=this.color='';this.backgroundImage=null;this.fontSize='';this.fontWeight=Qd;this.fontStyle=Rd;this.fontFamily='';this.textDecoration=[];this.wrapLine=!0;this.id=''}z('shaka.text.Cue',Hd);
var Kd='auto';Hd.positionAlign={ LEFT:'line-left',RIGHT:'line-right',CENTER:'center',AUTO:Kd };var Ld='center',Sd={ LEFT:'left',RIGHT:'right',CENTER:Ld,START:'start',END:'end' };Hd.textAlign=Sd;var Pd='after',Td={ BEFORE:'before',CENTER:'center',AFTER:Pd };Hd.displayAlign=Td;var Id='ltr';Hd.direction={ HORIZONTAL_LEFT_TO_RIGHT:Id,HORIZONTAL_RIGHT_TO_LEFT:'rtl' };var Md='horizontal-tb';Hd.writingMode={ HORIZONTAL_TOP_TO_BOTTOM:Md,VERTICAL_LEFT_TO_RIGHT:'vertical-lr',VERTICAL_RIGHT_TO_LEFT:'vertical-rl' };
var Nd=0;Hd.lineInterpretation={ LINE_NUMBER:Nd,PERCENTAGE:1 };var Od='start',Ud={ CENTER:'center',START:Od,END:'end' };Hd.lineAlign=Ud;var Qd=400;Hd.fontWeight={ NORMAL:Qd,BOLD:700 };var Rd='normal',Vd={ NORMAL:Rd,ITALIC:'italic',OBLIQUE:'oblique' };Hd.fontStyle=Vd;Hd.textDecoration={ UNDERLINE:'underline',LINE_THROUGH:'lineThrough',OVERLINE:'overline' };
function Jd(){this.id='';this.regionAnchorY=this.regionAnchorX=this.viewportAnchorY=this.viewportAnchorX=0;this.height=this.width=100;this.viewportAnchorUnits=this.widthUnits=this.heightUnits=Wd;this.scroll=Xd}z('shaka.text.CueRegion',Jd);var Wd=1;Jd.units={ PX:0,PERCENTAGE:Wd,LINES:2 };var Xd='';Jd.scrollMode={ NONE:Xd,UP:'up' };function Yd(b){this.g=null;this.c=b;this.f=this.m=0;this.h=Infinity;this.b=this.a=null;this.j='';this.i=new Map}var Zd={};z('shaka.text.TextEngine.registerParser',function(b,c){Zd[b]=c});z('shaka.text.TextEngine.unregisterParser',function(b){delete Zd[b]});function $d(b){return Zd[b]||window.muxjs&&'application/cea-608'==b?!0:!1}Yd.prototype.destroy=function(){this.c=this.g=null;this.i.clear();return Promise.resolve()};function ae(b,c){'application/cea-608'!=c&&(b.g=new Zd[c])}
Yd.prototype.Ic=function(b){var c={ periodStart:0,segmentStart:null,segmentEnd:0 };try{return this.g.parseMedia(new Uint8Array(b),c)[0].startTime}catch(d){throw new C(2,2,2009,d);}};
function be(b,c,d,e){return Promise.resolve().then(function(){if(this.g&&this.c)if(null==d||null==e)this.g.parseInit(new Uint8Array(c));else{var b={ periodStart:this.m,segmentStart:d,segmentEnd:e };b=this.g.parseMedia(new Uint8Array(c),b).filter(function(b){return b.startTime>=this.f&&b.startTime<this.h}.bind(this));this.c.append(b);null==this.a&&(this.a=Math.max(d,this.f));this.b=Math.min(e,this.h)}}.bind(b))}
Yd.prototype.remove=function(b,c){return Promise.resolve().then(function(){!this.c||!this.c.remove(b,c)||null==this.a||c<=this.a||b>=this.b||(b<=this.a&&c>=this.b?this.a=this.b=null:b<=this.a&&c<this.b?this.a=c:b>this.a&&c>=this.b&&(this.b=b))}.bind(this))};Yd.prototype.se=function(b){this.c.append(b)};Yd.prototype.appendCues=Yd.prototype.se;
Yd.prototype.oc=function(b,c){this.j=b;var d=this.i.get(b);if(d)for(var e=r(d.keys()),f=e.next();!f.done;f=e.next())if(f=d.get(f.value))f=f.filter(function(b){return b.endTime<=c}),this.c.append(f)};Yd.prototype.setSelectedClosedCaptionId=Yd.prototype.oc;
function ce(b,c,d,e,f){var g=d+' '+e,h=new Map;c=r(c);for(var k=c.next();!k.done;k=c.next()){var l=k.value;k=l.stream;h.has(k)||h.set(k,new Map);h.get(k).has(g)||h.get(k).set(g,[]);l.startTime+=f;l.endTime+=f;l.startTime>=b.f&&l.startTime<b.h&&(l=new Hd(l.startTime,l.endTime,l.text),h.get(k).get(g).push(l),k==b.j&&b.c.append([l]))}f=r(h.keys());for(g=f.next();!g.done;g=f.next())for(g=g.value,b.i.has(g)||b.i.set(g,new Map),c=r(h.get(g).keys()),k=c.next();!k.done;k=c.next())k=k.value,l=h.get(g).get(k),
b.i.get(g).set(k,l);b.a=null==b.a?Math.max(d,b.f):Math.min(b.a,Math.max(d,b.f));b.b=Math.max(b.b,Math.min(e,b.h))};function de(b,c,d){this.f=b;this.g=d;this.b={};this.a=null;this.c={};this.i=new bc;this.u=!1;this.j={};this.m=c;b=this.o=new G;c=new MediaSource;ec(this.i,c,'sourceopen',b.resolve);this.f.src=ee(c);this.h=c}var ee=window.URL.createObjectURL;function fe(b){var c=mc(b.mimeType,b.codecs),d=nc(b);return $d(c)||MediaSource.isTypeSupported(d)||Ed(c,b.type)}p=de.prototype;
p.destroy=function(){var b=this;this.u=!0;var c=[],d;for(d in this.c){var e=this.c[d],f=e[0];this.c[d]=e.slice(0,1);f&&c.push(f.p['catch'](wd.Hb));for(f=1;f<e.length;++f)e[f].p['catch'](wd.Hb),e[f].p.reject()}this.a&&c.push(this.a.destroy());this.g&&c.push(this.g.destroy());for(var g in this.j)c.push(this.j[g].destroy());return Promise.all(c).then(function(){b.i&&(b.i.a(),b.i=null);b.f&&(b.f.removeAttribute('src'),b.f.load(),b.f=null);b.h=null;b.a=null;b.g=null;b.b={};b.j={};b.m=null;b.c={}})};
p.init=function(b,c){var d=this;return t(function f(){var g;return y(f,function(f){switch(f.l){case 1:return g=Bd,u(f,d.o,2);case 2:b.forEach(function(b,f){var h=mc(b.mimeType,b.codecs);f==g.na?ge(d,h):(!c&&MediaSource.isTypeSupported(h)||!Ed(h,f)||(d.j[f]=new Dd,h=Fd(f,h)),h=d.h.addSourceBuffer(h),K(d.i,h,'error',d.$f.bind(d,f)),K(d.i,h,'updateend',d.rb.bind(d,f)),d.b[f]=h,d.c[f]=[])}),v(f)}})})};function ge(b,c){b.a||(b.a=new Yd(b.g));ae(b.a,c)}
function he(b,c){if('text'==c)var d=b.a.a;else d=ie(b,c),d=!d||1==d.length&&1E-6>d.end(0)-d.start(0)?null:1==d.length&&0>d.start(0)?0:d.length?d.start(0):null;return d}function je(b,c){return'text'==c?b.a.b:sd(ie(b,c))}function ke(b,c,d){if('text'==c)return b=b.a,null==b.b||b.b<d?0:b.b-Math.max(d,b.a);b=ie(b,c);return ud(b,d)}
p.Fc=function(b){b.total=vd(this.f.buffered);b.audio=vd(ie(this,'audio'));b.video=vd(ie(this,'video'));b.text=[];if(this.a){var c=this.a.a,d=this.a.b;null!=c&&null!=d&&b.text.push({ start:c,end:d })}};function ie(b,c){try{return b.b[c].buffered}catch(d){return null}}
function le(b,c,d,e,f,g){if('text'==c)return be(b.a,d,e,f);if(b.j[c])return Gd(b.j[c],d).then(function(b){this.a||ge(this,'text/vtt');b.captions&&ce(this.a,b.captions,e,f,this.b.video.timestampOffset);return me(this,c,this.ge.bind(this,c,b.data.buffer))}.bind(b));g&&window.muxjs&&(b.a||ge(b,'text/vtt'),null==e&&null==f?b.m.init(d):b.m.b(d,function(c){c.length&&ce(b.a,c,e,f,b.b.video.timestampOffset)}));return me(b,c,b.ge.bind(b,c,d))}p.oc=function(b){var c=je(this,'video')||0;this.a.oc(b,c)};
p.remove=function(b,c,d){return'text'==b?this.a.remove(c,d):me(this,b,this.he.bind(this,b,c,d))};function ne(b,c){if('text'==c){if(!b.a)return Promise.resolve();b.m.c();return b.a.remove(0,Infinity)}return me(b,c,b.he.bind(b,c,0,b.h.duration))}p.flush=function(b){return'text'==b?Promise.resolve():me(this,b,this.De.bind(this,b))};
function oe(b,c,d,e,f){return'text'==c?(b.a.m=d,b=b.a,b.f=e,b.h=f,Promise.resolve()):Promise.all([me(b,c,b.qe.bind(b,c)),me(b,c,b.Vf.bind(b,c,d)),me(b,c,b.Sf.bind(b,c,e,f))])}p.endOfStream=function(b){return pe(this,function(){b?this.h.endOfStream(b):this.h.endOfStream()}.bind(this))};p.ua=function(b){return pe(this,function(){this.h.duration=b}.bind(this))};p.V=function(){return this.h.duration};p.ge=function(b,c){this.b[b].appendBuffer(c)};
p.he=function(b,c,d){d<=c?this.rb(b):this.b[b].remove(c,d)};p.qe=function(b){var c=this.b[b].appendWindowStart,d=this.b[b].appendWindowEnd;this.b[b].abort();this.b[b].appendWindowStart=c;this.b[b].appendWindowEnd=d;this.rb(b)};p.De=function(b){this.f.currentTime-=.001;this.rb(b)};p.Vf=function(b,c){0>c&&(c+=.001);this.b[b].timestampOffset=c;this.rb(b)};p.Sf=function(b,c,d){this.b[b].appendWindowStart=0;this.b[b].appendWindowEnd=d;this.b[b].appendWindowStart=c;this.rb(b)};
p.$f=function(b){this.c[b][0].p.reject(new C(2,3,3014,this.f.error?this.f.error.code:0))};p.rb=function(b){var c=this.c[b][0];c&&(c.p.resolve(),qe(this,b))};function me(b,c,d){if(b.u)return Promise.reject();d={ start:d,p:new G };b.c[c].push(d);if(1==b.c[c].length)try{d.start()}catch(e){'QuotaExceededError'==e.name?d.p.reject(new C(2,3,3017,c)):d.p.reject(new C(2,3,3015,e)),qe(b,c)}return d.p}
function pe(b,c){if(b.u)return Promise.reject();var d=[],e;for(e in b.b){var f=new G,g={ start:function(b){b.resolve()}.bind(null,f),p:f };b.c[e].push(g);d.push(f);1==b.c[e].length&&g.start()}return Promise.all(d).then(function(){try{c()}catch(l){var b=Promise.reject(new C(2,3,3015,l))}for(var d in this.b)qe(this,d);return b}.bind(b),function(){return Promise.reject()}.bind(b))}function qe(b,c){b.c[c].shift();var d=b.c[c][0];if(d)try{d.start()}catch(e){d.p.reject(new C(2,3,3015,e)),qe(b,c)}};function re(b,c){b=L(b);c=L(c);return b.split('-')[0]==c.split('-')[0]}function se(b,c){b=L(b);c=L(c);var d=b.split('-'),e=c.split('-');return d[0]==e[0]&&1==d.length&&2==e.length}function L(b){var c=b.split('-');b=c[0]||'';c=c[1]||'';b=b.toLowerCase();b=te.get(b)||b;return(c=c.toUpperCase())?b+'-'+c:b}function ue(b){return b.language?L(b.language):b.audio&&b.audio.language?L(b.audio.language):b.video&&b.video.language?L(b.video.language):'und'}
function ve(b,c){for(var d=L(b),e=new Set,f=r(c),g=f.next();!g.done;g=f.next())e.add(L(g.value));f=r(e);for(g=f.next();!g.done;g=f.next())if(g=g.value,g==d)return g;f=r(e);for(g=f.next();!g.done;g=f.next())if(g=g.value,se(g,d))return g;f=r(e);for(g=f.next();!g.done;g=f.next()){var h=g=g.value,k=d;h=L(h);k=L(k);h=h.split('-');k=k.split('-');if(2==h.length&&2==k.length&&h[0]==k[0])return g}e=r(e);for(g=e.next();!g.done;g=e.next())if(f=g.value,se(d,f))return f;return null}
var te=new Map([['aar','aa'],['abk','ab'],['afr','af'],['aka','ak'],['alb','sq'],['amh','am'],['ara','ar'],['arg','an'],['arm','hy'],['asm','as'],['ava','av'],['ave','ae'],['aym','ay'],['aze','az'],['bak','ba'],['bam','bm'],['baq','eu'],['bel','be'],['ben','bn'],['bih','bh'],['bis','bi'],['bod','bo'],['bos','bs'],['bre','br'],['bul','bg'],['bur','my'],['cat','ca'],['ces','cs'],['cha','ch'],['che','ce'],['chi','zh'],['chu','cu'],['chv','cv'],['cor','kw'],['cos','co'],['cre','cr'],['cym','cy'],['cze',
'cs'],['dan','da'],['deu','de'],['div','dv'],['dut','nl'],['dzo','dz'],['ell','el'],['eng','en'],['epo','eo'],['est','et'],['eus','eu'],['ewe','ee'],['fao','fo'],['fas','fa'],['fij','fj'],['fin','fi'],['fra','fr'],['fre','fr'],['fry','fy'],['ful','ff'],['geo','ka'],['ger','de'],['gla','gd'],['gle','ga'],['glg','gl'],['glv','gv'],['gre','el'],['grn','gn'],['guj','gu'],['hat','ht'],['hau','ha'],['heb','he'],['her','hz'],['hin','hi'],['hmo','ho'],['hrv','hr'],['hun','hu'],['hye','hy'],['ibo','ig'],['ice',
'is'],['ido','io'],['iii','ii'],['iku','iu'],['ile','ie'],['ina','ia'],['ind','id'],['ipk','ik'],['isl','is'],['ita','it'],['jav','jv'],['jpn','ja'],['kal','kl'],['kan','kn'],['kas','ks'],['kat','ka'],['kau','kr'],['kaz','kk'],['khm','km'],['kik','ki'],['kin','rw'],['kir','ky'],['kom','kv'],['kon','kg'],['kor','ko'],['kua','kj'],['kur','ku'],['lao','lo'],['lat','la'],['lav','lv'],['lim','li'],['lin','ln'],['lit','lt'],['ltz','lb'],['lub','lu'],['lug','lg'],['mac','mk'],['mah','mh'],['mal','ml'],['mao',
'mi'],['mar','mr'],['may','ms'],['mkd','mk'],['mlg','mg'],['mlt','mt'],['mon','mn'],['mri','mi'],['msa','ms'],['mya','my'],['nau','na'],['nav','nv'],['nbl','nr'],['nde','nd'],['ndo','ng'],['nep','ne'],['nld','nl'],['nno','nn'],['nob','nb'],['nor','no'],['nya','ny'],['oci','oc'],['oji','oj'],['ori','or'],['orm','om'],['oss','os'],['pan','pa'],['per','fa'],['pli','pi'],['pol','pl'],['por','pt'],['pus','ps'],['que','qu'],['roh','rm'],['ron','ro'],['rum','ro'],['run','rn'],['rus','ru'],['sag','sg'],['san',
'sa'],['sin','si'],['slk','sk'],['slo','sk'],['slv','sl'],['sme','se'],['smo','sm'],['sna','sn'],['snd','sd'],['som','so'],['sot','st'],['spa','es'],['sqi','sq'],['srd','sc'],['srp','sr'],['ssw','ss'],['sun','su'],['swa','sw'],['swe','sv'],['tah','ty'],['tam','ta'],['tat','tt'],['tel','te'],['tgk','tg'],['tgl','tl'],['tha','th'],['tib','bo'],['tir','ti'],['ton','to'],['tsn','tn'],['tso','ts'],['tuk','tk'],['tur','tr'],['twi','tw'],['uig','ug'],['ukr','uk'],['urd','ur'],['uzb','uz'],['ven','ve'],['vie',
'vi'],['vol','vo'],['wel','cy'],['wln','wa'],['wol','wo'],['xho','xh'],['yid','yi'],['yor','yo'],['zha','za'],['zho','zh'],['zul','zu']]);function we(b,c,d){function e(b,c,d){return b>=c&&b<=d}var f=b.video;return f&&f.width&&f.height&&!(e(f.width,c.minWidth,Math.min(c.maxWidth,d.width))&&e(f.height,c.minHeight,Math.min(c.maxHeight,d.height))&&e(f.width*f.height,c.minPixels,c.maxPixels))||!e(b.bandwidth,c.minBandwidth,c.maxBandwidth)?!1:!0}function xe(b,c,d){var e=!1;b.forEach(function(b){var f=b.allowedByApplication;b.allowedByApplication=we(b,c,d);f!=b.allowedByApplication&&(e=!0)});return e}
function ye(b,c,d,e){e.variants=e.variants.filter(function(e){if(b&&b.N&&!nd(b,e))return!1;var f=e.audio;e=e.video;return f&&!fe(f)||e&&!fe(e)||f&&c&&!ze(f,c)||e&&d&&!ze(e,d)?!1:!0});e.textStreams=e.textStreams.filter(function(b){return $d(mc(b.mimeType,b.codecs))})}function ze(b,c){return b.mimeType!=c.mimeType||b.codecs.split('.')[0]!=c.codecs.split('.')[0]?!1:!0}
function Ae(b){var c=b.audio,d=b.video,e=c?c.codecs:null,f=d?d.codecs:null,g=[];f&&g.push(f);e&&g.push(e);var h=[];d&&h.push(d.mimeType);c&&h.push(c.mimeType);h=h[0]||null;var k=[];c&&k.push(c.kind);d&&k.push(d.kind);k=k[0]||null;var l=new Set;c&&c.roles.forEach(function(b){return l.add(b)});d&&d.roles.forEach(function(b){return l.add(b)});b={ id:b.id,active:!1,type:'variant',bandwidth:b.bandwidth,language:b.language,label:null,kind:k,width:null,height:null,frameRate:null,mimeType:h,codecs:g.join(', '),
audioCodec:e,videoCodec:f,primary:b.primary,roles:Array.from(l),audioRoles:null,videoId:null,audioId:null,channelsCount:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:null };d&&(b.videoId=d.id,b.originalVideoId=d.originalId,b.width=d.width||null,b.height=d.height||null,b.frameRate=d.frameRate||null,b.videoBandwidth=d.bandwidth||null);c&&(b.audioId=c.id,b.originalAudioId=c.originalId,b.channelsCount=c.channelsCount,b.audioBandwidth=c.bandwidth||
null,b.label=c.label,b.audioRoles=c.roles);return b}function Be(b){return{ id:b.id,active:!1,type:'text',bandwidth:0,language:b.language,label:b.label,kind:b.kind||null,width:null,height:null,frameRate:null,mimeType:b.mimeType,codecs:b.codecs||null,audioCodec:null,videoCodec:null,primary:b.primary,roles:b.roles,audioRoles:null,videoId:null,audioId:null,channelsCount:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:b.originalId }}
function Ce(b){b.__shaka_id||(b.__shaka_id=De++);return b.__shaka_id}var De=0;function Ee(b){return{ id:Ce(b),active:!1,type:'',bandwidth:0,language:L(b.language),label:b.label,kind:b.kind,width:null,height:null,frameRate:null,mimeType:null,codecs:null,audioCodec:null,videoCodec:null,primary:!1,roles:[],audioRoles:null,videoId:null,audioId:null,channelsCount:null,audioBandwidth:null,videoBandwidth:null,originalVideoId:null,originalAudioId:null,originalTextId:null }}
function Fe(b){return b.allowedByApplication&&b.allowedByKeySystem}function Ge(b){return b.filter(function(b){return Fe(b)})}
function He(b,c){var d=b.filter(function(b){return b.audio&&b.audio.channelsCount}),e=new Map;d=r(d);for(var f=d.next();!f.done;f=d.next()){f=f.value;var g=f.audio.channelsCount;e.has(g)||e.set(g,[]);e.get(g).push(f)}d=Array.from(e.keys());if(0==d.length)return b;f=d.filter(function(b){return b<=c});return f.length?e.get(Math.max.apply(null,f)):e.get(Math.min.apply(null,d))}
function Ie(b,c,d){var e=b,f=b.filter(function(b){return b.primary});f.length&&(e=f);var g=e.length?e[0].language:'';e=e.filter(function(b){return b.language==g});if(c){var h=ve(L(c),b.map(function(b){return b.language}));h&&(e=b.filter(function(b){return L(b.language)==h}))}if(d){if(b=Je(e,d),b.length)return b}else if(b=e.filter(function(b){return 0==b.roles.length}),b.length)return b;b=e.map(function(b){return b.roles}).reduce(wd.vc,[]);return b.length?Je(e,b[0]):e}
function Je(b,c){return b.filter(function(b){return b.roles.includes(c)})}function Ke(b,c,d){for(var e=0;e<d.length;e++)if(d[e].audio==b&&d[e].video==c)return d[e];return null}function Le(b){var c=[];b.audio&&c.push(b.audio);b.video&&c.push(b.video);return c};function M(){this.h=null;this.f=!1;this.b=new Ya;this.c=[];this.i=!1;this.a=this.g=null}z('shaka.abr.SimpleAbrManager',M);M.prototype.stop=function(){this.h=null;this.f=!1;this.c=[];this.g=null};M.prototype.stop=M.prototype.stop;M.prototype.init=function(b){this.h=b};M.prototype.init=M.prototype.init;
M.prototype.chooseVariant=function(){var b=Me(this.a.restrictions,this.c),c=this.b.getBandwidthEstimate(this.a.defaultBandwidthEstimate);this.c.length&&!b.length&&(b=Me(null,this.c),b=[b[0]]);for(var d=b[0]||null,e=0;e<b.length;++e){var f=b[e],g=(b[e+1]||{ bandwidth:Infinity }).bandwidth/this.a.bandwidthUpgradeTarget;c>=f.bandwidth/this.a.bandwidthDowngradeTarget&&c<=g&&(d=f)}this.g=Date.now();return d};M.prototype.chooseVariant=M.prototype.chooseVariant;M.prototype.enable=function(){this.f=!0};
M.prototype.enable=M.prototype.enable;M.prototype.disable=function(){this.f=!1};M.prototype.disable=M.prototype.disable;M.prototype.segmentDownloaded=function(b,c){var d=this.b;if(!(16E3>c)){var e=8E3*c/b,f=b/1E3;d.a+=c;Wa(d.b,f,e);Wa(d.c,f,e)}if(null!=this.g&&this.f)a:{if(!this.i){if(!(128E3<=this.b.a))break a;this.i=!0}else if(Date.now()-this.g<1E3*this.a.switchInterval)break a;d=this.chooseVariant();this.b.getBandwidthEstimate(this.a.defaultBandwidthEstimate);this.h(d)}};
M.prototype.segmentDownloaded=M.prototype.segmentDownloaded;M.prototype.getBandwidthEstimate=function(){return this.b.getBandwidthEstimate(this.a.defaultBandwidthEstimate)};M.prototype.getBandwidthEstimate=M.prototype.getBandwidthEstimate;M.prototype.setVariants=function(b){this.c=b};M.prototype.setVariants=M.prototype.setVariants;M.prototype.configure=function(b){this.a=b};M.prototype.configure=M.prototype.configure;
function Me(b,c){b&&(c=c.filter(function(c){return we(c,b,{ width:Infinity,height:Infinity })}));return c.sort(function(b,c){return b.bandwidth-c.bandwidth})};function Ne(b,c){this.a=b;this.b=c}Ne.prototype.toString=function(){return'v'+this.a+'.'+this.b};function Oe(b,c){var d=new Ne(2,6),e=Pe,f=e.a,g=d.b-f.b;(0<(d.a-f.a||g)?e.c:e.b)(e.a,d,b,c)}function Qe(b,c,d,e){$a([d,'has been deprecated and will be removed in',c,'. We are currently at version',b,'. Additional information:',e].join(' '))}function Re(b,c,d,e){Za([d,'has been deprecated and has been removed in',c,'. We are now at version',b,'. Additional information:',e].join(''))}var Pe=null;var Se='ended play playing pause pausing ratechange seeked seeking timeupdate volumechange'.split(' '),Te='buffered currentTime duration ended loop muted paused playbackRate seeking videoHeight videoWidth volume'.split(' '),Ue=['loop','playbackRate'],Ve=['pause','play'],We='abrstatuschanged adaptation buffering emsg error loading streaming texttrackvisibility timelineregionadded timelineregionenter timelineregionexit trackschanged unloading variantchanged textchanged'.split(' '),Xe={ getAssetUri:2,
getAudioLanguages:2,getAudioLanguagesAndRoles:2,getBufferedInfo:2,getConfiguration:2,getExpiration:2,getPlaybackRate:2,getTextLanguages:2,getTextLanguagesAndRoles:2,getTextTracks:2,getStats:5,getVariantTracks:2,isAudioOnly:10,isBuffering:1,isInProgress:1,isLive:10,isTextTrackVisible:1,keySystem:10,seekRange:1,usingEmbeddedTextTrack:2,getLoadMode:10 },Ye={ getPlayheadTimeAsDate:1,getPresentationStartTimeAsDate:20 },Ze=[['getConfiguration','configure']],$e=[['isTextTrackVisible','setTextTrackVisibility']],
af='addTextTrack cancelTrickPlay configure resetConfiguration retryStreaming selectAudioLanguage selectEmbeddedTextTrack selectTextLanguage selectTextTrack selectVariantTrack setTextTrackVisibility trickPlay'.split(' '),bf=['attach','detach','load','unload'];
function cf(b){return JSON.stringify(b,function(b,d){if('function'!=typeof d){if(d instanceof Event||d instanceof I){var c={},f;for(f in d){var g=d[f];g&&'object'==typeof g?'detail'==f&&(c[f]=g):f in Event||(c[f]=g)}return c}if(d instanceof TimeRanges)for(c={ __type__:'TimeRanges',length:d.length,start:[],end:[] },f=0;f<d.length;++f)c.start.push(d.start(f)),c.end.push(d.end(f));else c=d instanceof Uint8Array?{ __type__:'Uint8Array',entries:Array.from(d) }:'number'==typeof d?isNaN(d)?'NaN':isFinite(d)?
d:0>d?'-Infinity':'Infinity':d;return c}})}function df(b){return JSON.parse(b,function(b,d){return'NaN'==d?NaN:'-Infinity'==d?-Infinity:'Infinity'==d?Infinity:d&&'object'==typeof d&&'TimeRanges'==d.__type__?ef(d):d&&'object'==typeof d&&'Uint8Array'==d.__type__?new Uint8Array(d.entries):d})}function ef(b){return{ length:b.length,start:function(c){return b.start[c]},end:function(c){return b.end[c]} }};function ff(b,c,d,e,f,g){this.N=b;this.f=new A(c);this.S=d;this.j=!1;this.F=e;this.M=f;this.w=g;this.b=this.h=!1;this.C='';this.i=null;this.m=this.Od.bind(this);this.o=this.mf.bind(this);this.a={ video:{},player:{} };this.u=0;this.c={};this.g=null}var gf=!1,hf=null;p=ff.prototype;p.destroy=function(){jf(this);hf&&kf(this);this.f&&(this.f.stop(),this.f=null);this.M=this.F=null;this.b=this.h=!1;this.o=this.m=this.g=this.c=this.a=this.i=null;return Promise.resolve()};p.da=function(){return this.b};
p.ad=function(){return this.C};p.init=function(){if(window.chrome&&chrome.cast&&chrome.cast.isAvailable){delete window.__onGCastApiAvailable;this.h=!0;this.f.pc();var b=new chrome.cast.SessionRequest(this.N);b=new chrome.cast.ApiConfig(b,this.Pd.bind(this),this.rf.bind(this),'origin_scoped');chrome.cast.initialize(b,function(){},function(){});gf&&this.f.P(.02);(b=hf)&&b.status!=chrome.cast.SessionStatus.STOPPED?this.Pd(b):hf=null}else window.__onGCastApiAvailable=function(b){b&&this.init()}.bind(this)};
p.gd=function(b){this.i=b;this.b&&lf({ type:'appData',appData:this.i })};p.cast=function(b){if(!this.h)return Promise.reject(new C(1,8,8E3));if(!gf)return Promise.reject(new C(1,8,8001));if(this.b)return Promise.reject(new C(1,8,8002));this.g=new G;chrome.cast.requestSession(this.Yc.bind(this,b),this.Nd.bind(this));return this.g};p.$b=function(){this.b&&(jf(this),hf&&(kf(this),hf.stop(function(){},function(){}),hf=null))};
p.get=function(b,c){if('video'==b){if(Ve.includes(c))return this.Zd.bind(this,b,c)}else if('player'==b){if(Ye[c]&&!this.get('player','isLive')())return function(){};if(af.includes(c))return this.Zd.bind(this,b,c);if(bf.includes(c))return this.Hf.bind(this,b,c);if(Xe[c])return this.Wd.bind(this,b,c)}return this.Wd(b,c)};p.set=function(b,c,d){this.a[b][c]=d;lf({ type:'set',targetName:b,property:c,value:d })};
p.Yc=function(b,c){hf=c;c.addUpdateListener(this.m);c.addMessageListener('urn:x-cast:com.google.shaka.v2',this.o);this.Od();lf({ type:'init',initState:b,appData:this.i });this.g.resolve()};p.Nd=function(b){var c=8003;switch(b.code){case 'cancel':c=8004;break;case 'timeout':c=8005;break;case 'receiver_unavailable':c=8006}this.g.reject(new C(2,8,c,b))};p.Wd=function(b,c){return this.a[b][c]};
p.Zd=function(b,c,d){for(var e=[],f=2;f<arguments.length;++f)e[f-2]=arguments[f];lf({ type:'call',targetName:b,methodName:c,args:e })};p.Hf=function(b,c,d){for(var e=[],f=2;f<arguments.length;++f)e[f-2]=arguments[f];f=new G;var g=this.u.toString();this.u++;this.c[g]=f;lf({ type:'asyncCall',targetName:b,methodName:c,args:e,id:g });return f};p.Pd=function(b){var c=this.w();this.g=new G;this.j=!0;this.Yc(c,b)};p.rf=function(b){gf='available'==b;this.f.pc()};
function kf(b){var c=hf;c.removeUpdateListener(b.m);c.removeMessageListener('urn:x-cast:com.google.shaka.v2',b.o)}p.Od=function(){var b=hf?'connected'==hf.status:!1;if(this.b&&!b){this.M();for(var c in this.a)this.a[c]={};jf(this)}this.C=(this.b=b)?hf.receiver.friendlyName:'';this.f.pc()};function jf(b){for(var c in b.c){var d=b.c[c];delete b.c[c];d.reject(new C(1,7,7E3))}}
p.mf=function(b,c){var d=df(c);switch(d.type){case 'event':var e=d.event;this.F(d.targetName,new I(e.type,e));break;case 'update':e=d.update;for(var f in e){d=this.a[f]||{};for(var g in e[f])d[g]=e[f][g]}this.j&&(this.S(),this.j=!1);break;case 'asyncComplete':if(f=d.id,d=d.error,g=this.c[f],delete this.c[f],g)if(d){f=new C(d.severity,d.category,d.code);for(e in d)f[e]=d[e];g.reject(f)}else g.resolve()}};function lf(b){b=cf(b);hf.sendMessage('urn:x-cast:com.google.shaka.v2',b,function(){},ab)};function N(b,c,d){Ib.call(this);this.c=b;this.b=c;this.i=this.g=this.f=this.j=this.h=null;this.a=new ff(d,this.Wf.bind(this),this.Xf.bind(this),this.Yf.bind(this),this.Zf.bind(this),this.Bd.bind(this));mf(this)}Ra(N,Ib);z('shaka.cast.CastProxy',N);N.prototype.destroy=function(b){b&&this.a&&this.a.$b();this.i&&(this.i.a(),this.i=null);b=[];this.b&&(b.push(this.b.destroy()),this.b=null);this.a&&(b.push(this.a.destroy()),this.a=null);this.j=this.h=this.c=null;return Promise.all(b)};
N.prototype.destroy=N.prototype.destroy;N.prototype.$e=function(){return this.h};N.prototype.getVideo=N.prototype.$e;N.prototype.Te=function(){return this.j};N.prototype.getPlayer=N.prototype.Te;N.prototype.ue=function(){return this.a?this.a.h&&gf:!1};N.prototype.canCast=N.prototype.ue;N.prototype.da=function(){return this.a?this.a.da():!1};N.prototype.isCasting=N.prototype.da;N.prototype.ad=function(){return this.a?this.a.ad():''};N.prototype.receiverName=N.prototype.ad;
N.prototype.cast=function(){var b=this.Bd();return this.a.cast(b).then(function(){if(this.b)return this.b.qd()}.bind(this))};N.prototype.cast=N.prototype.cast;N.prototype.gd=function(b){this.a.gd(b)};N.prototype.setAppData=N.prototype.gd;N.prototype.gg=function(){var b=this.a;if(b.b){var c=b.w();chrome.cast.requestSession(b.Yc.bind(b,c),b.Nd.bind(b))}};N.prototype.suggestDisconnect=N.prototype.gg;N.prototype.$b=function(){this.a.$b()};N.prototype.forceDisconnect=N.prototype.$b;
function mf(b){b.a.init();b.i=new bc;Se.forEach(function(b){K(this.i,this.c,b,this.pg.bind(this))}.bind(b));We.forEach(function(b){K(this.i,this.b,b,this.Bf.bind(this))}.bind(b));b.h={};for(var c in b.c)Object.defineProperty(b.h,c,{ configurable:!1,enumerable:!0,get:b.og.bind(b,c),set:b.qg.bind(b,c) });b.j={};for(var d in b.b)Object.defineProperty(b.j,d,{ configurable:!1,enumerable:!0,get:b.Vd.bind(b,d) });b.f=new Ib;b.f.Tb=b.h;b.g=new Ib;b.g.Tb=b.j}p=N.prototype;
p.Bd=function(){var b={ video:{},player:{},playerAfterLoad:{},manifest:this.b.ac(),startTime:null };this.c.pause();Ue.forEach(function(c){b.video[c]=this.c[c]}.bind(this));this.c.ended||(b.startTime=this.c.currentTime);Ze.forEach(function(c){var d=c[1];c=this.b[c[0]]();b.player[d]=c}.bind(this));$e.forEach(function(c){var d=c[1];c=this.b[c[0]]();b.playerAfterLoad[d]=c}.bind(this));return b};p.Wf=function(){this.dispatchEvent(new I('caststatuschanged'))};
p.Xf=function(){this.f.dispatchEvent(new I(this.h.paused?'pause':'play'))};
p.Zf=function(){var b=this;Ze.forEach(function(b){var c=b[1];b=this.a.get('player',b[0])();this.b[c](b)}.bind(this));var c=this.a.get('player','getAssetUri')(),d=this.a.get('video','ended'),e=Promise.resolve(),f=this.c.autoplay,g=null;d||(g=this.a.get('video','currentTime'));c&&(this.c.autoplay=!1,e=this.b.load(c,g));var h={};Ue.forEach(function(b){h[b]=this.a.get('video',b)}.bind(this));e.then(function(){b.c&&(Ue.forEach(function(b){this.c[b]=h[b]}.bind(b)),$e.forEach(function(b){var c=b[1];b=this.a.get('player',
b[0])();this.b[c](b)}.bind(b)),b.c.autoplay=f,c&&b.c.play())},function(c){b.b.dispatchEvent(new I('error',{ detail:c }))})};p.og=function(b){if('addEventListener'==b)return this.f.addEventListener.bind(this.f);if('removeEventListener'==b)return this.f.removeEventListener.bind(this.f);if(this.a.da()&&0==Object.keys(this.a.a.video).length){var c=this.c[b];if('function'!=typeof c)return c}return this.a.da()?this.a.get('video',b):(b=this.c[b],'function'==typeof b&&(b=b.bind(this.c)),b)};
p.qg=function(b,c){this.a.da()?this.a.set('video',b,c):this.c[b]=c};p.pg=function(b){this.a.da()||this.f.dispatchEvent(new I(b.type,b))};
p.Vd=function(b){if('addEventListener'==b)return this.g.addEventListener.bind(this.g);if('removeEventListener'==b)return this.g.removeEventListener.bind(this.g);if('getMediaElement'==b)return function(){return this.h}.bind(this);if('getSharedConfiguration'==b)return this.a.get('player','getConfiguration');if('getNetworkingEngine'==b)return this.b.Cb.bind(this.b);if(this.a.da()){if('getManifest'==b||'drmInfo'==b)return function(){$a(b+'() does not work while casting!');return null};if('getManifestUri'==
b)return Oe('getManifestUri','Please use "getAssetUri" instead.'),this.Vd('getAssetUri');if('attach'==b||'detach'==b)return function(){$a(b+'() does not work while casting!');return Promise.resolve()}}return this.a.da()&&0==Object.keys(this.a.a.video).length&&Xe[b]||!this.a.da()?this.b[b].bind(this.b):this.a.get('player',b)};p.Bf=function(b){this.a.da()||this.g.dispatchEvent(b)};p.Yf=function(b,c){this.a.da()&&('video'==b?this.f.dispatchEvent(c):'player'==b&&this.g.dispatchEvent(c))};function nf(b,c,d,e){var f=this;Ib.call(this);this.a=b;this.b=c;this.c=new bc;this.w={ video:b,player:c };this.C=d||function(){};this.F=e||function(b){return b};this.o=!1;this.h=!0;this.g=0;this.m=!1;this.j=!0;this.i=this.f=null;this.u=new A(function(){of(f)});pf(this)}Ra(nf,Ib);z('shaka.cast.CastReceiver',nf);nf.prototype.isConnected=function(){return this.o};nf.prototype.isConnected=nf.prototype.isConnected;nf.prototype.df=function(){return this.h};nf.prototype.isIdle=nf.prototype.df;
nf.prototype.destroy=function(){var b=this;return t(function d(){var e,f;return y(d,function(d){switch(d.l){case 1:return b.c&&(b.c.a(),b.c=null),e=[],b.b&&(e.push(b.b.destroy()),b.b=null),b.u&&(b.u.stop(),b.u=null),b.a=null,b.w=null,b.C=null,b.o=!1,b.h=!0,b.f=null,b.i=null,u(d,Promise.all(e),2);case 2:f=cast.receiver.CastReceiverManager.getInstance(),f.stop(),v(d)}})})};nf.prototype.destroy=nf.prototype.destroy;
function pf(b){var c=cast.receiver.CastReceiverManager.getInstance();c.onSenderConnected=b.Rd.bind(b);c.onSenderDisconnected=b.Rd.bind(b);c.onSystemVolumeChanged=b.Ce.bind(b);b.i=c.getCastMessageBus('urn:x-cast:com.google.cast.media');b.i.onMessage=b.gf.bind(b);b.f=c.getCastMessageBus('urn:x-cast:com.google.shaka.v2');b.f.onMessage=b.tf.bind(b);c.start();Se.forEach(function(b){K(this.c,this.a,b,this.Xd.bind(this,'video'))}.bind(b));We.forEach(function(b){K(this.c,this.b,b,this.Xd.bind(this,'player'))}.bind(b));
cast.__platform__&&cast.__platform__.canDisplayType('video/mp4; codecs="avc1.640028"; width=3840; height=2160')?b.b.hd(3840,2160):b.b.hd(1920,1080);K(b.c,b.a,'loadeddata',function(){this.m=!0}.bind(b));K(b.c,b.b,'loading',function(){this.h=!1;qf(this)}.bind(b));K(b.c,b.a,'playing',function(){this.h=!1;qf(this)}.bind(b));K(b.c,b.a,'pause',function(){qf(this)}.bind(b));K(b.c,b.b,'unloading',function(){this.h=!0;qf(this)}.bind(b));K(b.c,b.a,'ended',function(){var b=this;(new A(function(){b.a&&b.a.ended&&
(b.h=!0,qf(b))})).P(5)}.bind(b))}p=nf.prototype;p.Rd=function(){this.g=0;this.j=!0;this.o=0!=cast.receiver.CastReceiverManager.getInstance().getSenders().length;qf(this)};function qf(b){Promise.resolve().then(function(){this.b&&(this.dispatchEvent(new I('caststatuschanged')),rf(this)||sf(this,0))}.bind(b))}
function tf(b,c,d){for(var e in c.player)b.b[e](c.player[e]);b.C(d);d=Promise.resolve();var f=b.a.autoplay;c.manifest&&(b.a.autoplay=!1,d=b.b.load(c.manifest,c.startTime));d.then(function(){if(b.b){for(var d in c.video)b.a[d]=c.video[d];for(var e in c.playerAfterLoad)b.b[e](c.playerAfterLoad[e]);b.a.autoplay=f;c.manifest&&(b.a.play(),sf(b,0))}},function(c){b.b.dispatchEvent(new I('error',{ detail:c }))})}p.Xd=function(b,c){this.b&&(of(this),uf(this,{ type:'event',targetName:b,event:c },this.f))};
function of(b){b.u.P(.5);var c={ video:{},player:{} };Te.forEach(function(b){c.video[b]=this.a[b]}.bind(b));if(b.b.U())for(var d in Ye)0==b.g%Ye[d]&&(c.player[d]=b.b[d]());for(var e in Xe)0==b.g%Xe[e]&&(c.player[e]=b.b[e]());if(d=cast.receiver.CastReceiverManager.getInstance().getSystemVolume())c.video.volume=d.level,c.video.muted=d.muted;b.m&&(b.g+=1);uf(b,{ type:'update',update:c },b.f);rf(b)}function rf(b){return b.j&&(b.a.duration||b.b.U())?(vf(b),b.j=!1,!0):!1}
function vf(b){var c={ contentId:b.b.ac(),streamType:b.b.U()?'LIVE':'BUFFERED',duration:b.a.duration,contentType:'' };sf(b,0,c)}p.Ce=function(){var b=cast.receiver.CastReceiverManager.getInstance().getSystemVolume();b&&uf(this,{ type:'update',update:{ video:{ volume:b.level,muted:b.muted } } },this.f);uf(this,{ type:'event',targetName:'video',event:{ type:'volumechange' } },this.f)};
p.tf=function(b){var c=df(b.data);switch(c.type){case 'init':this.g=0;this.m=!1;this.j=!0;tf(this,c.initState,c.appData);of(this);break;case 'appData':this.C(c.appData);break;case 'set':var d=c.targetName,e=c.property;c=c.value;if('video'==d){var f=cast.receiver.CastReceiverManager.getInstance();if('volume'==e){f.setSystemVolumeLevel(c);break}else if('muted'==e){f.setSystemVolumeMuted(c);break}}this.w[d][e]=c;break;case 'call':d=this.w[c.targetName];d[c.methodName].apply(d,c.args);break;case 'asyncCall':d=
c.targetName;e=c.methodName;'player'==d&&'load'==e&&(this.g=0,this.m=!1);f=c.id;b=b.senderId;var g=this.w[d];c=g[e].apply(g,c.args);'player'==d&&'load'==e&&(c=c.then(function(){this.j=!0}.bind(this)));c.then(this.ce.bind(this,b,f,null),this.ce.bind(this,b,f))}};
p.gf=function(b){var c=df(b.data);switch(c.type){case 'PLAY':this.a.play();sf(this,0);break;case 'PAUSE':this.a.pause();sf(this,0);break;case 'SEEK':b=c.currentTime;var d=c.resumeState;null!=b&&(this.a.currentTime=Number(b));d&&'PLAYBACK_START'==d?(this.a.play(),sf(this,0)):d&&'PLAYBACK_PAUSE'==d&&(this.a.pause(),sf(this,0));break;case 'STOP':this.b.qd().then(function(){this.b&&sf(this,0)}.bind(this));break;case 'GET_STATUS':sf(this,Number(c.requestId));break;case 'VOLUME':d=c.volume;b=d.level;d=
d.muted;var e=this.a.volume,f=this.a.muted;null!=b&&(this.a.volume=Number(b));null!=d&&(this.a.muted=d);e==this.a.volume&&f==this.a.muted||sf(this,0);break;case 'LOAD':this.g=0;this.j=this.m=!1;b=c.currentTime;d=this.F(c.media.contentId);this.a.autoplay=!0;this.b.load(d,b).then(function(){this.b&&vf(this)}.bind(this))['catch'](function(b){var d='LOAD_FAILED';7==b.category&&7E3==b.code&&(d='LOAD_CANCELLED');uf(this,{ requestId:Number(c.requestId),type:d },this.i)}.bind(this));break;default:uf(this,{ requestId:Number(c.requestId),
type:'INVALID_REQUEST',reason:'INVALID_COMMAND' },this.i)}};p.ce=function(b,c,d){this.b&&uf(this,{ type:'asyncComplete',id:c,error:d },this.f,b)};function uf(b,c,d,e){b.o&&(b=cf(c),e?d.getCastChannel(e).send(b):d.broadcast(b))}
function sf(b,c,d){var e=b.a.playbackRate;var f=wf;f=b.h?f.IDLE:b.b.Lc()?f.le:b.a.paused?f.ne:f.oe;e={ mediaSessionId:0,playbackRate:e,playerState:f,currentTime:b.a.currentTime,supportedMediaCommands:15,volume:{ level:b.a.volume,muted:b.a.muted } };d&&(e.media=d);uf(b,{ requestId:c,type:'MEDIA_STATUS',status:[e] },b.i)}var wf={ IDLE:'IDLE',oe:'PLAYING',le:'BUFFERING',ne:'PAUSED' };var O={ Zb:function(b,c){var d=O.R(b,c);return 1!=d.length?null:d[0]},yd:function(b,c,d){b=O.zd(b,c,d);return 1!=b.length?null:b[0]},R:function(b,c){return Array.prototype.filter.call(b.childNodes,function(b){return b instanceof Element&&b.tagName==c})},zd:function(b,c,d){return Array.prototype.filter.call(b.childNodes,function(b){return b instanceof Element&&b.localName==d&&b.namespaceURI==c})},getAttributeNS:function(b,c,d){return b.hasAttributeNS(c,d)?b.getAttributeNS(c,d):null},bc:function(b){return Array.prototype.every.call(b.childNodes,
function(b){return b.nodeType==Node.TEXT_NODE||b.nodeType==Node.CDATA_SECTION_NODE})?b.textContent.trim():null},H:function(b,c,d,e){e=void 0===e?null:e;var f=null;b=b.getAttribute(c);null!=b&&(f=d(b));return null==f?e:f},xf:function(b){if(!b)return null;/^\d+-\d+-\d+T\d+:\d+:\d+(\.\d+)?$/.test(b)&&(b+='Z');b=Date.parse(b);return isNaN(b)?null:Math.floor(b/1E3)},Ba:function(b){if(!b)return null;b=/^P(?:([0-9]*)Y)?(?:([0-9]*)M)?(?:([0-9]*)D)?(?:T(?:([0-9]*)H)?(?:([0-9]*)M)?(?:([0-9.]*)S)?)?$/.exec(b);
if(!b)return null;b=31536E3*Number(b[1]||null)+2592E3*Number(b[2]||null)+86400*Number(b[3]||null)+3600*Number(b[4]||null)+60*Number(b[5]||null)+Number(b[6]||null);return isFinite(b)?b:null},lc:function(b){var c=/([0-9]+)-([0-9]+)/.exec(b);if(!c)return null;b=Number(c[1]);if(!isFinite(b))return null;c=Number(c[2]);return isFinite(c)?{ start:b,end:c }:null},parseInt:function(b){b=Number(b);return 0===b%1?b:null},kc:function(b){b=Number(b);return 0===b%1&&0<b?b:null},sb:function(b){b=Number(b);return 0===
b%1&&0<=b?b:null},parseFloat:function(b){b=Number(b);return isNaN(b)?null:b},Be:function(b){var c;b=(c=b.match(/^(\d+)\/(\d+)$/))?Number(c[1])/Number(c[2]):Number(b);return isNaN(b)?null:b},Ud:function(b,c){var d=new DOMParser;try{var e=d.parseFromString(b,'text/xml')}catch(g){}if(e&&e.documentElement.tagName==c)var f=e.documentElement;return f&&0<f.getElementsByTagName('parsererror').length?null:f},Td:function(b,c){try{var d=xc(b);return O.Ud(d,c)}catch(e){}} };var xf=(new Map).set('urn:uuid:1077efec-c0b2-4d02-ace3-3c1e52e2fb4b','org.w3.clearkey').set('urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed','com.widevine.alpha').set('urn:uuid:9a04f079-9840-4286-ab92-e65be0885f95','com.microsoft.playready').set('urn:uuid:f239e769-efa3-4850-9c16-a903c6932efb','com.adobe.primetime');
function yf(b,c,d){var e=zf(b),f=null;b=[];var g=[],h=new Set(e.map(function(b){return b.keyId}));h['delete'](null);if(1<h.size)throw new C(2,4,4010);d||(g=e.filter(function(b){return'urn:mpeg:dash:mp4protection:2011'==b.be?(f=b.init||f,!1):!0}),g.length&&(b=Af(f,c,g),0==b.length&&(b=[Ad('',f)])));if(e.length&&(d||!g.length))for(b=[],c=r(xf.values()),d=c.next();!d.done;d=c.next())d=d.value,'org.w3.clearkey'!=d&&b.push(Ad(d,f));if(h=Array.from(h)[0]||null)for(c=r(b),d=c.next();!d.done;d=c.next())for(d=
r(d.value.initData),e=d.next();!e.done;e=d.next())e.value.keyId=h;return{ vd:h,wg:f,drmInfos:b,Ad:!0 }}function Bf(b,c,d,e){var f=yf(b,c,e);if(d.Ad){b=1==d.drmInfos.length&&!d.drmInfos[0].keySystem;c=0==f.drmInfos.length;if(0==d.drmInfos.length||b&&!c)d.drmInfos=f.drmInfos;d.Ad=!1}else if(0<f.drmInfos.length&&(d.drmInfos=d.drmInfos.filter(function(b){return f.drmInfos.some(function(c){return c.keySystem==b.keySystem})}),0==d.drmInfos.length))throw new C(2,4,4008);return f.vd||d.vd}
function Cf(b){var c=0,d=(new DataView(b)).getUint32(c,!0);if(d!==b.byteLength)return[];c+=6;d=[];for(var e=new DataView(b);c<b.byteLength-1;){var f=e.getUint16(c,!0);c+=2;var g=e.getUint16(c,!0);c+=2;var h=new Uint8Array(b,c,g);d.push({ type:f,value:h });c+=g}return d}function Df(b){return(b=b.querySelector('DATA > LA_URL'))?b.textContent:''}
function Af(b,c,d){var e=[];d=r(d);for(var f=d.next();!f.done;f=d.next()){f=f.value;var g=xf.get(f.be);if(g){var h=Ad(g,f.init||b);if(g=Ef.get(g))h.licenseServerUri=g(f);e.push(h)}else for(f=c(f.node)||[],f=r(f),h=f.next();!h.done;h=f.next())e.push(h.value)}return e}
var Ef=(new Map).set('com.widevine.alpha',function(b){return(b=O.yd(b.node,'urn:microsoft','laurl'))?b.getAttribute('licenseUrl')||'':''}).set('com.microsoft.playready',function(b){b=O.yd(b.node,'urn:microsoft:playready','pro');if(!b)return'';b=Ec(b.textContent);b=Cf(b.buffer).filter(function(b){return 1===b.type})[0];if(!b)return'';b=zc(b.value,!0);return(b=O.Ud(b,'WRMHEADER'))?Df(b):''});function zf(b){var c=[];b=r(b);for(var d=b.next();!d.done;d=b.next())(d=Ff(d.value))&&c.push(d);return c}
function Ff(b){var c=b.getAttribute('schemeIdUri'),d=O.getAttributeNS(b,'urn:mpeg:cenc:2013','default_KID'),e=O.zd(b,'urn:mpeg:cenc:2013','pssh').map(O.bc);if(!c)return null;c=c.toLowerCase();if(d&&(d=d.replace(/-/g,'').toLowerCase(),d.includes(' ')))throw new C(2,4,4009);var f=[];try{f=e.map(function(b){return{ initDataType:'cenc',initData:Ec(b),keyId:null }})}catch(g){throw new C(2,4,4007);}return{ node:b,be:c,keyId:d,init:0<f.length?f:null }};function Gf(b,c,d,e,f){var g={ RepresentationID:c,Number:d,Bandwidth:e,Time:f };return b.replace(/\$(RepresentationID|Number|Bandwidth|Time)?(?:%0([0-9]+)([diouxX]))?\$/g,function(b,c,d,e){if('$$'==b)return'$';var f=g[c];if(null==f)return b;'RepresentationID'==c&&d&&(d=void 0);'Time'==c&&(f=Math.round(f));switch(e){case void 0:case 'd':case 'i':case 'u':b=f.toString();break;case 'o':b=f.toString(8);break;case 'x':b=f.toString(16);break;case 'X':b=f.toString(16).toUpperCase();break;default:b=f.toString()}d=
window.parseInt(d,10)||1;return Array(Math.max(0,d-b.length)+1).join('0')+b})}
function Hf(b,c,d,e){b=O.R(b,'S');for(var f=[],g=0,h=0;h<b.length;++h){var k=b[h],l=O.H(k,'t',O.sb),m=O.H(k,'d',O.sb);k=O.H(k,'r',O.parseInt);null!=l&&(l-=d);if(!m)break;l=null!=l?l:g;k=k||0;if(0>k)if(h+1<b.length){k=O.H(b[h+1],'t',O.sb);if(null==k)break;else if(l>=k)break;k=Math.ceil((k-l)/m)-1}else{if(Infinity==e)break;else if(l/c>=e)break;k=Math.ceil((e*c-l)/m)-1}0<f.length&&l!=g&&(f[f.length-1].end=l/c);for(var n=0;n<=k;++n)g=l+m,f.push({ start:l/c,end:g/c,lg:l }),l=g}return f}
function If(b,c){var d=Jf(b,c,'timescale'),e=1;d&&(e=O.kc(d)||1);d=Jf(b,c,'duration');(d=O.kc(d||''))&&(d/=e);var f=Jf(b,c,'startNumber'),g=Number(Jf(b,c,'presentationTimeOffset'))||0,h=O.sb(f||'');if(null==f||null==h)h=1;f=Kf(b,c,'SegmentTimeline');var k=null;f&&(k=b.O.duration&&b.wasDynamic&&!b.Qa?Hf(f,e,0,Infinity):Hf(f,e,g,b.O.duration||Infinity));return{ timescale:e,Z:d,$a:h,ia:g/e||0,rd:g,L:k }}
function Jf(b,c,d){return[c(b.B),c(b.ba),c(b.ga)].filter(wd.Fa).map(function(b){return b.getAttribute(d)}).reduce(function(b,c){return b||c})}function Kf(b,c,d){return[c(b.B),c(b.ba),c(b.ga)].filter(wd.Fa).map(function(b){return O.Zb(b,d)}).reduce(function(b,c){return b||c})}
function Lf(b,c,d,e,f,g){for(var h=O.getAttributeNS(b,'http://www.w3.org/1999/xlink','href'),k=O.getAttributeNS(b,'http://www.w3.org/1999/xlink','actuate')||'onRequest',l=0;l<b.attributes.length;l++){var m=b.attributes[l];'http://www.w3.org/1999/xlink'==m.namespaceURI&&(b.removeAttributeNS(m.namespaceURI,m.localName),--l)}if(5<=g)return zb(new C(2,4,4028));if('onLoad'!=k)return zb(new C(2,4,4027));var n=xd([e],[h]);return f.request(0,Tb(n,c)).T(function(e){e=O.Td(e.data,b.tagName);if(!e)return zb(new C(2,
4,4001,h));for(;b.childNodes.length;)b.removeChild(b.childNodes[0]);for(;e.childNodes.length;){var k=e.childNodes[0];e.removeChild(k);b.appendChild(k)}for(k=0;k<e.attributes.length;k++){var l=e.attributes[k].nodeName,m=e.getAttribute(l);b.setAttribute(l,m)}return Mf(b,c,d,n[0],f,g+1)})}
function Mf(b,c,d,e,f,g){g=void 0===g?0:g;if(O.getAttributeNS(b,'http://www.w3.org/1999/xlink','href')){var h=Lf(b,c,d,e,f,g);d&&(h=h.T(void 0,function(){return Mf(b,c,d,e,f,g)}));return h}h=[];for(var k=0;k<b.childNodes.length;k++){var l=b.childNodes[k];l instanceof Element&&('urn:mpeg:dash:resolve-to-zero:2013'==O.getAttributeNS(l,'http://www.w3.org/1999/xlink','href')?(b.removeChild(l),--k):'SegmentTimeline'!=l.tagName&&h.push(Mf(l,c,d,e,f,g)))}return Db(h).T(function(){return b})};function Nf(b,c,d){this.c=b;this.b=c;this.a=d}z('shaka.media.InitSegmentReference',Nf);Nf.prototype.xc=function(){return this.c()};Nf.prototype.createUris=Nf.prototype.xc;Nf.prototype.Hc=function(){return this.b};Nf.prototype.getStartByte=Nf.prototype.Hc;Nf.prototype.Gc=function(){return this.a};Nf.prototype.getEndByte=Nf.prototype.Gc;function P(b,c,d,e,f,g){this.position=b;this.startTime=c;this.endTime=d;this.c=e;this.b=f;this.a=g}z('shaka.media.SegmentReference',P);P.prototype.aa=function(){return this.position};
P.prototype.getPosition=P.prototype.aa;P.prototype.Ic=function(){return this.startTime};P.prototype.getStartTime=P.prototype.Ic;P.prototype.He=function(){return this.endTime};P.prototype.getEndTime=P.prototype.He;P.prototype.xc=function(){return this.c()};P.prototype.createUris=P.prototype.xc;P.prototype.Hc=function(){return this.b};P.prototype.getStartByte=P.prototype.Hc;P.prototype.Gc=function(){return this.a};P.prototype.getEndByte=P.prototype.Gc;function Q(b,c){this.I=b;this.b=c==Of;this.a=0}z('shaka.util.DataViewReader',Q);var Of=1;Q.Endianness={ sg:0,tg:Of };Q.prototype.pa=function(){return this.a<this.I.byteLength};Q.prototype.hasMoreData=Q.prototype.pa;Q.prototype.aa=function(){return this.a};Q.prototype.getPosition=Q.prototype.aa;Q.prototype.Je=function(){return this.I.byteLength};Q.prototype.getLength=Q.prototype.Je;Q.prototype.ha=function(){try{var b=this.I.getUint8(this.a);this.a+=1;return b}catch(c){Pf()}};Q.prototype.readUint8=Q.prototype.ha;
Q.prototype.Kb=function(){try{var b=this.I.getUint16(this.a,this.b);this.a+=2;return b}catch(c){Pf()}};Q.prototype.readUint16=Q.prototype.Kb;Q.prototype.D=function(){try{var b=this.I.getUint32(this.a,this.b);this.a+=4;return b}catch(c){Pf()}};Q.prototype.readUint32=Q.prototype.D;Q.prototype.Yd=function(){try{var b=this.I.getInt32(this.a,this.b);this.a+=4;return b}catch(c){Pf()}};Q.prototype.readInt32=Q.prototype.Yd;
Q.prototype.vb=function(){try{if(this.b){var b=this.I.getUint32(this.a,!0);var c=this.I.getUint32(this.a+4,!0)}else c=this.I.getUint32(this.a,!1),b=this.I.getUint32(this.a+4,!1)}catch(d){Pf()}if(2097151<c)throw new C(2,3,3001);this.a+=8;return c*Math.pow(2,32)+b};Q.prototype.readUint64=Q.prototype.vb;Q.prototype.Za=function(b){this.a+b>this.I.byteLength&&Pf();var c=new Uint8Array(this.I.buffer,this.I.byteOffset+this.a,b);this.a+=b;return new Uint8Array(c)};Q.prototype.readBytes=Q.prototype.Za;
Q.prototype.J=function(b){this.a+b>this.I.byteLength&&Pf();this.a+=b};Q.prototype.skip=Q.prototype.J;Q.prototype.ae=function(b){this.a<b&&Pf();this.a-=b};Q.prototype.rewind=Q.prototype.ae;Q.prototype.seek=function(b){(0>b||b>this.I.byteLength)&&Pf();this.a=b};Q.prototype.seek=Q.prototype.seek;Q.prototype.$c=function(){for(var b=this.a;this.pa()&&0!=this.I.getUint8(this.a);)this.a+=1;b=new Uint8Array(this.I.buffer,this.I.byteOffset+b,this.a-b);this.a+=1;return xc(b)};
Q.prototype.readTerminatedString=Q.prototype.$c;function Pf(){throw new C(2,3,3E3);};function R(){this.c=[];this.b=[];this.a=!1}z('shaka.util.Mp4Parser',R);R.prototype.G=function(b,c){var d=Qf(b);this.c[d]=0;this.b[d]=c;return this};R.prototype.box=R.prototype.G;R.prototype.ca=function(b,c){var d=Qf(b);this.c[d]=1;this.b[d]=c;return this};R.prototype.fullBox=R.prototype.ca;R.prototype.stop=function(){this.a=!0};R.prototype.stop=R.prototype.stop;
R.prototype.parse=function(b,c){var d=new Uint8Array(b);d=new Q(new DataView(d.buffer,d.byteOffset,d.byteLength),0);for(this.a=!1;d.pa()&&!this.a;)this.jc(0,d,c)};R.prototype.parse=R.prototype.parse;
R.prototype.jc=function(b,c,d){var e=c.aa(),f=c.D(),g=c.D();switch(f){case 0:f=c.I.byteLength-e;break;case 1:f=c.vb()}var h=this.b[g];if(h){var k=null,l=null;1==this.c[g]&&(l=c.D(),k=l>>>24,l&=16777215);g=e+f;d&&g>c.I.byteLength&&(g=c.I.byteLength);g-=c.aa();c=0<g?c.Za(g):new Uint8Array(0);c=new Q(new DataView(c.buffer,c.byteOffset,c.byteLength),0);h({ parser:this,partialOkay:d||!1,version:k,flags:l,reader:c,size:f,start:e+b })}else c.J(Math.min(e+f-c.aa(),c.I.byteLength-c.aa()))};
R.prototype.parseNext=R.prototype.jc;function Rf(b){for(;b.reader.pa()&&!b.parser.a;)b.parser.jc(b.start,b.reader,b.partialOkay)}R.children=Rf;function Sf(b){for(var c=b.reader.D();0<c&&!b.parser.a;--c)b.parser.jc(b.start,b.reader,b.partialOkay)}R.sampleDescription=Sf;function Tf(b){return function(c){b(c.reader.Za(c.reader.I.byteLength-c.reader.aa()))}}R.allData=Tf;function Qf(b){for(var c=0,d=0;d<b.length;d++)c=c<<8|b.charCodeAt(d);return c}
function Uf(b){return String.fromCharCode(b>>24&255,b>>16&255,b>>8&255,b&255)}R.typeToString=Uf;function Vf(b,c,d,e){var f,g=(new R).ca('sidx',function(b){f=Wf(c,e,d,b)});b&&g.parse(b);if(f)return f;throw new C(2,3,3004);}
function Wf(b,c,d,e){var f=[];e.reader.J(4);var g=e.reader.D();if(0==g)throw new C(2,3,3005);if(0==e.version){var h=e.reader.D();var k=e.reader.D()}else h=e.reader.vb(),k=e.reader.vb();e.reader.J(2);var l=e.reader.Kb();b=b+e.size+k;for(k=0;k<l;k++){var m=e.reader.D(),n=(m&2147483648)>>>31;m&=2147483647;var q=e.reader.D();e.reader.J(4);if(1==n)throw new C(2,3,3006);f.push(new P(f.length,h/g-c,(h+q)/g-c,function(){return d},b,b+m-1));h+=q;b+=m}e.parser.stop();return f};function S(b){this.a=b}z('shaka.media.SegmentIndex',S);S.prototype.destroy=function(){this.a=null;return Promise.resolve()};S.prototype.destroy=S.prototype.destroy;S.prototype.find=function(b){for(var c=this.a.length-1;0<=c;--c){var d=this.a[c];if(b>=d.startTime&&b<d.endTime)return d.position}return this.a.length&&b<this.a[0].startTime?this.a[0].position:null};S.prototype.find=S.prototype.find;
S.prototype.get=function(b){if(0==this.a.length)return null;b-=this.a[0].position;return 0>b||b>=this.a.length?null:this.a[b]};S.prototype.get=S.prototype.get;S.prototype.offset=function(b){for(var c=0;c<this.a.length;++c)this.a[c].startTime+=b,this.a[c].endTime+=b};S.prototype.offset=S.prototype.offset;
S.prototype.Rc=function(b){for(var c=[],d=0,e=0;d<this.a.length&&e<b.length;){var f=this.a[d],g=b[e];f.startTime<g.startTime?(c.push(f),d++):(f.startTime>g.startTime?0==d&&c.push(g):(.1<Math.abs(f.endTime-g.endTime)?c.push(new P(f.position,g.startTime,g.endTime,g.c,g.b,g.a)):c.push(f),d++),e++)}for(;d<this.a.length;)c.push(this.a[d++]);if(c.length)for(d=c[c.length-1].position+1;e<b.length;)f=b[e++],f=new P(d++,f.startTime,f.endTime,f.c,f.b,f.a),c.push(f);else c=b;this.a=c};S.prototype.merge=S.prototype.Rc;
S.prototype.Ac=function(b){for(var c=0;c<this.a.length;++c)if(this.a[c].endTime>b){this.a.splice(0,c);return}this.a=[]};S.prototype.evict=S.prototype.Ac;function Xf(b,c){for(;b.a.length;)if(b.a[b.a.length-1].startTime>=c)b.a.pop();else break;for(;b.a.length;)if(0>=b.a[0].endTime)b.a.shift();else break;if(0!=b.a.length){var d=b.a[b.a.length-1];b.a[b.a.length-1]=new P(d.position,d.startTime,c,d.c,d.b,d.a)}};function Yf(b){this.b=b;this.a=new Q(b,0);Zf||(Zf=[new Uint8Array([255]),new Uint8Array([127,255]),new Uint8Array([63,255,255]),new Uint8Array([31,255,255,255]),new Uint8Array([15,255,255,255,255]),new Uint8Array([7,255,255,255,255,255]),new Uint8Array([3,255,255,255,255,255,255]),new Uint8Array([1,255,255,255,255,255,255,255])])}var Zf;Yf.prototype.pa=function(){return this.a.pa()};
function $f(b){var c=ag(b);if(7<c.length)throw new C(2,3,3002);for(var d=0,e=0;e<c.length;e++)d=256*d+c[e];c=d;d=ag(b);a:{for(e=0;e<Zf.length;e++)if(Hc(d,Zf[e])){e=!0;break a}e=!1}if(e)d=b.b.byteLength-b.a.aa();else{if(8==d.length&&d[1]&224)throw new C(2,3,3001);e=d[0]&(1<<8-d.length)-1;for(var f=1;f<d.length;f++)e=256*e+d[f];d=e}d=b.a.aa()+d<=b.b.byteLength?d:b.b.byteLength-b.a.aa();e=new DataView(b.b.buffer,b.b.byteOffset+b.a.aa(),d);b.a.J(d);return new bg(c,e)}
function ag(b){var c=b.a.ha(),d;for(d=1;8>=d&&!(c&1<<8-d);d++);if(8<d)throw new C(2,3,3002);var e=new Uint8Array(d);e[0]=c;for(c=1;c<d;c++)e[c]=b.a.ha();return e}function bg(b,c){this.id=b;this.a=c}function cg(b){if(8<b.a.byteLength)throw new C(2,3,3002);if(8==b.a.byteLength&&b.a.getUint8(0)&224)throw new C(2,3,3001);for(var c=0,d=0;d<b.a.byteLength;d++){var e=b.a.getUint8(d);c=256*c+e}return c};function dg(){}
dg.prototype.parse=function(b,c,d,e){var f;c=new Yf(new DataView(c));if(440786851!=$f(c).id)throw new C(2,3,3008);var g=$f(c);if(408125543!=g.id)throw new C(2,3,3009);c=g.a.byteOffset;g=new Yf(g.a);for(f=null;g.pa();){var h=$f(g);if(357149030==h.id){f=h;break}}if(!f)throw new C(2,3,3010);g=new Yf(f.a);f=1E6;for(h=null;g.pa();){var k=$f(g);if(2807729==k.id)f=cg(k);else if(17545==k.id)if(h=k,4==h.a.byteLength)h=h.a.getFloat32(0);else if(8==h.a.byteLength)h=h.a.getFloat64(0);else throw new C(2,3,3003);
}if(null==h)throw new C(2,3,3011);g=f/1E9;f=h*g;b=$f(new Yf(new DataView(b)));if(475249515!=b.id)throw new C(2,3,3007);return eg(b,c,g,f,d,e)};function eg(b,c,d,e,f,g){function h(){return f}var k=[];b=new Yf(b.a);for(var l=null,m=null;b.pa();){var n=$f(b);if(187==n.id){var q=fg(n);q&&(n=d*q.mg,q=c+q.Gf,null!=l&&k.push(new P(k.length,l-g,n-g,h,m,q-1)),l=n,m=q)}}null!=l&&k.push(new P(k.length,l-g,e-g,h,m,null));return k}
function fg(b){var c=new Yf(b.a);b=$f(c);if(179!=b.id)throw new C(2,3,3013);b=cg(b);c=$f(c);if(183!=c.id)throw new C(2,3,3012);c=new Yf(c.a);for(var d=0;c.pa();){var e=$f(c);if(241==e.id){d=cg(e);break}}return{ mg:b,Gf:d }};function gg(b,c){var d=Kf(b,c,'Initialization');if(!d)return null;var e=b.B.la,f=d.getAttribute('sourceURL');f&&(e=xd(b.B.la,[f]));f=0;var g=null;if(d=O.H(d,'range',O.lc))f=d.start,g=d.end;return new Nf(function(){return e},f,g)}
function hg(b,c){var d=Number(Jf(b,ig,'presentationTimeOffset'))||0,e=Jf(b,ig,'timescale'),f=1;e&&(f=O.kc(e)||1);d=d/f||0;e=gg(b,ig);var g=b.B.contentType;f=b.B.mimeType.split('/')[1];if('text'!=g&&'mp4'!=f&&'webm'!=f)throw new C(2,4,4006);if('webm'==f&&!e)throw new C(2,4,4005);g=Kf(b,ig,'RepresentationIndex');var h=Jf(b,ig,'indexRange'),k=b.B.la;h=O.lc(h||'');if(g){var l=g.getAttribute('sourceURL');l&&(k=xd(b.B.la,[l]));h=O.H(g,'range',O.lc,h)}if(!h)throw new C(2,4,4002);f=jg(b,c,e,k,h.start,h.end,
f,d);return{ createSegmentIndex:f.createSegmentIndex,findSegmentPosition:f.findSegmentPosition,getSegmentReference:f.getSegmentReference,initSegmentReference:e,ia:d }}
function jg(b,c,d,e,f,g,h,k){var l=b.presentationTimeline,m=!b.Qa||!b.O.Nc,n=b.O.start,q=b.O.duration,x=c,w=null;return{ createSegmentIndex:function(){var b=[x(e,f,g),'webm'==h?x(d.c(),d.b,d.a):null];x=null;return Promise.all(b).then(function(b){var c=b[0];b=b[1]||null;c='mp4'==h?Vf(c,f,e,k):(new dg).parse(c,b,e,k);l.pb(c,n);w=new S(c);m&&Xf(w,q)})},findSegmentPosition:function(b){return w.find(b)},getSegmentReference:function(b){return w.get(b)} }}function ig(b){return b.Mb};function kg(b,c){var d=gg(b,lg);var e=mg(b);var f=If(b,lg),g=f.$a;0==g&&(g=1);var h=0;f.Z?h=f.Z*(g-1):f.L&&0<f.L.length&&(h=f.L[0].start);e={ Z:f.Z,startTime:h,$a:g,ia:f.ia,L:f.L,nb:e };if(!e.Z&&!e.L&&1<e.nb.length)throw new C(2,4,4002);if(!e.Z&&!b.O.duration&&!e.L&&1==e.nb.length)throw new C(2,4,4002);if(e.L&&0==e.L.length)throw new C(2,4,4002);g=f=null;b.ga.id&&b.B.id&&(g=b.ga.id+','+b.B.id,f=c[g]);h=ng(b.O.duration,e.$a,b.B.la,e);f?(f.Rc(h),g=b.presentationTimeline.Eb(),f.Ac(g-b.O.start)):(b.presentationTimeline.pb(h,
b.O.start),f=new S(h),g&&b.Qa&&(c[g]=f));b.Qa&&b.O.Nc||Xf(f,b.O.duration);return{ createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:f.find.bind(f),getSegmentReference:f.get.bind(f),initSegmentReference:d,ia:e.ia }}function lg(b){return b.Ia}
function ng(b,c,d,e){var f=e.nb.length;e.L&&e.L.length!=e.nb.length&&(f=Math.min(e.L.length,e.nb.length));for(var g=[],h=e.startTime,k=0;k<f;k++){var l=e.nb[k],m=xd(d,[l.ef]),n=void 0;n=null!=e.Z?h+e.Z:e.L?e.L[k].end:h+b;g.push(new P(k+c,h,n,function(b){return b}.bind(null,m),l.start,l.end));h=n}return g}
function mg(b){return[b.B.Ia,b.ba.Ia,b.ga.Ia].filter(wd.Fa).map(function(b){return O.R(b,'SegmentURL')}).reduce(function(b,d){return 0<b.length?b:d}).map(function(c){c.getAttribute('indexRange')&&!b.Gd&&(b.Gd=!0);var d=c.getAttribute('media');c=O.H(c,'mediaRange',O.lc,{ start:0,end:null });return{ ef:d,start:c.start,end:c.end }})};function og(b,c,d,e){var f=pg(b);var g=If(b,qg);var h=Jf(b,qg,'media'),k=Jf(b,qg,'index');g={ Z:g.Z,timescale:g.timescale,$a:g.$a,ia:g.ia,rd:g.rd,L:g.L,Qc:h,Gb:k };h=g.Gb?1:0;h+=g.L?1:0;h+=g.Z?1:0;if(0==h)throw new C(2,4,4002);1!=h&&(g.Gb&&(g.L=null),g.Z=null);if(!g.Gb&&!g.Qc)throw new C(2,4,4002);if(g.Gb){d=b.B.mimeType.split('/')[1];if('mp4'!=d&&'webm'!=d)throw new C(2,4,4006);if('webm'==d&&!f)throw new C(2,4,4005);e=Gf(g.Gb,b.B.id,null,b.bandwidth||null,null);e=xd(b.B.la,[e]);b=jg(b,c,f,e,0,null,
d,g.ia)}else g.Z?(e||(b.presentationTimeline.Tc(g.Z),b.presentationTimeline.Uc(b.O.start)),b=rg(b,g)):(h=c=null,b.ga.id&&b.B.id&&(h=b.ga.id+','+b.B.id,c=d[h]),k=sg(b,g),e=!(b.Qa||b.wasDynamic)||!b.O.Nc,c?(e&&Xf(new S(k),b.O.duration),c.Rc(k),d=b.presentationTimeline.Eb(),c.Ac(d-b.O.start)):(b.presentationTimeline.pb(k,b.O.start),c=new S(k),h&&b.Qa&&(d[h]=c)),e&&Xf(c,b.O.duration),b={ createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:c.find.bind(c),getSegmentReference:c.get.bind(c) });
return{ createSegmentIndex:b.createSegmentIndex,findSegmentPosition:b.findSegmentPosition,getSegmentReference:b.getSegmentReference,initSegmentReference:f,ia:g.ia }}function qg(b){return b.Ob}
function rg(b,c){var d=b.O.duration,e=c.Z,f=c.$a,g=c.timescale,h=c.Qc,k=b.bandwidth||null,l=b.B.id,m=b.B.la;return{ createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(b){return 0>b||d&&b>=d?null:Math.floor(b/e)},getSegmentReference:function(b){var c=b*e,n=c+e;d&&(n=Math.min(n,d));return 0>n||d&&c>=d?null:new P(b,c,n,function(){var d=Gf(h,l,b+f,k,c*g);return xd(m,[d])},0,null)} }}
function sg(b,c){for(var d=[],e=0;e<c.L.length;e++){var f=e+c.$a;d.push(new P(f,c.L[e].start,c.L[e].end,function(b,c,d,e,f,n){b=Gf(b,c,f,d,n);return xd(e,[b]).map(function(b){return b.toString()})}.bind(null,c.Qc,b.B.id,b.bandwidth||null,b.B.la,f,c.L[e].lg+c.rd),0,null))}return d}function pg(b){var c=Jf(b,qg,'initialization');if(!c)return null;var d=b.B.id,e=b.bandwidth||null,f=b.B.la;return new Nf(function(){var b=Gf(c,d,null,e,null);return xd(f,[b])},0,null)};var T={ tb:{},Jb:{},cd:function(b,c){T.Jb[b]=c} };z('shaka.media.ManifestParser.registerParserByExtension',T.cd);T.Lb=function(b,c){T.tb[b]=c};z('shaka.media.ManifestParser.registerParserByMime',T.Lb);
T.Df=function(){var b={};if(qc()){for(var c in T.tb)b[c]=!0;for(var d in T.Jb)b[d]=!0}c={ mpd:'application/dash+xml',m3u8:'application/x-mpegurl',ism:'application/vnd.ms-sstr+xml' };d=r(['application/dash+xml','application/x-mpegurl','application/vnd.apple.mpegurl','application/vnd.ms-sstr+xml']);for(var e=d.next();!e.done;e=d.next())e=e.value,b[e]=qc()?!!T.tb[e]:rc(e);for(var f in c)b[f]=qc()?!!T.Jb[f]:rc(c[f]);return b};
T.create=function(b,c,d,e){return t(function g(){var h,k;return y(g,function(g){switch(g.l){case 1:return ya(g,2),u(g,T.Ie(b,c,d,e),4);case 4:return h=g.s,g['return'](new h);case 2:throw k=Da(g),k.severity=2,k;}})})};
T.Ie=function(b,c,d,e){return t(function g(){var h,k,l,m,n;return y(g,function(g){switch(g.l){case 1:h=T;if(e&&(k=h.tb[e.toLowerCase()]))return g['return'](k);if(l=h.getExtension(b))if(m=h.Jb[l])return g['return'](m);if(e){g.A(2);break}return u(g,h.Pe(b,c,d),3);case 3:if(e=g.s)if(n=T.tb[e])return g['return'](n);case 2:throw new C(2,4,4E3,b);}})})};
T.Pe=function(b,c,d){return t(function f(){var g,h,k;return y(f,function(f){switch(f.l){case 1:return g=Tb([b],d),g.method='HEAD',u(f,c.request(0,g).promise,2);case 2:return h=f.s,k=h.headers['content-type'],f['return'](k?k.toLowerCase():'')}})})};T.getExtension=function(b){b=(new cb(b)).fa.split('/').pop().split('.');return 1==b.length?'':b.pop().toLowerCase()};T.isSupported=function(b,c){return qc()?c in T.tb||T.getExtension(b)in T.Jb?!0:!1:!1};function U(b,c,d){this.g=b;this.mc=c;this.h=this.c=Infinity;this.b=1;this.f=this.a=null;this.m=0;this.i=!0;this.j=0;this.u=void 0===d?!0:d;this.o=!1}z('shaka.media.PresentationTimeline',U);U.prototype.V=function(){return this.c};U.prototype.getDuration=U.prototype.V;U.prototype.Qe=function(){return this.a};U.prototype.getMinSegmentStartTime=U.prototype.Qe;U.prototype.ua=function(b){this.c=b};U.prototype.setDuration=U.prototype.ua;U.prototype.Ve=function(){return this.g};
U.prototype.getPresentationStartTime=U.prototype.Ve;U.prototype.de=function(b){this.m=b};U.prototype.setClockOffset=U.prototype.de;U.prototype.Pb=function(b){this.i=b};U.prototype.setStatic=U.prototype.Pb;U.prototype.fe=function(b){this.o=b};U.prototype.setWasDynamic=U.prototype.fe;U.prototype.kd=function(b){this.h=b};U.prototype.setSegmentAvailabilityDuration=U.prototype.kd;U.prototype.Tf=function(b){this.mc=b};U.prototype.setDelay=U.prototype.Tf;U.prototype.Ge=function(){return this.mc};
U.prototype.getDelay=U.prototype.Ge;U.prototype.pb=function(b,c){if(0!=b.length){var d=b[b.length-1].endTime+c;this.Uc(b[0].startTime+c);this.b=b.reduce(function(b,c){return Math.max(b,c.endTime-c.startTime)},this.b);this.f=Math.max(this.f,d);null!=this.g&&this.u&&(this.g=(Date.now()+this.m)/1E3-this.f-this.b)}};U.prototype.notifySegments=U.prototype.pb;U.prototype.Uc=function(b){this.a=null==this.a?b:Math.min(this.a,b)};U.prototype.notifyMinSegmentStartTime=U.prototype.Uc;
U.prototype.Tc=function(b){this.b=Math.max(this.b,b)};U.prototype.notifyMaxSegmentDuration=U.prototype.Tc;U.prototype.offset=function(b){null!=this.a&&(this.a+=b);null!=this.f&&(this.f+=b)};U.prototype.offset=U.prototype.offset;U.prototype.U=function(){return Infinity==this.c&&!this.i};U.prototype.isLive=U.prototype.U;U.prototype.Xa=function(){return Infinity!=this.c&&!this.i};U.prototype.isInProgress=U.prototype.Xa;
U.prototype.Eb=function(){if(Infinity==this.h)return this.j;var b=this.lb()-this.h;return Math.max(this.j,b)};U.prototype.getSegmentAvailabilityStart=U.prototype.Eb;U.prototype.ee=function(b){this.j=b};U.prototype.setUserSeekStart=U.prototype.ee;U.prototype.lb=function(){return this.i&&this.o&&null!=this.a?this.c+this.a:this.U()||this.Xa()?Math.min(Math.max(0,(Date.now()+this.m)/1E3-this.b-this.g),this.c):this.c};U.prototype.getSegmentAvailabilityEnd=U.prototype.lb;
U.prototype.Db=function(b){var c=Math.max(this.a,this.j);if(Infinity==this.h)return c;var d=this.lb()-this.h;b=Math.min(d+b,this.ya());return Math.max(c,b)};U.prototype.getSafeSeekRangeStart=U.prototype.Db;U.prototype.Ua=function(){return this.Db(0)};U.prototype.getSeekRangeStart=U.prototype.Ua;U.prototype.ya=function(){var b=this.U()||this.Xa()?this.mc:0;return Math.max(0,this.lb()-b)};U.prototype.getSeekRangeEnd=U.prototype.ya;U.prototype.je=function(){return null==this.g||null!=this.f?!1:!0};
U.prototype.usingPresentationStartTime=U.prototype.je;function tg(b,c,d,e){b=Tb(b,e);if(0!=c||null!=d)b.headers.Range=d?'bytes='+c+'-'+d:'bytes='+c+'-';return b};function ug(){var b=this;this.a=this.b=null;this.f=[];this.c=null;this.j=[];this.h=1;this.m={};this.o=0;this.u=new Sa(5);this.i=new A(function(){vg(b)});this.g=new Ob}z('shaka.dash.DashParser',ug);p=ug.prototype;p.configure=function(b){this.b=b};p.start=function(b,c){var d=this;return t(function f(){var g;return y(f,function(f){switch(f.l){case 1:return d.f=[b],d.a=c,u(f,wg(d),2);case 2:g=f.s;d.a&&xg(d,g);if(!d.a)throw new C(2,7,7001);return f['return'](d.c)}})})};
p.stop=function(){this.b=this.a=null;this.f=[];this.c=null;this.j=[];this.m={};null!=this.i&&(this.i.stop(),this.i=null);return this.g.destroy()};p.update=function(){wg(this)['catch'](function(b){if(this.a)this.a.onError(b)}.bind(this))};p.onExpirationUpdated=function(){};
function wg(b){var c=Date.now(),d=b.a.networkingEngine.request(0,Tb(b.f,b.b.retryParameters));Pb(b.g,d);return d.promise.then(function(c){if(b.a)return c.uri&&!b.f.includes(c.uri)&&b.f.unshift(c.uri),yg(b,c.data,c.uri)}).then(function(){var d=(Date.now()-c)/1E3;Wa(b.u,1,d);return d})}function yg(b,c,d){c=O.Td(c,'MPD');if(!c)throw new C(2,4,4001,d);c=Mf(c,b.b.retryParameters,b.b.dash.xlinkFailGracefully,d,b.a.networkingEngine);Pb(b.g,c);return c.promise.then(function(c){return zg(b,c,d)})}
function zg(b,c,d){return t(function f(){var g,h,k,l,m,n,q,x,w,B,D,E,F,V,Y,wa,Ba,ba,da,xa,ka,Ta,Ca,eb,Ua,fb,gb;return y(f,function(f){switch(f.l){case 1:l=wd;m=O;n=[d];q=m.R(c,'Location').map(m.bc).filter(l.Fa);0<q.length&&(x=xd(n,q),n=b.f=x);w=m.R(c,'BaseURL').map(m.bc);B=xd(n,w);(D=b.b.dash.ignoreMinBufferTime)||(E=m.H(c,'minBufferTime',m.Ba));b.o=m.H(c,'minimumUpdatePeriod',m.Ba,-1);F=m.H(c,'availabilityStartTime',m.xf);V=m.H(c,'timeShiftBufferDepth',m.Ba);Y=m.H(c,'suggestedPresentationDelay',
m.Ba);wa=m.H(c,'maxSegmentDuration',m.Ba);Ba=c.getAttribute('type')||'static';da=!1;b.c?(ba=b.c.presentationTimeline,da=b.c.wasDynamic):(xa=Math.max(b.b.dash.defaultPresentationDelay,1.5*E),ka=null!=Y?Y:xa,ba=new U(F,ka,b.b.dash.autoCorrectDrift));Ta={ Qa:'static'!=Ba,presentationTimeline:ba,ga:null,O:null,ba:null,B:null,bandwidth:0,Gd:!1,wasDynamic:da };for(var hb=Ta,yd=B,wb=O.H(c,'mediaPresentationDuration',O.Ba),Gb=[],Ia=0,wc=O.R(c,'Period'),Va=0;Va<wc.length;Va++){var Hb=wc[Va];Ia=O.H(Hb,'start',
O.Ba,Ia);var zd=O.H(Hb,'duration',O.Ba),xb=null;if(Va!=wc.length-1){var Jh=O.H(wc[Va+1],'start',O.Ba);null!=Jh&&(xb=Jh-Ia)}else null!=wb&&(xb=wb-Ia);null==xb&&(xb=zd);Hb=Ag(b,hb,yd,{ start:Ia,duration:xb,node:Hb,Nc:null==xb||Va==wc.length-1 });Gb.push(Hb);zd=hb.ga.id;b.j.includes(zd)||(b.j.push(zd),b.c&&(b.a.filterNewPeriod(Hb),b.c.periods.push(Hb)));if(null==xb){Ia=null;break}Ia+=xb}null==b.c&&b.a.filterAllPeriods(Gb);null!=wb?(g=Gb,h=wb,k=!1):(g=Gb,h=Ia,k=!0);Ca=h;eb=g;ba.Pb('static'==Ba);'static'!=
Ba&&k||ba.ua(Ca||Infinity);ba.fe(da);(Ua=ba.U())&&!isNaN(b.b.availabilityWindowOverride)&&(V=b.b.availabilityWindowOverride);null==V&&(V=Infinity);ba.kd(V);ba.Tc(wa||1);if(b.c){f.A(0);break}b.c={ presentationTimeline:ba,periods:eb,offlineSessionIds:[],minBufferTime:E||0,wasDynamic:da };if(!ba.je()){f.A(0);break}fb=m.R(c,'UTCTiming');return u(f,Bg(b,B,fb),4);case 4:gb=f.s;if(!b.a)return f['return']();ba.de(gb);v(f)}})})}
function Ag(b,c,d,e){c.ga=Cg(e.node,null,d);c.O=e;c.ga.id||(c.ga.id='__shaka_period_'+e.start);O.R(e.node,'EventStream').forEach(b.zf.bind(b,e.start,e.duration));d=O.R(e.node,'AdaptationSet').map(b.wf.bind(b,c)).filter(wd.Fa);if(c.Qa){c=[];for(var f=r(d),g=f.next();!g.done;g=f.next()){g=r(g.value.Jf);for(var h=g.next();!h.done;h=g.next())c.push(h.value)}if(c.length!=(new Set(c)).size)throw new C(2,4,4018);}var k=d.filter(function(b){return!b.pd});d.filter(function(b){return b.pd}).forEach(function(b){var c=
b.streams[0],d=b.pd;k.forEach(function(b){b.id==d&&b.streams.forEach(function(b){b.trickModeVideo=c})})});c=Dg(k,'video');f=Dg(k,'audio');if(!c.length&&!f.length)throw new C(2,4,4004);f.length||(f=[null]);c.length||(c=[null]);d=[];for(g=0;g<f.length;g++)for(h=0;h<c.length;h++)Eg(b,f[g],c[h],d);b=Dg(k,'text');c=[];for(f=0;f<b.length;f++)c.push.apply(c,b[f].streams);return{ startTime:e.start,textStreams:c,variants:d }}function Dg(b,c){return b.filter(function(b){return b.contentType==c})}
function Eg(b,c,d,e){if(c||d)if(c&&d){var f=c.drmInfos;var g=d.drmInfos;if(f.length&&g.length?0<od(f,g).length:1){g=od(c.drmInfos,d.drmInfos);for(var h=0;h<c.streams.length;h++)for(var k=0;k<d.streams.length;k++)f=(d.streams[k].bandwidth||0)+(c.streams[h].bandwidth||0),f={ id:b.h++,language:c.language,primary:c.Pc||d.Pc,audio:c.streams[h],video:d.streams[k],bandwidth:f,drmInfos:g,allowedByApplication:!0,allowedByKeySystem:!0 },e.push(f)}}else for(g=c||d,h=0;h<g.streams.length;h++)f=g.streams[h].bandwidth||
0,f={ id:b.h++,language:g.language||'und',primary:g.Pc,audio:c?g.streams[h]:null,video:d?g.streams[h]:null,bandwidth:f,drmInfos:g.drmInfos,allowedByApplication:!0,allowedByKeySystem:!0 },e.push(f)}
p.wf=function(b,c){b.ba=Cg(c,b.ga,null);var d=!1,e=O.R(c,'Role'),f=e.map(function(b){return b.getAttribute('value')}).filter(wd.Fa),g=void 0,h='text'==b.ba.contentType;h&&(g='subtitle');for(var k=0;k<e.length;k++){var l=e[k].getAttribute('schemeIdUri');if(null==l||'urn:mpeg:dash:role:2011'==l)switch(l=e[k].getAttribute('value'),l){case 'main':d=!0;break;case 'caption':case 'subtitle':g=l}}var m=null,n=!1;O.R(c,'EssentialProperty').forEach(function(b){'http://dashif.org/guidelines/trickmode'==b.getAttribute('schemeIdUri')?
m=b.getAttribute('value'):n=!0});k=O.R(c,'Accessibility');var q=new Map;e={};k=r(k);for(l=k.next();!l.done;e={ Bb:e.Bb },l=k.next()){l=l.value;var x=l.getAttribute('schemeIdUri');if('urn:scte:dash:cc:cea-608:2015'==x||'urn:scte:dash:cc:cea-708:2015'==x)e.Bb=1,l=l.getAttribute('value'),null!=l?l.split(';').forEach(function(b){return function(c){if(c.includes('=')){c=c.split('=');var d=c[0].startsWith('CC')?c[0]:'CC'+c[0];c=c[1].split(',')[0].split(':').pop()}else d='CC'+b.Bb,b.Bb+=2;q.set(d,L(c))}}(e)):
q.set('CC1','und')}if(n)return null;e=O.R(c,'ContentProtection');var w=yf(e,this.b.dash.customScheme,this.b.dash.ignoreDrmInfo);e=L(c.getAttribute('lang')||'und');l=c.getAttribute('label');k=O.R(c,'Representation');f=k.map(this.Af.bind(this,b,w,g,e,l,d,f,q)).filter(function(b){return!!b});if(0==f.length){if(h)return null;throw new C(2,4,4003);}b.ba.contentType&&'application'!=b.ba.contentType||(b.ba.contentType=Fg(f[0].mimeType,f[0].codecs),f.forEach(function(c){c.type=b.ba.contentType}));f.forEach(function(b){w.drmInfos.forEach(function(c){b.keyId&&
c.keyIds.push(b.keyId)})});h=k.map(function(b){return b.getAttribute('id')}).filter(wd.Fa);return{ id:b.ba.id||'__fake__'+this.h++,contentType:b.ba.contentType,language:e,Pc:d,streams:f,drmInfos:w.drmInfos,pd:m,Jf:h }};
p.Af=function(b,c,d,e,f,g,h,k,l){b.B=Cg(l,b.ba,null);if(!Gg(b.B))return null;b.bandwidth=O.H(l,'bandwidth',O.kc)||0;var m=b.B.contentType;m='text'==m||'application'==m;try{var n=this.Kf.bind(this);if(b.B.Mb)var q=hg(b,n);else if(b.B.Ia)q=kg(b,this.m);else if(b.B.Ob)q=og(b,n,this.m,!!this.c);else{var x=b.B.la,w=b.O.duration||0;q={ createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(b){return 0<=b&&b<w?1:null},getSegmentReference:function(b){return 1!=b?null:new P(1,0,w,function(){return x},
0,null)},initSegmentReference:null,ia:0 }}}catch(B){if(m&&4002==B.code)return null;throw B;}l=O.R(l,'ContentProtection');l=Bf(l,this.b.dash.customScheme,c,this.b.dash.ignoreDrmInfo);return{ id:this.h++,originalId:b.B.id,createSegmentIndex:q.createSegmentIndex,findSegmentPosition:q.findSegmentPosition,getSegmentReference:q.getSegmentReference,initSegmentReference:q.initSegmentReference,presentationTimeOffset:q.ia,mimeType:b.B.mimeType,codecs:b.B.codecs,frameRate:b.B.frameRate,bandwidth:b.bandwidth,width:b.B.width,
height:b.B.height,kind:d,encrypted:0<c.drmInfos.length,keyId:l,language:e,label:f,type:b.ba.contentType,primary:g,trickModeVideo:null,emsgSchemeIdUris:b.B.emsgSchemeIdUris,roles:h,channelsCount:b.B.Vc,closedCaptions:k }};function vg(b){t(function d(){var e,f;return y(d,function(d){switch(d.l){case 1:return e=0,ya(d,2),u(d,wg(b),4);case 4:e=d.s;Aa(d,3);break;case 2:f=Da(d),b.a&&(f.severity=1,b.a.onError(f));case 3:if(!b.a)return d['return']();xg(b,e);v(d)}})})}
function xg(b,c){0>b.o||b.i.P(Math.max(3,b.o-c,Xa(b.u)))}
function Cg(b,c,d){c=c||{ contentType:'',mimeType:'',codecs:'',emsgSchemeIdUris:[],frameRate:void 0,Vc:null };d=d||c.la;var e=O.sb,f=O.Be,g=O.R(b,'BaseURL').map(O.bc),h=b.getAttribute('contentType')||c.contentType,k=b.getAttribute('mimeType')||c.mimeType,l=b.getAttribute('codecs')||c.codecs;f=O.H(b,'frameRate',f)||c.frameRate;var m=O.R(b,'InbandEventStream'),n=c.emsgSchemeIdUris.slice();m=r(m);for(var q=m.next();!q.done;q=m.next())q=q.value.getAttribute('schemeIdUri'),n.includes(q)||n.push(q);m=O.R(b,
'AudioChannelConfiguration');m=Hg(m)||c.Vc;h||(h=Fg(k,l));return{ la:xd(d,g),Mb:O.Zb(b,'SegmentBase')||c.Mb,Ia:O.Zb(b,'SegmentList')||c.Ia,Ob:O.Zb(b,'SegmentTemplate')||c.Ob,width:O.H(b,'width',e)||c.width,height:O.H(b,'height',e)||c.height,contentType:h,mimeType:k,codecs:l,frameRate:f,emsgSchemeIdUris:n,id:b.getAttribute('id'),Vc:m }}
function Hg(b){for(var c=0;c<b.length;++c){var d=b[c],e=d.getAttribute('schemeIdUri');if(e&&(d=d.getAttribute('value')))switch(e){case 'urn:mpeg:dash:outputChannelPositionList:2012':return d.trim().split(/ +/).length;case 'urn:mpeg:dash:23003:3:audio_channel_configuration:2011':case 'urn:dts:dash:audio_channel_configuration:2012':e=parseInt(d,10);if(!e)continue;return e;case 'tag:dolby.com,2014:dash:audio_channel_configuration:2011':case 'urn:dolby:dash:audio_channel_configuration:2011':if(e=parseInt(d,
16)){for(b=0;e;)e&1&&++b,e>>=1;return b}}}return null}function Gg(b){var c=b.Mb?1:0;c+=b.Ia?1:0;c+=b.Ob?1:0;if(0==c)return'text'==b.contentType||'application'==b.contentType?!0:!1;1!=c&&(b.Mb&&(b.Ia=null),b.Ob=null);return!0}
function Ig(b,c,d,e){c=xd(c,[d]);c=Tb(c,b.b.retryParameters);c.method=e;c=b.a.networkingEngine.request(4,c);Pb(b.g,c);return c.promise.then(function(b){if('HEAD'==e){if(!b.headers||!b.headers.date)return 0;b=b.headers.date}else b=xc(b.data);b=Date.parse(b);return isNaN(b)?0:b-Date.now()})}
function Bg(b,c,d){d=d.map(function(b){return{ scheme:b.getAttribute('schemeIdUri'),value:b.getAttribute('value') }});var e=b.b.dash.clockSyncUri;!d.length&&e&&d.push({ scheme:'urn:mpeg:dash:utc:http-head:2014',value:e });return wd.ze(d,function(b){var d=b.scheme;b=b.value;switch(d){case 'urn:mpeg:dash:utc:http-head:2014':case 'urn:mpeg:dash:utc:http-head:2012':return Ig(this,c,b,'HEAD');case 'urn:mpeg:dash:utc:http-xsdate:2014':case 'urn:mpeg:dash:utc:http-iso:2014':case 'urn:mpeg:dash:utc:http-xsdate:2012':case 'urn:mpeg:dash:utc:http-iso:2012':return Ig(this,
c,b,'GET');case 'urn:mpeg:dash:utc:direct:2014':case 'urn:mpeg:dash:utc:direct:2012':return d=Date.parse(b),isNaN(d)?0:d-Date.now();case 'urn:mpeg:dash:utc:http-ntp:2014':case 'urn:mpeg:dash:utc:ntp:2014':case 'urn:mpeg:dash:utc:sntp:2014':return $a('NTP UTCTiming scheme is not supported'),Promise.reject();default:return $a('Unrecognized scheme in UTCTiming element',d),Promise.reject()}}.bind(b))['catch'](function(){$a('A UTCTiming element should always be given in live manifests! This content may not play on clients with bad clocks!');
return 0})}p.zf=function(b,c,d){var e=O.sb,f=d.getAttribute('schemeIdUri')||'',g=d.getAttribute('value')||'',h=O.H(d,'timescale',e)||1;O.R(d,'Event').forEach(function(d){var k=O.H(d,'presentationTime',e)||0,m=O.H(d,'duration',e)||0;k=k/h+b;m=k+m/h;null!=c&&(k=Math.min(k,b+c),m=Math.min(m,b+c));d={ schemeIdUri:f,value:g,startTime:k,endTime:m,id:d.getAttribute('id')||'',eventElement:d };this.a.onTimelineRegionAdded(d)}.bind(this))};
p.Kf=function(b,c,d){b=tg(b,c,d,this.b.retryParameters);b=this.a.networkingEngine.request(1,b);Pb(this.g,b);return b.promise.then(function(b){return b.data})};function Fg(b,c){return $d(mc(b,c))?'text':b.split('/')[0]}T.cd('mpd',ug);T.Lb('application/dash+xml',ug);function Jg(b,c,d,e){this.b=b;this.type=c;this.a=d;this.segments=e||null}function Kg(b,c,d,e){this.id=b;this.name=c;this.a=d;this.value=void 0===e?null:e}Kg.prototype.toString=function(){function b(b){return b.name+'='+(isNaN(Number(b.value))?'"'+b.value+'"':b.value)}var c='#'+this.name,d=this.a?this.a.map(b):[];this.value&&d.unshift(this.value);0<d.length&&(c+=':'+d.join(','));return c};function Lg(b,c){this.name=b;this.value=c}
Kg.prototype.getAttribute=function(b){var c=this.a.filter(function(c){return c.name==b});return c.length?c[0]:null};function Mg(b,c,d){return(b=b.getAttribute(c))?b.value:d||null}function Ng(b,c){this.b=c;this.a=b};var Og={ kb:function(b,c){return b.filter(function(b){return b.name==c})},Sa:function(b,c){var d=Og.kb(b,c);return d.length?d[0]:null},Dc:function(b,c,d){return b.filter(function(b){var e=b.getAttribute('TYPE');b=b.getAttribute('GROUP-ID');return e.value==c&&b.value==d})},wc:function(b,c){return xd([b],[c])[0]},Mc:function(b){return/^#(?!EXT)/m.test(b)} };function Pg(b){this.b=b;this.a=0}function Qg(b){Rg(b,/[ \t]+/gm)}function Rg(b,c){c.lastIndex=b.a;var d=c.exec(b.b);d=null==d?null:{ position:d.index,length:d[0].length,Mf:d };if(b.a==b.b.length||null==d||d.position!=b.a)return null;b.a+=d.length;return d.Mf}function Sg(b){return b.a==b.b.length?null:(b=Rg(b,/[^ \t\n]*/gm))?b[0]:null};function Tg(){this.a=0}
function Ug(b,c,d){c=xc(c);c=c.replace(/\r\n|\r(?=[^\n]|$)/gm,'\n').trim();var e=c.split(/\n+/m);if(!/^#EXTM3U($|[ \t\n])/m.test(e[0]))throw new C(2,4,4015);c=0;for(var f=1;f<e.length;f++)if(!Og.Mc(e[f])){var g=Vg(b,e[f]);--b.a;if(Wg.includes(g.name)){c=1;break}else'EXT-X-STREAM-INF'==g.name&&(f+=1)}f=[];for(g=1;g<e.length;)if(Og.Mc(e[g]))g+=1;else{var h=Vg(b,e[g]);if(Xg.includes(h.name)){if(1!=c)throw new C(2,4,4017);e=e.splice(g,e.length-g);b=Yg(b,d,e,f);return new Jg(d,c,f,b)}f.push(h);g+=1;'EXT-X-STREAM-INF'==
h.name&&(h.a.push(new Lg('URI',e[g])),g+=1)}return new Jg(d,c,f)}function Yg(b,c,d,e){var f=[],g=[];d.forEach(function(d){if(/^(#EXT)/.test(d))d=Vg(b,d),Wg.includes(d.name)?e.push(d):g.push(d);else{if(Og.Mc(d))return[];d=Og.wc(c,d.trim());f.push(new Ng(d,g));g=[]}});return f}
function Vg(b,c){var d=b.a++,e=c.match(/^#(EXT[^:]*)(?::(.*))?$/);if(!e)throw new C(2,4,4016,c);var f=e[1],g=e[2];e=[];var h;if(g){g=new Pg(g);var k;(k=Rg(g,/^([^,=]+)(?:,|$)/g))&&(h=k[1]);for(var l=/([^=]+)=(?:"([^"]*)"|([^",]*))(?:,|$)/g;k=Rg(g,l);)e.push(new Lg(k[1],k[2]||k[3]))}return new Kg(d,f,e,h)}var Wg='EXT-X-TARGETDURATION EXT-X-MEDIA-SEQUENCE EXT-X-DISCONTINUITY-SEQUENCE EXT-X-PLAYLIST-TYPE EXT-X-MAP EXT-X-I-FRAMES-ONLY EXT-X-ENDLIST'.split(' '),Xg='EXTINF EXT-X-BYTERANGE EXT-X-DISCONTINUITY EXT-X-PROGRAM-DATE-TIME EXT-X-KEY EXT-X-DATERANGE'.split(' ');function Zg(b){try{var c=Zg.parse(b);return Bb({ uri:b,Zc:b,data:c.data,headers:{ 'content-type':c.contentType } })}catch(d){return zb(d)}}z('shaka.net.DataUriPlugin',Zg);
Zg.parse=function(b){var c=b.split(':');if(2>c.length||'data'!=c[0])throw new C(2,1,1004,b);c=c.slice(1).join(':').split(',');if(2>c.length)throw new C(2,1,1004,b);var d=c[0];c=window.decodeURIComponent(c.slice(1).join(','));d=d.split(';');var e=null;1<d.length&&(e=d[1]);if('base64'==e)b=Ec(c).buffer;else{if(e)throw new C(2,1,1005,b);b=Bc(c)}return{ data:b,contentType:d[0] }};Sb('data',Zg);function $g(){var b=this;this.c=this.g=null;this.X=1;this.C=new Map;this.S=new Set;this.a=new Map;this.b=null;this.u='';this.o=new Tg;this.N=0;this.h=new A(function(){ah(b)});this.f=bh;this.m=null;this.w=0;this.F=Infinity;this.i=new Ob;this.M=[];this.j=new Map;this.W=!1}z('shaka.hls.HlsParser',$g);p=$g.prototype;p.configure=function(b){this.c=b};
p.start=function(b,c){var d=this;return t(function f(){var g,h;return y(f,function(f){switch(f.l){case 1:return d.g=c,u(f,ch(d,b),2);case 2:return g=f.s,d.u=g.uri,u(f,dh(d,g.data),3);case 3:return h=d.N,0<h&&d.h.P(h),f['return'](d.m)}})})};p.stop=function(){this.h&&(this.h.stop(),this.h=null);var b=[];this.i&&(b.push(this.i.destroy()),this.i=null);this.c=this.g=null;this.C.clear();this.S.clear();this.a.clear();this.m=null;return Promise.all(b)};
p.update=function(){if(this.f!=eh.Oa){for(var b=[],c=r(this.a.values()),d=c.next();!d.done;d=c.next())b.push(fh(this,d.value));return Promise.all(b)}};
function fh(b,c){return t(function e(){var f,g,h,k,l,m,n,q,x,w,B;return y(e,function(e){switch(e.l){case 1:return f=Og,g=eh,h=c.re,u(e,ch(b,h),2);case 2:k=e.s;l=Ug(b.o,k.data,k.uri);if(1!=l.type)throw new C(2,4,4017);n=(m=f.Sa(l.a,'EXT-X-MEDIA-SEQUENCE'))?Number(m.value):0;q=c.stream;return u(e,gh(b,c.qc,l,n,q.mimeType,q.codecs),3);case 3:x=e.s;c.Nb.a=x;w=x[x.length-1];if(B=f.Sa(l.a,'EXT-X-ENDLIST'))hh(b,g.Oa),b.b.ua(w.endTime);v(e)}})})}p.onExpirationUpdated=function(){};
function dh(b,c){return t(function e(){var f,g,h,k,l,m,n,q,x,w,B;return y(e,function(e){switch(e.l){case 1:f=Ug(b.o,c,b.u);if(0!=f.type)throw new C(2,4,4022);return u(e,ih(b,f),2);case 2:g=e.s;if(!b.g)throw new C(2,7,7001);if(b.W&&0==g.variants.length)throw new C(2,4,4034);b.g.filterAllPeriods([g]);h=Infinity;k=0;l=Infinity;for(var E=r(b.a.values()),F=E.next();!F.done;F=E.next())m=F.value,h=Math.min(h,m.Sc),k=Math.max(k,m.Sc),'text'!=m.stream.type&&(l=Math.min(l,m.duration));b.f!=eh.Oa?(b.b=new U(0,
3*b.w),b.b.Pb(!1)):(b.b=new U(null,0),b.b.Pb(!0));jh(b);if(b.f!=eh.Oa){b.N=b.F;n=eh;b.f==n.sd&&(q=b.b.mc,isNaN(b.c.availabilityWindowOverride)||(q=b.c.availabilityWindowOverride),b.b.kd(q));for(x=0;95443.7176888889<=k;)x+=95443.7176888889,k-=95443.7176888889;if(x)for(E=r(b.a.values()),F=E.next();!F.done;F=E.next())w=F.value,95443.7176888889>w.Sc&&(w.stream.presentationTimeOffset=-x,w.Nb.offset(x))}else for(b.b.ua(l),b.b.offset(-h),E=r(b.a.values()),F=E.next();!F.done;F=E.next())B=F.value,B.stream.presentationTimeOffset=
h,B.Nb.offset(-h),Xf(B.Nb,l);b.m={ presentationTimeline:b.b,periods:[g],offlineSessionIds:[],minBufferTime:0,wasDynamic:!1 };v(e)}})})}
function ih(b,c){return t(function e(){var f,g,h,k,l,m,n,q,x,w,B,D;return y(e,function(e){switch(e.l){case 1:return f=Og,g=wd,h=c.a,k=f.kb(c.a,'EXT-X-MEDIA'),l=k.filter(function(b){return'SUBTITLES'==kh(b,'TYPE')}.bind(b)),m=l.map(function(b){return lh(this,b)}.bind(b)),n=k.filter(function(b){return'CLOSED-CAPTIONS'==kh(b,'TYPE')}),mh(b,n),u(e,Promise.all(m),2);case 2:return q=e.s,x=f.kb(h,'EXT-X-STREAM-INF'),w=x.map(function(b){return nh(this,b,c)}.bind(b)),u(e,Promise.all(w),3);case 3:return B=
e.s,D=B.reduce(g.vc,[]),D=D.filter(function(b){return null!=b}),e['return']({ startTime:0,variants:D,textStreams:q })}})})}
function nh(b,c,d){return t(function f(){var g,h,k,l,m,n,q,x,w,B,D,E,F,V,Y,wa,Ba,ba,da,xa,ka,Ta,Ca,eb,Ua,fb,gb;return y(f,function(f){switch(f.l){case 1:g=Bd;h=Og;k=Mg(c,'CODECS','avc1.42E01E,mp4a.40.2');l=oh(k.split(/\s*,\s*/));m=c.getAttribute('RESOLUTION');q=n=null;x=Mg(c,'FRAME-RATE');w=Number(kh(c,'BANDWIDTH'));m&&(B=m.value.split('x'),n=B[0],q=B[1]);D=h.kb(d.a,'EXT-X-MEDIA');D=D.filter(function(b){return'CLOSED-CAPTIONS'!=kh(b,'TYPE')});D=D.filter(function(b){var c=Mg(b,'URI')||'';return'SUBTITLES'==
(Mg(b,'TYPE')||'')||''!=c});E=Mg(c,'AUDIO');F=Mg(c,'VIDEO');E?D=h.Dc(D,'AUDIO',E):F&&(D=h.Dc(D,'VIDEO',F));if(V=ph(g.na,l)){if(Y=Mg(c,'SUBTITLES'))wa=h.Dc(D,'SUBTITLES',Y),wa.length&&(Ba=b.C.get(wa[0].id),Ba.stream.codecs=V);Lb(l,V)}ba=D.map(function(b){return qh(this,b,l)}.bind(b));da=[];xa=[];return u(f,Promise.all(ba),2);case 2:Ta=f.s;Ta=Ta.filter(function(b){return null!=b});E?da=Ta:F&&(xa=Ta);eb=!1;da.length||xa.length?da.length?(fb=kh(c,'URI'),gb=da[0].qc,fb==gb?(Ca=g.xb,eb=!0):Ca=g.Na):Ca=
g.xb:1==l.length?(Ua=ph(g.Na,l),Ca=m||x||Ua?g.Na:g.xb):(Ca=g.Na,l=[l.join(',')]);if(eb){f.A(3);break}return u(f,rh(b,c,l,Ca),4);case 4:ka=f.s;case 3:if(ka)ka.stream.type==g.xb?da=[ka]:xa=[ka];else if(null===ka)return f['return']([]);xa&&sh(xa);da&&sh(da);return f['return'](th(b,da,xa,w,n,q,x))}})})}function sh(b){b.forEach(function(b){var c=b.stream.codecs.split(',');c=c.filter(function(b){return'mp4a.40.34'!=b});b.stream.codecs=c.join(',')})}
function th(b,c,d,e,f,g,h){d.forEach(function(b){if(b=b.stream)b.width=Number(f)||void 0,b.height=Number(g)||void 0,b.frameRate=Number(h)||void 0}.bind(b));c.length||(c=[null]);d.length||(d=[null]);var k=[];c=r(c);for(var l=c.next();!l.done;l=c.next()){l=l.value;for(var m=r(d),n=m.next();!n.done;n=m.next()){var q=n.value;n=l?l.stream:null;var x=q?q.stream:null,w=l?l.drmInfos:null,B=q?q.drmInfos:null;q=(q?q.qc:'')+' - '+(l?l.qc:'');var D=void 0;if(n&&x)if(w.length&&B.length?0<od(w,B).length:1)D=od(w,
B);else continue;else n?D=w:x&&(D=B);b.S.has(q)||(n=uh(b,n,x,e,D),k.push(n),b.S.add(q))}}return k}function uh(b,c,d,e,f){return{ id:b.X++,language:c?c.language:'und',primary:!!c&&c.primary||!!d&&d.primary,audio:c,video:d,bandwidth:e,drmInfos:f,allowedByApplication:!0,allowedByKeySystem:!0 }}function lh(b,c){return t(function e(){var f;return y(e,function(e){switch(e.l){case 1:return kh(c,'TYPE'),u(e,qh(b,c,[]),2);case 2:return f=e.s,e['return'](f.stream)}})})}
function mh(b,c){for(var d=r(c),e=d.next();!e.done;e=d.next()){e=e.value;kh(e,'TYPE');var f=Mg(e,'LANGUAGE')||'und';f=L(f);var g=kh(e,'GROUP-ID');e=kh(e,'INSTREAM-ID');b.j.get(g)||b.j.set(g,new Map);b.j.get(g).set(e,f)}}
function qh(b,c,d){return t(function f(){var g,h,k,l,m,n,q,x,w,B,D;return y(f,function(f){switch(f.l){case 1:g=kh(c,'URI');if(b.a.has(g))return f['return'](b.a.get(g));h=kh(c,'TYPE').toLowerCase();k=Bd;'subtitles'==h&&(h=k.na);l=L(Mg(c,'LANGUAGE','und'));m=Mg(c,'NAME');n=c.getAttribute('DEFAULT');q=c.getAttribute('AUTOSELECT');x=Mg(c,'CHANNELS');if('audio'==h)if(x){var E=x.split('/')[0];E=parseInt(E,10)}else E=null;else E=null;w=E;B=!!n||!!q;return u(f,vh(b,g,d,h,l,B,m,w,null),2);case 2:D=f.s;if(null==
D)return f['return'](null);if(b.a.has(g))return f['return'](b.a.get(g));b.C.set(c.id,D);b.a.set(g,D);return f['return'](D)}})})}
function rh(b,c,d,e){return t(function g(){var h,k,l,m,n;return y(g,function(g){switch(g.l){case 1:h=Bd;k=kh(c,'URI');if(b.a.has(k))return g['return'](b.a.get(k));l=Mg(c,'CLOSED-CAPTIONS');m=null;e==h.Na&&l&&'NONE'!=l&&(m=b.j.get(l));return u(g,vh(b,k,d,e,'und',!1,null,null,m),2);case 2:n=g.s;if(null==n)return g['return'](null);if(b.a.has(k))return g['return'](b.a.get(k));b.a.set(k,n);return g['return'](n)}})})}
function vh(b,c,d,e,f,g,h,k,l){return t(function n(){var q,x,w,B,D,E,F,V,Y,wa,Ba,ba,da,xa,ka,Ta,Ca,eb,Ua,fb,gb,yd,hb,Ih,wb,Gb;return y(n,function(n){switch(n.l){case 1:return q=Og,x=q.wc(b.u,c),B='',u(n,ch(b,x),2);case 2:E=n.s;x=E.uri;w=Ug(b.o,E.data,x);if(1!=w.type)throw new C(2,4,4017);F=[];w.segments.forEach(function(b){b=q.kb(b.b,'EXT-X-KEY');F.push.apply(F,b)});V=!1;Y=[];wa=null;for(var Ia=r(F),Va=Ia.next();!Va.done;Va=Ia.next())if(Ba=Va.value,ba=kh(Ba,'METHOD'),'NONE'!=ba){V=!0;if('AES-128'==
ba)return b.W=!0,n['return'](null);da=kh(Ba,'KEYFORMAT');if(ka=(xa=wh[da])?xa(Ba):null)ka.keyIds.length&&(wa=ka.keyIds[0]),Y.push(ka)}if(V&&!Y.length)throw new C(2,4,4026);xh(b,w);B=yh(e,d);return u(n,zh(b,e,B,w),3);case 3:return D=Ta=n.s,eb=(Ca=q.Sa(w.a,'EXT-X-MEDIA-SEQUENCE'))?Number(Ca.value):0,u(n,gh(b,c,w,eb,D,B),4);case 4:return Ua=n.s,fb=Ua[0].startTime,gb=Ua[Ua.length-1].endTime,yd=gb-fb,hb=new S(Ua),Ih=Ah(w),wb=void 0,'text'==e&&(wb='subtitle'),Gb={ id:b.X++,originalId:h,createSegmentIndex:Promise.resolve.bind(Promise),
findSegmentPosition:hb.find.bind(hb),getSegmentReference:hb.get.bind(hb),initSegmentReference:Ih,presentationTimeOffset:0,mimeType:D,codecs:B,kind:wb,encrypted:V,keyId:wa,language:f,label:h,type:e,primary:g,trickModeVideo:null,emsgSchemeIdUris:null,frameRate:void 0,width:void 0,height:void 0,bandwidth:void 0,roles:[],channelsCount:k,closedCaptions:l },n['return']({ stream:Gb,Nb:hb,drmInfos:Y,qc:c,re:x,Sc:fb,xg:gb,duration:yd })}})})}
function xh(b,c){var d=eh,e=Og.Sa(c.a,'EXT-X-PLAYLIST-TYPE'),f=Og.Sa(c.a,'EXT-X-ENDLIST');f=e&&'VOD'==e.value||f;e=e&&'EVENT'==e.value&&!f;e=!f&&!e;f?hh(b,d.Oa):(e?hh(b,d.sd):hh(b,d.me),d=Bh(c.a,'EXT-X-TARGETDURATION'),d=Number(d.value),b.w=Math.max(d,b.w),b.F=Math.min(d,b.F))}
function Ah(b){var c=Og.kb(b.a,'EXT-X-MAP');if(!c.length)return null;if(1<c.length)throw new C(2,4,4020);c=c[0];var d=kh(c,'URI'),e=Og.wc(b.b,d);b=0;d=null;if(c=Mg(c,'BYTERANGE'))b=c.split('@'),c=Number(b[0]),b=Number(b[1]),d=b+c-1;return new Nf(function(){return[e]},b,d)}
function Ch(b,c,d,e){var f=c.b,g=c.a;c=Bh(f,'EXTINF').value.split(',');c=e+Number(c[0]);var h=0,k=null;if(f=Og.Sa(f,'EXT-X-BYTERANGE'))h=f.value.split('@'),f=Number(h[0]),h=h[1]?Number(h[1]):b.a+1,k=h+f-1;return new P(d,e,c,function(){return[g]},h,k)}function jh(b){b.b&&(b.M.forEach(function(c){b.b.pb(c,0)}),b.M=[])}
function gh(b,c,d,e,f,g){return t(function k(){var l,m,n,q,x,w,B,D,E,F,V;return y(k,function(k){switch(k.l){case 1:return l=d.segments,m=[],n=l[0].a,q=Ch(null,l[0],e,0),x=Ah(d),u(k,Dh(b,c,x,q,f,g),2);case 2:w=k.s;n.split('/').pop();for(var Y=0;Y<l.length;++Y)B=l[Y],D=m[m.length-1],E=0==Y?w:D.endTime,F=e+Y,V=Ch(D,B,F,E),m.push(V);b.M.push(m);jh(b);return k['return'](m)}})})}
function Eh(b,c){return t(function e(){var f,g,h,k,l,m;return y(e,function(e){switch(e.l){case 1:return f=Qb,g=tg(c.c(),c.b,c.b+2048-1,b.c.retryParameters),h=tg(c.c(),c.b,c.a,b.c.retryParameters),ya(e,2),u(e,Fh(b,g,f.td),4);case 4:return k=e.s,e['return'](k);case 2:l=Da(e);if(7001==l.code)throw l;$a('Unable to fetch a partial HLS segment! Falling back to a full segment request, which is expensive!  Your server should support Range requests and CORS preflights.',g.uris[0]);return u(e,Fh(b,h,f.td),
5);case 5:return m=e.s,e['return'](m)}})})}
function Dh(b,c,d,e,f,g){return t(function k(){var l,m,n,q,x,w,B,D,E;return y(k,function(k){switch(k.l){case 1:if(b.m&&(l=b.a.get(c),m=l.Nb,n=m.get(e.position)))return k['return'](n.startTime);if('audio/mpeg'==f)return k['return'](0);if('video/mp4'!=f&&'audio/mp4'!=f){k.A(2);break}q=[Eh(b,e)];d&&q.push(Eh(b,d));return u(k,Promise.all(q),3);case 3:return x=k.s,w=x[0],B=x[1]||x[0],k['return'](Gh(w.data,B.data));case 2:if('video/mp2t'!=f){k.A(4);break}return u(k,Eh(b,e),5);case 5:return D=k.s,k['return'](Hh(D.data));
case 4:if('application/mp4'!=f&&!f.startsWith('text/')){k.A(6);break}return u(k,Eh(b,e),7);case 7:return E=k.s,k['return'](Kh(f,g,E.data));case 6:throw new C(2,4,4030);}})})}
function Gh(b,c){var d=0;(new R).G('moov',Rf).G('trak',Rf).G('mdia',Rf).ca('mdhd',function(b){b.reader.J(0==b.version?8:16);d=b.reader.D();b.parser.stop()}).parse(c,!0);if(!d)throw new C(2,4,4030);var e=0,f=!1;(new R).G('moof',Rf).G('traf',Rf).ca('tfdt',function(b){e=(0==b.version?b.reader.D():b.reader.vb())/d;f=!0;b.parser.stop()}).parse(b,!0);if(!f)throw new C(2,4,4030);return e}
function Hh(b){function c(){throw new C(2,4,4030);}b=new Q(new DataView(b),0);for(var d=0,e=0;;)if(d=b.aa(),e=b.ha(),71!=e&&c(),b.Kb()&16384||c(),e=(b.ha()&48)>>4,0!=e&&2!=e||c(),3==e&&(e=b.ha(),b.J(e)),1!=b.D()>>8)b.seek(d+188),e=b.ha(),71!=e&&(b.seek(d+192),e=b.ha()),71!=e&&(b.seek(d+204),e=b.ha()),71!=e&&c(),b.ae(1);else return b.J(3),d=b.ha()>>6,0!=d&&1!=d||c(),0==b.ha()&&c(),d=b.ha(),e=b.Kb(),b=b.Kb(),(1073741824*((d&14)>>1)+((e&65534)<<14|(b&65534)>>1))/9E4}
function Kh(b,c,d){b=mc(b,c);if(!$d(b))return 0;c=new Yd(null);ae(c,b);return c.Ic(d)}function oh(b){var c=new Set,d=[];b=r(b);for(var e=b.next();!e.done;e=b.next()){e=e.value;var f=pc(e)[0];c.has(f)||(d.push(e),c.add(f))}return d}function ph(b,c){for(var d=Lh[b],e=0;e<d.length;e++)for(var f=0;f<c.length;f++)if(d[e].test(c[f].trim()))return c[f].trim();return'text'==b?'':null}function yh(b,c){if(1==c.length)return c[0];var d=ph(b,c);if(null!=d)return d;throw new C(2,4,4025,c);}
function zh(b,c,d,e){return t(function g(){var h,k,l,m,n,q,x,w,B,D;return y(g,function(g){switch(g.l){case 1:h=Bd;k=Qb;l=e.segments[0].a;m=new cb(l);n=m.fa.split('.').pop();q=Mh[c];if(x=q[n])return g['return'](x);if(c==h.na)return d&&'vtt'!=d?g['return']('application/mp4'):g['return']('text/vtt');w=Tb([l],b.c.retryParameters);w.method='HEAD';return u(g,Fh(b,w,k.td),2);case 2:B=g.s;D=B.headers['content-type'];if(!D)throw new C(2,4,4021,n);return g['return'](D.split(';')[0])}})})}
function kh(b,c){var d=b.getAttribute(c);if(!d)throw new C(2,4,4023,c);return d.value}function Bh(b,c){var d=Og.Sa(b,c);if(!d)throw new C(2,4,4024,c);return d}function ch(b,c){return Fh(b,Tb([c],b.c.retryParameters),Qb.ug)}
var Lh={ audio:[/^vorbis$/,/^opus$/,/^flac$/,/^mp4a/,/^[ae]c-3$/],video:[/^avc/,/^hev/,/^hvc/,/^vp0?[89]/,/^av1$/],text:[/^vtt$/,/^wvtt/,/^stpp/] },Mh={ audio:{ mp4:'audio/mp4',m4s:'audio/mp4',m4i:'audio/mp4',m4a:'audio/mp4',ts:'video/mp2t' },video:{ mp4:'video/mp4',m4s:'video/mp4',m4i:'video/mp4',m4v:'video/mp4',ts:'video/mp2t' },text:{ mp4:'application/mp4',m4s:'application/mp4',m4i:'application/mp4',vtt:'text/vtt',ttml:'application/ttml+xml' } };
function ah(b){t(function d(){var e,f;return y(d,function(d){switch(d.l){case 1:if(!b.g)return d['return']();ya(d,2);return u(d,b.update(),4);case 4:e=b.N;b.h.P(e);Aa(d,0);break;case 2:f=Da(d),f.severity=1,b.g.onError(f),b.h.P(.1),v(d)}})})}function hh(b,c){b.f=c;b.b&&b.b.Pb(b.f==eh.Oa);b.f!=eh.Oa||b.h.stop()}function Fh(b,c,d){if(!b.i)throw new C(2,7,7001);c=b.g.networkingEngine.request(d,c);Pb(b.i,c);return c.promise}
var wh={ 'urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed':function(b){var c=kh(b,'METHOD');Oe('HLS SAMPLE-AES-CENC','SAMPLE-AES-CENC will no longer be supported, see Issue #1227');if(!['SAMPLE-AES','SAMPLE-AES-CTR','SAMPLE-AES-CENC'].includes(c))return null;c=kh(b,'URI');c=Zg.parse(c);c=new Uint8Array(c.data);c=Ad('com.widevine.alpha',[{ initDataType:'cenc',initData:c }]);if(b=Mg(b,'KEYID'))c.keyIds=[b.substr(2).toLowerCase()];return c} },bh='VOD',eh={ Oa:bh,me:'EVENT',sd:'LIVE' };T.cd('m3u8',$g);
T.Lb('application/x-mpegurl',$g);T.Lb('application/vnd.apple.mpegurl',$g);function Nh(){this.a=new Map}function Oh(b,c,d){Ph(b,c).text=d}function Ph(b,c){b.a.has(c)||b.a.set(c,new Qh);return b.a.get(c)}function Qh(){this.text=this.variant=null};function Rh(b,c){this.a=b;this.b=new Set([b]);c=c||[];for(var d=r(c),e=d.next();!e.done;e=d.next())this.add(e.value)}Rh.prototype.add=function(b){return Sh(this.a,b)?(this.b.add(b),!0):!1};function Sh(b,c){var d;if(!(d=!!b.audio!=!!c.audio||!!b.video!=!!c.video||b.language!=c.language)&&(d=b.audio&&c.audio)){d=b.audio;var e=c.audio;d=!(d.channelsCount==e.channelsCount&&Th(d,e)&&Uh(d.roles,e.roles))}!d&&(d=b.video&&c.video)&&(d=b.video,e=c.video,d=!(Th(d,e)&&Uh(d.roles,e.roles)));return d?!1:!0}
Rh.prototype.values=function(){return this.b.values()};function Th(b,c){if(b.mimeType!=c.mimeType)return!1;var d=b.codecs.split(',').map(function(b){return pc(b)[0]}),e=c.codecs.split(',').map(function(b){return pc(b)[0]});if(d.length!=e.length)return!1;d.sort();e.sort();for(var f=0;f<d.length;f++)if(d[f]!=e[f])return!1;return!0}
function Uh(b,c){var d=new Set(b),e=new Set(c);d['delete']('main');e['delete']('main');if(d.size!=e.size)return!1;d=r(d);for(var f=d.next();!f.done;f=d.next())if(!e.has(f.value))return!1;return!0};function Vh(b){this.a=b;this.b=new Wh(b.language,'',b.audio&&b.audio.channelsCount?b.audio.channelsCount:0)}Vh.prototype.create=function(b){var c=this,d=b.filter(function(b){return Sh(c.a,b)});return d.length?new Rh(d[0],d):this.b.create(b)};function Wh(b,c,d){this.c=b;this.b=c;this.a=d}
Wh.prototype.create=function(b){var c=[];c=Xh(b,this.c);var d=b.filter(function(b){return b.primary});c=c.length?c:d.length?d:b;this.b&&(b=Yh(c,this.b),b.length&&(c=b));this.a&&(b=He(c,this.a),b.length&&(c=b));b=new Rh(c[0]);c=r(c);for(d=c.next();!d.done;d=c.next())d=d.value,Sh(b.a,d)&&b.add(d);return b};function Xh(b,c){var d=L(c),e=ve(d,b.map(function(b){return ue(b)}));return e?b.filter(function(b){return e==ue(b)}):[]}
function Yh(b,c){return b.filter(function(b){var d=b.audio;b=b.video;return d&&0<=d.roles.indexOf(c)||b&&0<=b.roles.indexOf(c)})};function Zh(b,c){this.a=$h;this.b=(new Map).set($h,c).set(ai,b)}var ai=0,$h=1;function bi(b,c){this.g=b;this.h=ci(b);this.c=b.a.currentTime;this.f=Date.now()/1E3;this.i=c;this.b=function(){}}bi.prototype.a=function(){this.g=null;this.b=function(){}};function di(b,c){b.b=c}function ei(b){this.a=b}function ci(b){if(b.a.paused||0==b.a.playbackRate||null==b.a.buffered)var c=!1;else a:{c=b.a.buffered;b=b.a.currentTime;for(var d=0;d<c.length;d++){var e=c.start(d),f=c.end(d);if(!(b<e||b>f-.5)){c=!0;break a}}c=!1}return c};function fi(b,c,d,e,f){var g=this;this.b=b;this.w=c;this.u=d;this.m=f;this.g=new bc;this.j=!1;this.o=b.readyState;this.f=!1;this.c=e;this.i=!1;K(this.g,b,'waiting',function(){return gi(g)});this.h=(new A(function(){gi(g)})).Ka(.25)}fi.prototype.a=function(){this.g&&(this.g.a(),this.g=null);null!=this.h&&(this.h.stop(),this.h=null);this.c&&(this.c.a(),this.c=null);this.b=this.w=this.m=null};fi.prototype.Xc=function(){this.i=!0;gi(this)};
function gi(b){if(0!=b.b.readyState){if(b.b.seeking){if(!b.j)return}else b.j=!1;if(!b.b.paused){b.b.readyState!=b.o&&(b.f=!1,b.o=b.b.readyState);var c=b.u.smallGapLimit,d=b.b.currentTime,e=b.b.buffered;a:{if(e&&e.length&&!(1==e.length&&1E-6>e.end(0)-e.start(0))){var f=tc('Edge/')||tc('Trident/')||tc('Tizen')||tc('CrKey')?.5:.1;for(var g=0;g<e.length;g++)if(e.start(g)>d&&(0==g||e.end(g-1)-d<=f)){f=g;break a}}f=null}if(null==f){if(b.c){b=b.c;d=b.g;e=ci(d);d=d.a.currentTime;f=Date.now()/1E3;if(b.c!=
d||b.h!=e)b.f=f,b.c=d,b.h=e;d=f-b.f;d>=b.i&&e&&b.b(b.c,d)}}else if(0!=f||b.i){g=e.start(f);var h=b.w.ya();if(!(g>=h)){h=g-d;c=h<=c;var k=!1;.001>h||(c||b.f||(b.f=!0,d=new I('largegap',{ currentTime:d,gapSize:h }),d.cancelable=!0,b.m(d),b.u.jumpLargeGaps&&!d.defaultPrevented&&(k=!0)),!c&&!k)||(0!=f&&e.end(f-1),b.b.currentTime=g)}}}}};function hi(b){var c=this;this.f=b;this.b=new Set;this.c=(new A(function(){ii(c,!1)})).Ka(.25)}hi.prototype.a=function(){this.c.stop();for(var b=r(this.b),c=b.next();!c.done;c=b.next())c.value.a();this.b.clear()};function ii(b,c){for(var d=r(b.b),e=d.next();!e.done;e=d.next())e.value.h(b.f.currentTime,c)};function ji(b){var c=[];b=r(b);for(var d=b.next();!d.done;d=b.next()){d=r(d.value.variants);for(var e=d.next();!e.done;e=d.next())c.push(e.value)}return c}function ki(b,c){for(var d=null,e=r(b),f=e.next();!f.done;f=e.next())f=f.value,c>=f.startTime&&(d=f);return d};function li(b){this.f=b;this.b=null;this.c=function(){}}li.prototype.a=function(){this.b=this.f=null;this.c=function(){}};li.prototype.h=function(b){var c=this.b,d=this.f.periods;b=ki(d,b)||d[0];c!=b&&this.c(b);this.b=b};function mi(b,c){b.c=c};function ni(b){var c=this;this.b=b;this.g=!1;this.f=this.b.dc();this.c=new A(function(){c.b.Jd(.25*c.f)})}ni.prototype.a=function(){this.c&&(this.c.stop(),this.c=null);this.b=null};ni.prototype.set=function(b){this.f=b;oi(this)};function oi(b){b.c.stop();var c=b.g?0:b.f;0<=c?b.b.dc()!=c&&b.b.jd(c):(b.c.Ka(.25),0!=b.b.dc()&&b.b.jd(0))};function pi(b,c,d){this.b=b;this.g=c;this.h=d;this.c=new bc;this.f=new qi(b);0<b.readyState?ri(this,d):si(this,d)}pi.prototype.a=function(){this.c&&(this.c.a(),this.c=null);null!=this.f&&(this.f.a(),this.f=null);this.g=function(){};this.b=null};function ti(b){return 0<b.b.readyState?b.b.currentTime:b.h}function si(b,c){b.h=c;b.c.ma(b.b,'loadedmetadata');ec(b.c,b.b,'loadedmetadata',function(){ri(b,c)})}
function ri(b,c){.001>Math.abs(b.b.currentTime-c)?ui(b):(ec(b.c,b.b,'seeking',function(){ui(b)}),vi(b.f,0==b.b.currentTime?c:b.b.currentTime))}function ui(b){K(b.c,b.b,'seeking',function(){return b.g()})}function qi(b){var c=this;this.c=b;this.i=10;this.h=this.g=this.f=0;this.b=new A(function(){0>=c.f?c.b.stop():c.c.currentTime!=c.g?c.b.stop():(c.c.currentTime=c.h,c.f--)})}qi.prototype.a=function(){this.b&&(this.b.stop(),this.b=null);this.c=null};
function vi(b,c){b.g=b.c.currentTime;b.h=c;b.f=b.i;b.c.currentTime=c;b.b.Ka(.1)};function wi(b){function c(){d.g=!0;null!=d.c&&(d.b.currentTime=d.c)}var d=this;this.b=b;this.g=!1;this.c=null;this.f=new bc;0==this.b.readyState?ec(this.f,this.b,'loadedmetadata',c):c()}wi.prototype.a=function(){this.f&&(this.f.a(),this.f=null);this.b=null};wi.prototype.o=function(b){this.c=this.g?this.c:b};wi.prototype.i=function(){return(this.g?this.b.currentTime:this.c)||0};wi.prototype.u=function(){};
function xi(b,c,d,e,f,g){var h=this;this.c=b;this.b=c.presentationTimeline;this.C=c.minBufferTime||0;this.h=d;this.w=f;this.m=null;this.g=new fi(b,c.presentationTimeline,d,yi(b,d),g);this.f=new pi(b,function(){a:{var b=h.g;b.j=!0;b.i=!1;b.f=!1;var c=ti(h.f);b=zi(h,c);if(.001<Math.abs(b-c)&&(c=(new Date).getTime()/1E3,!h.m||h.m<c-1)){h.m=c;c=h.f;0<c.b.readyState?vi(c.f,b):si(c,b);b=void 0;break a}h.w();b=void 0}return b},Ai(this,e));this.j=(new A(function(){if(0!=h.c.readyState&&!h.c.paused){var b=
h.c.currentTime,c=h.b.Ua(),d=h.b.ya();3>d-c&&(c=d-3);b<c&&(b=zi(h,b),h.c.currentTime=b)}})).Ka(.25)}xi.prototype.a=function(){this.f&&(this.f.a(),this.f=null);this.g&&(this.g.a(),this.g=null);this.j&&(this.j.stop(),this.j=null);this.c=this.f=this.b=this.h=null;this.w=function(){}};xi.prototype.o=function(b){var c=this.f;0<c.b.readyState?vi(c.f,b):si(c,b)};xi.prototype.i=function(){var b=ti(this.f);return 0<this.c.readyState&&!this.c.paused?Bi(this,b):b};
function Ai(b,c){null==c?c=Infinity>b.b.V()?b.b.Ua():b.b.ya():0>c?c=b.b.ya()+c:0<=c&&Infinity==b.b.V()&&(c=b.b.Ua()+c);return Ci(b,Bi(b,c))}xi.prototype.u=function(){this.g.Xc()};function Ci(b,c){var d=b.b.V();return c>=d?d-b.h.durationBackoff:c}function zi(b,c){var d=td.bind(null,b.c.buffered),e=Math.max(b.C,b.h.rebufferingGoal),f=b.h.safeSeekOffset,g=b.b.Ua(),h=b.b.ya(),k=b.b.V();3>h-g&&(g=h-3);var l=b.b.Db(e),m=b.b.Db(f);e=b.b.Db(e+f);return c>=k?Ci(b,c):c>h?h:c<g?d(m)?m:e:c>=l||d(c)?c:e}
function Bi(b,c){var d=b.b.Ua();if(c<d)return d;d=b.b.ya();return c>d?d:c}function yi(b,c){if(!c.stallEnabled)return null;var d=c.stallSkip,e=new bi(new ei(b),c.stallThreshold);di(e,function(){b.currentTime+=d});return e};function Di(){this.c=function(){};this.b=new Set}Di.prototype.a=function(){this.c=function(){};this.b.clear()};function Ei(b,c){b.c=c};function Fi(b){var c=this;this.i=b;this.g=new Map;this.b=function(){};this.c=function(){};this.f=function(){};this.j=[{ cb:null,bb:Gi,Wa:function(b,e){return c.b(b,e)} },{ cb:Hi,bb:Gi,Wa:function(b,e){return c.b(b,e)} },{ cb:Ii,bb:Gi,Wa:function(b,e){return c.b(b,e)} },{ cb:Gi,bb:Hi,Wa:function(b,e){return c.c(b,e)} },{ cb:Gi,bb:Ii,Wa:function(b,e){return c.c(b,e)} },{ cb:Hi,bb:Ii,Wa:function(b,e){return c.f(b,e)} },{ cb:Ii,bb:Hi,Wa:function(b,e){return c.f(b,e)} }]}
Fi.prototype.a=function(){this.i=null;this.g.clear();this.b=function(){};this.c=function(){};this.f=function(){}};Fi.prototype.h=function(b,c){for(var d=r(this.i.b),e=d.next();!e.done;e=d.next()){e=e.value;var f=this.g.get(e),g=b<e.startTime?Hi:b>e.endTime?Ii:Gi;this.g.set(e,g);for(var h=r(this.j),k=h.next();!k.done;k=h.next())k=k.value,k.cb==f&&k.bb==g&&k.Wa(e,c)}};function Ji(b,c,d,e){b.b=c;b.c=d;b.f=e}var Hi=1,Gi=2,Ii=3;function Ki(b,c){this.a=c;this.c=b;this.g=null;this.j=1;this.u=Promise.resolve();this.h=[];this.i=new Map;this.b=new Map;this.o=!1;this.F=null;this.C=this.f=this.m=!1;this.w=0}p=Ki.prototype;p.destroy=function(){for(var b=r(this.b.values()),c=b.next();!c.done;c=b.next())Li(c.value);this.b.clear();this.i.clear();this.g=this.h=this.u=this.c=this.a=null;this.f=!0;return Promise.resolve()};
p.configure=function(b){this.g=b;this.F=new ub({ maxAttempts:Math.max(b.retryParameters.maxAttempts,2),baseDelay:b.retryParameters.baseDelay,backoffFactor:b.retryParameters.backoffFactor,fuzzFactor:b.retryParameters.fuzzFactor,timeout:0 },!0)};
p.start=function(){var b=this;return t(function d(){var e,f,g;return y(d,function(d){switch(d.l){case 1:return e=b.a.Ta(),f=Mi(b,e),g=b.a.Md(b.c.periods[f]),g.variant||g.text?u(d,Ni(b,g.variant?g.variant.audio:null,g.variant?g.variant.video:null,g.text,e),2):d['return'](new C(2,5,5005));case 2:if(b.f)return d['return']();b.a&&b.a.jf&&b.a.jf();v(d)}})})};function Oi(b){return Pi(b,'audio')}function Qi(b){return Pi(b,'video')}function Pi(b,c){var d=b.b.get(c);return d?d.Ha||d.stream:null}
function Ri(b,c){return t(function e(){var f,g,h,k,l,m,n,q;return y(e,function(e){switch(e.l){case 1:return f=Bd,u(e,ne(b.a.K,f.na),2);case 2:return b.w++,b.C=!1,g=b.w,h=b.a.K,k=new Map,l=new Set,k.set(f.na,c),l.add(c),u(e,h.init(k,!1),3);case 3:return b.f?e['return']():u(e,Si(b,l),4);case 4:if(b.f)return e['return']();b.w!=g||b.b.has(f.na)||b.C||(m=b.a.Ta(),n=Mi(b,m),q=Ti(c,n,0),b.b.set(f.na,q),Ui(b,q,0));v(e)}})})}
function Vi(b,c){var d=b.b.get('video');if(d){var e=d.stream;if(e)if(c){var f=e.trickModeVideo;f&&!d.Ha&&(Wi(b,f,!1,0,!1),d.Ha=e)}else if(e=d.Ha)d.Ha=null,Wi(b,e,!0,0,!1)}}function Xi(b,c,d,e){c.video&&Wi(b,c.video,d,e,!1);c.audio&&Wi(b,c.audio,d,e,!1)}
function Wi(b,c,d,e,f){var g=b.b.get(c.type);if(!g&&'text'==c.type&&b.g.ignoreTextStreamFailures)Ri(b,c);else if(g){var h=Yi(b,c);if(d&&h!=g.Aa)b.b.forEach(function(c){Zi(b,c)});else{g.Ha&&(c.trickModeVideo?(g.Ha=c,c=c.trickModeVideo):g.Ha=null);var k=b.h[h];k&&k.wb&&(k=b.i.get(c.id))&&k.wb&&(g.stream!=c||f)&&('text'==c.type&&ge(b.a.K,mc(c.mimeType,c.codecs)),g.stream=c,g.fc=!0,$i(b,g,h)&&g.Ib.abort(),d&&(g.Pa?g.rc=!0:g.Ga?(g.La=!0,g.Xb=e,g.rc=!0):(Li(g),aj(b,g,!0,e))))}}}
function $i(b,c,d){if(!c.Ib)return!1;var e=b.a.Ta(),f=je(b.a.K,c.type);d=(d=bj(b,c,e,f,d))?d.a?d.a-d.b:null:null;if(null==d)return!1;var g=c.stream.initSegmentReference;g&&(d+=(g.a?g.a-g.b:null)||0);g=b.a.getBandwidthEstimate();return 8*d/g<f-e-Math.max(b.c.minBufferTime||0,b.g.rebufferingGoal)||c.Ib.b.a>d?!0:!1}
function cj(b){function c(c){var f=b.a.K;'text'==c?(c=f.a,c=null==c.a||null==c.b?!1:d>=c.a&&d<c.b):(c=ie(f,c),c=td(c,d,e));return c}var d=b.a.Ta(),e=b.g.smallGapLimit,f=Mi(b,d);if(jc(b.b.values(),function(b){return b.Aa==f}))for(var g=r(b.b.keys()),h=g.next();!h.done;h=g.next())h=h.value,c(h)||Zi(b,b.b.get(h));else jc(b.b.keys(),c)||b.b.forEach(function(c){Zi(b,c)})}function Zi(b,c){c.Pa||c.La||(c.Ga?(c.La=!0,c.Xb=0):null==he(b.a.K,c.type)?null==c.Da&&Ui(b,c,0):(Li(c),aj(b,c,!1,0)))}
function Ni(b,c,d,e,f){return t(function h(){var k,l,m,n,q,x,w;return y(h,function(h){switch(h.l){case 1:return k=b.a.Ta(),l=Mi(b,k),m=Bd,n=new Map,q=new Set,c&&(n.set(m.xb,c),q.add(c)),d&&(n.set(m.Na,d),q.add(d)),e&&(n.set(m.na,e),q.add(e)),x=b.a.K,w=b.g.forceTransmuxTS,u(h,x.init(n,w),2);case 2:if(b.f)return h['return']();dj(b);return u(h,Si(b,q),3);case 3:if(b.f)return h['return']();n.forEach(function(c,d){if(!b.b.has(d)){var e=Ti(c,l,f);b.b.set(d,e);Ui(b,e,0)}});v(h)}})})}
function Ti(b,c,d){return{ stream:b,type:b.type,qa:null,za:null,Ha:null,fc:!0,Aa:c,endOfStream:!1,Ga:!1,Da:null,La:!1,Xb:0,rc:!1,Pa:!1,bd:!1,Fb:!1,$d:d||0,Ib:null,va:[] }}
function ej(b,c){var d=b.h[c];if(d)return d.promise;d={ promise:new G,wb:!1 };b.h[c]=d;for(var e=new Set,f=r(b.c.periods[c].variants),g=f.next();!g.done;g=f.next())g=g.value,g.video&&e.add(g.video),g.video&&g.video.trickModeVideo&&e.add(g.video.trickModeVideo),g.audio&&e.add(g.audio);f=r(b.c.periods[c].textStreams);for(g=f.next();!g.done;g=f.next())e.add(g.value);b.u=b.u.then(function(){if(!this.f)return Si(this,e)}.bind(b)).then(function(){this.f||(this.h[c].promise.resolve(),this.h[c].wb=!0)}.bind(b))['catch'](function(b){this.f||
(this.h[c].promise['catch'](function(){}),this.h[c].promise.reject(),delete this.h[c],this.a.onError(b))}.bind(b));return d.promise}
function Si(b,c){return t(function e(){var f,g,h,k,l,m,n;return y(e,function(e){switch(e.l){case 1:f=[];for(var q=r(c),w=q.next();!w.done;w=q.next())g=w.value,(h=b.i.get(g.id))?f.push(h.promise):(b.i.set(g.id,{ promise:new G,wb:!1 }),f.push(g.createSegmentIndex()));ya(e,2);return u(e,Promise.all(f),4);case 4:if(b.f)return e['return']();Aa(e,3);break;case 2:k=Da(e);if(b.f)return e['return']();e=r(c);for(w=e.next();!w.done;w=e.next())l=w.value,b.i.get(l.id).promise['catch'](function(){}),b.i.get(l.id).promise.reject(),
b.i['delete'](l.id);throw k;case 3:q=r(c);for(w=q.next();!w.done;w=q.next())m=w.value,n=b.i.get(m.id),n.wb||(n.promise.resolve(),n.wb=!0);v(e)}})})}function dj(b){var c=b.c.presentationTimeline.V();Infinity>c?b.a.K.ua(c):b.a.K.ua(Math.pow(2,32))}
function fj(b,c){if(!b.f&&!c.Ga&&null!=c.Da&&!c.Pa)if(c.Da=null,c.La)aj(b,c,c.rc,c.Xb);else{try{var d=gj(b,c);null!=d&&(Ui(b,c,d),c.Fb=!1)}catch(e){hj(b,e);return}d=Array.from(b.b.values());ij(b,c);b.o&&d.every(function(b){return b.endOfStream})&&b.a.K.endOfStream().then(function(){if(!this.f){var b=this.a.K.V();b<this.c.presentationTimeline.V()&&this.c.presentationTimeline.ua(b)}}.bind(b))}}
function gj(b,c){function d(b){return'text'==b.type&&'application/cea-608'==b.stream.mimeType}if(d(c))return b.a.K.oc(c.stream.originalId||''),null;var e=b.a.Ta(),f=jj(b,c,e),g=Yi(b,c.stream),h=Mi(b,f),k=ke(b.a.K,c.type,e),l=Math.max(b.c.minBufferTime||0,b.g.rebufferingGoal,b.g.bufferingGoal)*b.j;if(f>=b.c.presentationTimeline.V())return c.endOfStream=!0,'video'==c.type&&(f=b.b.get('text'))&&'application/cea-608'==f.stream.mimeType&&(f.endOfStream=!0),null;c.endOfStream=!1;c.Aa=h;if(h!=g)return null;
if(k>=l)return.5;h=je(b.a.K,c.type);h=bj(b,c,e,h,g);if(!h)return 1;var m=Infinity;Array.from(b.b.values()).forEach(function(c){d(c)||(c=jj(b,c,e),m=Math.min(m,c))});if(f>=m+b.c.presentationTimeline.b)return 1;c.$d=0;kj(b,c,e,g,h);return null}function jj(b,c,d){if(!c.qa||!c.za)return Math.max(d,c.$d);d=Yi(b,c.qa);return b.c.periods[d].startTime+c.za.endTime}
function bj(b,c,d,e,f){if(c.za&&c.stream==c.qa)return lj(b,c,f,c.za.position+1);c.za?(d=Yi(b,c.qa),d=c.stream.findSegmentPosition(Math.max(0,b.c.periods[d].startTime+c.za.endTime-b.c.periods[f].startTime))):d=c.stream.findSegmentPosition(Math.max(0,(e||d)-b.c.periods[f].startTime));if(null==d)return null;var g=null;null==e&&(g=lj(b,c,f,Math.max(0,d-1)));return g||lj(b,c,f,d)}
function lj(b,c,d,e){d=b.c.periods[d];c=c.stream.getSegmentReference(e);if(!c)return null;e=b.c.presentationTimeline;b=e.Eb();e=e.lb();return d.startTime+c.endTime<b||d.startTime+c.startTime>e?null:c}
function kj(b,c,d,e,f){var g=b.c.periods[e],h=c.stream,k=b.c.presentationTimeline.V(),l=b.c.periods[e+1];e=mj(b,c,e,Math.max(0,g.startTime-.1),l?l.startTime+.01:k);c.Ga=!0;c.fc=!1;k=nj(b,c,f);Promise.all([e,k]).then(function(b){if(!this.f&&!this.m)return oj(this,c,d,g,h,f,b[1])}.bind(b)).then(function(){this.f||this.m||(c.Ga=!1,c.bd=!1,c.La||this.a.Xc(),Ui(this,c,0),pj(this,h))}.bind(b))['catch'](function(b){this.f||this.m||(c.Ga=!1,'text'==c.type&&this.g.ignoreTextStreamFailures?this.b['delete']('text'):
7001==b.code?(c.Ga=!1,c.Da=null,Ui(this,c,0)):3017==b.code?qj(this,c,b):(c.Fb=!0,b.severity=2,hj(this,b)))}.bind(b))}function qj(b,c,d){if(!Array.from(b.b.values()).some(function(b){return b!=c&&b.bd})){var e=Math.round(100*b.j);if(20<e)b.j-=.2;else if(4<e)b.j-=.04;else{c.Fb=!0;b.m=!0;b.a.onError(d);return}c.bd=!0}Ui(b,c,4)}
function mj(b,c,d,e,f){if(!c.fc)return Promise.resolve();d=oe(b.a.K,c.type,b.c.periods[d].startTime-c.stream.presentationTimeOffset,e,f);if(!c.stream.initSegmentReference)return d;b=nj(b,c,c.stream.initSegmentReference).then(function(b){if(!this.f)return le(this.a.K,c.type,b,null,null,c.stream.closedCaptions&&0<c.stream.closedCaptions.size)}.bind(b))['catch'](function(b){c.fc=!0;return Promise.reject(b)});return Promise.all([d,b])}
function oj(b,c,d,e,f,g,h){var k=f.closedCaptions&&0<f.closedCaptions.size;null!=f.emsgSchemeIdUris&&0<f.emsgSchemeIdUris.length&&(new R).ca('emsg',b.yf.bind(b,e,g,f.emsgSchemeIdUris)).parse(h);return rj(b,c,d).then(function(){if(!this.f)return le(this.a.K,c.type,h,g.startTime+e.startTime,g.endTime+e.startTime,k)}.bind(b)).then(function(){if(!this.f){var b={};null!=c.qa&&c.qa.id!=f.id?(b={ time:g.startTime,from:c.qa.id,od:f.id },c.va.push(b),c.va.sort(function(b,c){return b.time-c.time})):null==c.qa&&
(b={ time:g.startTime,from:-1,od:f.id },c.va.push(b),c.va.sort(function(b,c){return b.time-c.time}));c.qa=f;c.za=g;return Promise.resolve()}}.bind(b))}
p.yf=function(b,c,d,e){var f=e.reader.$c(),g=e.reader.$c(),h=e.reader.D(),k=e.reader.D(),l=e.reader.D(),m=e.reader.D();e=e.reader.Za(e.reader.I.byteLength-e.reader.aa());b=b.startTime+c.startTime+k/h;if(d.includes(f))if('urn:mpeg:dash:event:2012'==f)this.a.kf();else this.a.onEvent(new I('emsg',{ detail:{ startTime:b,endTime:b+l/h,schemeIdUri:f,value:g,timescale:h,presentationTimeDelta:k,eventDuration:l,id:m,messageData:e } }))};
function rj(b,c,d){var e=Math.max(b.g.bufferBehind,b.c.presentationTimeline.b),f=he(b.a.K,c.type);if(null==f)return Promise.resolve();d=d-f-e;if(0>=d)return Promise.resolve();for(;0<c.va.length&&c.va[0].time<f+d;)c.va.shift();return b.a.K.remove(c.type,f,f+d).then(function(){}.bind(b))}
function pj(b,c){if(!b.o){var d=Array.from(b.b.values());if(1!=d.length||'text'!=d[0].type)b.o=d.every(function(b){return'text'==b.type?!0:!b.La&&!b.Pa&&b.za});if(b.o){d=Yi(b,c);b.h[d]||ej(b,d).then(function(){this.f||this.a.Ld()}.bind(b))['catch'](wd.Hb);for(d=0;d<b.c.periods.length;++d)ej(b,d)['catch'](wd.Hb);b.a.uf&&b.a.uf()}}}
function ij(b,c){var d=Yi(b,c.stream);if(c.Aa!=d){var e=c.Aa,f=Array.from(b.b.values());f.every(function(b){return b.Aa==e})&&f.every(sj)&&ej(b,e).then(function(){if(!this.f&&f.every(function(b){var c=sj(b),d=Yi(this,b.stream);return c&&b.Aa==e&&d!=e}.bind(this))){var b=this.c.periods[e],c=this.a.Md(b),d=new Map;c.variant&&c.variant.video&&d.set('video',c.variant.video);c.variant&&c.variant.audio&&d.set('audio',c.variant.audio);c.text&&d.set('text',c.text);var l=r(this.b.keys());for(c=l.next();!c.done;c=
l.next())if(c=c.value,!d.has(c)&&'text'!=c){this.a.onError(new C(2,5,5005));return}l=r(Array.from(d.keys()));for(c=l.next();!c.done;c=l.next())if(c=c.value,!this.b.has(c))if('text'==c)Ni(this,null,null,d.get('text'),b.startTime),d['delete'](c);else{this.a.onError(new C(2,5,5005));return}b=r(Array.from(this.b.keys()));for(c=b.next();!c.done;c=b.next())c=c.value,(l=d.get(c))?(Wi(this,l,!1,0,!1),Ui(this,this.b.get(c),0)):this.b['delete'](c);this.a.Ld()}}.bind(b))['catch'](wd.Hb)}}
function sj(b){return!b.Ga&&null==b.Da&&!b.La&&!b.Pa}function Mi(b,c){var d=ki(b.c.periods,c+Cd);return d?b.c.periods.indexOf(d):0}function Yi(b,c){for(var d=b.c.periods,e=0;e<d.length;e++){for(var f=d[e],g=new Set,h=r(f.variants),k=h.next();!k.done;k=h.next())k=k.value,k.audio&&g.add(k.audio),k.video&&g.add(k.video),k.video&&k.video.trickModeVideo&&g.add(k.video.trickModeVideo);f=r(f.textStreams);for(h=f.next();!h.done;h=f.next())g.add(h.value);if(g.has(c))return e}return-1}
function nj(b,c,d){d=tg(d.c(),d.b,d.a,b.g.retryParameters);b=b.a.ob.request(1,d);c.Ib=b;return b.promise.then(function(b){c.Ib=null;return b.data})}
function aj(b,c,d,e){t(function g(){var h,k,l;return y(g,function(g){switch(g.l){case 1:return c.La=!1,c.rc=!1,c.Xb=0,c.Pa=!0,e?(k=b.a.Ta(),l=b.a.K.V(),h=b.a.K.remove(c.type,k+e,l)):h=ne(b.a.K,c.type).then(function(){if(!this.f&&d)return this.a.K.flush(c.type)}.bind(b)),u(g,h,2);case 2:if(b.f)return g['return']();for(;0<c.va.length;)c.va.shift();c.qa=null;c.za=null;c.Pa=!1;c.endOfStream=!1;Ui(b,c,0);v(g)}})})}function Ui(b,c,d){c.Da=(new tb(function(){fj(b,c)})).P(d)}
p.Jc=function(b,c){if('video'!==b)return-1;var d=this.b.get('video').va,e=-1;if(d&&0<d.length)if(1==d.length)e=c>=d[0].time?d[0].od:d[0].from;else{for(var f=0;f<d.length;){var g=d[f];if(g.time>=c){e=g.from;break}f++}0>e&&(e=d[d.length-1].od)}return e};function Li(b){null!=b.Da&&(b.Da.stop(),b.Da=null)}function hj(b,c){yb(b.F).then(function(){this.f||(this.a.onError(c),c.handled||this.g.failureCallback(c))}.bind(b))};function tj(b,c,d,e,f,g){if(200<=d&&299>=d&&202!=d)return{ uri:f||e,Zc:e,data:c,headers:b,fromCache:!!b['x-shaka-from-cache'] };f=null;try{f=Ac(c)}catch(h){}throw new C(401==d||403==d?2:1,1,1001,e,d,f,b,g);};function uj(b,c,d,e){var f=new uj.b;kc(c.headers).forEach(function(b,c){f.append(c,b)});var g=new uj.a,h={ ud:!1,ie:!1 };b=uj.j(b,d,{ body:c.body||void 0,headers:f,method:c.method,signal:g.signal,credentials:c.allowCrossSiteCredentials?'include':void 0 },h,e);b=new H(b,function(){h.ud=!0;g.abort();return Promise.resolve()});if(c=c.retryParameters.timeout){var k=new A(function(){h.ie=!0;g.abort()});k.P(c/1E3);b['finally'](function(){k.stop()})}return b}z('shaka.net.HttpFetchPlugin',uj);
uj.j=function(b,c,d,e,f){return t(function h(){var k,l,m,n,q,x,w,B,D,E,F,V,Y,wa;return y(h,function(h){switch(h.l){case 1:return k=uj.g,l=uj.c,x=q=0,w=Date.now(),ya(h,2),u(h,k(b,d),4);case 4:return m=h.s,B=m.clone().body.getReader(),E=(D=m.headers.get('Content-Length'))?parseInt(D,10):0,F=function(b){function c(){return t(function ka(){var d,e;return y(ka,function(h){switch(h.l){case 1:return ya(h,2),u(h,B.read(),4);case 4:d=h.s;Aa(h,3);break;case 2:return Da(h),h['return']();case 3:d.done||(q+=d.value.byteLength);
e=Date.now();if(100<e-w||d.done)f(e-w,q-x,E-q),x=q,w=e;d.done?b.close():(b.enqueue(d.value),c());v(h)}})})}c()},new l({ start:F }),u(h,m.arrayBuffer(),5);case 5:n=h.s;Aa(h,3);break;case 2:V=Da(h);if(e.ud)throw new C(1,1,7001,b,c);if(e.ie)throw new C(1,1,1003,b,c);throw new C(1,1,1002,b,V,c);case 3:return Y={},wa=m.headers,wa.forEach(function(b,c){Y[c.trim()]=b}),h['return'](tj(Y,n,m.status,b,m.url,c))}})})};
uj.isSupported=function(){if(window.ReadableStream)try{new ReadableStream({})}catch(b){return!1}else return!1;return!(!window.fetch||!window.AbortController)};uj.isSupported=uj.isSupported;uj.g=window.fetch;uj.a=window.AbortController;uj.c=window.ReadableStream;uj.b=window.Headers;uj.isSupported()&&(Sb('http',uj,2),Sb('https',uj,2));function vj(b,c,d,e){var f=new vj.f,g=Date.now(),h=0,k=new Promise(function(k,m){f.open(c.method,b,!0);f.responseType='arraybuffer';f.timeout=c.retryParameters.timeout;f.withCredentials=c.allowCrossSiteCredentials;f.onabort=function(){m(new C(1,1,7001,b,d))};f.onload=function(c){c=c.target;var e=c.getAllResponseHeaders().trim().split('\r\n'),f={};e=r(e);for(var g=e.next();!g.done;g=e.next())g=g.value.split(': '),f[g[0].toLowerCase()]=g.slice(1).join(': ');try{var h=tj(f,c.response,c.status,b,c.responseURL,
d);k(h)}catch(E){m(E)}};f.onerror=function(c){m(new C(1,1,1002,b,c,d))};f.ontimeout=function(){m(new C(1,1,1003,b,d))};f.onprogress=function(b){var c=Date.now();if(100<c-g||b.lengthComputable&&b.loaded==b.total)e(c-g,b.loaded-h,b.total-b.loaded),h=b.loaded,g=c};for(var l in c.headers)f.setRequestHeader(l.toLowerCase(),c.headers[l]);f.send(c.body)});return new H(k,function(){f.abort();return Promise.resolve()})}z('shaka.net.HttpXHRPlugin',vj);vj.f=window.XMLHttpRequest;Sb('http',vj,1);
Sb('https',vj,1);function wj(){this.a=this.f=this.b=0;this.c=new Map;this.g=0}function xj(b,c){b.b+=c;var d=b.g;b.g++;b.c.set(d,c);return d}wj.prototype.close=function(b,c){if(this.c.has(b)){var d=this.c.get(b);this.c['delete'](b);this.f+=d;this.a+=c}};function yj(b,c){this.g=b;this.b=new Map;this.c=!1;this.f=c;this.a=new wj}yj.prototype.destroy=function(){this.c=!0;return Promise.all(this.b.values()).then(function(){},function(){})};
function zj(b,c,d,e,f){var g=xj(b.a,e);e=b.b.get(c)||Promise.resolve();b.b.set(c,e.then(function(){return t(function k(){var c;return y(k,function(e){switch(e.l){case 1:return u(e,Aj(b,d),2);case 2:c=e.s;if(b.c)throw new C(2,9,7001);b.a.close(g,c.byteLength);var k=b.a;b.f(0==k.b?0:k.f/k.b,b.a.a);return e['return'](f(c))}})})}))}function Bj(b){return t(function d(){return y(d,function(d){switch(d.l){case 1:return u(d,Promise.all(b.b.values()),2);case 2:return d['return'](b.a.a)}})})}
function Aj(b,c){return t(function e(){var f,g;return y(e,function(e){switch(e.l){case 1:return f=b.g.request(1,c),u(e,f.promise,2);case 2:return g=e.s,e['return'](g.data)}})})};function Cj(b,c){var d=this;this.c=b;this.b=b.objectStore(c);this.a=new G;b.onabort=function(b){b.preventDefault();d.a.reject()};b.onerror=function(b){b.preventDefault();d.a.reject()};b.oncomplete=function(){d.a.resolve()}}Cj.prototype.abort=function(){try{this.c.abort()}catch(b){}return this.a['catch'](function(){})};
function Dj(b,c){return new Promise(function(d,e){var f=b.b.openCursor();f.onerror=e;f.onsuccess=function(b){b=b.target.result;if(!b)return d();c(b.key,b.value,b);b['continue']()}})}Cj.prototype.store=function(){return this.b};Cj.prototype.promise=function(){return this.a};function Ej(b){this.b=b;this.a=[]}Ej.prototype.destroy=function(){return Promise.all(this.a.map(function(b){return b.abort()}))};function Fj(b,c){return Gj(b,c,'readonly')}function Hj(b,c){return Gj(b,c,'readwrite')}function Gj(b,c,d){d=b.b.transaction([c],d);var e=new Cj(d,c);b.a.push(e);e.promise().then(function(){Lb(b.a,e)},function(){Lb(b.a,e)});return e};function Ij(b){this.a=new Ej(b)}Ij.prototype.destroy=function(){return this.a.destroy()};Ij.prototype.getAll=function(){var b=this;return t(function d(){var e,f;return y(d,function(d){switch(d.l){case 1:return e=Fj(b.a,'session-ids'),f=[],u(d,Dj(e,function(b,d){f.push(d)}),2);case 2:return u(d,e.promise(),3);case 3:return d['return'](f)}})})};Ij.prototype.add=function(b){var c=Hj(this.a,'session-ids'),d=c.store();b=r(b);for(var e=b.next();!e.done;e=b.next())d.add(e.value);return c.promise()};
Ij.prototype.remove=function(b){var c=this;return t(function e(){var f;return y(e,function(e){switch(e.l){case 1:return f=Hj(c.a,'session-ids'),u(e,Dj(f,function(c,e,f){0<=b.indexOf(e.sessionId)&&f['delete']()}),2);case 2:return u(e,f.promise(),0)}})})};function Jj(){this.a=new Map}Jj.prototype.destroy=function(){for(var b=[],c=r(this.a.values()),d=c.next();!d.done;d=c.next())b.push(d.value.destroy());this.a.clear();return Promise.all(b)};Jj.prototype.init=function(){var b=this;Kj.forEach(function(c,d){var e=c();e&&b.a.set(d,e)});for(var c=[],d=r(this.a.values()),e=d.next();!e.done;e=d.next())c.push(e.value.init());return Promise.all(c)};
function Lj(b){var c=null;b.a.forEach(function(b,e){b.getCells().forEach(function(b,d){b.hasFixedKeySpace()||c||(c={ path:{ sa:e,$:d },$:b })})});if(c)return c;throw new C(2,9,9013,'Could not find a cell that supports add-operations');}function Mj(b,c){b.a.forEach(function(b,e){b.getCells().forEach(function(b,d){c({ sa:e,$:d },b)})})}
function Nj(b,c,d){b=b.a.get(c);if(!b)throw new C(2,9,9013,'Could not find mechanism with name '+c);c=b.getCells().get(d);if(!c)throw new C(2,9,9013,'Could not find cell with name '+d);return c}function Oj(b,c){b.a.forEach(function(b){c(b.getEmeSessionCell())})}function Pj(b){var c=Array.from(b.a.keys());if(!c.length)throw new C(2,9,9E3,'No supported storage mechanisms found');return b.a.get(c[0]).getEmeSessionCell()}
Jj.prototype.erase=function(){var b=this;return t(function d(){var e,f,g;return y(d,function(d){switch(d.l){case 1:return e=Array.from(b.a.values()),f=0<e.length,f||(g=Kj,g.forEach(function(b){(b=b())&&e.push(b)})),u(d,Promise.all(e.map(function(b){return b.erase()})),2);case 2:if(f)d.A(0);else return u(d,Promise.all(e.map(function(b){return b.destroy()})),0)}})})};function Qj(b,c){Kj.set(b,c)}z('shaka.offline.StorageMuxer.register',Qj);z('shaka.offline.StorageMuxer.unregister',function(b){Kj['delete'](b)});
var Kj=new Map;function Rj(b){this.a=new Ej(b)}p=Rj.prototype;p.destroy=function(){return this.a.destroy()};p.hasFixedKeySpace=function(){return!0};p.addSegments=function(){return Sj('segment')};p.removeSegments=function(b,c){return Tj(this,'segment',b,c)};p.getSegments=function(b){return Uj(this,'segment',b).then(function(b){return b.map(Vj)})};p.addManifests=function(){return Sj('manifest')};
p.updateManifestExpiration=function(b,c){var d=Hj(this.a,'manifest'),e=d.store(),f=new G;e.get(b).onsuccess=function(d){(d=d.target.result)?(d.expiration=c,e.put(d),f.resolve()):f.reject(new C(2,9,9012,'Could not find values for '+b))};return d.promise().then(function(){return f})};p.removeManifests=function(b,c){return Tj(this,'manifest',b,c)};p.getManifests=function(b){return Uj(this,'manifest',b).then(function(b){return b.map(Wj)})};
p.getAllManifests=function(){var b=this;return t(function d(){var e,f;return y(d,function(d){switch(d.l){case 1:return e=Fj(b.a,'manifest'),f=new Map,u(d,Dj(e,function(b,d){f.set(b,Wj(d))}),2);case 2:return u(d,e.promise(),3);case 3:return d['return'](f)}})})};function Sj(b){return Promise.reject(new C(2,9,9011,'Cannot add new value to '+b))}function Tj(b,c,d,e){b=Hj(b.a,c);var f=b.store();d.forEach(function(b){f['delete'](b).onsuccess=function(){return e(b)}});return b.promise()}
function Uj(b,c,d){b=Fj(b.a,c);var e=b.store(),f={},g=[];d.forEach(function(b){e.get(b).onsuccess=function(c){c=c.target.result;void 0==c&&g.push(b);f[b]=c}});return b.promise().then(function(){return g.length?Promise.reject(new C(2,9,9012,'Could not find values for '+g)):d.map(function(b){return f[b]})})}
function Wj(b){return{ originalManifestUri:b.originalManifestUri,duration:b.duration,size:b.size,expiration:null==b.expiration?Infinity:b.expiration,periods:b.periods.map(Xj),sessionIds:b.sessionIds,drmInfo:b.drmInfo,appMetadata:b.appMetadata }}function Xj(b){Yj(b);b.streams.forEach(function(){});return{ startTime:b.startTime,streams:b.streams.map(Zj) }}
function Zj(b){var c=b.bf?ak(b.bf):null;return{ id:b.id,originalId:null,primary:b.primary,presentationTimeOffset:b.presentationTimeOffset,contentType:b.contentType,mimeType:b.mimeType,codecs:b.codecs,frameRate:b.frameRate,kind:b.kind,language:b.language,label:b.label,width:b.width,height:b.height,initSegmentKey:c,encrypted:b.encrypted,keyId:b.keyId,segments:b.segments.map(bk),variantIds:b.variantIds }}function bk(b){var c=ak(b.uri);return{ startTime:b.startTime,endTime:b.endTime,dataKey:c }}
function Vj(b){return{ data:b.data }}function ak(b){var c;if((c=/^offline:[0-9]+\/[0-9]+\/([0-9]+)$/.exec(b))||(c=/^offline:segment\/([0-9]+)$/.exec(b)))return Number(c[1]);throw new C(2,9,9004,'Could not parse uri '+b);}
function Yj(b){var c=b.streams.filter(function(b){return'audio'==b.contentType}),d=b.streams.filter(function(b){return'video'==b.contentType});if(!c.every(function(b){return b.variantIds})||!d.every(function(b){return b.variantIds})){c.forEach(function(b){b.variantIds=[]});d.forEach(function(b){b.variantIds=[]});var e=0;if(d.length&&!c.length){var f=e++;d.forEach(function(b){b.variantIds.push(f)})}if(!d.length&&c.length){var g=e++;c.forEach(function(b){b.variantIds.push(g)})}d.length&&c.length&&c.forEach(function(b){d.forEach(function(c){var d=
e++;b.variantIds.push(d);c.variantIds.push(d)})})}};function ck(b,c,d,e){this.a=new Ej(b);this.c=c;this.b=d;this.f=e}p=ck.prototype;p.destroy=function(){return this.a.destroy()};p.hasFixedKeySpace=function(){return this.f};p.addSegments=function(b){return dk(this,this.c,b)};p.removeSegments=function(b,c){return ek(this,this.c,b,c)};p.getSegments=function(b){return fk(this,this.c,b)};p.addManifests=function(b){return dk(this,this.b,b)};
p.updateManifestExpiration=function(b,c){var d=Hj(this.a,this.b),e=d.store();e.get(b).onsuccess=function(d){if(d=d.target.result)d.expiration=c,e.put(d,b)};return d.promise()};p.removeManifests=function(b,c){return ek(this,this.b,b,c)};p.getManifests=function(b){return fk(this,this.b,b)};
p.getAllManifests=function(){var b=this;return t(function d(){var e,f;return y(d,function(d){switch(d.l){case 1:return e=Fj(b.a,b.b),f=new Map,u(d,Dj(e,function(b,d){f.set(b,d)}),2);case 2:return u(d,e.promise(),3);case 3:return d['return'](f)}})})};
function dk(b,c,d){if(b.f)return Promise.reject(new C(1,9,9011,'Cannot add new value to '+c));b=Hj(b.a,c);var e=b.store(),f=[];d.forEach(function(b){e.add(b).onsuccess=function(b){f.push(b.target.result)}});return b.promise().then(function(){return f})}function ek(b,c,d,e){b=Hj(b.a,c);var f=b.store();d.forEach(function(b){f['delete'](b).onsuccess=function(){return e(b)}});return b.promise()}
function fk(b,c,d){b=Fj(b.a,c);var e=b.store(),f={},g=[];d.forEach(function(b){var c=e.get(b);c.onsuccess=function(){void 0==c.result&&g.push(b);f[b]=c.result}});return b.promise().then(function(){return g.length?Promise.reject(new C(1,9,9012,'Could not find values for '+g)):d.map(function(b){return f[b]})})};function gk(){this.g=this.c=this.b=this.a=this.f=null}p=gk.prototype;
p.init=function(){var b=this,c=new G,d=window.indexedDB.open('shaka_offline_db',4);d.onsuccess=function(d){d=d.target.result;b.f=d;var e=d.objectStoreNames;e=e.contains('manifest')&&e.contains('segment')?new Rj(d):null;b.a=e;e=d.objectStoreNames;e=e.contains('manifest-v2')&&e.contains('segment-v2')?new ck(d,'segment-v2','manifest-v2',!0):null;b.b=e;e=d.objectStoreNames;e=e.contains('manifest-v3')&&e.contains('segment-v3')?new ck(d,'segment-v3','manifest-v3',!1):null;b.c=e;d=d.objectStoreNames.contains('session-ids')?
new Ij(d):null;b.g=d;c.resolve()};d.onupgradeneeded=function(b){b=b.target.result;for(var c=r(['segment-v3','manifest-v3','session-ids']),d=c.next();!d.done;d=c.next())d=d.value,b.objectStoreNames.contains(d)||b.createObjectStore(d,{ autoIncrement:!0 })};d.onerror=function(b){c.reject(new C(2,9,9001,d.error));b.preventDefault()};return c};
p.destroy=function(){var b=this;return t(function d(){return y(d,function(d){switch(d.l){case 1:if(!b.a){d.A(2);break}return u(d,b.a.destroy(),2);case 2:if(!b.b){d.A(4);break}return u(d,b.b.destroy(),4);case 4:if(!b.c){d.A(6);break}return u(d,b.c.destroy(),6);case 6:if(!b.g){d.A(8);break}return u(d,b.g.destroy(),8);case 8:b.f&&b.f.close(),v(d)}})})};p.getCells=function(){var b=new Map;this.a&&b.set('v1',this.a);this.b&&b.set('v2',this.b);this.c&&b.set('v3',this.c);return b};p.getEmeSessionCell=function(){return this.g};
p.erase=function(){var b=this;return t(function d(){return y(d,function(d){switch(d.l){case 1:if(!b.a){d.A(2);break}return u(d,b.a.destroy(),2);case 2:if(!b.b){d.A(4);break}return u(d,b.b.destroy(),4);case 4:if(!b.c){d.A(6);break}return u(d,b.c.destroy(),6);case 6:return b.f&&b.f.close(),u(d,hk(),8);case 8:return b.f=null,b.a=null,b.b=null,b.c=null,u(d,b.init(),0)}})})};
function hk(){var b=new G,c=window.indexedDB.deleteDatabase('shaka_offline_db');c.onblocked=function(){};c.onsuccess=function(){b.resolve()};c.onerror=function(d){b.reject(new C(2,9,9001,c.error));d.preventDefault()};return b}Qj('idb',function(){return window.indexedDB?new gk:null});function ik(b,c,d,e){this.a=b;this.g=c;this.f=d;this.c=e;this.b=['offline:',b,'/',c,'/',d,'/',e].join('')}ik.prototype.sa=function(){return this.g};ik.prototype.$=function(){return this.f};ik.prototype.key=function(){return this.c};ik.prototype.toString=function(){return this.b};
function jk(b){b=/^offline:([a-z]+)\/([^/]+)\/([^/]+)\/([0-9]+)$/.exec(b);if(null==b)return null;var c=b[1];if('manifest'!=c&&'segment'!=c)return null;var d=b[2];if(!d)return null;var e=b[3];return e&&null!=c?new ik(c,d,e,Number(b[4])):null};function kk(b,c){this.b=b;this.a=c}function lk(b,c){var d=new U(null,0);d.ua(c.duration);var e=c.periods.map(function(c){return mk(b,c,d)}),f=c.drmInfo?[c.drmInfo]:[];c.drmInfo&&e.forEach(function(b){b.variants.forEach(function(b){b.drmInfos=f})});return{ presentationTimeline:d,minBufferTime:2,offlineSessionIds:c.sessionIds,periods:e,wasDynamic:!1 }}
function mk(b,c,d){var e=c.streams.filter(function(b){return'audio'==b.contentType}),f=c.streams.filter(function(b){return'video'==b.contentType});e=nk(b,e,f);f=c.streams.filter(function(b){return'text'==b.contentType}).map(function(c){return ok(b,c)});c.streams.forEach(function(e){e=e.segments.map(function(c,d){return pk(b,d,c)});d.pb(e,c.startTime)});return{ startTime:c.startTime,variants:Array.from(e.values()),textStreams:f }}
function nk(b,c,d){for(var e=new Set,f=r(c),g=f.next();!g.done;g=f.next()){var h=r(g.value.variantIds);for(g=h.next();!g.done;g=h.next())e.add(g.value)}f=r(d);for(g=f.next();!g.done;g=f.next())for(h=r(g.value.variantIds),g=h.next();!g.done;g=h.next())e.add(g.value);f=new Map;e=r(e);for(g=e.next();!g.done;g=e.next())g=g.value,f.set(g,{ id:g,language:'',primary:!1,audio:null,video:null,bandwidth:0,drmInfos:[],allowedByApplication:!0,allowedByKeySystem:!0 });c=r(c);for(e=c.next();!e.done;e=c.next())for(e=
e.value,g=ok(b,e),h=r(e.variantIds),e=h.next();!e.done;e=h.next())e=f.get(e.value),e.language=g.language,e.primary=e.primary||g.primary,e.audio=g;d=r(d);for(c=d.next();!c.done;c=d.next())for(e=c.value,c=ok(b,e),g=r(e.variantIds),e=g.next();!e.done;e=g.next())e=f.get(e.value),e.primary=e.primary||c.primary,e.video=c;return f}
function ok(b,c){var d=c.segments.map(function(c,d){return pk(b,d,c)}),e=new S(d);d={ id:c.id,originalId:c.originalId,createSegmentIndex:function(){return Promise.resolve()},findSegmentPosition:function(b){return e.find(b)},getSegmentReference:function(b){return e.get(b)},initSegmentReference:null,presentationTimeOffset:c.presentationTimeOffset,mimeType:c.mimeType,codecs:c.codecs,width:c.width||void 0,height:c.height||void 0,frameRate:c.frameRate||void 0,kind:c.kind,encrypted:c.encrypted,keyId:c.keyId,
language:c.language,label:c.label||null,type:c.contentType,primary:c.primary,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],channelsCount:null,closedCaptions:null };null!=c.initSegmentKey&&(d.initSegmentReference=qk(b,c.initSegmentKey));return d}function pk(b,c,d){var e=new ik('segment',b.b,b.a,d.dataKey);return new P(c,d.startTime,d.endTime,function(){return[e.toString()]},0,null)}function qk(b,c){var d=new ik('segment',b.b,b.a,c);return new Nf(function(){return[d.toString()]},0,null)};function rk(){this.a=null}p=rk.prototype;p.configure=function(){};
p.start=function(b){var c=this;return t(function e(){var f,g,h,k,l,m;return y(e,function(e){switch(e.l){case 1:f=jk(b);c.a=f;if(null==f||'manifest'!=f.a)return e['return'](Promise.reject(new C(2,1,9004,f)));g=new Jj;za(e,2);return u(e,g.init(),4);case 4:return u(e,Nj(g,f.sa(),f.$()),5);case 5:return h=e.s,u(e,h.getManifests([f.key()]),6);case 6:return k=e.s,l=k[0],m=new kk(f.sa(),f.$()),e['return'](lk(m,l));case 2:return Ea(e),u(e,g.destroy(),7);case 7:Fa(e,0)}})})};p.stop=function(){return Promise.resolve()};
p.update=function(){};
p.onExpirationUpdated=function(b,c){var d=this;return t(function f(){var g,h,k,l,m,n,q;return y(f,function(f){switch(f.l){case 1:return g=d.a,h=new Jj,ya(f,2,3),u(f,h.init(),5);case 5:return u(f,Nj(h,g.sa(),g.$()),6);case 6:return k=f.s,u(f,k.getManifests([g.key()]),7);case 7:l=f.s;m=l[0];n=m.sessionIds.includes(b);q=void 0==m.expiration||m.expiration>c;if(!n||!q){f.A(3);break}return u(f,k.updateManifestExpiration(g.key(),c),3);case 3:return Ea(f),u(f,h.destroy(),10);case 10:Fa(f,0);break;case 2:Da(f),
f.A(3)}})})};T.Lb('application/x-offline-manifest',rk);function sk(b){var c=jk(b);return c&&'manifest'==c.a?sk.h(b):c&&'segment'==c.a?sk.i(c.key(),c):zb(new C(2,1,9004,b))}z('shaka.offline.OfflineScheme',sk);sk.h=function(b){b={ uri:b,Zc:b,data:new ArrayBuffer(0),headers:{ 'content-type':'application/x-offline-manifest' } };return Bb(b)};sk.i=function(b,c){var d=new Jj;return Bb(void 0).T(function(){return d.init()}).T(function(){return Nj(d,c.sa(),c.$())}).T(function(b){return b.getSegments([c.key()])}).T(function(b){return{ uri:c,Zc:c,data:b[0].data,headers:{} }})['finally'](function(){return d.destroy()})};
Sb('offline',sk);function tk(b,c,d){return t(function f(){var g,h,k,l,m,n;return y(f,function(f){switch(f.l){case 1:g=[];for(var q=[],w=r(d),B=w.next();!B.done;B=w.next()){B=B.value;for(var D=!1,E=r(q),F=E.next();!F.done;F=E.next())if(F=F.value,uk(F.info,B)){F.sessionIds.push(B.sessionId);D=!0;break}D||q.push({ info:B,sessionIds:[B.sessionId] })}h=r(q);k=h.next();case 2:if(k.done){f.A(4);break}l=k.value;m=vk(b,c,l);return u(f,m,5);case 5:n=f.s;g=g.concat(n);k=h.next();f.A(2);break;case 4:return f['return'](g)}})})}
function vk(b,c,d){return t(function f(){var g,h;return y(f,function(f){switch(f.l){case 1:return g=new Jc({ ob:c,onError:function(){},hc:function(){},onExpirationUpdated:function(){},onEvent:function(){} }),ya(f,2),g.configure(b),u(f,Rc(g,d.info.keySystem,d.info.licenseUri,d.info.serverCertificate,d.info.audioCapabilities,d.info.videoCapabilities),4);case 4:Aa(f,3);break;case 2:return Da(f),u(f,g.destroy(),5);case 5:return f['return']([]);case 3:return ya(f,6),u(f,Yc(g),8);case 8:Aa(f,7);break;case 6:return Da(f),
u(f,g.destroy(),9);case 9:return f['return']([]);case 7:return h=[],u(f,Promise.all(d.sessionIds.map(function(b){return t(function n(){return y(n,function(c){switch(c.l){case 1:return ya(c,2),u(c,ad(g,b),4);case 4:h.push(b);Aa(c,0);break;case 2:Da(c),v(c)}})})})),10);case 10:return u(f,g.destroy(),11);case 11:return f['return'](h)}})})}
function uk(b,c){function d(b,c){return b.robustness==c.robustness&&b.contentType==c.contentType}return b.keySystem==c.keySystem&&b.licenseUri==c.licenseUri&&Nb(b.audioCapabilities,c.audioCapabilities,d)&&Nb(b.videoCapabilities,c.videoCapabilities,d)};function wk(b,c){var d=xk(),e=this;this.g=c;this.c=b;this.i=d;this.h=null;this.f=[];this.b=this.a=null;this.j=!0;this.m=Promise.resolve().then(function(){return yk(e)})}wk.prototype.destroy=function(){var b=this;return t(function d(){var e;return y(d,function(d){switch(d.l){case 1:return b.j=!1,b.b&&b.b.abort(),zk(b),u(d,b.m,2);case 2:b.a&&b.a.ra.Ya();for(var f=r(b.f),h=f.next();!h.done;h=f.next())e=h.value,e.ra.Ya();b.a=null;b.f=[];b.g=null;v(d)}})})};
function Ak(b,c){var d={ qb:function(){},gc:function(){},Ya:function(){},onError:function(){},ic:function(){},zg:function(){} };b.f.push({ create:c,ra:d });b.b&&b.b.abort();zk(b);return d}
function yk(b){return t(function d(){return y(d,function(d){switch(d.l){case 1:if(b.j){if(0==b.f.length||b.a&&!b.a.Va)var e=!1;else{b.a&&(b.a.ra.Ya(),b.a=null);e=b.f.shift();var g=e.create(b.i);g?(e.ra.qb(),b.a={ node:g.node,payload:g.payload,Va:g.Va,ra:e.ra }):e.ra.ic();e=!0}e?e=Promise.resolve():b.a?e=Bk(b):(b.g.hf(b.c),b.h=new G,e=b.h);return u(d,e,1)}d.A(0)}})})}
function Bk(b){return t(function d(){var e,f;return y(d,function(d){switch(d.l){case 1:return b.c=b.g.Re(b.c,b.i,b.a.node,b.a.payload),ya(d,2),b.b=b.g.Ae(b.c,b.i,b.a.payload),u(d,b.b.promise,4);case 4:b.b=null;b.c==b.a.node&&(b.a.ra.gc(),b.a=null);Aa(d,0);break;case 2:e=Da(d);if(7001==e.code)b.a.ra.Ya();else b.a.ra.onError(e);b.a=null;b.b=null;f=b;return u(d,b.g.handleError(b.i,e),5);case 5:f.c=d.s,v(d)}})})}function zk(b){b.h&&(b.h.resolve(),b.h=null)};function W(b){this.a=null;for(var c=0;c<b.textTracks.length;++c){var d=b.textTracks[c];d.mode='disabled';'Shaka Player TextTrack'==d.label&&(this.a=d)}this.a||(this.a=b.addTextTrack('subtitles','Shaka Player TextTrack'));this.a.mode='hidden'}z('shaka.text.SimpleTextDisplayer',W);W.prototype.remove=function(b,c){if(!this.a)return!1;Ck(this.a,function(d){return d.startTime<c&&d.endTime>b});return!0};W.prototype.remove=W.prototype.remove;
W.prototype.append=function(b){for(var c=Dk,d=[],e=0;e<b.length;e++){var f=c(b[e]);f&&d.push(f)}d.slice().sort(function(b,c){return b.startTime!=c.startTime?b.startTime-c.startTime:b.endTime!=c.endTime?b.endTime-c.startTime:d.indexOf(c)-d.indexOf(b)}).forEach(function(b){this.a.addCue(b)}.bind(this))};W.prototype.append=W.prototype.append;W.prototype.destroy=function(){this.a&&Ck(this.a,function(){return!0});this.a=null;return Promise.resolve()};W.prototype.destroy=W.prototype.destroy;
W.prototype.isTextVisible=function(){return'showing'==this.a.mode};W.prototype.isTextVisible=W.prototype.isTextVisible;W.prototype.setTextVisibility=function(){this.a.mode='hidden'};W.prototype.setTextVisibility=W.prototype.setTextVisibility;W.prototype.getTextTrack=function(){return this.a};W.prototype.getTextTrack=W.prototype.getTextTrack;
function Dk(b){if(b.startTime>=b.endTime)return null;var c=new VTTCue(b.startTime,b.endTime,b.payload);c.lineAlign=b.lineAlign;c.positionAlign=b.positionAlign;c.size=b.size;try{c.align=b.textAlign}catch(d){}'center'==b.textAlign&&'center'!=c.align&&(c.align='middle');'vertical-lr'==b.writingMode?c.vertical='lr':'vertical-rl'==b.writingMode&&(c.vertical='rl');1==b.lineInterpretation&&(c.snapToLines=!1);null!=b.line&&(c.line=b.line);null!=b.position&&(c.position=b.position);null!=b.backgroundImage&&
(c.backgroundImage=b.backgroundImage);return c}function Ck(b,c){var d=b.mode;b.mode='showing'==d?'showing':'hidden';for(var e=b.cues,f=e.length-1;0<=f;f--){var g=e[f];g&&c(g)&&b.removeCue(g)}b.mode=d};function Ek(b,c,d,e,f){var g=f in e,h=!0,k;for(k in c){var l=f+'.'+k,m=g?e[f]:d[k];g||k in d?void 0===c[k]?void 0===m||g?delete b[k]:b[k]=Jb(m):m.constructor==Object&&c[k]&&c[k].constructor==Object?(b[k]||(b[k]=Jb(m)),l=Ek(b[k],c[k],m,e,l),h=h&&l):typeof c[k]!=typeof m||null==c[k]||c[k].constructor!=m.constructor?h=!1:b[k]=c[k]:h=!1}return h}z('shaka.util.ConfigUtils.mergeConfigObjects',Ek);
function Fk(b,c){for(var d={},e=d,f=0,g=0;;){f=b.indexOf('.',f);if(0>f)break;if(0==f||'\\'!=b[f-1])g=b.substring(g,f).replace(/\\\./g,'.'),e[g]={},e=e[g],g=f+1;f+=1}e[b.substring(g).replace(/\\\./g,'.')]=c;return d}z('shaka.util.ConfigUtils.convertToConfigObject',Fk);function Gk(){}z('shaka.util.PlayerConfiguration',Gk);
function Hk(){var b=5E5,c=Infinity;navigator.connection&&(b=1E6*navigator.connection.downlink,navigator.connection.saveData&&(c=360));var d={ retryParameters:vb(),servers:{},clearKeys:{},advanced:{},delayLicenseRequestUntilPlayed:!1 },e={ retryParameters:vb(),availabilityWindowOverride:NaN,dash:{ customScheme:function(b){if(b)return null},clockSyncUri:'',ignoreDrmInfo:!1,xlinkFailGracefully:!1,defaultPresentationDelay:10,ignoreMinBufferTime:!1,autoCorrectDrift:!0 } },f={ retryParameters:vb(),failureCallback:function(){},
rebufferingGoal:2,bufferingGoal:10,bufferBehind:30,ignoreTextStreamFailures:!1,alwaysStreamText:!1,startAtSegmentBoundary:!1,smallGapLimit:.5,jumpLargeGaps:!1,durationBackoff:1,forceTransmuxTS:!1,safeSeekOffset:5,stallEnabled:!0,stallThreshold:1,stallSkip:.1 };tc('Web0S')&&(f.stallEnabled=!1);var g={ trackSelectionCallback:function(b){return b},progressCallback:function(){},usePersistentLicense:!0 },h={ drm:d,manifest:e,streaming:f,offline:g,abrFactory:M,abr:{ enabled:!0,defaultBandwidthEstimate:b,switchInterval:8,
bandwidthUpgradeTarget:.85,bandwidthDowngradeTarget:.95,restrictions:{ minWidth:0,maxWidth:Infinity,minHeight:0,maxHeight:c,minPixels:0,maxPixels:Infinity,minBandwidth:0,maxBandwidth:Infinity } },preferredAudioLanguage:'',preferredTextLanguage:'',preferredVariantRole:'',preferredTextRole:'',preferredAudioChannelCount:2,restrictions:{ minWidth:0,maxWidth:Infinity,minHeight:0,maxHeight:Infinity,minPixels:0,maxPixels:Infinity,minBandwidth:0,maxBandwidth:Infinity },playRangeStart:0,playRangeEnd:Infinity,textDisplayFactory:function(){return null} };
g.trackSelectionCallback=function(b){return Ik(b,h.preferredAudioLanguage)};return h}function Jk(b,c,d){var e={ '.drm.servers':'','.drm.clearKeys':'','.drm.advanced':{ distinctiveIdentifierRequired:!1,persistentStateRequired:!1,videoRobustness:'',audioRobustness:'',serverCertificate:new Uint8Array(0),individualizationServer:'' } };return Ek(b,c,d||Hk(),e,'')}Gk.mergeConfigObjects=Jk;
function Ik(b,c){var d=b.filter(function(b){return'variant'==b.type}),e=[],f=ve(c,d.map(function(b){return b.language}));f&&(e=d.filter(function(b){return L(b.language)==f}));0==e.length&&(e=d.filter(function(b){return b.primary}));0==e.length&&(d.map(function(b){return b.language}),e=d);var g=e.filter(function(b){return b.height&&480>=b.height});g.length&&(g.sort(function(b,c){return c.height-b.height}),e=g.filter(function(b){return b.height==g[0].height}));d=[];if(e.length){var h=Math.floor(e.length/
2);e.sort(function(b,c){return b.bandwidth-c.bandwidth});d.push(e[h])}e=r(b);for(h=e.next();!h.done;h=e.next())h=h.value,'text'==h.type&&d.push(h);return d};function Kk(){this.a=null;this.b=[]}function Lk(b,c){if(null==b.a)b.a={ timestamp:Date.now()/1E3,state:c,duration:0 };else{var d=Date.now()/1E3;b.a.duration=d-b.a.timestamp;b.a.state!=c&&(b.b.push(b.a),b.a={ timestamp:d,state:c,duration:0 })}}function Mk(b,c){var d=0;b.a&&b.a.state==c&&(d+=b.a.duration);for(var e=r(b.b),f=e.next();!f.done;f=e.next())f=f.value,d+=f.state==c?f.duration:0;return d}
function Nk(b){function c(b){return{ timestamp:b.timestamp,state:b.state,duration:b.duration }}for(var d=[],e=r(b.b),f=e.next();!f.done;f=e.next())d.push(c(f.value));b.a&&d.push(c(b.a));return d};function Ok(){this.b=this.c=null;this.a=[]}function Pk(b,c,d){b.b!=c&&(b.b=c,b.a.push({ timestamp:Date.now()/1E3,id:c.id,type:'text',fromAdaptation:d,bandwidth:null }))};function Qk(){this.f=this.j=this.c=this.h=this.i=this.g=this.m=NaN;this.a=new Kk;this.b=new Ok};function X(b,c){var d=this;Ib.call(this);this.g=Rk;this.a=null;this.eb=!1;this.i=new bc;this.sc=this.j=this.yb=this.f=this.m=this.b=this.Qb=this.W=this.Rb=this.M=this.gb=this.o=this.w=this.h=this.N=null;this.Id=1E9;this.Ub=new Set;this.ib=!0;this.ka=null;this.Ed=!1;this.Cd=0;this.ja=null;this.F=new Nh;this.c=Sk(this);this.Vb={ width:Infinity,height:Infinity };this.u=null;this.Sb=new Wh(this.c.preferredAudioLanguage,this.c.preferredVariantRole,this.c.preferredAudioChannelCount);this.Ma=this.c.preferredTextLanguage;
this.zb=this.c.preferredTextRole;c&&c(this);this.N=Tk(this);K(this.i,window,'online',function(){d.ed()});this.C={ name:'detach' };this.S={ name:'attach' };this.Ea={ name:'unload' };this.Bc={ name:'manifest-parser' };this.zc={ name:'manifest' };this.fb={ name:'media-source' };this.tc={ name:'drm-engine' };this.X={ name:'load' };this.Ec={ name:'src-equals-drm-engine' };this.hb={ name:'src-equals' };var e=new Map;e.set(this.S,function(b,c){return Cb(Uk(d,b,c))});e.set(this.C,function(b){b.v&&(d.i.ma(b.v,'error'),b.v=null);
d.a=null;b=Promise.resolve();return Cb(b)});e.set(this.Ea,function(b){return Cb(Vk(d,b))});e.set(this.fb,function(b){b=Wk(d,b);return Cb(b)});e.set(this.Bc,function(b,c){var e=Xk(d,b,c);return Cb(e)});e.set(this.zc,function(b){return Yk(d,b)});e.set(this.tc,function(){var b=Zk(d);return Cb(b)});e.set(this.X,function(b,c){return Cb($k(d,b,c))});e.set(this.Ec,function(b){b=al(d,b);return Cb(b)});e.set(this.hb,function(b,c){return bl(d,b,c)});this.jb=new wk(this.C,{ Re:function(b,c,e,k){var f=null;b==
d.C&&(f=e==d.C?d.C:d.S);b==d.S&&(f=e==d.C||c.v!=k.v?d.C:e==d.S?d.S:e==d.fb||e==d.X?d.fb:e==d.hb?d.Ec:null);b==d.fb&&(f=e==d.X&&c.v==k.v?d.Bc:d.Ea);b==d.Bc&&(f=cl(d.X,d.zc,d.Ea,e,c,k));b==d.zc&&(f=cl(d.X,d.tc,d.Ea,e,c,k));b==d.tc&&(f=cl(d.X,d.X,d.Ea,e,c,k));b==d.Ec&&(f=e==d.hb&&c.v==k.v?d.hb:d.Ea);if(b==d.X||b==d.hb)f=d.Ea;b==d.Ea&&(f=k.v&&c.v==k.v?d.S:d.C);return f},Ae:function(b,c,h){d.dispatchEvent(new I('onstatechange',{ state:b.name }));return e.get(b)(c,h)},handleError:function(b){return t(function h(){return y(h,
function(c){switch(c.l){case 1:return u(c,Vk(d,b),2);case 2:return c['return'](b.v?d.S:d.C)}})})},hf:function(b){d.dispatchEvent(new I('onstateidle',{ state:b.name }))} });b&&this.Ab(b,!0)}Ra(X,Ib);z('shaka.Player',X);
X.prototype.destroy=function(){var b=this;return t(function d(){var e;return y(d,function(d){switch(d.l){case 1:if(b.g==dl)return d['return']();b.g=dl;e=Ak(b.jb,function(){return{ node:b.C,payload:xk(),Va:!1 }});return u(d,new Promise(function(b){e.qb=function(){};e.gc=function(){b()};e.Ya=function(){b()};e.onError=function(){b()};e.ic=function(){b()}}),2);case 2:return u(d,b.jb.destroy(),3);case 3:b.i&&(b.i.a(),b.i=null);b.sc=null;b.j=null;b.c=null;if(!b.N){d.A(0);break}return u(d,b.N.destroy(),5);
case 5:b.N=null,v(d)}})})};X.prototype.destroy=X.prototype.destroy;X.version='2.5.2-npm-dirty';var el=['','5'];Pe=new function(b){this.a=b;this.c=Qe;this.b=Re}(new Ne(Number(el[0]),Number(el[1])));var fl=['output-restricted','internal-error'],gl={};X.registerSupportPlugin=function(b,c){gl[b]=c};
X.isBrowserSupported=function(){return window.Promise&&window.Uint8Array&&Array.prototype.forEach&&window.MediaKeys&&window.navigator&&window.navigator.requestMediaKeySystemAccess&&window.MediaKeySystemAccess&&window.MediaKeySystemAccess.prototype.getConfiguration?qc()?!0:rc('application/x-mpegurl'):!1};
X.probeSupport=function(){return md().then(function(b){for(var c=T.Df(),d={},e=r('video/mp4; codecs="avc1.42E01E",video/mp4; codecs="avc3.42E01E",video/mp4; codecs="hev1.1.6.L93.90",video/mp4; codecs="hvc1.1.6.L93.90",video/mp4; codecs="hev1.2.4.L153.B0"; eotf="smpte2084",video/mp4; codecs="hvc1.2.4.L153.B0"; eotf="smpte2084",video/mp4; codecs="vp9",video/mp4; codecs="vp09.00.10.08",audio/mp4; codecs="mp4a.40.2",audio/mp4; codecs="ac-3",audio/mp4; codecs="ec-3",audio/mp4; codecs="opus",audio/mp4; codecs="flac",video/webm; codecs="vp8",video/webm; codecs="vp9",video/webm; codecs="vp09.00.10.08",audio/webm; codecs="vorbis",audio/webm; codecs="opus",video/mp2t; codecs="avc1.42E01E",video/mp2t; codecs="avc3.42E01E",video/mp2t; codecs="hvc1.1.6.L93.90",video/mp2t; codecs="mp4a.40.2",video/mp2t; codecs="ac-3",video/mp2t; codecs="ec-3",text/vtt,application/mp4; codecs="wvtt",application/ttml+xml,application/mp4; codecs="stpp"'.split(',')),f=
e.next();!f.done;f=e.next()){f=f.value;d[f]=qc()?$d(f)?!0:MediaSource.isTypeSupported(f)||Ed(f):rc(f);var g=f.split(';')[0];d[g]=d[g]||d[f]}b={ manifest:c,media:d,drm:b };for(var h in gl)b[h]=gl[h]();return b})};X.prototype.Ab=function(b,c){c=void 0===c?!0:c;if(this.g==dl)return Promise.reject(hl());var d=xk();d.v=b;qc()||(c=!1);var e=c?this.fb:this.S,f=Ak(this.jb,function(){return{ node:e,payload:d,Va:!1 }});f.qb=function(){};return il(f)};X.prototype.attach=X.prototype.Ab;
X.prototype.detach=function(){var b=this;if(this.g==dl)return Promise.reject(hl());var c=Ak(this.jb,function(){return{ node:b.C,payload:xk(),Va:!1 }});c.qb=function(){};return il(c)};X.prototype.detach=X.prototype.detach;X.prototype.qd=function(b){var c=this;b=void 0===b?!0:b;if(this.g==dl)return Promise.reject(hl());qc()||(b=!1);var d=xk(),e=Ak(this.jb,function(e){var f=e.v&&b?c.fb:e.v?c.S:c.C;d.v=e.v;return{ node:f,payload:d,Va:!1 }});e.qb=function(){};return il(e)};X.prototype.unload=X.prototype.qd;
X.prototype.load=function(b,c,d){if(this.g==dl)return Promise.reject(hl());this.dispatchEvent(new I('loading'));var e=xk();e.uri=b;e.md=Date.now()/1E3;d&&'string'!=typeof d&&(Oe('Loading with a manifest parser factory','Please register a manifest parser and for the mime-type.'),e.xa=function(){return new d});d&&'string'==typeof d&&(e.mimeType=d);void 0!==c&&(e.startTime=c);var f=jl(e)?this.hb:this.X,g=Ak(this.jb,function(b){if(null==b.v)return null;e.v=b.v;return{ node:f,payload:e,Va:!0 }});g.qb=function(){};
return new Promise(function(b,c){g.ic=function(){return c(new C(2,7,7002))};g.gc=function(){return b()};g.Ya=function(){return c(hl())};g.onError=function(b){return c(b)}})};X.prototype.load=X.prototype.load;
function jl(b){if(b.xa)return!1;if(!qc())return!0;var c=b.mimeType;b=b.uri||'';c||(c={ mp4:'video/mp4',m4v:'video/mp4',m4a:'audio/mp4',webm:'video/webm',ts:'video/mp2t',m3u8:'application/x-mpegurl',mp3:'audio/mpeg',aac:'audio/aac',flac:'audio/flac' }[T.getExtension(b)]);return c?rc(c)?T.isSupported(b,c)?!!navigator.vendor&&navigator.vendor.includes('Apple'):!0:!1:!1}function Uk(b,c,d){null==c.v&&(c.v=d.v,K(b.i,c.v,'error',function(){var c=kl(b);c&&b.Ja(c)}));b.a=c.v;return Promise.resolve()}
function Vk(b,c){return t(function e(){return y(e,function(e){switch(e.l){case 1:b.g!=dl&&(b.g=Rk);b.dispatchEvent(new I('unloading'));c.xa=null;c.mimeType=null;c.startTime=null;c.uri=null;c.v&&(b.i.ma(c.v,'loadeddata'),b.i.ma(c.v,'playing'),b.i.ma(c.v,'pause'),b.i.ma(c.v,'ended'),b.i.ma(c.v,'ratechange'));b.gb&&(b.gb.a(),b.gb=null);b.Rb&&(b.Rb.stop(),b.Rb=null);if(!b.m){e.A(2);break}return u(e,b.m.stop(),3);case 3:b.m=null;case 2:if(!b.j){e.A(4);break}return u(e,b.j.stop(),4);case 4:if(!b.b){e.A(6);
break}return u(e,b.b.destroy(),7);case 7:b.b=null;case 6:b.o&&(b.o.a(),b.o=null);if(!b.w){e.A(8);break}return u(e,b.w.destroy(),9);case 9:b.w=null;case 8:c.v&&c.v.src&&(c.v.removeAttribute('src'),c.v.load());if(!b.h){e.A(10);break}return u(e,b.h.destroy(),11);case 11:b.h=null;case 10:b.F.a.clear(),b.yb=null,b.W=null,b.Ub.clear(),b.f=null,b.u=null,b.uc=null,b.ib=!0,ll(b),v(e)}})})}
function Wk(b,c){return t(function e(){var f,g,h,k;return y(e,function(e){switch(e.l){case 1:return f=window.muxjs?new qd:new rd,g=b.c.textDisplayFactory,h=new g,b.uc=g,k=new de(c.v,f,h),u(e,k.o,2);case 2:b.w=k,v(e)}})})}
function Xk(b,c,d){return t(function f(){var g,h,k;return y(f,function(f){switch(f.l){case 1:c.xa=d.xa;c.mimeType=d.mimeType;c.uri=d.uri;g=c.uri;h=b.N;b.yb=g;if(c.xa){b.m=c.xa();f.A(2);break}k=b;return u(f,T.create(g,h,b.c.manifest.retryParameters,c.mimeType),3);case 3:k.m=f.s;case 2:b.m.configure(b.c.manifest),v(f)}})})}
function Yk(b,c){var d=c.uri,e=b.N;b.Qb=new Di;Ei(b.Qb,function(c){ml(b,'timelineregionadded',c)});var f={ networkingEngine:e,filterNewPeriod:function(c){return b.Cc(c)},filterAllPeriods:function(c){return nl(b,c)},onTimelineRegionAdded:function(c){var d=b.Qb;a:{var e=r(d.b);for(var f=e.next();!f.done;f=e.next())if(f=f.value,f.schemeIdUri==c.schemeIdUri&&f.startTime==c.startTime&&f.endTime==c.endTime){e=f;break a}e=null}null==e&&(d.b.add(c),d.c(c))},onEvent:function(c){return b.dispatchEvent(c)},onError:function(c){return b.Ja(c)} };
return new H(Promise.resolve().then(function(){return t(function h(){var c;return y(h,function(e){switch(e.l){case 1:return c=b,u(e,b.m.start(d,f),2);case 2:c.f=e.s;b.dispatchEvent(new I('manifestparsed'));if(0==b.f.periods.length)throw new C(2,4,4014);ol(b.f.periods);v(e)}})})}),function(){return b.m.stop()})}
function Zk(b){return t(function d(){return y(d,function(d){switch(d.l){case 1:return b.h=new Jc({ ob:b.N,onError:function(d){b.Ja(d)},hc:function(d){pl(b,d)},onExpirationUpdated:function(d,e){ql(b,d,e)},onEvent:function(d){b.dispatchEvent(d)} }),b.h.configure(b.c.drm),u(d,Qc(b.h,ji(b.f.periods),b.f.offlineSessionIds),2);case 2:nl(b,b.f.periods),v(d)}})})}
function $k(b,c,d){return t(function f(){var g,h,k,l,m,n,q,x,w;return y(f,function(f){switch(f.l){case 1:return c.startTime=d.startTime,g=c.v,h=c.uri,b.yb=h,b.u=new Qk,k=function(){return rl(b)},l=function(){var c=b.a.playbackRate;0!=c&&b.M.set(c)},K(b.i,g,'playing',k),K(b.i,g,'pause',k),K(b.i,g,'ended',k),K(b.i,g,'ratechange',l),m=b.c.abrFactory,b.j&&b.sc==m||(b.sc=m,b.j=new m,b.j.configure(b.c.abr)),sl(b,b.f.periods),b.Sb=new Wh(b.c.preferredAudioLanguage,b.c.preferredVariantRole,b.c.preferredAudioChannelCount),
b.Ma=b.c.preferredTextLanguage,tl(b.f.presentationTimeline,b.c.playRangeStart,b.c.playRangeEnd),u(f,b.h.Ab(g),2);case 2:return b.j.init(function(c,d,f){d=void 0===d?!1:d;f=void 0===f?0:f;a:{var g=r(b.f.periods);for(var h=g.next();!h.done;h=g.next())if(h=h.value,h.variants.includes(c)){g=h;break a}g=null}ul(b,g,c,!0);b.b&&(Xi(b.b,c,d,f),vl(b))}),b.o=wl(b,c.startTime),b.gb=xl(b),b.M=new ni({ dc:function(){return c.v.playbackRate},jd:function(b){c.v.playbackRate=b},Jd:function(b){c.v.currentTime+=b} }),
n=Math.max(b.f.minBufferTime,b.c.streaming.rebufferingGoal),yl(b,n),b.b=zl(b),b.b.configure(b.c.streaming),Al(b),b.g=Bl,b.dispatchEvent(new I('streaming')),u(f,b.b.start(),3);case 3:b.c.streaming.startAtSegmentBoundary&&(q=b.o.i(),x=Cl(b,q),b.o.o(x)),b.f.periods.forEach(b.Cc.bind(b)),Dl(b),vl(b),w=El(b),w.variants.some(function(b){return b.primary}),Fl(b,w.variants),ec(b.i,g,'loadeddata',function(){b.u.c=Date.now()/1E3-d.md}),v(f)}})})}
function al(b,c){return t(function e(){var f,g;return y(e,function(e){switch(e.l){case 1:return f=Bd,b.h=new Jc({ ob:b.N,onError:function(c){b.Ja(c)},hc:function(c){pl(b,c)},onExpirationUpdated:function(c,e){ql(b,c,e)},onEvent:function(c){b.dispatchEvent(c)} }),b.h.configure(b.c.drm),g={ id:0,language:'und',primary:!1,audio:null,video:{ id:0,originalId:null,createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(){return null},getSegmentReference:function(){return null},initSegmentReference:null,
presentationTimeOffset:0,mimeType:'video/mp4',codecs:'',encrypted:!0,keyId:null,language:'und',label:null,type:f.Na,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],channelsCount:null,closedCaptions:null },bandwidth:100,drmInfos:[],allowedByApplication:!0,allowedByKeySystem:!0 },u(e,Qc(b.h,[g],[]),2);case 2:return u(e,b.h.Ab(c.v),0)}})})}
function bl(b,c,d){function e(){return rl(b)}c.uri=d.uri;c.startTime=d.startTime;b.yb=c.uri;b.u=new Qk;b.o=new wi(c.v);null!=c.startTime&&b.o.o(c.startTime);b.M=new ni({ dc:function(){return c.v.playbackRate},jd:function(b){c.v.playbackRate=b},Jd:function(b){c.v.currentTime+=b} });yl(b,b.c.streaming.rebufferingGoal);K(b.i,c.v,'playing',e);K(b.i,c.v,'pause',e);K(b.i,c.v,'ended',e);ec(b.i,c.v,'loadeddata',function(){b.u.c=Date.now()/1E3-d.md});b.a.audioTracks&&(K(b.i,b.a.audioTracks,'addtrack',function(){return Dl(b)}),
K(b.i,b.a.audioTracks,'removetrack',function(){return Dl(b)}));if(b.a.textTracks){var f=b.a.textTracks;K(b.i,f,'addtrack',function(){return Dl(b)});K(b.i,f,'removetrack',function(){return Dl(b)})}c.v.src=c.uri;b.g=Gl;b.dispatchEvent(new I('streaming'));var g=new G;b.a.readyState>=HTMLMediaElement.HAVE_CURRENT_DATA?g.resolve():b.a.error?g.reject(kl(b)):(ec(b.i,b.a,'loadeddata',function(){g.resolve()}),ec(b.i,b.a,'error',function(){g.reject(kl(b))}));return new H(g,function(){g.reject(new C(2,7,7001));
return Promise.resolve()})}function ol(b){function c(b){return b.video&&b.audio||b.video&&b.video.codecs.includes(',')}b.some(function(b){return b.variants.some(c)})&&b.forEach(function(b){b.variants=b.variants.filter(c)})}
function Al(b){function c(b){var c='';b.video&&(c=pc(b.video.codecs)[0]);var d='';b.audio&&(d=pc(b.audio.codecs)[0]);return c+'-'+d}var d=b.f.periods.reduce(function(b,c){return b.concat(c.variants)},[]);d=He(d,b.c.preferredAudioChannelCount);var e=new Fb;d.forEach(function(b){var d=c(b);e.push(d,b)});var f=null,g=Infinity;e.forEach(function(b,c){var d=0,e=0;c.forEach(function(b){d+=b.bandwidth||0;++e});var h=d/e;h<g&&(f=b,g=h)});b.f.periods.forEach(function(b){b.variants=b.variants.filter(function(b){return c(b)==
f?!0:!1})})}function Tk(b){return new J(function(c,d){b.j&&b.j.segmentDownloaded(c,d)})}function wl(b,c){return new xi(b.a,b.f,b.c.streaming,c,function(){b.gb&&ii(b.gb,!0);b.b&&cj(b.b)},function(c){return b.dispatchEvent(c)})}
function xl(b){var c=new li(b.f);mi(c,function(){Dl(b)});var d=new Fi(b.Qb);Ji(d,function(c){ml(b,'timelineregionenter',c)},function(c){ml(b,'timelineregionexit',c)},function(c,d){d||(ml(b,'timelineregionenter',c),ml(b,'timelineregionexit',c))});var e=new hi(b.a);e.b.add(c);e.b.add(d);return e}
function yl(b,c){b.W=new Zh(c,Math.min(.5,c/2));b.W.a=ai;ll(b);b.Rb=(new A(function(){switch(b.g){case Gl:var c=b.a.ended?!0:sd(b.a.buffered)>=b.a.duration-.1;break;case Bl:a:{var e;(e=b.a.ended)||(e=b.w,e=e.h?'ended'==e.h.readyState:!0);if(e)c=!0;else{if(b.f.presentationTimeline.U()&&(e=b.f.presentationTimeline.lb(),sd(b.a.buffered)>=e)){c=!0;break a}c=!1}}break;default:c=!1}var f=ud(b.a.buffered,b.a.currentTime);e=b.W;var g=c,h=e.b.get(e.a);c=e.a;f=g||f>=h?$h:ai;e.a=f;c!=f&&ll(b)})).Ka(.25)}
function zl(b){return new Ki(b.f,{ Ta:function(){return b.o.i()},getBandwidthEstimate:function(){return b.j.getBandwidthEstimate()},K:b.w,ob:b.N,Md:b.ff.bind(b),Ld:b.ve.bind(b),onError:b.Ja.bind(b),onEvent:function(c){return b.dispatchEvent(c)},kf:b.lf.bind(b),Xc:b.sf.bind(b) })}X.prototype.configure=function(b,c){2==arguments.length&&'string'==typeof b&&(b=Fk(b,c));var d=Jk(this.c,b,Sk(this));Hl(this);return d};X.prototype.configure=X.prototype.configure;
function Hl(b){b.m&&b.m.configure(b.c.manifest);b.h&&b.h.configure(b.c.drm);if(b.b){b.b.configure(b.c.streaming);try{b.f.periods.forEach(b.Cc.bind(b))}catch(g){b.Ja(g)}var c=Oi(b.b),d=Qi(b.b),e=El(b);c=Ke(c,d,e.variants);b.j&&c&&c.allowedByApplication&&c.allowedByKeySystem?Fl(b,e.variants):Il(b,e)}if(b.w&&(e=b.c.textDisplayFactory,b.uc!=e)){c=new e;d=b.w;var f=d.g;d.g=c;f&&(c.setTextVisibility(f.isTextVisible()),f.destroy());d.a&&(d.a.c=c);b.uc=e;b.b&&(e=b.b,(c=e.b.get('text'))&&Wi(e,c.stream,!0,
0,!0))}b.j&&(b.j.configure(b.c.abr),b.c.abr.enabled&&!b.ib?b.j.enable():b.j.disable(),Jl(b))}X.prototype.getConfiguration=function(){var b=Sk(this);Jk(b,this.c,Sk(this));return b};X.prototype.getConfiguration=X.prototype.getConfiguration;X.prototype.Lf=function(){for(var b in this.c)delete this.c[b];Jk(this.c,Sk(this),Sk(this));Hl(this)};X.prototype.resetConfiguration=X.prototype.Lf;X.prototype.Ke=function(){return this.g};X.prototype.getLoadMode=X.prototype.Ke;X.prototype.Oe=function(){return this.a};
X.prototype.getMediaElement=X.prototype.Oe;X.prototype.Cb=function(){return this.N};X.prototype.getNetworkingEngine=X.prototype.Cb;X.prototype.ac=function(){return this.yb};X.prototype.getAssetUri=X.prototype.ac;X.prototype.Ne=function(){Oe('getManifestUri','Please use "getAssetUri" instead.');return this.ac()};X.prototype.getManifestUri=X.prototype.Ne;X.prototype.U=function(){return this.f?this.f.presentationTimeline.U():this.a&&this.a.src?Infinity==this.a.duration:!1};X.prototype.isLive=X.prototype.U;
X.prototype.Xa=function(){return this.f?this.f.presentationTimeline.Xa():!1};X.prototype.isInProgress=X.prototype.Xa;X.prototype.cf=function(){if(this.f){if(!this.f.periods.length)return!1;var b=this.f.periods[0].variants;return b.length?!b[0].video:!1}return this.a&&this.a.src?this.a.videoTracks?0==this.a.videoTracks.length:0==this.a.videoHeight:!1};X.prototype.isAudioOnly=X.prototype.cf;
X.prototype.Nf=function(){if(this.f){var b=this.f.presentationTimeline;return{ start:b.Ua(),end:b.ya() }}return this.a&&this.a.src&&(b=this.a.seekable,b.length)?{ start:b.start(0),end:b.end(b.length-1) }:{ start:0,end:0 }};X.prototype.seekRange=X.prototype.Nf;X.prototype.keySystem=function(){return this.h?this.h.keySystem():''};X.prototype.keySystem=X.prototype.keySystem;X.prototype.drmInfo=function(){return this.h?this.h.a:null};X.prototype.drmInfo=X.prototype.drmInfo;
X.prototype.cc=function(){return this.h?this.h.cc():Infinity};X.prototype.getExpiration=X.prototype.cc;X.prototype.Lc=function(){return this.W?this.W.a==ai:!1};X.prototype.isBuffering=X.prototype.Lc;X.prototype.Se=function(){if(this.M){var b=this.M;b=b.g?0:b.f}else b=0;return b};X.prototype.getPlaybackRate=X.prototype.Se;X.prototype.ig=function(b){0==b?$a('A trick play rate of 0 is unsupported!'):(this.g==Gl&&this.M.set(b),this.g==Bl&&(this.M.set(b),Vi(this.b,1<Math.abs(b))))};
X.prototype.trickPlay=X.prototype.ig;X.prototype.we=function(){this.g==Gl&&this.M.set(1);this.g==Bl&&(this.M.set(1),Vi(this.b,!1))};X.prototype.cancelTrickPlay=X.prototype.we;
X.prototype.Kc=function(){if(this.f&&this.o){for(var b=Kl(this),c=[],d=r(Ll(this)),e=d.next();!e.done;e=d.next()){e=e.value;var f=Ae(e);f.active=e==b;c.push(f)}return c}return this.a&&this.a.audioTracks?Array.from(this.a.audioTracks).map(function(b){var c=Ee(b);c.active=b.enabled;c.type='variant';c.originalAudioId=b.id;'main'==b.kind?(c.primary=!0,c.roles=['main'],c.audioRoles=['main']):c.audioRoles=[];return c}):[]};X.prototype.getVariantTracks=X.prototype.Kc;
X.prototype.mb=function(){if(this.f&&this.o){for(var b=Ml(this),c=[],d=r(Nl(this)),e=d.next();!e.done;e=d.next()){e=e.value;var f=Be(e);f.active=e==b;c.push(f)}return c}return this.a&&this.a.src&&this.a.textTracks?Array.from(this.a.textTracks).map(function(b){var c=Ee(b);c.active='disabled'!=b.mode;c.type='text';c.originalTextId=b.id;'captions'==b.kind&&(c.mimeType='application/cea-608');return c}):[]};X.prototype.getTextTracks=X.prototype.mb;X.prototype.getTextTrack=function(){return this.w.g.getTextTrack()};
X.prototype.getTextTrack=X.prototype.getTextTrack;X.prototype.fd=function(b){if(this.f&&this.b){var c=El(this),d=c.textStreams.find(function(c){return c.id==b.id});d&&(Oh(this.F,c,d),Pk(this.u.b,d,!1),Ol(this,d),this.Ma=d.language)}else if(this.a&&this.a.src&&this.a.textTracks){c=Array.from(this.a.textTracks);c=r(c);for(d=c.next();!d.done;d=c.next())d=d.value,Ce(d)==b.id?d.mode=this.eb?'showing':'hidden':d.mode='disabled';Pl(this)}};X.prototype.selectTextTrack=X.prototype.fd;
X.prototype.Pf=function(){Oe('selectEmbeddedTextTrack','If closed captions are signaled in the manifest, a text stream will be created to represent them. Please use SelectTextTrack.');var b=this.mb().filter(function(b){return'application/cea-608'==b.mimeType});0<b.length&&this.fd(b[0])};X.prototype.selectEmbeddedTextTrack=X.prototype.Pf;
X.prototype.ng=function(){Oe('usingEmbeddedTextTrack','If closed captions are signaled in the manifest, a text stream will be created to represent them. There should be no reason to know if the player is playing embedded text.');var b=this.mb().filter(function(b){return b.active})[0];return b?'application/cea-608'==b.mimeType:!1};X.prototype.usingEmbeddedTextTrack=X.prototype.ng;
X.prototype.Rf=function(b,c,d){d=void 0===d?0:d;if(this.f&&this.b){var e=El(this);this.c.abr.enabled&&$a('Changing tracks while abr manager is enabled will likely result in the selected track being overriden. Consider disabling abr before calling selectVariantTrack().');var f=e.variants.find(function(c){return c.id==b.id});f&&Fe(f)&&(ul(this,e,f,!1),Ql(this,f,c,d),this.Sb=new Vh(f),Fl(this,e.variants))}else if(this.a&&this.a.audioTracks){c=Array.from(this.a.audioTracks);c=r(c);for(d=c.next();!d.done;d=
c.next())d=d.value,Ce(d)==b.id&&(d.enabled=!0);Rl(this)}};X.prototype.selectVariantTrack=X.prototype.Rf;X.prototype.Jc=function(b,c){return this.b?this.b.Jc(b,c):-1};X.prototype.getTrackIdForTime=X.prototype.Jc;X.prototype.Fe=function(){return Sl(this.Kc())};X.prototype.getAudioLanguagesAndRoles=X.prototype.Fe;X.prototype.Ze=function(){return Sl(this.mb())};X.prototype.getTextLanguagesAndRoles=X.prototype.Ze;X.prototype.Ee=function(){return Array.from(Tl(this.Kc()))};
X.prototype.getAudioLanguages=X.prototype.Ee;X.prototype.Ye=function(){return Array.from(Tl(this.mb()))};X.prototype.getTextLanguages=X.prototype.Ye;X.prototype.Of=function(b,c){if(this.f&&this.o){var d=El(this);this.Sb=new Wh(b,c||'',0);Il(this,d)}else if(this.a&&this.a.audioTracks){d=Array.from(this.a.audioTracks);d=r(d);for(var e=d.next();!e.done;e=d.next())e=e.value,e.language==b&&(e.enabled=!0);Rl(this)}};X.prototype.selectAudioLanguage=X.prototype.Of;
X.prototype.Qf=function(b,c){if(this.f&&this.o){var d=El(this);this.Ma=b;this.zb=c||'';Il(this,d)}else(d=this.mb().filter(function(c){return c.language==b})[0])&&this.fd(d)};X.prototype.selectTextLanguage=X.prototype.Qf;X.prototype.Oc=function(){var b=this.eb;return this.f?this.w.g.isTextVisible():this.a&&this.a.src&&this.a.textTracks?Array.from(this.a.textTracks).some(function(b){return'showing'==b.mode}):b};X.prototype.isTextTrackVisible=X.prototype.Oc;
X.prototype.Uf=function(b){var c=this;return t(function e(){var f,g,h,k,l,m;return y(e,function(e){switch(e.l){case 1:f=c.eb;g=b;if(f==g)return e['return']();c.eb=g;if(c.g!=Bl){if(c.a&&c.a.src&&c.a.textTracks){h=Array.from(c.a.textTracks);for(var n=r(h),x=n.next();!x.done;x=n.next())k=x.value,'disabled'!=k.mode&&(k.mode=b?'showing':'hidden')}e.A(2);break}c.w.g.setTextVisibility(b);if(c.c.streaming.alwaysStreamText){e.A(2);break}if(!b){n=c.b;n.C=!0;if(x=n.b.get('text'))Li(x),n.b['delete']('text');
e.A(2);break}l=El(c);m=Ie(l.textStreams,c.Ma,c.zb);if(!(0<m.length)){e.A(2);break}return u(e,Ri(c.b,m[0]),2);case 2:Ul(c),v(e)}})})};X.prototype.setTextTrackVisibility=X.prototype.Uf;X.prototype.Ue=function(){if(!this.U())return null;if(this.f)return new Date(1E3*(this.f.presentationTimeline.g+this.a.currentTime));if(this.a&&this.a.getStartDate){var b=this.a.getStartDate();return isNaN(b.getTime())?null:new Date(b.getTime()+1E3*this.a.currentTime)}return null};X.prototype.getPlayheadTimeAsDate=X.prototype.Ue;
X.prototype.We=function(){if(!this.U())return null;if(this.f)return new Date(1E3*this.f.presentationTimeline.g);if(this.a&&this.a.getStartDate){var b=this.a.getStartDate();return isNaN(b.getTime())?null:b}return null};X.prototype.getPresentationStartTimeAsDate=X.prototype.We;X.prototype.Fc=function(){var b={ total:[],audio:[],video:[],text:[] };this.g==Gl&&(b.total=vd(this.a.buffered));this.g==Bl&&this.w.Fc(b);return b};X.prototype.getBufferedInfo=X.prototype.Fc;
X.prototype.getStats=function(){if(this.g!=Bl&&this.g!=Gl)return{ width:NaN,height:NaN,streamBandwidth:NaN,decodedFrames:NaN,droppedFrames:NaN,estimatedBandwidth:NaN,loadLatency:NaN,playTime:NaN,pauseTime:NaN,bufferingTime:NaN,switchHistory:[],stateHistory:[] };rl(this);var b=this.a;if(b.getVideoPlaybackQuality){b=b.getVideoPlaybackQuality();var c=this.u,d=Number(b.totalVideoFrames);c.i=Number(b.droppedVideoFrames);c.h=d}if(this.g==Bl){if(b=Kl(this))this.u.j=b.bandwidth;b&&b.video&&(c=this.u,d=b.video.height||
NaN,c.m=b.video.width||NaN,c.g=d);b=this.j.getBandwidthEstimate();this.u.f=b}var e=this.u;b=e.m;c=e.g;d=e.j;var f=e.h,g=e.i,h=e.f,k=e.c,l=Mk(e.a,'playing'),m=Mk(e.a,'paused'),n=Mk(e.a,'buffering'),q=Nk(e.a),x=[];e=r(e.b.a);for(var w=e.next();!w.done;w=e.next())w=w.value,x.push({ timestamp:w.timestamp,id:w.id,type:w.type,fromAdaptation:w.fromAdaptation,bandwidth:w.bandwidth });return{ width:b,height:c,streamBandwidth:d,decodedFrames:f,droppedFrames:g,estimatedBandwidth:h,loadLatency:k,playTime:l,pauseTime:m,
bufferingTime:n,stateHistory:q,switchHistory:x }};X.prototype.getStats=X.prototype.getStats;
X.prototype.addTextTrack=function(b,c,d,e,f,g){var h=this;return t(function l(){var m,n,q,x,w,B,D,E,F;return y(l,function(l){switch(l.l){case 1:if(h.g==Gl)throw Error('State error!');if(h.g!=Bl)throw Error('State error!');m=El(h);n=Bd;q=h.f.periods.indexOf(m);x=q+1;w=x>=h.f.periods.length?h.f.presentationTimeline.V():h.f.periods[x].startTime;B=w-m.startTime;if(Infinity==B)throw new C(1,4,4033);D=new P(1,0,B,function(){return[b]},0,null);E={ id:h.Id++,originalId:null,createSegmentIndex:Promise.resolve.bind(Promise),
findSegmentPosition:function(){return 1},getSegmentReference:function(b){return 1==b?D:null},initSegmentReference:null,presentationTimeOffset:0,mimeType:e,codecs:f||'',kind:d,encrypted:!1,keyId:null,language:c,label:g||null,type:n.na,primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:[],channelsCount:null,closedCaptions:null };h.Ub.add(E);m.textStreams.push(E);return u(l,Ri(h.b,E),2);case 2:return(F=Pi(h.b,'text'))&&Oh(h.F,m,F),h.Ub['delete'](E),Il(h,m),Dl(h),l['return'](Be(E))}})})};
X.prototype.addTextTrack=X.prototype.addTextTrack;X.prototype.hd=function(b,c){this.Vb.width=b;this.Vb.height=c};X.prototype.setMaxHardwareResolution=X.prototype.hd;X.prototype.ed=function(){if(this.g==Bl){var b=this.b;if(b.f)b=!1;else if(b.m)b=!1;else{for(var c=r(b.b.values()),d=c.next();!d.done;d=c.next())d=d.value,d.Fb&&(d.Fb=!1,Ui(b,d,.1));b=!0}}else b=!1;return b};X.prototype.retryStreaming=X.prototype.ed;X.prototype.Le=function(){return this.f};X.prototype.getManifest=X.prototype.Le;
X.prototype.Me=function(){return this.m?this.m.constructor:null};X.prototype.getManifestParserFactory=X.prototype.Me;function ul(b,c,d,e){Ph(b.F,c).variant=d;b=b.u.b;b.c!=d&&(b.c=d,b.a.push({ timestamp:Date.now()/1E3,id:d.id,type:'variant',fromAdaptation:e,bandwidth:d.bandwidth }))}function Sk(b){var c=Hk();c.streaming.failureCallback=function(c){var d=[1001,1002,1003];b.U()&&d.includes(c.code)&&(c.severity=1,b.ed())};c.textDisplayFactory=function(){return new W(b.a)};return c}
function sl(b,c){for(var d=0;d<c.length;d++){for(var e=c[d],f=new Map,g=r(e.variants),h=g.next();!h.done;h=g.next())if(h=h.value,h.video&&h.video.closedCaptions){h=h.video;for(var k=r(h.closedCaptions.keys()),l=k.next();!l.done;l=k.next())if(l=l.value,!f.has(l)){var m={ id:b.Id++,originalId:l,createSegmentIndex:Promise.resolve.bind(Promise),findSegmentPosition:function(){return null},getSegmentReference:function(){return null},initSegmentReference:null,presentationTimeOffset:0,mimeType:'application/cea-608',
codecs:'',kind:'caption',encrypted:!1,keyId:null,language:h.closedCaptions.get(l),label:null,type:'text',primary:!1,trickModeVideo:null,emsgSchemeIdUris:null,roles:h.roles,channelsCount:null,closedCaptions:null };f.set(l,m)}}f=r(f.values());for(g=f.next();!g.done;g=f.next())e.textStreams.push(g.value)}}
function nl(b,c){var d=b.b?Oi(b.b):null,e=b.b?Qi(b.b):null;c.forEach(ye.bind(null,b.h,d,e));d=Mb(c,function(b){return b.variants.some(Fe)});if(0==d)throw new C(2,4,4032);if(d<c.length)throw new C(2,4,4011);c.forEach(function(b){xe(b.variants,this.c.restrictions,this.Vb)&&this.b&&El(this)==b&&Dl(this);Vl(this,b.variants)}.bind(b))}p=X.prototype;
p.Cc=function(b){var c=this.b?Oi(this.b):null,d=this.b?Qi(this.b):null;ye(this.h,c,d,b);c=b.variants;if(!c.some(Fe))throw new C(2,4,4011);Vl(this,b.variants);xe(c,this.c.restrictions,this.Vb)&&this.b&&El(this)==b&&Dl(this);if(b=this.h?this.h.a:null)for(c=r(c),d=c.next();!d.done;d=c.next()){d=r(d.value.drmInfos);for(var e=d.next();!e.done;e=d.next())if(e=e.value,e.keySystem==b.keySystem){e=r(e.initData||[]);for(var f=e.next();!f.done;f=e.next())f=f.value,$c(this.h,f.initDataType,f.initData)}}};
function Ql(b,c,d,e){d=void 0===d?!1:d;e=void 0===e?0:e;b.ib?(b.ka=c,b.Ed=d,b.Cd=e):(Xi(b.b,c,d,e),Rl(b))}function Ol(b,c){b.ib?b.ja=c:(Wi(b.b,c,!0,0,!1),Pl(b))}function Cl(b,c){function d(b,c){if(!b)return null;var d=b.findSegmentPosition(c-g.startTime);return null==d?null:(d=b.getSegmentReference(d))?d.startTime+g.startTime:null}var e=Oi(b.b),f=Qi(b.b),g=El(b);e=d(e,c);f=d(f,c);return null!=f&&null!=e?Math.max(f,e):null!=f?f:null!=e?e:c}
function ll(b){var c=b.Lc();if(b.u&&b.W&&b.o){var d=b.M;d.g=c;oi(d);rl(b)}b.dispatchEvent(new I('buffering',{ buffering:c }))}function rl(b){if(b.u&&b.W){var c=b.u.a;b.W.a==ai?Lk(c,'buffering'):b.a.paused?Lk(c,'paused'):b.a.ended?Lk(c,'ended'):Lk(c,'playing')}}function Fl(b,c){try{Vl(b,c)}catch(e){return b.Ja(e),null}var d=c.filter(function(b){return Fe(b)});d=b.Sb.create(d);b.j.setVariants(Array.from(d.values()));return b.j.chooseVariant()}
function Il(b,c){var d=Fl(b,c.variants);d&&(ul(b,c,d,!0),Ql(b,d,!0));(d=Ie(c.textStreams,b.Ma,b.zb)[0]||null)&&(b.c.streaming.alwaysStreamText||b.Oc())&&(Oh(b.F,c,d),Pk(b.u.b,d,!0),Ol(b,d));vl(b)}
p.ff=function(b){try{this.ib=!0;this.j.disable();Jl(this);var c=Fl(this,b.variants),d=Ie(b.textStreams,this.Ma,this.zb)[0]||null;this.ka&&(b.variants.includes(this.ka)&&(c=this.ka),this.ka=null);this.ja&&(b.textStreams.includes(this.ja)&&(d=this.ja),this.ja=null);c&&ul(this,b,c,!0);if(d){var e=d;Oh(this.F,b,e);Pk(this.u.b,e,!0)}var f=this.b,g=f.b.get('video');if(g)var h=f.c.periods[g.Aa];else{var k=f.b.get('audio');h=k?f.c.periods[k.Aa]:null}var l=c?c.audio:null;if(!h&&d){var m;if(m=l){b=d;var n=
L(this.c.preferredTextLanguage),q=L(l.language),x=L(b.language);m=re(x,n)&&!re(q,x)}m&&(this.eb=!0);this.eb&&this.w.g.setTextVisibility(!0);Ul(this)}return this.c.streaming.alwaysStreamText||this.Oc()?{ variant:c,text:d }:{ variant:c,text:null }}catch(w){return this.Ja(w),{ variant:null,text:null }}};p.ve=function(){this.ib=!1;this.c.abr.enabled&&(this.j.enable(),Jl(this));this.ka&&(Xi(this.b,this.ka,this.Ed,this.Cd),Rl(this),this.ka=null);this.ja&&(Wi(this.b,this.ja,!0,0,!1),Pl(this),this.ja=null)};
p.lf=function(){this.m&&this.m.update&&this.m.update()};p.sf=function(){this.o&&this.o.u()};function vl(b){Wl(b,new I('adaptation'))}function Dl(b){Wl(b,new I('trackschanged'))}function Rl(b){Wl(b,new I('variantchanged'))}function Pl(b){Wl(b,new I('textchanged'))}function Ul(b){Wl(b,new I('texttrackvisibility'))}function Jl(b){Wl(b,new I('abrstatuschanged',{ yg:b.c.abr.enabled }))}p.Ja=function(b){if(this.g!=dl){var c=new I('error',{ detail:b });this.dispatchEvent(c);c.defaultPrevented&&(b.handled=!0)}};
function ml(b,c,d){b.dispatchEvent(new I(c,{ detail:{ schemeIdUri:d.schemeIdUri,value:d.value,startTime:d.startTime,endTime:d.endTime,id:d.id,eventElement:d.eventElement } }))}function kl(b){if(!b.a.error)return null;var c=b.a.error.code;if(1==c)return null;var d=b.a.error.msExtendedCode;d&&(0>d&&(d+=Math.pow(2,32)),d=d.toString(16));return new C(2,3,3016,c,d,b.a.error.message)}
function pl(b,c){if(b.b){var d=El(b),e=!1,f=Object.keys(c),g=1==f.length&&'00'==f[0];f.length&&d.variants.forEach(function(b){Le(b).forEach(function(d){var f=b.allowedByKeySystem;d.keyId&&(d=c[g?'00':d.keyId],b.allowedByKeySystem=!!d&&!fl.includes(d));f!=b.allowedByKeySystem&&(e=!0)})});f=Oi(b.b);var h=Qi(b.b);(f=Ke(f,h,d.variants))&&!f.allowedByKeySystem&&Il(b,d);e&&(Dl(b),Fl(b,d.variants))}}
function ql(b,c,d){if(b.m&&b.m.onExpirationUpdated)b.m.onExpirationUpdated(c,d);b.dispatchEvent(new I('expirationupdated'))}function tl(b,c,d){0<c&&(b.U()||b.ee(c));d<b.V()&&(b.U()||b.ua(d))}
function Vl(b,c){var d=b.h?lc(b.h.S):{},e=Object.keys(d);e=e.length&&'00'==e[0];for(var f=!1,g=!1,h=[],k=[],l=r(c),m=l.next();!m.done;m=l.next()){m=m.value;var n=[];m.audio&&n.push(m.audio);m.video&&n.push(m.video);n=r(n);for(var q=n.next();!q.done;q=n.next())if(q=q.value,q.keyId){var x=d[e?'00':q.keyId];x?fl.includes(x)&&(k.includes(x)||k.push(x)):h.includes(q.keyId)||h.push(q.keyId)}m.allowedByApplication?m.allowedByKeySystem&&(f=!0):g=!0}if(!f)throw new C(2,4,4012,{ hasAppRestrictions:g,missingKeys:h,
restrictedKeyStatuses:k });}function Wl(b,c){t(function e(){return y(e,function(e){switch(e.l){case 1:return u(e,Promise.resolve(),2);case 2:b.g!=dl&&b.dispatchEvent(c),v(e)}})})}function Tl(b){var c=new Set;b=r(b);for(var d=b.next();!d.done;d=b.next())d=d.value,d.language?c.add(L(d.language)):c.add('und');return c}
function Sl(b){var c=new Map;b=r(b);for(var d=b.next();!d.done;d=b.next()){var e=d.value;d='und';var f=[];e.language&&(d=L(e.language));'variant'==e.type?f=e.audioRoles:f=e.roles;f&&f.length||(f=['']);c.has(d)||c.set(d,new Set);e=r(f);for(f=e.next();!f.done;f=e.next())f=f.value,c.get(d).add(f)}var g=[];c.forEach(function(b,c){for(var d=r(b),e=d.next();!e.done;e=d.next())g.push({ language:c,role:e.value })});return g}
function Ll(b){b=El(b);return null==b?[]:b.variants.filter(function(b){return Fe(b)})}function Nl(b){var c=El(b);return null==c?[]:c.textStreams.filter(function(c){return!b.Ub.has(c)})}function El(b){var c=b.o.i(),d=null;b=r(b.f.periods);for(var e=b.next();!e.done;e=b.next())e=e.value,e.startTime<=c&&(d=e);return d}function Kl(b){var c=El(b);return Ph(b.F,c).variant}
function Ml(b){var c=El(b);if(null==c)return null;if(!Ph(b.F,c).text){var d=Ie(c.textStreams,b.Ma,b.zb);d.length&&Oh(b.F,c,d[0])}return Ph(b.F,c).text}function hl(){return new C(2,7,7E3)}function cl(b,c,d,e,f,g){return e==b&&f.v==g.v&&f.uri==g.uri&&f.mimeType==g.mimeType&&f.xa==g.xa?c:d}function xk(){return{ xa:null,v:null,mimeType:null,startTime:null,md:null,uri:null }}
function il(b){return new Promise(function(c,d){b.Ya=function(){return d(hl())};b.gc=function(){return c()};b.onError=function(b){return d(b)};b.ic=function(){return d(hl())}})}var dl=0,Rk=1,Bl=2,Gl=3;X.LoadMode={ DESTROYED:dl,NOT_LOADED:Rk,MEDIA_SOURCE:Bl,SRC_EQUALS:Gl };function Xl(b,c,d){var e=void 0==c.expiration?Infinity:c.expiration,f=c.presentationTimeline.V();c=Yl(c.periods[0]);return{ offlineUri:null,originalManifestUri:b,duration:f,size:0,expiration:e,tracks:c,appMetadata:d }}function Zl(b,c){var d=mk(new kk(b.sa(),b.$()),c.periods[0],new U(null,0)),e=c.appMetadata||{};d=Yl(d);return{ offlineUri:b.toString(),originalManifestUri:c.originalManifestUri,duration:c.duration,size:c.size,expiration:c.expiration,tracks:d,appMetadata:e }}
function Yl(b){var c=[],d=Ge(b.variants);d=r(d);for(var e=d.next();!e.done;e=d.next())c.push(Ae(e.value));b=r(b.textStreams);for(d=b.next();!d.done;d=b.next())c.push(Be(d.value));return c};function $l(){this.a={}}function am(b,c,d){d=d.endTime-d.startTime;return bm(b,c)*d}function bm(b,c){var d=b.a[c];null==d&&(d=0);return d};function cm(b){this.a=!1;this.b=new G;this.c=b}cm.prototype.destroy=function(){var b=this;if(this.a)return this.b;this.a=!0;return this.c().then(function(){b.b.resolve()},function(){b.b.resolve()})};function dm(b,c){for(var d={ width:Infinity,height:Infinity },e=r(b.periods),f=e.next();!f.done;f=e.next())f=f.value,f.variants=f.variants.filter(function(b){return we(b,c,d)})}function em(b){b=r(b.periods);for(var c=b.next();!c.done;c=b.next())c=c.value,c.variants=c.variants.filter(function(b){var c=!0;b.audio&&(c=c&&fe(b.audio));b.video&&(c=c&&fe(b.video));return c})}
function fm(b,c){for(var d=r(b.periods),e=d.next();!e.done;e=d.next())e=e.value,e.variants=e.variants.filter(function(b){return nd(c,b)})}function gm(b){var c=new hm;b.periods.forEach(function(b,d){var e=im(b.variants);if(0==d){e=r(e.a);for(var f=e.next();!f.done;f=e.next())c.add(f.value)}else jm(c,e)});b=r(b.periods);for(var d=b.next();!d.done;d=b.next())d=d.value,d.variants=d.variants.filter(function(b){return km(c,new lm(b))})}
function mm(b,c){var d=new hm;b.periods.forEach(function(b,f){0<f&&(b.variants=b.variants.filter(function(b){return km(d,new lm(b))}));c(b);d=im(b.variants)})}function lm(b){var c=b.audio;b=b.video;this.b=c?c.mimeType:null;this.a=c?c.codecs.split('.')[0]:null;this.f=b?b.mimeType:null;this.c=b?b.codecs.split('.')[0]:null}function hm(){this.a=[]}hm.prototype.add=function(b){km(this,b)||this.a.push(b)};function jm(b,c){b.a=b.a.filter(function(b){return km(c,b)})}
function km(b,c){return b.a.some(function(b){return c.b==b.b&&c.a==b.a&&c.f==b.f&&c.c==b.c})}function im(b){var c=new hm;b=r(b);for(var d=b.next();!d.done;d=b.next())c.add(new lm(d.value));return c};function Z(b){var c=this;if(b&&b.constructor!=X)throw new C(2,9,9008);this.b=this.a=null;b?(this.a=b.c,this.b=b.Cb()):(this.a=Hk(),this.b=new J);this.f=!1;this.c=[];this.g=[];var d=!b;this.h=new cm(function(){return t(function f(){var b;return y(f,function(f){switch(f.l){case 1:return b=function(){},u(f,Promise.all(c.g.map(function(c){return c.then(b,b)})),2);case 2:if(!d){f.A(3);break}return u(f,c.b.destroy(),3);case 3:c.a=null,c.b=null,v(f)}})})})}z('shaka.offline.Storage',Z);
function nm(){if(qc())a:{var b=r(Kj.values());for(var c=b.next();!c.done;c=b.next())if(c=c.value,c=c()){c.destroy();b=!0;break a}b=!1}else b=!1;return b}Z.support=nm;Z.prototype.destroy=function(){return this.h.destroy()};Z.prototype.destroy=Z.prototype.destroy;
Z.prototype.configure=function(b,c){2==arguments.length&&'string'==typeof b&&(b=Fk(b,c));var d=b,e=!1;null!=d.trackSelectionCallback&&(e=!0,d.offline=d.offline||{},d.offline.trackSelectionCallback=d.trackSelectionCallback,delete d.trackSelectionCallback);null!=d.progressCallback&&(e=!0,d.offline=d.offline||{},d.offline.progressCallback=d.progressCallback,delete d.progressCallback);null!=d.usePersistentLicense&&(e=!0,d.offline=d.offline||{},d.offline.usePersistentLicense=d.usePersistentLicense,delete d.usePersistentLicense);
e&&Oe('Storage.configure with OfflineConfig','Please configure storage with a player configuration.');return Jk(this.a,b)};Z.prototype.configure=Z.prototype.configure;Z.prototype.getConfiguration=function(){var b=Hk();Jk(b,this.a,Hk());return b};Z.prototype.getConfiguration=Z.prototype.getConfiguration;Z.prototype.Cb=function(){return this.b};Z.prototype.getNetworkingEngine=Z.prototype.Cb;
Z.prototype.store=function(b,c,d){var e=this;return om(this,pm(this,b,c||{},function(){return t(function g(){var c,k;return y(g,function(g){switch(g.l){case 1:return d&&'string'!=typeof d?(Oe('Storing with a manifest parser factory','Please register a manifest parser and for the mime-type.'),c=d,g['return'](new c)):u(g,T.create(b,e.b,e.a.manifest.retryParameters,d),2);case 2:return k=g.s,g['return'](k)}})})}))};Z.prototype.store=Z.prototype.store;Z.prototype.Xe=function(){return this.f};
Z.prototype.getStoreInProgress=Z.prototype.Xe;
function pm(b,c,d,e){return t(function g(){var h,k,l,m,n,q,x,w,B,D;return y(g,function(g){switch(g.l){case 1:qm();if(b.f)return g['return'](Promise.reject(new C(2,9,9006)));b.f=!0;return u(g,rm(b,c,e),2);case 2:h=g.s;sm(b);k=!h.presentationTimeline.U()&&!h.presentationTimeline.Xa();if(!k)throw new C(2,9,9005,c);l=null;m=new Jj;q=n=null;ya(g,3,4);return u(g,tm(b,h,function(b){q=q||b}),6);case 6:l=g.s;sm(b);if(q)throw q;um(b,h,l);return u(g,m.init(),7);case 7:return sm(b),u(g,Lj(m),8);case 8:return n=
g.s,sm(b),u(g,vm(b,n.$,l,h,c,d),9);case 9:x=g.s;sm(b);if(q)throw q;return u(g,n.$.addManifests([x]),10);case 10:return w=g.s,sm(b),B=new ik('manifest',n.path.sa,n.path.$,w[0]),g['return'](Zl(B,x));case 4:return Ea(g),b.f=!1,b.c=[],u(g,m.destroy(),11);case 11:if(!l){g.A(12);break}return u(g,l.destroy(),12);case 12:Fa(g,0);break;case 3:D=Da(g);if(!n){g.A(14);break}return u(g,n.$.removeSegments(b.c,function(){}),14);case 14:throw q||D;}})})}
function um(b,c,d){dm(c,b.a.restrictions);em(c);fm(c,d);gm(c);mm(c,function(c){for(var d=[],e=r(c.variants),h=e.next();!h.done;h=e.next())d.push(Ae(h.value));e=r(c.textStreams);for(h=e.next();!h.done;h=e.next())d.push(Be(h.value));d=b.a.offline.trackSelectionCallback(d);var k=new Set,l=new Set;d=r(d);for(e=d.next();!e.done;e=d.next())e=e.value,'variant'==e.type&&k.add(e.id),'text'==e.type&&l.add(e.id);c.variants=c.variants.filter(function(b){return k.has(b.id)});c.textStreams=c.textStreams.filter(function(b){return l.has(b.id)})});
wm(c)}function vm(b,c,d,e,f,g){return t(function k(){var l,m,n,q;return y(k,function(k){switch(k.l){case 1:return l=Xl(f,e,g),m=new yj(b.b,function(c,d){l.size=d;b.a.offline.progressCallback(l,c)}),za(k,2),q=n=xm(b,m,c,d,e,f,g),u(k,Bj(m),4);case 4:return q.size=k.s,k['return'](n);case 2:return Ea(k),u(k,m.destroy(),5);case 5:Fa(k,0)}})})}Z.prototype.remove=function(b){return om(this,ym(this,b))};Z.prototype.remove=Z.prototype.remove;
function ym(b,c){return t(function e(){var f,g,h,k,l,m;return y(e,function(e){switch(e.l){case 1:qm();f=jk(c);if(null==f||'manifest'!=f.a)return e['return'](Promise.reject(new C(2,9,9004,c)));g=f;h=new Jj;za(e,2);return u(e,h.init(),4);case 4:return u(e,Nj(h,g.sa(),g.$()),5);case 5:return k=e.s,u(e,k.getManifests([g.key()]),6);case 6:return l=e.s,m=l[0],u(e,Promise.all([zm(b,m,h),Am(b,k,g,m)]),2);case 2:return Ea(e),u(e,h.destroy(),8);case 8:Fa(e,0)}})})}
function Bm(b,c){for(var d=[],e=r(b.periods),f=e.next();!f.done;f=e.next()){f=r(f.value.streams);for(var g=f.next();!g.done;g=f.next())g=g.value,c&&'video'==g.contentType?d.push({ contentType:mc(g.mimeType,g.codecs),robustness:b.drmInfo.videoRobustness }):c||'audio'!=g.contentType||d.push({ contentType:mc(g.mimeType,g.codecs),robustness:b.drmInfo.audioRobustness })}return d}function zm(b,c,d){return t(function f(){return y(f,function(f){switch(f.l){case 1:return u(f,Cm(b.b,b.a.drm,d,c),0)}})})}
function Am(b,c,d,e){function f(){k+=1;b.a.offline.progressCallback(l,k/h)}var g=Dm(e),h=g.length+1,k=0,l=Zl(d,e);return Promise.all([c.removeSegments(g,f),c.removeManifests([d.key()],f)])}Z.prototype.If=function(){return om(this,Em(this))};Z.prototype.removeEmeSessions=Z.prototype.If;
function Em(b){return t(function d(){var e,f,g,h,k,l,m,n,q;return y(d,function(d){switch(d.l){case 1:return qm(),e=b.b,f=b.a.drm,g=new Jj,h=!1,za(d,2),u(d,g.init(),4);case 4:k=[];Oj(g,function(b){return k.push(b)});l=Promise.resolve();m={};n=r(k);for(q=n.next();!q.done;m={ nc:m.nc },q=n.next())m.nc=q.value,l=l.then(function(b){return function(){return t(function D(){var d,g;return y(D,function(k){switch(k.l){case 1:return u(k,b.nc.getAll(),2);case 2:return d=k.s,u(k,tk(f,e,d),3);case 3:return g=k.s,
u(k,b.nc.remove(g),4);case 4:g.length!=d.length&&(h=!0),v(k)}})})}}(m));return u(d,l,2);case 2:return Ea(d),u(d,g.destroy(),6);case 6:Fa(d,3);break;case 3:return d['return'](!h)}})})}Z.prototype.list=function(){return om(this,Fm())};Z.prototype.list=Z.prototype.list;
function Fm(){return t(function c(){var d,e,f;return y(c,function(c){switch(c.l){case 1:return qm(),d=[],e=new Jj,za(c,2),u(c,e.init(),4);case 4:return f=Promise.resolve(),Mj(e,function(c,e){f=f.then(function(){return t(function m(){var f;return y(m,function(g){switch(g.l){case 1:return u(g,e.getAllManifests(),2);case 2:f=g.s,f.forEach(function(e,f){var g=Zl(new ik('manifest',c.sa,c.$,f),e);d.push(g)}),v(g)}})})})}),u(c,f,2);case 2:return Ea(c),u(c,e.destroy(),6);case 6:Fa(c,3);break;case 3:return c['return'](d)}})})}
function rm(b,c,d){return t(function f(){var g,h,k,l,m,n;return y(f,function(f){switch(f.l){case 1:return g=null,h=b.b,k={ networkingEngine:h,filterAllPeriods:function(){},filterNewPeriod:function(){},onTimelineRegionAdded:function(){},onEvent:function(){},onError:function(b){g=b} },u(f,d(),2);case 2:return l=f.s,l.configure(b.a.manifest),sm(b),za(f,3),u(f,l.start(c,k),5);case 5:return m=f.s,sm(b),n=Gm(m),u(f,Promise.all(Array.from(n).map(function(b){return b.createSegmentIndex()})),6);case 6:sm(b);
if(g)throw g;return f['return'](m);case 3:return Ea(f),u(f,l.stop(),7);case 7:Fa(f,0)}})})}function tm(b,c,d){return t(function f(){var g,h,k;return y(f,function(f){switch(f.l){case 1:return g=new Jc({ ob:b.b,onError:d,hc:function(){},onExpirationUpdated:function(){},onEvent:function(){} }),h=ji(c.periods),k=b.a,g.configure(k.drm),u(f,Oc(g,h,k.offline.usePersistentLicense),2);case 2:return u(f,Yc(g),3);case 3:return u(f,Zc(g),4);case 4:return f['return'](g)}})})}
function xm(b,c,d,e,f,g,h){var k=new $l,l=f.periods.map(function(e){return Hm(b,c,d,k,f,e)}),m=e.a,n=ed(e);if(m&&b.a.offline.usePersistentLicense){if(!n.length)throw new C(2,9,9007,g);m.initData=[]}return{ originalManifestUri:g,duration:f.presentationTimeline.V(),size:0,expiration:e.cc(),periods:l,sessionIds:b.a.offline.usePersistentLicense?n:[],drmInfo:m,appMetadata:h }}
function Hm(b,c,d,e,f,g){f.periods.forEach(function(b){b.variants.forEach(function(b){var c=b.audio,d=b.video;c&&!d&&(e.a[c.id]=c.bandwidth||b.bandwidth);!c&&d&&(e.a[d.id]=d.bandwidth||b.bandwidth);if(c&&d){var f=c.bandwidth||393216,g=d.bandwidth||b.bandwidth-f;0>=g&&(g=b.bandwidth);e.a[c.id]=f;e.a[d.id]=g}});b.textStreams.forEach(function(b){e.a[b.id]=52})});var h=Gm(f),k=new Map;h=r(h);for(var l=h.next();!l.done;l=h.next()){l=l.value;var m=Im(b,c,d,e,f,l);k.set(l.id,m)}g.variants.forEach(function(b){b.audio&&
k.get(b.audio.id).variantIds.push(b.id);b.video&&k.get(b.video.id).variantIds.push(b.id)});return{ startTime:g.startTime,streams:Array.from(k.values()) }}
function Im(b,c,d,e,f,g){var h={ id:g.id,originalId:g.originalId,primary:g.primary,presentationTimeOffset:g.presentationTimeOffset||0,contentType:g.type,mimeType:g.mimeType,codecs:g.codecs,frameRate:g.frameRate,kind:g.kind,language:g.language,label:g.label,width:g.width||null,height:g.height||null,initSegmentKey:null,encrypted:g.encrypted,keyId:g.keyId,segments:[],variantIds:[] };f=f.presentationTimeline.Eb();var k=g.id;Jm(g,f,function(f){var l=tg(f.c(),f.b,f.a,b.a.streaming.retryParameters);zj(c,k,
l,am(e,g.id,f),function(c){return d.addSegments([{ data:c }]).then(function(c){b.c.push(c[0]);h.segments.push({ startTime:f.startTime,endTime:f.endTime,dataKey:c[0] })})})});if(f=g.initSegmentReference)f=tg(f.c(),f.b,f.a,b.a.streaming.retryParameters),zj(c,k,f,.5*bm(e,g.id),function(c){return d.addSegments([{ data:c }]).then(function(c){b.c.push(c[0]);h.initSegmentKey=c[0]})});return h}
function Jm(b,c,d){c=b.findSegmentPosition(c);for(var e=null==c?null:b.getSegmentReference(c);e;)d(e),e=b.getSegmentReference(++c)}function sm(b){if(b.h.a)throw new C(2,9,7001);}function qm(){if(!nm())throw new C(2,9,9E3);}function om(b,c){return t(function e(){return y(e,function(e){switch(e.l){case 1:return b.g.push(c),za(e,2),u(e,c,4);case 4:return e['return'](e.s);case 2:Ea(e),Lb(b.g,c),Fa(e,0)}})})}
function Dm(b){var c=[];b.periods.forEach(function(b){b.streams.forEach(function(b){null!=b.initSegmentKey&&c.push(b.initSegmentKey);b.segments.forEach(function(b){c.push(b.dataKey)})})});return c}Z.deleteAll=function(){return t(function c(){var d;return y(c,function(c){switch(c.l){case 1:return d=new Jj,za(c,2),u(c,d.erase(),2);case 2:return Ea(c),u(c,d.destroy(),5);case 5:Fa(c,0)}})})};
function Cm(b,c,d,e){return t(function g(){var h,k,l;return y(g,function(g){switch(g.l){case 1:if(!e.drmInfo)return g['return']();h=Pj(d);k=e.sessionIds.map(function(b){return{ sessionId:b,keySystem:e.drmInfo.keySystem,licenseUri:e.drmInfo.licenseServerUri,serverCertificate:e.drmInfo.serverCertificate,audioCapabilities:Bm(e,!1),videoCapabilities:Bm(e,!0) }});return u(g,tk(c,b,k),2);case 2:return l=g.s,u(g,h.remove(l),3);case 3:return u(g,h.add(k.filter(function(b){return-1==l.indexOf(b.sessionId)})),
0)}})})}function Gm(b){var c=new Set;b=r(b.periods);for(var d=b.next();!d.done;d=b.next()){d=d.value;for(var e=r(d.textStreams),f=e.next();!f.done;f=e.next())c.add(f.value);d=r(d.variants);for(e=d.next();!e.done;e=d.next())e=e.value,e.audio&&c.add(e.audio),e.video&&c.add(e.video)}return c}function wm(b){if(0==b.periods.length)throw new C(2,4,4014);b=r(b.periods);for(var c=b.next();!c.done;c=b.next())Km(c.value)}
function Km(b){b.variants.map(function(b){return b.video});var c=new Set(b.variants.map(function(b){return b.audio}));b=b.textStreams;for(var d=r(c),e=d.next();!e.done;e=d.next()){e=r(c);for(var f=e.next();!f.done;f=e.next());}c=r(b);for(d=c.next();!d.done;d=c.next())for(d=r(b),e=d.next();!e.done;e=d.next());}gl.offline=nm;z('shaka.polyfill.installAll',function(){for(var b=0;b<Lm.length;++b)Lm[b].te()});var Lm=[];function Mm(b,c){c=c||0;for(var d={ priority:c,te:b },e=0;e<Lm.length;e++)if(Lm[e].priority<c){Lm.splice(e,0,d);return}Lm.push(d)}z('shaka.polyfill.register',Mm);function Nm(b){var c=b.type.replace(/^(webkit|moz|MS)/,'').toLowerCase();if('function'===typeof Event)var d=new Event(c,b);else d=document.createEvent('Event'),d.initEvent(c,b.bubbles,b.cancelable);b.target.dispatchEvent(d)}
Mm(function(){if(window.Document){var b=Element.prototype;b.requestFullscreen=b.requestFullscreen||b.mozRequestFullScreen||b.msRequestFullscreen||b.webkitRequestFullscreen;b=Document.prototype;b.exitFullscreen=b.exitFullscreen||b.mozCancelFullScreen||b.msExitFullscreen||b.webkitExitFullscreen;'fullscreenElement'in document||(Object.defineProperty(document,'fullscreenElement',{ get:function(){return document.mozFullScreenElement||document.msFullscreenElement||document.webkitFullscreenElement} }),Object.defineProperty(document,
'fullscreenEnabled',{ get:function(){return document.mozFullScreenEnabled||document.msFullscreenEnabled||document.webkitSupportsFullscreen||document.webkitFullscreenEnabled} }));document.addEventListener('webkitfullscreenchange',Nm);document.addEventListener('webkitfullscreenerror',Nm);document.addEventListener('mozfullscreenchange',Nm);document.addEventListener('mozfullscreenerror',Nm);document.addEventListener('MSFullscreenChange',Nm);document.addEventListener('MSFullscreenError',Nm)}});Mm(function(){tc('CrKey')&&delete window.indexedDB});function Om(b,c,d){if('input'==b)switch(this.type){case 'range':b='change'}HTMLInputElement.prototype.originalAddEventListener.call(this,b,c,d)}Mm(function(){tc('Trident/')&&!HTMLInputElement.prototype.originalAddEventListener&&(HTMLInputElement.prototype.originalAddEventListener=HTMLInputElement.prototype.addEventListener,HTMLInputElement.prototype.addEventListener=Om)});Mm(function(){navigator.languages||Object.defineProperty(navigator,'languages',{ get:function(){return navigator.language?[navigator.language]:['en']} })});Mm(function(){});function Pm(){var b=MediaSource.prototype.addSourceBuffer;MediaSource.prototype.addSourceBuffer=function(c){for(var d=[],e=0;e<arguments.length;++e)d[e]=arguments[e];d=b.apply(this,d);d.abort=function(){};return d}}function Qm(){var b=SourceBuffer.prototype.remove;SourceBuffer.prototype.remove=function(c,d){return b.call(this,c,d-.001)}}
function Rm(){var b=MediaSource.prototype.endOfStream;MediaSource.prototype.endOfStream=function(c){for(var d=[],e=0;e<arguments.length;++e)d[e]=arguments[e];for(var h=e=0;h<this.sourceBuffers.length;++h){var k=this.sourceBuffers[h];k=k.buffered.end(k.buffered.length-1);e=Math.max(e,k)}if(!isNaN(this.duration)&&e<this.duration)for(this.Fd=!0,e=0;e<this.sourceBuffers.length;++e)this.sourceBuffers[e].wd=!1;return b.apply(this,d)};var c=!1,d=MediaSource.prototype.addSourceBuffer;MediaSource.prototype.addSourceBuffer=
function(b){for(var e=[],g=0;g<arguments.length;++g)e[g]=arguments[g];e=d.apply(this,e);e.mediaSource_=this;e.addEventListener('updateend',Sm,!1);c||(this.addEventListener('sourceclose',Tm,!1),c=!0);return e}}function Sm(b){var c=b.target,d=c.mediaSource_;if(d.Fd){b.preventDefault();b.stopPropagation();b.stopImmediatePropagation();c.wd=!0;for(b=0;b<d.sourceBuffers.length;++b)if(0==d.sourceBuffers[b].wd)return;d.Fd=!1}}
function Tm(b){b=b.target;for(var c=0;c<b.sourceBuffers.length;++c)b.sourceBuffers[c].removeEventListener('updateend',Sm,!1);b.removeEventListener('sourceclose',Tm,!1)}function Um(){var b=MediaSource.isTypeSupported;MediaSource.isTypeSupported=function(c){return'mp2t'==c.split(/ *; */)[0].split('/')[1]?!1:b(c)}}function Vm(){var b=MediaSource.isTypeSupported;MediaSource.isTypeSupported=function(c){return'opus'!=pc(c)[0]&&b(c)}}
function Wm(){var b=MediaSource.isTypeSupported,c=/^dv(?:h[e1]|a[v1])\./;MediaSource.isTypeSupported=function(d){for(var e=d.split(/ *; */),f=e[0],g={},h=1;h<e.length;++h){var k=e[h].split('='),l=k[0];k=k[1].replace(/"(.*)"/,'$1');g[l]=k}e=g.codecs;if(!e)return b(d);var m=!1,n=!1;d=e.split(',').filter(function(b){c.test(b)&&(n=!0);/^(hev|hvc)1\.2/.test(b)&&(m=!0);return!0});n&&(m=!1);g.codecs=d.join(',');m&&(g.eotf='smpte2084');for(var q in g)f+='; '+q+'="'+g[q]+'"';return cast.__platform__.canDisplayType(f)}}
Mm(function(){if(window.MediaSource)if(window.cast&&cast.__platform__&&cast.__platform__.canDisplayType)Wm();else if(navigator.vendor&&navigator.vendor.includes('Apple')){var b=navigator.appVersion;Um();if(b.includes('Version/8'))window.MediaSource=null;else if(b.includes('Version/9'))Pm();else if(b.includes('Version/10'))Pm(),Rm();else if(b.includes('Version/11')||b.includes('Version/12'))Pm(),Qm()}else tc('Tizen')&&Vm()});function Xm(b,c){try{var d=new Ym(b,c);return Promise.resolve(d)}catch(e){return Promise.reject(e)}}
function Ym(b,c){this.keySystem=b;if(b.startsWith('com.apple.fps'))for(var d=r(c),e=d.next();!e.done;e=d.next()){var f=e.value;if('required'==f.persistentState)e=null;else{e={ audioCapabilities:[],videoCapabilities:[],persistentState:'optional',distinctiveIdentifier:'optional',initDataTypes:f.initDataTypes,sessionTypes:['temporary'],label:f.label };var g=!1,h=!1;if(f.audioCapabilities)for(var k=r(f.audioCapabilities),l=k.next();!l.done;l=k.next())if(l=l.value,l.contentType){g=!0;var m=l.contentType.split(';')[0];
WebKitMediaKeys.isTypeSupported(this.keySystem,m)&&(e.audioCapabilities.push(l),h=!0)}if(f.videoCapabilities)for(f=r(f.videoCapabilities),l=f.next();!l.done;l=f.next())k=l.value,k.contentType&&(g=!0,l=k.contentType.split(';')[0],WebKitMediaKeys.isTypeSupported(this.keySystem,l)&&(e.videoCapabilities.push(k),h=!0));g||(h=WebKitMediaKeys.isTypeSupported(this.keySystem,'video/mp4'));e=h?e:null}if(e){this.a=e;return}}d=Error('Unsupported keySystem');d.name='NotSupportedError';d.code=DOMException.NOT_SUPPORTED_ERR;
throw d;}Ym.prototype.createMediaKeys=function(){var b=new Zm(this.keySystem);return Promise.resolve(b)};Ym.prototype.getConfiguration=function(){return this.a};function $m(b){var c=this.mediaKeys;c&&c!=b&&an(c,null);delete this.mediaKeys;return(this.mediaKeys=b)?an(b,this):Promise.resolve()}function Zm(b){this.b=new WebKitMediaKeys(b);this.a=new bc;this.c=null}
Zm.prototype.createSession=function(b){b=b||'temporary';if('temporary'!=b)throw new TypeError('Session type '+b+' is unsupported on this platform.');return new bn(this.b,b)};Zm.prototype.setServerCertificate=function(b){this.c=b?new Uint8Array(b):null;return Promise.resolve(!0)};
function an(b,c){cc(b.a);if(!c)return Promise.resolve();K(b.a,c,'webkitneedkey',cn);try{return 1<=c.readyState?c.webkitSetMediaKeys(b.b):ec(b.a,c,'loadedmetadata',function(){c.webkitSetMediaKeys(b.b)}),Promise.resolve()}catch(d){return Promise.reject(d)}}function bn(b){Ib.call(this);this.c=null;this.g=b;this.b=this.a=null;this.f=new bc;this.sessionId='';this.expiration=NaN;this.closed=new G;this.keyStatuses=new dn}Ra(bn,Ib);p=bn.prototype;
p.generateRequest=function(b,c){this.a=new G;try{this.c=this.g.createSession('video/mp4',new Uint8Array(c)),K(this.f,this.c,'webkitkeymessage',this.cg.bind(this)),K(this.f,this.c,'webkitkeyadded',this.ag.bind(this)),K(this.f,this.c,'webkitkeyerror',this.bg.bind(this)),en(this,'status-pending')}catch(d){this.a.reject(d)}return this.a};p.load=function(){return Promise.reject(Error('MediaKeySession.load not yet supported'))};p.update=function(b){this.b=new G;try{this.c.update(new Uint8Array(b))}catch(c){this.b.reject(c)}return this.b};
p.close=function(){try{this.c.close(),this.closed.resolve(),cc(this.f)}catch(b){this.closed.reject(b)}return this.closed};p.remove=function(){return Promise.reject(Error('MediaKeySession.remove is only applicable for persistent licenses, which are not supported on this platform'))};
function fn(b,c){function d(b){(new DataView(g.buffer)).setUint32(h,b.byteLength,!0);h+=4;g.set(b,h);h+=b.byteLength}var e=new Uint8Array(b);if((new DataView(e.buffer)).getUint32(0,!0)+4!=e.byteLength)throw Error('Malformed init data!');var f=zc(e.slice(4),!0);f=(new cb(f)).oa;f=new Uint8Array(Cc(f,!0));var g=new Uint8Array(e.byteLength+4+f.byteLength+4+c.byteLength),h=0;g.set(e,h);h+=e.byteLength;d(f);d(new Uint8Array(c));return g}
function cn(b){var c=this.mediaKeys.c,d=new Event('encrypted');d.initDataType='cenc';d.initData=fn(b.initData,c);this.dispatchEvent(d)}p.cg=function(b){this.a&&(this.a.resolve(),this.a=null);this.dispatchEvent(new I('message',{ messageType:void 0==this.keyStatuses.a?'license-request':'license-renewal',message:b.message.buffer }))};p.ag=function(){this.b&&(en(this,'usable'),this.b.resolve(),this.b=null)};
p.bg=function(){var b=Error('EME PatchedMediaKeysApple key error');b.errorCode=this.c.error;if(null!=this.a)this.a.reject(b),this.a=null;else if(null!=this.b)this.b.reject(b),this.b=null;else switch(this.c.error.code){case WebKitMediaKeyError.MEDIA_KEYERR_OUTPUT:case WebKitMediaKeyError.MEDIA_KEYERR_HARDWARECHANGE:en(this,'output-not-allowed');break;default:en(this,'internal-error')}};function en(b,c){var d=b.keyStatuses;d.size=void 0==c?0:1;d.a=c;b.dispatchEvent(new I('keystatuseschange'))}
function dn(){this.size=0;this.a=void 0}var gn;p=dn.prototype;p.forEach=function(b){this.a&&b(this.a,gn)};p.get=function(b){if(this.has(b))return this.a};p.has=function(b){var c=gn;return this.a&&Hc(new Uint8Array(b),new Uint8Array(c))?!0:!1};p.entries=function(){};p.keys=function(){};p.values=function(){};
Mm(function(){window.HTMLVideoElement&&window.WebKitMediaKeys&&(gn=(new Uint8Array([0])).buffer,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=$m,window.MediaKeys=Zm,window.MediaKeySystemAccess=Ym,navigator.requestMediaKeySystemAccess=Xm)});function hn(b){this.f=[];this.b=[];this.a=[];(new R).ca('pssh',this.c.bind(this)).parse(b.buffer)}hn.prototype.c=function(b){if(!(1<b.version)){var c=Gc(b.reader.Za(16)),d=[];if(0<b.version)for(var e=b.reader.D(),f=0;f<e;++f){var g=Gc(b.reader.Za(16));d.push(g)}e=b.reader.D();b.reader.J(e);this.b.push.apply(this.b,d);this.f.push(c);this.a.push({ start:b.start,end:b.start+b.size-1 })}};function jn(b,c){try{var d=new kn(b,c);return Promise.resolve(d)}catch(e){return Promise.reject(e)}}
function kn(b,c){this.keySystem=b;for(var d=!1,e=0;e<c.length;++e){var f=c[e],g={ audioCapabilities:[],videoCapabilities:[],persistentState:'optional',distinctiveIdentifier:'optional',initDataTypes:f.initDataTypes,sessionTypes:['temporary'],label:f.label },h=!1;if(f.audioCapabilities)for(var k=0;k<f.audioCapabilities.length;++k){var l=f.audioCapabilities[k];if(l.contentType){h=!0;var m=l.contentType.split(';')[0];MSMediaKeys.isTypeSupported(this.keySystem,m)&&(g.audioCapabilities.push(l),d=!0)}}if(f.videoCapabilities)for(k=
0;k<f.videoCapabilities.length;++k)l=f.videoCapabilities[k],l.contentType&&(h=!0,m=l.contentType.split(';')[0],MSMediaKeys.isTypeSupported(this.keySystem,m)&&(g.videoCapabilities.push(l),d=!0));h||(d=MSMediaKeys.isTypeSupported(this.keySystem,'video/mp4'));'required'==f.persistentState&&(d=!1);if(d){this.a=g;return}}d=Error('Unsupported keySystem');d.name='NotSupportedError';d.code=DOMException.NOT_SUPPORTED_ERR;throw d;}kn.prototype.createMediaKeys=function(){var b=new ln(this.keySystem);return Promise.resolve(b)};
kn.prototype.getConfiguration=function(){return this.a};function mn(b){var c=this.mediaKeys;c&&c!=b&&nn(c,null);delete this.mediaKeys;return(this.mediaKeys=b)?nn(b,this):Promise.resolve()}function ln(b){this.a=new MSMediaKeys(b);this.b=new bc}ln.prototype.createSession=function(b){b=b||'temporary';if('temporary'!=b)throw new TypeError('Session type '+b+' is unsupported on this platform.');return new on(this.a,b)};ln.prototype.setServerCertificate=function(){return Promise.resolve(!1)};
function nn(b,c){function d(){c.msSetMediaKeys(e.a);c.removeEventListener('loadedmetadata',d)}cc(b.b);if(!c)return Promise.resolve();K(b.b,c,'msneedkey',pn);var e=b;try{return 1<=c.readyState?c.msSetMediaKeys(b.a):c.addEventListener('loadedmetadata',d),Promise.resolve()}catch(f){return Promise.reject(f)}}function on(b){Ib.call(this);this.c=null;this.g=b;this.b=this.a=null;this.f=new bc;this.sessionId='';this.expiration=NaN;this.closed=new G;this.keyStatuses=new qn}Ra(on,Ib);p=on.prototype;
p.generateRequest=function(b,c){this.a=new G;try{this.c=this.g.createSession('video/mp4',new Uint8Array(c),null),K(this.f,this.c,'mskeymessage',this.qf.bind(this)),K(this.f,this.c,'mskeyadded',this.nf.bind(this)),K(this.f,this.c,'mskeyerror',this.pf.bind(this)),rn(this,'status-pending')}catch(d){this.a.reject(d)}return this.a};p.load=function(){return Promise.reject(Error('MediaKeySession.load not yet supported'))};p.update=function(b){this.b=new G;try{this.c.update(new Uint8Array(b))}catch(c){this.b.reject(c)}return this.b};
p.close=function(){try{this.c.close(),this.closed.resolve(),cc(this.f)}catch(b){this.closed.reject(b)}return this.closed};p.remove=function(){return Promise.reject(Error('MediaKeySession.remove is only applicable for persistent licenses, which are not supported on this platform'))};function pn(b){if(b.initData){var c=document.createEvent('CustomEvent');c.initCustomEvent('encrypted',!1,!1,null);c.initDataType='cenc';c.initData=sn(b.initData);this.dispatchEvent(c)}}
function sn(b){if(!b)return b;var c=new hn(b);if(1>=c.a.length)return b;for(var d=[],e=0;e<c.a.length;e++)d.push(b.subarray(c.a[e].start,c.a[e].end+1));b=[];c={};e=r(d);for(d=e.next();!d.done;c={ ec:c.ec },d=e.next())c.ec=d.value,b.some(function(b){return function(c){return Hc(c,b.ec)}}(c))||b.push(c.ec);c=0;e=r(b);for(d=e.next();!d.done;d=e.next())c+=d.value.length;c=new Uint8Array(c);e=0;b=r(b);for(d=b.next();!d.done;d=b.next())d=d.value,c.set(d,e),e+=d.length;return c}
p.qf=function(b){this.a&&(this.a.resolve(),this.a=null);this.dispatchEvent(new I('message',{ messageType:void 0==this.keyStatuses.a?'license-request':'license-renewal',message:b.message.buffer }))};p.nf=function(){this.a?(rn(this,'usable'),this.a.resolve(),this.a=null):this.b&&(rn(this,'usable'),this.b.resolve(),this.b=null)};
p.pf=function(){var b=Error('EME PatchedMediaKeysMs key error');b.errorCode=this.c.error;if(null!=this.a)this.a.reject(b),this.a=null;else if(null!=this.b)this.b.reject(b),this.b=null;else switch(this.c.error.code){case MSMediaKeyError.MS_MEDIA_KEYERR_OUTPUT:case MSMediaKeyError.MS_MEDIA_KEYERR_HARDWARECHANGE:rn(this,'output-not-allowed');break;default:rn(this,'internal-error')}};function rn(b,c){var d=b.keyStatuses;d.size=void 0==c?0:1;d.a=c;b.dispatchEvent(new I('keystatuseschange'))}
function qn(){this.size=0;this.a=void 0}var tn;p=qn.prototype;p.forEach=function(b){this.a&&b(this.a,tn)};p.get=function(b){if(this.has(b))return this.a};p.has=function(b){var c=tn;return this.a&&Hc(new Uint8Array(b),new Uint8Array(c))?!0:!1};p.entries=function(){};p.keys=function(){};p.values=function(){};
Mm(function(){!window.HTMLVideoElement||!window.MSMediaKeys||navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration||(tn=(new Uint8Array([0])).buffer,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=mn,window.MediaKeys=ln,window.MediaKeySystemAccess=kn,navigator.requestMediaKeySystemAccess=jn)});function un(){return Promise.reject(Error('The key system specified is not supported.'))}function vn(b){return null==b?Promise.resolve():Promise.reject(Error('MediaKeys not supported.'))}function wn(){throw new TypeError('Illegal constructor.');}wn.prototype.createSession=function(){};wn.prototype.setServerCertificate=function(){};function xn(){throw new TypeError('Illegal constructor.');}xn.prototype.getConfiguration=function(){};xn.prototype.createMediaKeys=function(){};
Mm(function(){!window.HTMLVideoElement||navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration||(navigator.requestMediaKeySystemAccess=un,delete HTMLMediaElement.prototype.mediaKeys,HTMLMediaElement.prototype.mediaKeys=null,HTMLMediaElement.prototype.setMediaKeys=vn,window.MediaKeys=wn,window.MediaKeySystemAccess=xn)},-10);var yn='';function zn(b){var c=yn;return c?c+b.charAt(0).toUpperCase()+b.slice(1):b}function An(b,c){try{var d=new Bn(b,c);return Promise.resolve(d)}catch(e){return Promise.reject(e)}}function Cn(b){var c=this.mediaKeys;c&&c!=b&&Dn(c,null);delete this.mediaKeys;(this.mediaKeys=b)&&Dn(b,this);return Promise.resolve()}
function Bn(b,c){this.a=this.keySystem=b;var d=!1;'org.w3.clearkey'==b&&(this.a='webkit-org.w3.clearkey',d=!1);var e=!1;var f=document.getElementsByTagName('video');f=f.length?f[0]:document.createElement('video');for(var g=0;g<c.length;++g){var h=c[g],k={ audioCapabilities:[],videoCapabilities:[],persistentState:'optional',distinctiveIdentifier:'optional',initDataTypes:h.initDataTypes,sessionTypes:['temporary'],label:h.label },l=!1;if(h.audioCapabilities)for(var m=0;m<h.audioCapabilities.length;++m){var n=
h.audioCapabilities[m];if(n.contentType){l=!0;var q=n.contentType.split(';')[0];f.canPlayType(q,this.a)&&(k.audioCapabilities.push(n),e=!0)}}if(h.videoCapabilities)for(m=0;m<h.videoCapabilities.length;++m)n=h.videoCapabilities[m],n.contentType&&(l=!0,f.canPlayType(n.contentType,this.a)&&(k.videoCapabilities.push(n),e=!0));l||(e=f.canPlayType('video/mp4',this.a)||f.canPlayType('video/webm',this.a));'required'==h.persistentState&&(d?(k.persistentState='required',k.sessionTypes=['persistent-license']):
e=!1);if(e){this.b=k;return}}d='Unsupported keySystem';if('org.w3.clearkey'==b||'com.widevine.alpha'==b)d='None of the requested configurations were supported.';d=Error(d);d.name='NotSupportedError';d.code=DOMException.NOT_SUPPORTED_ERR;throw d;}Bn.prototype.createMediaKeys=function(){var b=new En(this.a);return Promise.resolve(b)};Bn.prototype.getConfiguration=function(){return this.b};function En(b){this.g=b;this.b=null;this.a=new bc;this.c=[];this.f={}}
function Dn(b,c){b.b=c;cc(b.a);var d=yn;c&&(K(b.a,c,d+'needkey',b.vf.bind(b)),K(b.a,c,d+'keymessage',b.fg.bind(b)),K(b.a,c,d+'keyadded',b.dg.bind(b)),K(b.a,c,d+'keyerror',b.eg.bind(b)))}p=En.prototype;p.createSession=function(b){b=b||'temporary';if('temporary'!=b&&'persistent-license'!=b)throw new TypeError('Session type '+b+' is unsupported on this platform.');var c=this.b||document.createElement('video');c.src||(c.src='about:blank');b=new Fn(c,this.g,b);this.c.push(b);return b};
p.setServerCertificate=function(){return Promise.resolve(!1)};p.vf=function(b){var c=document.createEvent('CustomEvent');c.initCustomEvent('encrypted',!1,!1,null);c.initDataType='webm';c.initData=b.initData;this.b.dispatchEvent(c)};p.fg=function(b){var c=Gn(this,b.sessionId);c&&(b=new I('message',{ messageType:void 0==c.keyStatuses.a?'licenserequest':'licenserenewal',message:b.message }),c.b&&(c.b.resolve(),c.b=null),c.dispatchEvent(b))};
p.dg=function(b){if(b=Gn(this,b.sessionId))Hn(b,'usable'),b.a&&b.a.resolve(),b.a=null};p.eg=function(b){var c=Gn(this,b.sessionId);c&&c.handleError(b)};function Gn(b,c){var d=b.f[c];return d?d:(d=b.c.shift())?(d.sessionId=c,b.f[c]=d):null}function Fn(b,c,d){Ib.call(this);this.f=b;this.h=!1;this.a=this.b=null;this.c=c;this.g=d;this.sessionId='';this.expiration=NaN;this.closed=new G;this.keyStatuses=new In}Ra(Fn,Ib);p=Fn.prototype;
p.handleError=function(b){var c=Error('EME v0.1b key error');c.errorCode=b.errorCode;c.errorCode.systemCode=b.systemCode;!b.sessionId&&this.b?(c.method='generateRequest',45==b.systemCode&&(c.message='Unsupported session type.'),this.b.reject(c),this.b=null):b.sessionId&&this.a?(c.method='update',this.a.reject(c),this.a=null):(c=b.systemCode,b.errorCode.code==MediaKeyError.MEDIA_KEYERR_OUTPUT?Hn(this,'output-restricted'):1==c?Hn(this,'expired'):Hn(this,'internal-error'))};
function Jn(b,c,d){if(b.h)return Promise.reject(Error('The session is already initialized.'));b.h=!0;try{if('persistent-license'==b.g)if(d)var e=new Uint8Array(Bc('LOAD_SESSION|'+d));else{var f=Bc('PERSISTENT|'),g=new Uint8Array(f.byteLength+c.byteLength);g.set(new Uint8Array(f),0);g.set(new Uint8Array(c),f.byteLength);e=g}else e=new Uint8Array(c)}catch(k){return Promise.reject(k)}b.b=new G;var h=zn('generateKeyRequest');try{b.f[h](b.c,e)}catch(k){if('InvalidStateError'!=k.name)return b.b=null,Promise.reject(k);
(new A(function(){try{b.f[h](b.c,e)}catch(l){b.b.reject(l),b.b=null}})).P(.01)}return b.b}
p.ld=function(b,c){if(this.a)this.a.then(this.ld.bind(this,b,c))['catch'](this.ld.bind(this,b,c));else{this.a=b;if('webkit-org.w3.clearkey'==this.c){var d=xc(c);var e=JSON.parse(d);'oct'!=e.keys[0].kty&&(this.a.reject(Error('Response is not a valid JSON Web Key Set.')),this.a=null);d=Ec(e.keys[0].k);e=Ec(e.keys[0].kid)}else d=new Uint8Array(c),e=null;var f=zn('addKey');try{this.f[f](this.c,d,e,this.sessionId)}catch(g){this.a.reject(g),this.a=null}}};
function Hn(b,c){var d=b.keyStatuses;d.size=void 0==c?0:1;d.a=c;b.dispatchEvent(new I('keystatuseschange'))}p.generateRequest=function(b,c){return Jn(this,c,null)};p.load=function(b){return'persistent-license'==this.g?Jn(this,null,b):Promise.reject(Error('Not a persistent session.'))};p.update=function(b){var c=new G;this.ld(c,b);return c};
p.close=function(){if('persistent-license'!=this.g){if(!this.sessionId)return this.closed.reject(Error('The session is not callable.')),this.closed;var b=zn('cancelKeyRequest');try{this.f[b](this.c,this.sessionId)}catch(c){}}this.closed.resolve();return this.closed};p.remove=function(){return'persistent-license'!=this.g?Promise.reject(Error('Not a persistent session.')):this.close()};function In(){this.size=0;this.a=void 0}var Kn;p=In.prototype;p.forEach=function(b){this.a&&b(this.a,Kn)};p.get=function(b){if(this.has(b))return this.a};
p.has=function(b){var c=Kn;return this.a&&Hc(new Uint8Array(b),new Uint8Array(c))?!0:!1};p.entries=function(){};p.keys=function(){};p.values=function(){};
Mm(function(){if(!(!window.HTMLVideoElement||navigator.requestMediaKeySystemAccess&&MediaKeySystemAccess.prototype.getConfiguration)){if(HTMLMediaElement.prototype.webkitGenerateKeyRequest)yn='webkit';else if(!HTMLMediaElement.prototype.generateKeyRequest)return;Kn=(new Uint8Array([0])).buffer;navigator.requestMediaKeySystemAccess=An;delete HTMLMediaElement.prototype.mediaKeys;HTMLMediaElement.prototype.mediaKeys=null;HTMLMediaElement.prototype.setMediaKeys=Cn;window.MediaKeys=En;window.MediaKeySystemAccess=
Bn}});function Ln(b){b=b.target;if('picture-in-picture'==b.webkitPresentationMode){document.pictureInPictureElement=b;var c=new Event('enterpictureinpicture');b.dispatchEvent(c)}else document.pictureInPictureElement==b&&(document.pictureInPictureElement=null),c=new Event('leavepictureinpicture'),b.dispatchEvent(c)}
function Mn(){return this.webkitSupportsPresentationMode('picture-in-picture')?(this.webkitSetPresentationMode('picture-in-picture'),document.pictureInPictureElement=this,Promise.resolve()):Promise.reject(Error('PiP not allowed by video element'))}function Nn(){var b=document.pictureInPictureElement;return b?(b.webkitSetPresentationMode('inline'),document.pictureInPictureElement=null,Promise.resolve()):Promise.reject(Error('No picture in picture element found'))}
Mm(function(){if(window.HTMLVideoElement){var b=HTMLVideoElement.prototype;b.requestPictureInPicture&&document.exitPictureInPicture||!b.webkitSupportsPresentationMode||(document.pictureInPictureEnabled=!0,document.pictureInPictureElement=null,b.requestPictureInPicture=Mn,document.exitPictureInPicture=Nn,document.addEventListener('webkitpresentationmodechanged',Ln,!0))}});Mm(function(){if(window.HTMLMediaElement){var b=HTMLMediaElement.prototype.play;HTMLMediaElement.prototype.play=function(){var c=b.apply(this);c&&c['catch'](function(){});return c}}});function On(){return{ droppedVideoFrames:this.webkitDroppedFrameCount,totalVideoFrames:this.webkitDecodedFrameCount,corruptedVideoFrames:0,creationTime:NaN,totalFrameDelay:0 }}Mm(function(){if(window.HTMLVideoElement){var b=HTMLVideoElement.prototype;!b.getVideoPlaybackQuality&&'webkitDroppedFrameCount'in b&&(b.getVideoPlaybackQuality=On)}});function Pn(b,c,d){return new window.TextTrackCue(b,c,d)}function Qn(b,c,d){return new window.TextTrackCue(b+'-'+c+'-'+d,b,c,d)}Mm(function(){if(!window.VTTCue&&window.TextTrackCue){var b=TextTrackCue.length;if(3==b)window.VTTCue=Pn;else if(6==b)window.VTTCue=Qn;else{try{var c=!!Pn(1,2,'')}catch(d){c=!1}c&&(window.VTTCue=Pn)}}});function Rn(){}Rn.prototype.parseInit=function(){};
Rn.prototype.parseMedia=function(b,c){var d=xc(b),e=[],f=new DOMParser,g=null;try{g=f.parseFromString(d,'text/xml')}catch(Y){throw new C(2,2,2005);}if(g){if(g=g.getElementsByTagName('tt')[0]){var h=O.getAttributeNS(g,'http://www.w3.org/ns/ttml#parameter','frameRate');var k=O.getAttributeNS(g,'http://www.w3.org/ns/ttml#parameter','subFrameRate');var l=O.getAttributeNS(g,'http://www.w3.org/ns/ttml#parameter','frameRateMultiplier');var m=O.getAttributeNS(g,'http://www.w3.org/ns/ttml#parameter','tickRate');
d=g.getAttribute('xml:space')||'default';f=g.getAttribute('tts:extent')}else throw new C(2,2,2005);if('default'!=d&&'preserve'!=d)throw new C(2,2,2005);d='default'==d;h=new Sn(h,k,l,m);k=Tn(g.getElementsByTagName('metadata')[0]);l=Tn(g.getElementsByTagName('styling')[0]);m=Tn(g.getElementsByTagName('layout')[0]);for(var n=[],q=0;q<m.length;q++){var x=m[q],w=l,B=f;var D=new Jd;var E=x.getAttribute('xml:id');if(E){D.id=E;E=null;B&&(E=Un.exec(B)||Vn.exec(B));B=E?Number(E[1]):null;E=E?Number(E[2]):null;
var F,V;if(F=Wn(x,w,'extent'))F=(V=Un.exec(F))||Vn.exec(F),null!=F&&(D.width=null!=B?100*Number(F[1])/B:Number(F[1]),D.height=null!=E?100*Number(F[2])/E:Number(F[2]),D.widthUnits=V||null!=B?Wd:0,D.heightUnits=V||null!=E?Wd:0);if(x=Wn(x,w,'origin'))F=(V=Un.exec(x))||Vn.exec(x),null!=F&&(D.viewportAnchorX=null!=E?100*Number(F[1])/E:Number(F[1]),D.viewportAnchorY=null!=B?100*Number(F[2])/B:Number(F[2]),D.viewportAnchorUnits=V||null!=B?Wd:0)}else D=null;D&&n.push(D)}f=Tn(g.getElementsByTagName('body')[0]);
for(g=0;g<f.length;g++)(q=Xn(f[g],c.periodStart,h,k,l,m,n,d))&&e.push(q)}return e};
var Un=/^(\d{1,2}|100)% (\d{1,2}|100)%$/,Yn=/^(\d+px|\d+em)$/,Vn=/^(\d+)px (\d+)px$/,Zn=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,$n=/^(?:(\d{2,}):)?(\d{2}):(\d{2})$/,ao=/^(?:(\d{2,}):)?(\d{2}):(\d{2}\.\d{2,})$/,bo=/^(\d*(?:\.\d*)?)f$/,co=/^(\d*(?:\.\d*)?)t$/,eo=/^(?:(\d*(?:\.\d*)?)h)?(?:(\d*(?:\.\d*)?)m)?(?:(\d*(?:\.\d*)?)s)?(?:(\d*(?:\.\d*)?)ms)?$/,fo={ left:Od,center:'center',right:'end',start:Od,end:'end' },go={ left:'line-left',center:'center',right:'line-right' };
function Tn(b){var c=[];if(!b)return c;for(var d=b.childNodes,e=0;e<d.length;e++){var f='span'==d[e].nodeName&&'p'==b.nodeName;d[e].nodeType!=Node.ELEMENT_NODE||'br'==d[e].nodeName||f||(f=Tn(d[e]),c=c.concat(f))}c.length||c.push(b);return c}function ho(b,c){for(var d=b.childNodes,e=0;e<d.length;e++)if('br'==d[e].nodeName&&0<e)d[e-1].textContent+='\n';else if(0<d[e].childNodes.length)ho(d[e],c);else if(c){var f=d[e].textContent.trim();f=f.replace(/\s+/g,' ');d[e].textContent=f}}
function Xn(b,c,d,e,f,g,h,k){if(!b.hasAttribute('begin')&&!b.hasAttribute('end')&&/^\s*$/.test(b.textContent))return null;ho(b,k);k=io(b.getAttribute('begin'),d);var l=io(b.getAttribute('end'),d);d=io(b.getAttribute('dur'),d);var m=b.textContent;null==l&&null!=d&&(l=k+d);if(null==k||null==l)throw new C(2,2,2001);c=new Hd(k+c,l+c,m);if((g=jo(b,'region',g,''))&&g.getAttribute('xml:id')){var n=g.getAttribute('xml:id');h=h.filter(function(b){return b.id==n});c.region=h[0]}e=jo(b,'smpte:backgroundImage',
e,'#');ko(c,b,g,e,f);return c}
function ko(b,c,d,e,f){'rtl'==lo(c,d,f,'direction')&&(b.direction='rtl');var g=lo(c,d,f,'writingMode');'tb'==g||'tblr'==g?b.writingMode='vertical-lr':'tbrl'==g?b.writingMode='vertical-rl':'rltb'==g||'rl'==g?b.direction='rtl':g&&(b.direction=Id);if(g=lo(c,d,f,'textAlign'))b.positionAlign=go[g],b.lineAlign=fo[g],b.textAlign=Sd[g.toUpperCase()];if(g=lo(c,d,f,'displayAlign'))b.displayAlign=Td[g.toUpperCase()];if(g=lo(c,d,f,'color'))b.color=g;if(g=lo(c,d,f,'backgroundColor'))b.backgroundColor=g;if(g=lo(c,
d,f,'fontFamily'))b.fontFamily=g;(g=lo(c,d,f,'fontWeight'))&&'bold'==g&&(b.fontWeight=700);(g=lo(c,d,f,'wrapOption'))&&'noWrap'==g&&(b.wrapLine=!1);(g=lo(c,d,f,'lineHeight'))&&g.match(Yn)&&(b.lineHeight=g);(g=lo(c,d,f,'fontSize'))&&g.match(Yn)&&(b.fontSize=g);if(g=lo(c,d,f,'fontStyle'))b.fontStyle=Vd[g.toUpperCase()];if(e){g=e.getAttribute('imagetype');var h=e.getAttribute('encoding');e=e.textContent;'PNG'==g&&'Base64'==h&&e&&(b.backgroundImage='data:image/png;base64,'+e)}(d=Wn(d,f,'textDecoration'))&&
mo(b,d);(c=no(c,f,'textDecoration'))&&mo(b,c)}
function mo(b,c){for(var d=c.split(' '),e=0;e<d.length;e++)switch(d[e]){case 'underline':b.textDecoration.includes('underline')||b.textDecoration.push('underline');break;case 'noUnderline':b.textDecoration.includes('underline')&&Lb(b.textDecoration,'underline');break;case 'lineThrough':b.textDecoration.includes('lineThrough')||b.textDecoration.push('lineThrough');break;case 'noLineThrough':b.textDecoration.includes('lineThrough')&&Lb(b.textDecoration,'lineThrough');break;case 'overline':b.textDecoration.includes('overline')||
b.textDecoration.push('overline');break;case 'noOverline':b.textDecoration.includes('overline')&&Lb(b.textDecoration,'overline')}}function lo(b,c,d,e){return(b=no(b,d,e))?b:Wn(c,d,e)}function Wn(b,c,d){for(var e=Tn(b),f=0;f<e.length;f++){var g=O.getAttributeNS(e[f],'http://www.w3.org/ns/ttml#styling',d);if(g)return g}return(b=jo(b,'style',c,''))?O.getAttributeNS(b,'http://www.w3.org/ns/ttml#styling',d):null}
function no(b,c,d){return(b=jo(b,'style',c,''))?O.getAttributeNS(b,'http://www.w3.org/ns/ttml#styling',d):null}function jo(b,c,d,e){if(!b||1>d.length)return null;var f=null,g=b;for(b=null;g&&!(b=g.getAttribute(c))&&(g=g.parentNode,g instanceof Element););if(c=b)for(b=0;b<d.length;b++)if(e+d[b].getAttribute('xml:id')==c){f=d[b];break}return f}
function io(b,c){var d=null;if(Zn.test(b)){d=Zn.exec(b);var e=Number(d[1]),f=Number(d[2]),g=Number(d[3]),h=Number(d[4]);h+=(Number(d[5])||0)/c.b;g+=h/c.frameRate;d=g+60*f+3600*e}else $n.test(b)?d=oo($n,b):ao.test(b)?d=oo(ao,b):bo.test(b)?(d=bo.exec(b),d=Number(d[1])/c.frameRate):co.test(b)?(d=co.exec(b),d=Number(d[1])/c.a):eo.test(b)&&(d=oo(eo,b));return d}
function oo(b,c){var d=b.exec(c);return null==d||''==d[0]?null:(Number(d[4])||0)/1E3+(Number(d[3])||0)+60*(Number(d[2])||0)+3600*(Number(d[1])||0)}function Sn(b,c,d,e){this.frameRate=Number(b)||30;this.b=Number(c)||1;this.a=Number(e);0==this.a&&(this.a=b?this.frameRate*this.b:1);d&&(b=/^(\d+) (\d+)$/g.exec(d))&&(this.frameRate*=Number(b[1])/Number(b[2]))}Zd['application/ttml+xml']=Rn;function po(){this.a=new Rn}po.prototype.parseInit=function(b){var c=!1;(new R).G('moov',Rf).G('trak',Rf).G('mdia',Rf).G('minf',Rf).G('stbl',Rf).ca('stsd',Sf).G('stpp',function(b){c=!0;b.parser.stop()}).parse(b);if(!c)throw new C(2,2,2007);};po.prototype.parseMedia=function(b,c){var d=!1,e=[];(new R).G('mdat',Tf(function(b){d=!0;e=e.concat(this.a.parseMedia(b,c))}.bind(this))).parse(b);if(!d)throw new C(2,2,2007);return e};Zd['application/mp4; codecs="stpp"']=po;
Zd['application/mp4; codecs="stpp.TTML.im1t"']=po;function qo(){}qo.prototype.parseInit=function(){};
qo.prototype.parseMedia=function(b,c){var d=xc(b);d=d.replace(/\r\n|\r(?=[^\n]|$)/gm,'\n');d=d.split(/\n{2,}/m);if(!/^WEBVTT($|[ \t\n])/m.test(d[0]))throw new C(2,2,2E3);var e=c.segmentStart;if(null==e&&(e=0,d[0].includes('X-TIMESTAMP-MAP'))){var f=d[0].match(/LOCAL:((?:(\d{1,}):)?(\d{2}):(\d{2})\.(\d{3}))/m),g=d[0].match(/MPEGTS:(\d+)/m);if(f&&g){e=ro(new Pg(f[1]));if(null==e)throw new C(2,2,2E3);e=c.periodStart+(Number(g[1])/9E4-e)}}g=[];var h=d[0].split('\n');for(f=1;f<h.length;f++)if(/^Region:/.test(h[f])){var k=
new Pg(h[f]),l=new Jd;Sg(k);Qg(k);for(var m=Sg(k);m;){var n=l,q=m;(m=/^id=(.*)$/.exec(q))?n.id=m[1]:(m=/^width=(\d{1,2}|100)%$/.exec(q))?n.width=Number(m[1]):(m=/^lines=(\d+)$/.exec(q))?(n.height=Number(m[1]),n.heightUnits=2):(m=/^regionanchor=(\d{1,2}|100)%,(\d{1,2}|100)%$/.exec(q))?(n.regionAnchorX=Number(m[1]),n.regionAnchorY=Number(m[2])):(m=/^viewportanchor=(\d{1,2}|100)%,(\d{1,2}|100)%$/.exec(q))?(n.viewportAnchorX=Number(m[1]),n.viewportAnchorY=Number(m[2])):/^scroll=up$/.exec(q)&&(n.scroll=
'up');Qg(k);m=Sg(k)}g.push(l)}f=[];for(k=1;k<d.length;k++){h=d[k].split('\n');m=h;q=e;h=g;if(1==m.length&&!m[0]||/^NOTE($|[ \t])/.test(m[0])||'STYLE'==m[0])h=null;else{l=null;m[0].includes('--\x3e')||(l=m[0],m.splice(0,1));n=new Pg(m[0]);var x=ro(n),w=Rg(n,/[ \t]+--\x3e[ \t]+/g),B=ro(n);if(null==x||null==w||null==B)throw new C(2,2,2001);m=new Hd(x+q,B+q,m.slice(1).join('\n').trim());Qg(n);for(q=Sg(n);q;)so(m,q,h),Qg(n),q=Sg(n);null!=l&&(m.id=l);h=m}h&&f.push(h)}return f};
function so(b,c,d){var e;if(e=/^align:(start|middle|center|end|left|right)$/.exec(c))c=e[1],'middle'==c?b.textAlign=Ld:b.textAlign=Sd[c.toUpperCase()];else if(e=/^vertical:(lr|rl)$/.exec(c))b.writingMode='lr'==e[1]?'vertical-lr':'vertical-rl';else if(e=/^size:([\d.]+)%$/.exec(c))b.size=Number(e[1]);else if(e=/^position:([\d.]+)%(?:,(line-left|line-right|center|start|end))?$/.exec(c))b.position=Number(e[1]),e[2]&&(c=e[2],b.positionAlign='line-left'==c||'start'==c?'line-left':'line-right'==c||'end'==
c?'line-right':'center');else if(e=/^region:(.*)$/.exec(c)){if(c=to(d,e[1]))b.region=c}else if(d=/^line:([\d.]+)%(?:,(start|end|center))?$/.exec(c))b.lineInterpretation=1,b.line=Number(d[1]),d[2]&&(b.lineAlign=Ud[d[2].toUpperCase()]);else if(d=/^line:(-?\d+)(?:,(start|end|center))?$/.exec(c))b.lineInterpretation=Nd,b.line=Number(d[1]),d[2]&&(b.lineAlign=Ud[d[2].toUpperCase()])}function to(b,c){var d=b.filter(function(b){return b.id==c});return d.length?d[0]:null}
function ro(b){b=Rg(b,/(?:(\d{1,}):)?(\d{2}):(\d{2})\.(\d{3})/g);if(null==b)return null;var c=Number(b[2]),d=Number(b[3]);return 59<c||59<d?null:Number(b[4])/1E3+d+60*c+3600*(Number(b[1])||0)}Zd['text/vtt']=qo;Zd['text/vtt; codecs="vtt"']=qo;function uo(){this.a=null}uo.prototype.parseInit=function(b){var c=!1;(new R).G('moov',Rf).G('trak',Rf).G('mdia',Rf).ca('mdhd',function(b){0==b.version?(b.reader.J(4),b.reader.J(4),this.a=b.reader.D(),b.reader.J(4)):(b.reader.J(8),b.reader.J(8),this.a=b.reader.D(),b.reader.J(8));b.reader.J(4)}.bind(this)).G('minf',Rf).G('stbl',Rf).ca('stsd',Sf).G('wvtt',function(){c=!0}).parse(b);if(!this.a)throw new C(2,2,2008);if(!c)throw new C(2,2,2008);};
uo.prototype.parseMedia=function(b,c){var d=this;if(!this.a)throw new C(2,2,2008);var e=0,f=[],g,h=[],k=!1,l=!1,m=!1,n=null;(new R).G('moof',Rf).G('traf',Rf).ca('tfdt',function(b){k=!0;e=0==b.version?b.reader.D():b.reader.vb()}).ca('tfhd',function(b){var c=b.flags;b=b.reader;b.J(4);c&1&&b.J(8);c&2&&b.J(4);n=c&8?b.D():null}).ca('trun',function(b){l=!0;var c=b.version,d=b.flags;b=b.reader;var e=b.D();d&1&&b.J(4);d&4&&b.J(4);for(var g=[],h=0;h<e;h++){var k={ duration:null,sampleSize:null,nd:null };d&256&&
(k.duration=b.D());d&512&&(k.sampleSize=b.D());d&1024&&b.J(4);d&2048&&(k.nd=0==c?b.D():b.Yd());g.push(k)}f=g}).G('mdat',Tf(function(b){m=!0;g=b})).parse(b);if(!m&&!k&&!l)throw new C(2,2,2008);var q=e,x=new DataView(g.buffer,g.byteOffset,g.byteLength),w=new Q(x,0);f.forEach(function(b){var f=b.duration||n,g=b.nd?e+b.nd:q;q=g+(f||0);var k=0;do{var l=w.D();k+=l;var m=w.D(),x=null;'vttc'==Uf(m)?8<l&&(x=w.Za(l-8)):w.J(l-8);f&&x&&h.push(vo(x,c.periodStart+g/d.a,c.periodStart+q/d.a))}while(b.sampleSize&&
k<b.sampleSize)});return h.filter(wd.Fa)};function vo(b,c,d){var e,f,g;(new R).G('payl',Tf(function(b){e=xc(b)})).G('iden',Tf(function(b){f=xc(b)})).G('sttg',Tf(function(b){g=xc(b)})).parse(b);return e?wo(e,f,g,c,d):null}function wo(b,c,d,e,f){b=new Hd(e,f,b);c&&(b.id=c);if(d)for(c=new Pg(d),d=Sg(c);d;)so(b,d,[]),Qg(c),d=Sg(c);return b}Zd['application/mp4; codecs="wvtt"']=uo;z('shaka.util.Dom.createHTMLElement',function(b){return document.createElement(b)});z('shaka.util.Dom.createVideoElement',function(){var b=document.createElement('video');b.muted=!0;b.width=600;b.height=400;return b});z('shaka.util.Dom.asHTMLElement',function(b){return b});z('shaka.util.Dom.asHTMLMediaElement',function(b){return b});z('shaka.util.Dom.removeAllChildren',function(b){for(;b.firstChild;)b.removeChild(b.firstChild)});}).call(exportTo,innerGlobal,innerGlobal);if(typeof exports!='undefined')for(var k in exportTo.shaka)exports[k]=exportTo.shaka[k];else if(typeof define!='undefined'&&define.amd)define(function(){return exportTo.shaka});else innerGlobal.shaka=exportTo.shaka})();

